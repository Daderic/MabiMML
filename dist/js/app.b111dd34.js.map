{"version":3,"file":"js/app.b111dd34.js","mappings":"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","sources":["webpack://music-sequencer/./src/App.vue","webpack://music-sequencer/./src/components/PatternEditor.vue","webpack://music-sequencer/./src/components/PianoRoll.vue","webpack://music-sequencer/./src/components/HelpMenu.vue","webpack://music-sequencer/./src/components/HelpMenu.vue?d290","webpack://music-sequencer/./src/components/Tracks.vue","webpack://music-sequencer/./src/components/Tracks.vue?6cb4","webpack://music-sequencer/./src/components/PianoRoll.vue?b086","webpack://music-sequencer/./src/components/Sequencer.vue","webpack://music-sequencer/./src/components/PatternEditor.vue?415c","webpack://music-sequencer/./src/App.vue?7ccd","webpack://music-sequencer/./src/main.js","webpack://music-sequencer/webpack/bootstrap","webpack://music-sequencer/webpack/runtime/chunk loaded","webpack://music-sequencer/webpack/runtime/compat get default export","webpack://music-sequencer/webpack/runtime/define property getters","webpack://music-sequencer/webpack/runtime/global","webpack://music-sequencer/webpack/runtime/hasOwnProperty shorthand","webpack://music-sequencer/webpack/runtime/publicPath","webpack://music-sequencer/webpack/runtime/jsonp chunk loading","webpack://music-sequencer/webpack/startup"],"sourcesContent":["<template>\n  <img alt=\"Vue logo\" src=\"./assets/logo.png\">\n  <div id=\"app\">\n    <PatternEditor />\n  </div>\n</template>\n\n<script>\nimport PatternEditor from './components/PatternEditor.vue';\nimport PianoRoll from './components/PianoRoll.vue';\n\nexport default {\n  name: 'App',\n  components: {\n    PatternEditor\n  }\n}\n</script>\n\n<style>\n  #app {\n    font-family: Avenir, Helvetica, Arial, sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    text-align: center;\n    color: #2c3e50;\n    margin-top: 60px;\n  }\n</style>\n","<template>\r\n    <div class=\"pattern-editor\">\r\n        <div class=\"scroll-container\" ref=\"scrollContainer\">\r\n            <PianoRoll />\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from 'vue';\r\nimport PianoRoll from './PianoRoll.vue';\r\nimport Sequencer from './Sequencer.vue';\r\n\r\nexport default {\r\n    name: 'PatternEditor',\r\n    components: {\r\n        PianoRoll\r\n    },\r\n    setup() {\r\n        const scrollContainer = ref(null);\r\n\r\n        return {\r\n            scrollContainer\r\n        };\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n\r\n.pattern-editor {\r\n    height: 100%;\r\n    width: 100%;\r\n    overflow: hidden;\r\n}\r\n\r\n.scroll-container {\r\n    height: 100%;\r\n    width: 100%;\r\n    overflow: auto;\r\n    display: flex;\r\n}\r\n</style>\r\n","<template>\r\n    <div class=\"piano-container\">\r\n        <button class=\"play-button\" @click=\"playSequence\">Play Sequence</button>\r\n        <label class=\"loop-wrapper\">\r\n            Loop:\r\n            <input type=\"checkbox\" v-model=\"loopSong\"/>\r\n        </label>\r\n        <HelpMenu />\r\n        <div v-if=\"showCopyNotification\" class=\"copyNotification\">\r\n            MML copied to clipboard!\r\n        </div>\r\n        <div v-if=\"showFailedNotification\" class=\"copyNotification\" style=\"background-color: #d44;\">\r\n            {{ failedNotificationText }}\r\n        </div>\r\n        \r\n        <Tracks @track-selected=\"handleTrackSelected\" @add-track=\"handleAddTrack\" @remove-track=\"handleRemoveTrack\" @mute-track=\"handleMuteTrack\" />\r\n        <div class=\"controls\">\r\n            <div class=\"instrument-selector\">\r\n                <label for=\"instrument-select\">Select Instrument: </label>\r\n                <select id=\"instrument-select\" v-model=\"selectedInstrument\" @change=\"changeInstrument\">\r\n                    <option v-for=\"(instrument, index) in instruments\" :key=\"index\" :value=\"instrument\">\r\n                        {{ instrument.name }}\r\n                    </option>\r\n                </select>\r\n            </div>\r\n            <div class=\"tempo-selector\">\r\n                <label for=\"tempo-select\">Tempo: </label>\r\n                <input type=\"number\" id=\"tempo-select\" v-model.number=\"tempo\" min=\"40\" max=\"240\">\r\n            </div>\r\n            <button class=\"track-splitter\" @click=\"trackify\">Split Track</button>\r\n            <button class=\"MML-converter\" @click=\"genMML\">Gen MML</button>\r\n            <div class=\"grid-division-selector\">\r\n                <label for=\"grid-select\">Grid Spacing: </label>\r\n                <select id=\"grid-select\" v-model=\"gridWidth\">\r\n                    <option v-for=\"(value) in [{displayName: '16ths', width: 256/16}, {displayName: '12ths', width: 256/12}]\" :key=\"value.displayName\" :value=\"value.width\">\r\n                        {{ value.displayName }}\r\n                    </option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n        <div class=\"piano-roll\" ref=\"pianoRoll\">\r\n            <div class=\"piano-keys\">\r\n                <!-- Generate piano keys for multiple octaves -->\r\n                <div v-for=\"octave in octaves\" :key=\"octave\" class=\"octave\">\r\n                    <div class=\"keys-wrapper\">\r\n                        <!-- Keys should be in reverse order to have higher notes at the top -->\r\n                        <div v-for=\"(note, index) in notes.slice().reverse()\" :key=\"note.name\"\r\n                            :class=\"['piano-key', note.isBlack ? 'black-key' : 'white-key']\"\r\n                            @mousedown=\"startNote(0, note, octave)\"\r\n                            @mouseover=\"mouseOverNote(0, note, octave)\"\r\n                            @mouseup=\"endNote(0, note, octave)\"\r\n                            @mouseleave=\"mouseLeaveNote(0, note, octave)\"\r\n                            :style=\"note.isBlack ? { zIndex: 1 } : {}\">\r\n                            {{ note.name + octave }}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"ruler\" ref=\"ruler\" \r\n                @mousedown=\"startMarkerDrag\"\r\n                :style=\"{ width: 'calc( 10% + ' + gridSpan + 'px )' }\">\r\n                <div\r\n                    v-for=\"index in Math.ceil(gridSpan / 256)\"\r\n                    :key=\"index\"\r\n                    class=\"ruler-tick-label\"\r\n                    :style=\"{ left: `calc(${(index - 1) * 256}px)` }\"\r\n                    >\r\n                    {{ index }}\r\n                </div>\r\n                <div class=\"marker-replay-triangle\" :style=\"{ left: markerReplayPosition + 'px' }\"></div>\r\n                <div class=\"marker-wrapper\" :style=\"{ left: markerPosition + 'px' }\">\r\n                    <div class=\"marker-triangle\"></div>\r\n                    <div class=\"marker-line\"></div>\r\n                </div>\r\n            </div>\r\n            <div class=\"grid-wrapper\">\r\n                <div class=\"grid\" ref=\"grid\" :style=\"{ width: gridSpan + 'px', background: backgroundStyle.background }\" @mousedown.left=\"handleGridClick\" @contextmenu.prevent=\"startNoteRemove\">\r\n                    <div v-for=\"note in notesInGrid\" :key=\"note.id\" class=\"note\"\r\n                        :style=\"{\r\n                            left: note.left + 'px',\r\n                            top: note.top + 'px',\r\n                            width: note.width + 'px',\r\n                            height: gridHeight + 'px',\r\n                            visibility: note.muted ? 'hidden' : 'visible',\r\n                            pointerEvents: note.muted ? 'none' : 'auto',\r\n                            backgroundColor: note.color,//note.highlighted ? 'rgba(255, 0, 0, 0.5)' : 'rgba(0, 120, 255, 0.5)'\r\n                            border: `${note.highlighted ? 2 : 1}px solid ${note.highlighted ? 'white' : note.color}`\r\n                        }\"\r\n                        @mousedown.left=\"startDrag(note, $event)\"\r\n                        @mouseup.left=\"endDrag\"\r\n                        @mousedown.right.prevent=\"removeNote(note, false)\">\r\n                        <div class=\"resize-handle\" @mousedown=\"startResize(note, $event)\"></div>\r\n                        {{ note.name }} <!-- + ` ${noteWidthToMML(note.width + 1)}` -->\r\n                    </div>\r\n                    <div v-if=\"isSelecting\" class=\"selection-rect\" :style=\"rectangleStyle\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, watchEffect, computed } from 'vue';\r\nimport { Synthetizer, MIDIBuilder, writeMIDIFile, Sequencer } from \"spessasynth_lib\";\r\nimport HelpMenu from '@/components/HelpMenu.vue'\r\nimport Tracks from '@/components/Tracks.vue'\r\nimport { selectedTrack, tracks, selectedTrackIndex, trackHexColor, EventBus } from '@/components/Tracks.vue'\r\nimport { _ } from 'core-js';\r\n\r\nexport default {\r\n    name: 'PianoRoll',\r\n    components: {\r\n        HelpMenu, Tracks\r\n    },\r\n    setup() {\r\n        const root = process.env.NODE_ENV === 'production' ? '../MabiMML/' : '../';\r\n        const pianoRoll = ref(null);\r\n        const grid = ref(null);\r\n        const synth = ref(null);\r\n        const context = ref(null);\r\n        const isMouseDown = ref(false);\r\n        const selectedInstrument = ref({ name: 'Lute', program: 0 });\r\n        const midiBuilder = ref(null);\r\n        const tempo = ref(120);\r\n        const loopSong = ref(false);\r\n\r\n        // const instruments = ref([\r\n        //     { name: 'Piano', sf2: root + 'soundfonts/piano.sf2' },\r\n        //     { name: 'Harp', sf2: root + 'soundfonts/harp.sf2' },\r\n        //     { name: 'Lyre', sf2: root + 'soundfonts/lyre.sf2' },\r\n        //     { name: 'Lute', sf2: root + 'soundfonts/lute.sf2' },\r\n        //     { name: 'Ukulele', sf2: root + 'soundfonts/ukulele.sf2' },\r\n        //     { name: 'Mandolin', sf2: root + 'soundfonts/mandolin.sf2' },\r\n        //     { name: 'Electric Guitar', sf2: root + 'soundfonts/electric_guitar.sf2' },\r\n        //     { name: 'Violin', sf2: root + 'soundfonts/violin.sf2' },\r\n        //     { name: 'Cello', sf2: root + 'soundfonts/cello.sf2' },\r\n        //     { name: 'Flute', sf2: root + 'soundfonts/flute.sf2' },\r\n        //     { name: 'Whistle', sf2: root + 'soundfonts/whistle.sf2' },\r\n        //     { name: 'Chalumeau', sf2: root + 'soundfonts/chalumeau.sf2' },\r\n        //     { name: 'Roncadora', sf2: root + 'soundfonts/roncadora.sf2' },\r\n        //     { name: 'Physis Tuba', sf2: root + 'soundfonts/tuba.sf2' },\r\n        //     { name: 'Festival Lute', sf2: root + 'soundfonts/festival_lute.sf2' },\r\n        //     { name: 'Festival Ukulele', sf2: root + 'soundfonts/festival_ukulele.sf2' },\r\n        //     { name: 'Festival Mandolin', sf2: root + 'soundfonts/festival_mandolin.sf2' },\r\n        //     { name: 'Fest/Tuned Flute', sf2: root + 'soundfonts/festival_flute.sf2' },\r\n        //     { name: 'Fest/Tuned Whistle', sf2: root + 'soundfonts/festival_whistle.sf2' },\r\n        //     { name: 'Tuned Violin', sf2: root + 'soundfonts/tuned_violin.sf2' },\r\n        //     { name: 'Tuned Cello', sf2: root + 'soundfonts/tuned_cello.sf2' },\r\n        //     { name: 'Drum Kit', sf2: root + 'soundfonts/drum_kit.sf2' },\r\n        //     { name: 'Bass Drum', sf2: root + 'soundfonts/bass_drum.sf2' },\r\n        //     { name: 'Snare Drum', sf2: root + 'soundfonts/snare_drum.sf2' },\r\n        //     { name: 'Cymbals', sf2: root + 'soundfonts/cymbals.sf2' },\r\n        //     { name: 'Hand Chimes', sf2: root + 'soundfonts/hand_chimes.sf2' },\r\n        //     { name: 'Male Voice', sf2: root + 'soundfonts/male_voice.sf2' },\r\n        //     { name: 'Male Chorus', sf2: root + 'soundfonts/male_chorus.sf2' },\r\n        //     { name: 'Female Voice', sf2: root + 'soundfonts/female_voice.sf2' },\r\n        //     { name: 'Female Chorus', sf2: root + 'soundfonts/female_chorus.sf2' },\r\n        // ]);\r\n\r\n        const instruments = ref([\r\n            { name: 'Lute', program: 0 },\r\n            { name: 'Ukulele', program: 1 },\r\n            { name: 'Mandolin', program: 2 },\r\n            { name: 'Whistle', program: 3 },\r\n            { name: 'Roncadora', program: 4 },\r\n            { name: 'Flute', program: 5 },\r\n            { name: 'Chalumeau', program: 6 },\r\n            { name: 'Tuba', program: 18 },\r\n            { name: 'Lyre', program: 19 },\r\n            { name: 'Electric Guitar', program: 20 },\r\n            { name: 'Piano', program: 21 },\r\n            { name: 'Violin', program: 22 },\r\n            { name: 'Cello', program: 23 },\r\n            { name: 'Harp', program: 24 },\r\n            { name: 'Tuned Violin', program: 25 },\r\n            { name: 'Tuned Cello', program: 26 },\r\n            { name: 'Drum Kit', program: 27 },\r\n            { name: 'Festival Lute', program: 50 },\r\n            { name: 'Festival Ukulele', program: 51 },\r\n            { name: 'Festival Mandolin', program: 52 },\r\n            { name: 'Festival Whistle', program: 53 },\r\n            { name: 'Festival Flute', program: 54 },\r\n            { name: 'Bass Drum', program: 66 },\r\n            { name: 'Snare Drum', program: 67 },\r\n            { name: 'Cymbals', program: 68 },\r\n            { name: 'Hand Chimes', program: 107 },\r\n            { name: 'Female Chorus', program: 110 },\r\n            { name: 'Male Chorus', program: 111 },\r\n            { name: 'Male Voice', program: 120 },\r\n            { name: 'Female Voice', program: 121 },\r\n        ]);\r\n\r\n\r\n        let currentNoteLength = ref(16);\r\n        const gridWidth = ref(256/16); // This makes the base size an x-th note\r\n        const gridHeight = 24;\r\n        const notesInGrid = ref([]);\r\n        const draggingNotes = ref([]);\r\n        const resizingNotes = ref([]);\r\n        const startX = ref(0);\r\n        const startY = ref(0);\r\n        const startLeft = ref(0);\r\n        const startTop = ref(0);\r\n        const startWidth = ref(0);\r\n        const gridSpan = ref(window.innerWidth);\r\n\r\n        const scrollX = ref(0);\r\n\r\n        const selectedNotes = ref([]);\r\n        const isSelecting = ref(false);\r\n        const currentX = ref(0);\r\n        const currentY = ref(0);\r\n\r\n        const ruler = ref(null);\r\n        const markerPosition = ref(0);\r\n        const markerReplayPosition = ref(0);\r\n        const seq = ref(null);\r\n        const isPlaying = ref(false);\r\n\r\n        const rectangleStyle = computed(() => ({\r\n            left: `${Math.min(startX.value, currentX.value)}px`,\r\n            top: `${Math.min(startY.value, currentY.value)}px`,\r\n            width: `${Math.abs(currentX.value - startX.value)}px`,\r\n            height: `${Math.abs(currentY.value - startY.value)}px`,\r\n            backgroundColor: 'rgba(0, 100, 255, 0.3)', // Transparent blue\r\n            border: '1px solid rgba(0, 100, 255, 0.5)' // Optional border\r\n        }));\r\n\r\n        const backgroundStyle = computed(() => ({\r\n            background: `repeating-linear-gradient( /*This is the horizontal lines*/\r\n                0deg,\r\n                #bbb,\r\n                #bbb 2px,\r\n                transparent 2px,\r\n                transparent 24px\r\n            ),\r\n            repeating-linear-gradient( /*This is the Bar line*/\r\n                90deg,\r\n                #777,\r\n                #777 2px,\r\n                transparent 2px,\r\n                transparent 256px\r\n            ),\r\n            repeating-linear-gradient( /*This is the vertical lines*/\r\n                90deg,\r\n                #c0c0c0,\r\n                #c0c0c0 2px,\r\n                transparent 2px,\r\n                transparent ${gridWidth.value}px\r\n            ),\r\n            repeating-linear-gradient(/*This is the background colors*/\r\n                90deg,\r\n                #e0e0e0,\r\n                #e0e0e0 64px,\r\n                #ccc 64px,\r\n                #ccc 128px\r\n            )`\r\n        }));\r\n\r\n        // Left-hand Piano notes, not grid notes\r\n        const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\r\n        const blackNotes = ['C#', 'D#', 'F#', 'G#', 'A#'];\r\n        const notes = ref(noteNames.map((name, index) => ({\r\n            name: name,\r\n            index: index,\r\n            isBlack: blackNotes.includes(name)\r\n        })));\r\n        const octaves = ref([0, 1, 2, 3, 4, 5, 6, 7, 8]);\r\n\r\n        const showCopyNotification = ref(false);\r\n        const showFailedNotification = ref(false);\r\n        const failedNotificationText = ref('');\r\n\r\n        watchEffect(() => {\r\n            const maxRightPosition = Math.max(...notesInGrid.value.map(note => note.left + note.width), 0);\r\n            gridSpan.value = Math.max(maxRightPosition + window.innerWidth, window.innerWidth);\r\n        });\r\n        \r\n        const addTrack = (instr, color, name) => {\r\n            return EventBus.addTrack(instr, color, name);\r\n        };\r\n\r\n        const handleTrackSelected = (track) => {\r\n            //console.log(newInstrument);\r\n            selectedInstrument.value = track.instrument;\r\n            selectedTrackIndex.value = tracks.value.indexOf(track);\r\n            changeInstrument();\r\n        };\r\n\r\n        const handleAddTrack = async (newTrack, index) => {\r\n            // if (synth.value)\r\n            //     await synth.value.soundfontManager.addNewSoundFont(newTrack.instrument, `main${index}`, index);\r\n        };\r\n\r\n        const handleRemoveTrack = async (oldTrack, newTrack) => {\r\n            for (const note of oldTrack.notes) {\r\n                removeNote(note, true);\r\n            }\r\n            // if (selectedTrackIndex.value === newTrack.index)\r\n            //     selectedInstrument.value = newTrack.instrument;\r\n            // if (synth.value)\r\n            //     await synth.value.soundfontManager.deleteSoundFont(`main${index}`);\r\n        };\r\n\r\n        const handleMuteTrack = async () => {\r\n            if (isPlaying.value)\r\n                playSequence();\r\n        };\r\n\r\n        const loadSoundFont = async (instrument) => {\r\n            try {\r\n                const response = await fetch(root + 'soundfonts/mabi_instruments_high_quality.sf3');\r\n                const soundFontArrayBuffer = await response.arrayBuffer();\r\n                return soundFontArrayBuffer;\r\n            } catch (error) {\r\n                console.error(\"Failed to load SoundFont:\", error);\r\n                return null;\r\n            }\r\n        };\r\n\r\n        onMounted(async () => {\r\n            try {\r\n\r\n                const gridWrapper = document.querySelector('.grid-wrapper');\r\n                if (gridWrapper) {\r\n                    gridWrapper.addEventListener('scroll', updateRuler);\r\n                    updateRuler();\r\n                }\r\n\r\n                document.addEventListener('keydown', handleKeyPress);\r\n                context.value = new AudioContext();\r\n                await context.value.audioWorklet.addModule(root + \"worklet_processor.min.js\");\r\n                const soundFontArrayBuffer = await loadSoundFont(selectedInstrument.value);\r\n                if (!soundFontArrayBuffer) return;\r\n                synth.value = new Synthetizer(context.value.destination, soundFontArrayBuffer, true, undefined, {chorusEnabled: false, reverbEnabled: false});\r\n                await synth.value.isReady;\r\n\r\n            } catch (error) {\r\n                console.error(\"Error initializing sequencer or synthesizer:\", error);\r\n            }\r\n        });\r\n\r\n        const startMarkerDrag = (event) => {\r\n            if (isPlaying) {\r\n                stopPlaying();\r\n            }\r\n            updateMarkerPos(event.clientX, event.altKey, true);\r\n            document.addEventListener('mousemove', onMarkerDrag);\r\n            document.addEventListener('mouseup', onMarkerDragEnd);\r\n        }\r\n\r\n        const onMarkerDrag = (event) => {\r\n            updateMarkerPos(event.clientX, event.altKey, true);\r\n        }\r\n\r\n        const onMarkerDragEnd = async () => {\r\n            document.removeEventListener('mousemove', onMarkerDrag);\r\n            document.removeEventListener('mouseup', onMarkerDragEnd);\r\n        }\r\n\r\n        let markerInterval;\r\n        let markerStartPos;\r\n        let startTempo;\r\n\r\n        async function startMarkerAnim() {\r\n            isPlaying.value = true;\r\n            markerStartPos = markerPosition.value;\r\n            startTempo = tempo.value;\r\n            doMarkerAnim();\r\n        }\r\n\r\n        function doMarkerAnim() {\r\n            function tick() {\r\n                //console.log(markerPosition.value);\r\n                markerPosition.value = (seq.value.currentTime * 4 * 16 * startTempo / 60) + markerStartPos;\r\n                if (seq.value && !loopSong.value)\r\n                    seq.value.loop = loopSong.value;\r\n                //console.log(seq.value.currentTime);\r\n            }\r\n            clearInterval(markerInterval);\r\n            tick();\r\n            markerInterval = setInterval(tick, (125/2)/(tempo.value/120));\r\n        }\r\n\r\n        function noteWidthToMML(width) {\r\n            let outString = '';\r\n            //256 pixels is 1 bar (4 beats); 64 pixels is 1 beat in 4/4\r\n            let mmlWidth = width;\r\n            let noteLengths = [];\r\n            for (let i = 1; i <= 64; ++i) {\r\n              if (i < 12 || i % 12 === 0 || i % 16 === 0) {\r\n\r\n                  let val1 = Math.round(256 / i * 100);\r\n                  let val2 = Math.round(256 / i * 150);\r\n                \r\n                  noteLengths.push({\r\n                      length: val2,\r\n                      name: 'L' + i + '.'\r\n                  });\r\n                  noteLengths.push({\r\n                      length: val1,\r\n                      name: 'L' + i\r\n                  });\r\n              }\r\n            }\r\n            let result = getClosestWidth(noteLengths, mmlWidth);\r\n            outString = result.noteCombination.map(note => note.name).join('&');\r\n            return outString;\r\n        }\r\n\r\n        function getClosestWidth(notes, targetWidth) {\r\n            let amount = Math.round(targetWidth * 100);\r\n\r\n            const dp = new Array(amount + 1).fill(Infinity);\r\n            dp[0] = 0;\r\n\r\n            const usedNotes = new Array(amount + 1).fill(-1);   \r\n\r\n            for (let i = 1; i <= amount; i++) {\r\n                for (const note of notes) {\r\n                    const noteValue = note.length;\r\n                    if (i >= noteValue && dp[i - noteValue] + 1 < dp[i]) {\r\n                        dp[i] = dp[i - noteValue] + 1;\r\n                        usedNotes[i] = note;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (dp[amount] === Infinity) {\r\n                return { minNotes: null, noteCombination: []};\r\n            }\r\n\r\n            const result = []\r\n            let currentAmount = amount;\r\n            while (currentAmount > 0) {\r\n                const note = usedNotes[currentAmount];\r\n                result.push(note);\r\n                currentAmount -= note.length;\r\n            }\r\n\r\n            return { minNotes: dp[amount], noteCombination: result };\r\n\r\n        }\r\n\r\n        const stopMarkerAnim = () => {\r\n            clearInterval(markerInterval);\r\n            isPlaying.value = false;\r\n        }\r\n\r\n        const updateMarkerPos = (clientX, altKey, fromClick) => {\r\n            if (ruler.value) {\r\n                const rulerRect = ruler.value.getBoundingClientRect();\r\n                let newPos = clientX - rulerRect.left;\r\n\r\n                if (!altKey) {\r\n                    newPos = Math.round(newPos / gridWidth.value) * gridWidth.value;\r\n                }\r\n\r\n                newPos = Math.max(0, Math.min(gridSpan.value, newPos));\r\n\r\n                markerPosition.value = newPos;\r\n                if (fromClick) {\r\n                    markerReplayPosition.value = newPos;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        function handleKeyPress(event) {\r\n            if (event.key === 'Backspace' || event.key === 'Delete') {\r\n                for (const note of selectedNotes.value) {\r\n                    removeNote(note, true);\r\n                }\r\n                \r\n                if (isPlaying.value)\r\n                    playSequence();\r\n            }\r\n            if (event.code === 'Space') {\r\n                event.preventDefault();\r\n                if (isPlaying.value) {\r\n                    stopPlaying();\r\n                    if (!event.ctrlKey) {\r\n                        markerPosition.value = markerReplayPosition.value;\r\n                    }\r\n                } else {\r\n                    playSequence();\r\n                }\r\n            } else if (event.key === 'a' && event.ctrlKey && !selectedTrack.value.isEditingName) {\r\n                event.preventDefault();\r\n                for (const note of notesInGrid.value) {\r\n                    selectNote(note);\r\n                }\r\n            }\r\n        }\r\n\r\n        function updateRuler() {\r\n            const gridWrapper = document.querySelector('.grid-wrapper');\r\n            const ruler = document.querySelector('.ruler');\r\n            if (gridWrapper && ruler) {\r\n                scrollX.value = gridWrapper.scrollLeft;\r\n                ruler.style.left = -scrollX.value + 'px'; // Adjust ruler's left position\r\n            }\r\n        }\r\n\r\n        function stopPlaying() {\r\n            if (seq.value)\r\n                seq.value.stop();\r\n            stopMarkerAnim();\r\n            synth.value.programChange(0, selectedInstrument.value.program);\r\n        }\r\n\r\n        const playSequence = async (fromClick = null) => {\r\n            try {\r\n                if (fromClick && isPlaying.value) {\r\n                    stopPlaying();\r\n                    markerPosition.value = markerReplayPosition.value;\r\n                    return;\r\n                }\r\n                midiBuilder.value = new MIDIBuilder(\"untitled\", 480, tempo.value);\r\n                //midiBuilder.value.addEvent(0, 0, 0xC0, [selectedInstrument.value.program]);\r\n                \r\n                await context.value.resume();\r\n                if (!synth.value) return;\r\n\r\n                let notesAdded = 0;\r\n\r\n                let audibleTracks = [];\r\n\r\n                for (const track of tracks.value) {\r\n                    if (!track.isMuted) {\r\n                        audibleTracks.push(track);\r\n                        midiBuilder.value.addNewTrack(track.name + tracks.value.indexOf(track));\r\n                    }\r\n                }\r\n\r\n                notesInGrid.value.forEach(note => {\r\n                    if (!note.muted && note.left + note.width >= markerPosition.value) {\r\n\r\n                        // Code to get the note's parent track\r\n                        let containingTrack = null;\r\n                        for (const track of tracks.value) {\r\n                            if (track.notes.some(n => n.id === note.id)) {\r\n                                containingTrack = track;\r\n                            }\r\n                        }\r\n                        const trackIndex = audibleTracks.indexOf(containingTrack);\r\n                        const channel = trackIndex;//trackIndex;\r\n                        const pitch = note.pitch;\r\n                        // Conversion from pixels to time.\r\n                        const noteStartTime = note.left/16*120;\r\n                        const noteDuration = (note.width+1)/16*120;\r\n                        const markerTime = markerPosition.value/16*120;\r\n                        const startTime = Math.max(noteStartTime, markerTime)-markerTime;\r\n                        const duration = Math.min(noteDuration, noteStartTime+noteDuration-markerTime);\r\n                        const volume = Math.max(0, Math.min(127, (note.volume + 1) * 8 - 1));\r\n\r\n                        \r\n\r\n                        midiBuilder.value.addEvent(startTime, trackIndex, 0xC0 | (channel & 0x0F), [containingTrack.instrument.program]);\r\n                        midiBuilder.value.addNoteOn(startTime, trackIndex, channel, pitch, volume);\r\n                        midiBuilder.value.addNoteOff(startTime + duration, trackIndex, channel, pitch);\r\n                        notesAdded++;\r\n                    }\r\n                });\r\n\r\n                if (notesAdded === 0) {\r\n                    return;\r\n                }\r\n\r\n                midiBuilder.value.flush();\r\n\r\n                const b = await(writeMIDIFile(midiBuilder.value));\r\n                seq.value = new Sequencer([{binary: b}], synth.value);\r\n                seq.value.loop = loopSong.value && markerPosition.value === 0;\r\n                await synth.value.isReady;\r\n                seq.value.skipToFirstNoteOn = false;\r\n                seq.value.addOnSongEndedEvent(() => {\r\n                    stopMarkerAnim();\r\n                    markerPosition.value = markerReplayPosition.value;\r\n                    if (loopSong.value && !seq.value.loop) {\r\n                        markerPosition.value = 0;\r\n                        playSequence();\r\n                    }\r\n                }, 'test2');\r\n                await seq.value.play();\r\n                startMarkerAnim();\r\n            } catch (error) {\r\n                console.error(\"Error playing sequence: \", error);\r\n            }\r\n        };\r\n\r\n        const startNote = async (channel, note, octave) => {\r\n            try {\r\n                context.value.resume();\r\n                await synth.value.isReady;\r\n                synth.value.noteOn(channel, note.index + 12 * (octave + 1), 127, false);\r\n            } catch (error) {\r\n                console.error(error);\r\n            }\r\n        };\r\n\r\n        const endNote = async (channel, note, octave) => {\r\n            try {\r\n                await synth.value.isReady;\r\n                if (synth.value) {\r\n                    synth.value.noteOff(channel, note.index + 12 * (octave + 1));\r\n                }\r\n            } catch (error) {\r\n                console.error(error);\r\n            }\r\n        };\r\n\r\n        const mouseOverNote = (channel, note, octave) => {\r\n            if (isMouseDown.value && draggingNotes.value.length === 0 && resizingNotes.value.length === 0) {\r\n                startNote(channel, note, octave);\r\n            }\r\n        };\r\n\r\n        const mouseLeaveNote = (channel, note, octave) => {\r\n            if (isMouseDown.value && draggingNotes.value.length === 0 && resizingNotes.value.length === 0) {\r\n                endNote(channel, note, octave);\r\n            }\r\n        };\r\n\r\n        const changeInstrument = async () => {\r\n            if (synth.value && selectedInstrument.value) {\r\n                selectedTrack.value.instrument = selectedInstrument.value;\r\n                //const soundFontArrayBuffer = await loadSoundFont(tracks.value[0].instrument);\r\n\r\n                //if (!soundFontArrayBuffer) return;\r\n\r\n                //context.value = new AudioContext();\r\n                //await context.value.audioWorklet.addModule(\"../worklet_processor.min.js\");\r\n\r\n                //synth.value = new Synthetizer(context.value.destination, soundFontArrayBuffer, true, undefined, {chorusEnabled: false, reverbEnabled: false});\r\n                // synth.value = new Synthetizer(context.value.destination, soundFontArrayBuffer, true, undefined, {chorusEnabled: false, reverbEnabled: false});\r\n                // await synth.value.isReady;\r\n                // for (let i = 1; i < tracks.value.length; ++i) {\r\n                //     //synth.value.soundfontManager.deleteSoundFont(`main${i}`);\r\n                //     const newSoundFont = await loadSoundFont(tracks.value[i].instrument);\r\n                //     await synth.value.soundfontManager.addNewSoundFont(newSoundFont, `main${i}`, 0);\r\n                // }\r\n                // console.log(synth.value.soundfontManager.soundfontList);\r\n                // console.log(synth.value);\r\n                // console.log(selectedInstrument.value.name);\r\n                synth.value.programChange(0, selectedInstrument.value.program);\r\n                if (isPlaying.value)\r\n                    playSequence();\r\n\r\n                await synth.value.isReady;\r\n            }\r\n        };\r\n\r\n        const startPositions = new Map();\r\n\r\n        const startDrag = (note, event, placeNote = true) => {\r\n            // console.log(note.id);\r\n            event.preventDefault();\r\n            if (event.button === 0 && resizingNotes.value.length === 0) { // Ensure we're dragging with left button\r\n                if (note.highlighted) {\r\n                    draggingNotes.value = selectedNotes.value;\r\n                } else {\r\n                    clearSelection();\r\n                    draggingNotes.value.push(note);\r\n                }\r\n\r\n                if (event.shiftKey && placeNote) {\r\n                    for (const note of draggingNotes.value) {\r\n                        const newNote = {\r\n                            id: notesInGrid.value.length + Date.now(),\r\n                            name: note.name,\r\n                            left: note.left,\r\n                            top: note.top,\r\n                            pitch: note.pitch,\r\n                            width: note.width,\r\n                            length: note.length,\r\n                            highlighted: false,\r\n                            color: note.color,\r\n                            start: note.start,\r\n                            end: note.end,\r\n                            volume: 15,\r\n                            muted: false,\r\n                            track: note.track\r\n                        };\r\n                        notesInGrid.value.push(newNote);\r\n                        newNote.track.notes.unshift(newNote);\r\n                    }\r\n                }\r\n\r\n                for (const draggingNote of draggingNotes.value) {\r\n                    startPositions.set(draggingNote.id, {\r\n                        x: event.clientX,\r\n                        y: event.clientY,\r\n                        left: draggingNote.left,\r\n                        top: draggingNote.top\r\n                    });\r\n                }\r\n\r\n                currentNoteLength.value = note.length;\r\n                selectedTrackIndex.value = tracks.value.indexOf(note.track);\r\n                trackHexColor.value = note.track.color;\r\n                document.addEventListener('mousemove', onDrag);\r\n                document.addEventListener('mouseup', endDrag);\r\n            }\r\n        };\r\n\r\n        const onDrag = (event) => {\r\n            if (draggingNotes.value && resizingNotes.value.length === 0) {\r\n\r\n                let outOfBounds = false;\r\n                const newPositions = [];\r\n\r\n                for (const note of draggingNotes.value) {\r\n\r\n                    const startPos = startPositions.get(note.id);\r\n                    if (!startPos) continue;\r\n\r\n                    const dx = event.clientX - startPos.x;\r\n                    const dy = event.clientY - startPos.y;\r\n\r\n                    let newLeft = 0;\r\n\r\n                    if (event.altKey || (note.highlighted && (note.width+1) % gridWidth.value !== 0)) {\r\n                        newLeft = Math.round((startPos.left + dx) / (gridWidth.value / 4)) * (gridWidth.value / 4);\r\n                    } else {\r\n                        newLeft = Math.round((startPos.left + dx) / gridWidth.value) * gridWidth.value;\r\n                    }\r\n                    let newTop = Math.round((startPos.top + dy) / gridHeight) * gridHeight;\r\n                    \r\n                    if (newLeft < 0 || newTop < 0 || newTop > 2568) {\r\n                        outOfBounds = true;\r\n                        break; // Exit loop if any note is out of bounds\r\n                    }\r\n\r\n                    newPositions.push({ note, newLeft, newTop });\r\n\r\n                }\r\n\r\n                if (outOfBounds) return;\r\n\r\n                for (const { note, newLeft, newTop } of newPositions) {\r\n\r\n                    note.left = newLeft;\r\n                    note.top = newTop;\r\n\r\n                    const number = (1284-(note.top/2))/144;\r\n                    const noteName = noteNames[number * 12 % 12] + \"\" + Math.floor(number);\r\n                    if (note.name != noteName && draggingNotes.value.length === 1) {\r\n                        startNote(0, {name: noteName, index: number * 12 % 12}, Math.floor(number))\r\n                        endNote(0, {name: noteName, index: number * 12 % 12}, Math.floor(number))\r\n                    }\r\n                    note.name = noteName;\r\n                    note.pitch = number * 12 % 12 + 12 * (Math.floor(number) + 1);\r\n                    \r\n                }\r\n            }\r\n        };\r\n\r\n        const endDrag = () => {\r\n            if (isPlaying.value)\r\n                playSequence();\r\n            draggingNotes.value = [];\r\n            document.removeEventListener('mousemove', onDrag);\r\n            document.removeEventListener('mouseup', endDrag);\r\n            startPositions.clear();\r\n        };\r\n\r\n        const startResizeData = new Map();\r\n\r\n        const startResize = (note, event) => {\r\n            event.preventDefault();\r\n            if (event.button === 0) { // Ensure we're resizing with the left button\r\n                resizingNotes.value = [];\r\n                startX.value = event.clientX;\r\n                startResizeData.clear(); // Clear previous data\r\n\r\n                if (note.highlighted) {\r\n                    // If note is highlighted, prepare to resize all selected notes\r\n                    selectedNotes.value.forEach(n => {\r\n                        startResizeData.set(n.id, { width: n.width, startX: event.clientX });\r\n                    });\r\n                    resizingNotes.value = selectedNotes.value;\r\n                } else {\r\n                    // If note is not highlighted, resize only this note\r\n                    clearSelection();\r\n                    startResizeData.set(note.id, { width: note.width, startX: event.clientX });\r\n                    resizingNotes.value = [note];\r\n                }\r\n                \r\n                document.addEventListener('mousemove', onResize);\r\n                document.addEventListener('mouseup', endResize);\r\n            }\r\n        };\r\n\r\n        const onResize = (event) => {\r\n            if (resizingNotes.value.length > 0) {\r\n                let allInBounds = true;\r\n\r\n                const newWidths = [];\r\n\r\n                resizingNotes.value.forEach(note => {\r\n                    const startData = startResizeData.get(note.id);\r\n                    if (!startData) return;\r\n\r\n                    const dx = event.clientX - startData.startX;\r\n                    let newWidth = 0;\r\n                    if (event.altKey) {\r\n                        newWidth = Math.round((startData.width + dx) / (gridWidth.value/4)) * gridWidth.value / 4 - 1;\r\n                    } else {\r\n                        newWidth = Math.round((startData.width + dx) / gridWidth.value) * gridWidth.value - 1;\r\n                    }\r\n\r\n                    // Check if newWidth is valid for the note\r\n                    if (newWidth < gridWidth.value - 1 && !event.altKey || newWidth < 3) {\r\n                        allInBounds = false;\r\n                        return;\r\n                    }\r\n\r\n                    newWidths.push({ note, newWidth })\r\n\r\n                });\r\n\r\n                // If any note was resized to an invalid width, stop resizing\r\n                if (allInBounds) {\r\n                    for (const { note, newWidth } of newWidths) {\r\n                        note.width = newWidth;\r\n                        note.length = (newWidth + 1) / gridWidth.value;\r\n                        currentNoteLength.value = note.length;\r\n                    };\r\n                }\r\n            }\r\n        };\r\n\r\n        const endResize = () => {\r\n            resizingNotes.value = [];\r\n            startResizeData.clear();\r\n            document.removeEventListener('mousemove', onResize);\r\n            document.removeEventListener('mouseup', endResize);\r\n        }\r\n\r\n        const handleGridClick = (event) => {\r\n            if (event.ctrlKey && draggingNotes.value.length <= 0) {\r\n                if (!event.shiftKey)\r\n                    clearSelection();\r\n                startSelection(event);\r\n            } else {\r\n                startPlacingNote(event);\r\n            }\r\n        }\r\n\r\n        function clearSelection() {\r\n            selectedNotes.value.forEach((note) => {\r\n                note.highlighted = false;\r\n            });\r\n            selectedNotes.value = [];\r\n        }\r\n\r\n        const startSelection = (event) => {\r\n            event.preventDefault();\r\n            isSelecting.value = true;\r\n            const rect = grid.value.getBoundingClientRect();\r\n            startX.value = event.clientX - rect.left;\r\n            startY.value = event.clientY - rect.top;\r\n            currentX.value = event.clientX - rect.left;\r\n            currentY.value = event.clientY - rect.top;\r\n            document.addEventListener('mousemove', onSelectionMove);\r\n            document.addEventListener('mouseup', onSelectionEnd);\r\n        };\r\n\r\n        const onSelectionMove = (event) => {\r\n            if (isSelecting.value) {\r\n                const rect = grid.value.getBoundingClientRect();\r\n                currentX.value = event.clientX - rect.left;\r\n                currentY.value = event.clientY - rect.top;\r\n                // This is where we add the logic to highlight the notes that might be selected (or we can select them I dont really care)\r\n            }\r\n        };\r\n\r\n        const onSelectionEnd = () => {\r\n            if (isSelecting.value) {\r\n                isSelecting.value = false;\r\n                document.removeEventListener('mousemove', onSelectionMove);\r\n                document.removeEventListener('mouseup', onSelectionEnd);\r\n                // This is where we add the logic to actually select the notes\r\n                checkIntersections();\r\n            }\r\n        };\r\n\r\n        function checkIntersections() {\r\n            const selectionRect = {\r\n                left: Math.min(startX.value, currentX.value),\r\n                top: Math.min(startY.value, currentY.value),\r\n                right: Math.max(startX.value, currentX.value),\r\n                bottom: Math.max(startY.value, currentY.value),\r\n            };\r\n\r\n            notesInGrid.value.forEach(note => {\r\n                const itemRect = {\r\n                    left: note.left,\r\n                    top: note.top,\r\n                    right: note.left + note.width,\r\n                    bottom: note.top + gridHeight,\r\n                };   \r\n\r\n                if (intersects(selectionRect, itemRect)) {\r\n                    //console.log(note.name + ' intersects with selection.');\r\n                    selectNote(note);\r\n                }\r\n            });\r\n\r\n        };\r\n\r\n        function selectNote(note) {\r\n            if (!selectedNotes.value.includes(note) && !note.muted) {\r\n                selectedNotes.value.push(note);\r\n                note.highlighted = true;\r\n            }\r\n        }\r\n\r\n        function intersects(rect1, rect2) {\r\n            return !(rect2.left >= rect1.right ||\r\n                    rect2.right <= rect1.left ||\r\n                    rect2.top >= rect1.bottom ||\r\n                    rect2.bottom <= rect1.top);\r\n        }\r\n\r\n\r\n        const startPlacingNote = (event) => {\r\n            if (draggingNotes.value.length > 0 || resizingNotes.value.length > 0) {\r\n                return;\r\n            }\r\n\r\n            const gridElement = grid.value;\r\n            const rect = gridElement.getBoundingClientRect();\r\n            const x = event.clientX - rect.left + gridElement.scrollLeft;\r\n            const y = event.clientY - rect.top + gridElement.scrollTop;\r\n\r\n            const left = Math.round((x - gridWidth.value / 2) / gridWidth.value) * gridWidth.value;\r\n            const top = Math.round((y - gridHeight / 2) / gridHeight) * gridHeight;\r\n\r\n            const number = (1284-(top/2))/144;\r\n            const noteName = noteNames[number * 12 % 12] + \"\" + Math.floor(number);\r\n            startNote(0, {name: noteName, index: number * 12 % 12}, Math.floor(number));\r\n            endNote(0, {name: noteName, index: number * 12 % 12}, Math.floor(number));\r\n\r\n            const existingNote = notesInGrid.value.find(note =>\r\n                note.left === left && note.top === top && !note.muted\r\n            );\r\n\r\n            if (!existingNote) {\r\n                clearSelection();\r\n                const id = notesInGrid.value.length + Date.now();\r\n                const newNote = {\r\n                    left: left,\r\n                    top: top,\r\n                    width: gridWidth.value * currentNoteLength.value - 1,\r\n                    highlighted: false,\r\n                    color: selectedTrack.value ? selectedTrack.value.color : 'hsla(212, 100%, 50%, 0.5)',\r\n                    id: id,\r\n                    name: noteName,\r\n                    pitch: number * 12 % 12 + 12 * (Math.floor(number) + 1),\r\n                    length: currentNoteLength.value,\r\n                    start: left / gridWidth.value,\r\n                    end: left / gridWidth.value + currentNoteLength.value,\r\n                    volume: 15,\r\n                    track: selectedTrack.value\r\n                };\r\n                notesInGrid.value.push(newNote);\r\n                selectedTrack.value.notes.unshift(newNote);\r\n                startDrag(notesInGrid.value.find(note => note.id == id), event, false);\r\n            } else {\r\n                startDrag(existingNote, event);\r\n            }\r\n        };\r\n\r\n        //let trackWrappers = [];\r\n\r\n        const trackify = () => {\r\n            let notesList = [...selectedTrack.value.notes].sort((a, b) => {\r\n                if (a.left === b.left) {\r\n                    return a.top - b.top;\r\n                }\r\n                return a.left - b.left;\r\n            });\r\n            //let trackWrappers = [];\r\n            // for (let i = 0; i < tracks.value.length; ++i) {   \r\n            //     trackWrappers.push({\r\n            //         notes: [],\r\n            //         track: tracks.value[i]\r\n            //     });\r\n            // }\r\n\r\n            // Idea: Take the selected track and split it into more tracks.\r\n            // This involves adding new tracks (only if allowed, otherwise cancel the operation)\r\n            // if (tracks.value.length < 16)\r\n            //     addTrack();\r\n            // Then, put the proper notes into the proper tracks.\r\n\r\n            // For all notes in the selected track\r\n            // starting with selected track:\r\n            // if note can go into this track, then add it\r\n            // otherwise, add a new track, and put the note in there.\r\n\r\n            // after all notes are situated, loop through all tracks in the wrapper and set their notes equal to the new note lists\r\n\r\n            let trackWrappers = [];\r\n            trackWrappers.push({\r\n                notes: [],\r\n                track: selectedTrack.value,\r\n                index: 0\r\n            });\r\n\r\n            for (const note of notesList) {\r\n                console.log(note.id);\r\n                for (const trackWrapper of trackWrappers) {\r\n                    if (!trackWrapper.notes[0] || trackWrapper.notes[0].left + trackWrapper.notes[0].width < note.left) {\r\n                        trackWrapper.notes.unshift(note);\r\n                        break;\r\n                    } else {\r\n                        if (trackWrapper.index === trackWrappers.length - 1) {\r\n                            trackWrappers.push({\r\n                                notes: [],\r\n                                track: {instrument: trackWrapper.track.instrument, color: null, name: selectedTrack.value.name + ` (${trackWrappers.length})`},\r\n                                index: trackWrappers.length\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (tracks.value.length + trackWrappers.length - 1 > 16) {\r\n                showFailedNotification.value = true;\r\n                failedNotificationText.value = 'Failed to split track! (Process would create too many tracks!)';\r\n                setTimeout(() => {\r\n                    showFailedNotification.value = false;\r\n                }, 2000);\r\n                return;\r\n            }\r\n\r\n            for (const trackWrapper of trackWrappers) {\r\n                if (!tracks.value.includes(trackWrapper.track)) {\r\n                    trackWrapper.track = addTrack(trackWrapper.track.instrument, trackWrapper.track.color, trackWrapper.track.name);\r\n                }\r\n                trackWrapper.track.notes = trackWrapper.notes;\r\n                for (const note of trackWrapper.track.notes) {\r\n                    note.track = trackWrapper.track;\r\n                    note.color = trackWrapper.track.color;\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        function copyToClipboard(text) {\r\n            navigator.clipboard.writeText(text).then(() => {\r\n                    showCopyNotification.value = true; // Show notification\r\n\r\n                    // Hide notification after 2 seconds\r\n                    setTimeout(() => {\r\n                        showCopyNotification.value = false;\r\n                    }, 2000);\r\n                }).catch(err => {\r\n                    console.error('Could not copy text: ', err);\r\n                });\r\n        }\r\n\r\n        const genMML = () => {\r\n            let outString = ''\r\n            // console.log(tracks.value.length, tracks.value);\r\n            if (0 <= tracks.value.length && tracks.value.length <= 4) {\r\n                tracks.value.sort((a, b) => a.length > b.length);\r\n                for (const track of tracks.value) {\r\n                    let prevNoteEnd = 0;\r\n                    for (const note of track.notes.slice().reverse()) {\r\n                        if (note.left > prevNoteEnd + 4) {\r\n                            // console.log('Adding Rest...', note.left, prevNoteEnd + 4);\r\n                            let gap = note.left - prevNoteEnd;\r\n                            let restStr = noteWidthToMML(gap);\r\n                            restStr = restStr.replaceAll('L', 'R');\r\n                            outString += restStr;\r\n                        }\r\n                        let noteStr = noteWidthToMML(note.width + 1);\r\n                        if (noteStr.includes('&')) {\r\n                            let k = noteStr.split('&');\r\n                            for (let i = 0; i < k.length; ++i) {\r\n                                outString += k[i] + 'N' + (note.pitch - 12) + (i === k.length - 1 ? '' : '&');\r\n                            }\r\n                        } else {\r\n                            outString += noteWidthToMML(note.width + 1) + 'N' + (note.pitch-12);\r\n                        }\r\n                        prevNoteEnd = note.left + note.width + 1;\r\n                    }\r\n                    outString += ',';\r\n                }\r\n            } else {\r\n                console.log(\"Could Not Gen MML\");\r\n                showFailedNotification.value = true;\r\n                failedNotificationText.value = 'Failed to copy MML to clipboard! Too many tracks visible!';\r\n                setTimeout(() => {\r\n                    showFailedNotification.value = false;\r\n                }, 2000);\r\n                return null;\r\n            }\r\n            outString = outString.slice(0, -1);\r\n            // Now we condense the output;\r\n            let outTracks = outString.split(',');\r\n            let newTracks = [];\r\n            for (const track of outTracks) {\r\n                let tokens = tokenizeMML(track);\r\n                let simplifiedTokens = simplifyMML(tokens);\r\n                let simplifiedMML = stringifyMML(simplifiedTokens);\r\n                newTracks.push(simplifiedMML);\r\n            }\r\n\r\n            outString = `MML@V15${newTracks.join(',V15')};`;\r\n\r\n            // Log output to console and copy it to the clipboard\r\n            console.log(outString);\r\n            copyToClipboard(outString);\r\n        };\r\n\r\n        const patterns = {\r\n            LENGTH: /L(\\d+)\\.?/g,  // Matches note lengths, e.g., L4, L8.\r\n            NOTE: /[A-G][-+#]?\\d*\\.?|N\\d+/g,         // Matches notes like N60, N62.\r\n            REST: /R\\d+\\.?/g,      // Matches rests like R4, R8.\r\n            TIE: /&/g,              // Matches ties.\r\n            OCTAVE: /O(\\d+)|[<>]/g\r\n        };\r\n\r\n        function tokenizeMML(mmlString) {\r\n            let tokens = [];\r\n            \r\n            // Run regex patterns over the input\r\n            for (const [key, regex] of Object.entries(patterns)) {\r\n                let match;\r\n                while ((match = regex.exec(mmlString)) !== null) {\r\n                    tokens.push({ type: key, value: match[0], index: match.index });\r\n                }\r\n            }\r\n\r\n            // Sort tokens by their original index in the string\r\n            tokens.sort((a, b) => a.index - b.index);\r\n\r\n            return tokens;\r\n        }\r\n\r\n        function simplifyMML(tokenList) {\r\n            // This is NOT optimal, but it is quite good.\r\n            let newTokenList = JSON.parse(JSON.stringify(tokenList));\r\n            let totalPasses = 2;\r\n            \r\n            for (let pass = 0; pass < totalPasses; ++pass) {\r\n                let octave = 4;\r\n                let length = '4';\r\n                let tempo = 120;\r\n                let volume = 8;\r\n            \r\n                for (let i = 0; i < newTokenList.length; ++i) {\r\n                    let token = newTokenList[i];\r\n                    if (token.type === 'LENGTH') {\r\n                        let tokenLength = token.value.split('L')[1];\r\n                        if (tokenLength !== length) {\r\n                            length = tokenLength;\r\n                        } else {\r\n                            newTokenList.splice(i, 1);\r\n                            i--;\r\n                        }\r\n                    } else if (token.type === 'REST') {\r\n                        let restLength = token.value.split('R')[1];\r\n                        if (restLength === length) {\r\n                            token.value = 'R';\r\n                        }\r\n                    } else if (token.type === 'NOTE') {\r\n                        if (!token.value.includes('N'))\r\n                            continue;\r\n                        let notePitch = Number(token.value.split('N')[1]);\r\n                        let noteOctave = Math.floor(notePitch/12);\r\n                        let keys = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\r\n                        let noteKey = keys[notePitch - 12*noteOctave];\r\n                        if (noteOctave !== octave) {\r\n                            let diff = noteOctave - octave;  // Positive diff means noteOctave is higher.\r\n                            let octaveChanges = [];\r\n\r\n                            if (Math.abs(diff) < 3) {\r\n                                // Insert `>` or `<` for smaller octave differences.\r\n                                let symbol = diff > 0 ? '>' : '<';\r\n                                for (let j = 0; j < Math.abs(diff); ++j) {\r\n                                    octaveChanges.push({ type: 'OCTAVE', value: symbol, index: token.index+j });\r\n                                }\r\n                            } else {\r\n                                // Use absolute octave changes for larger octave differences.\r\n                                octaveChanges = [{ type: 'OCTAVE', value: 'O' + noteOctave, index: token.index }];\r\n                            }\r\n                            // console.log(octaveChanges);\r\n                            // Now splice in the octave changes and the note key.\r\n                            newTokenList.splice(i, 1, ...octaveChanges, { type: 'NOTE', value: noteKey, index: token.index + octaveChanges.length });\r\n\r\n                            octave = noteOctave; // Update current octave to the new one.\r\n                        } else {\r\n                            // No octave change, just update the note value.\r\n                            token.value = noteKey;\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                // Now we simplify lengths\r\n                let lengthIndex = 0;\r\n                for (let i = 0; i < newTokenList.length; ++i) {\r\n                    let token = newTokenList[i];\r\n                    let prevToken = i > 0 ? newTokenList[i-1] : null;\r\n                    if (token.type === 'LENGTH') {\r\n                        // Count until we hit the next length token or the end of the list.\r\n                        let noteCount = 0;\r\n                        let noteIndexes = [];\r\n                        for (let j = i+1; j < newTokenList.length; ++j) {\r\n                            let token2 = newTokenList[j];\r\n                            // if note/rest has no postfix number, then we add it to the count\r\n                            if ((token2.type === 'NOTE' || token2.type === 'REST') && token2.value.replace(/[A-GRN][#]?/g, '') === '') {\r\n                                noteCount++;\r\n                                noteIndexes.push(j);\r\n                            } else if (token2.type === 'LENGTH') {\r\n                                break;\r\n                            }\r\n                        }\r\n                        \r\n                        if ((prevToken && prevToken.type === 'TIE') || noteCount * token.value.length <= token.value.length + noteCount) {\r\n                            // remove this length tag and put the length on the notes\r\n                            // console.log(noteCount);\r\n                            for (const noteIndex of noteIndexes) {\r\n                                newTokenList[noteIndex].value = newTokenList[noteIndex].value + token.value.split('L')[1];\r\n                            } \r\n                            newTokenList.splice(i, 1);\r\n                        }\r\n                        \r\n                    }\r\n                }\r\n            }\r\n            \r\n            return newTokenList;\r\n        }\r\n\r\n        function stringifyMML(tokens) {\r\n            let outStr = '';\r\n            for (const token of tokens) {\r\n                outStr += token.value;\r\n            }\r\n            return outStr;\r\n        }\r\n\r\n        const removeNote = (note, fromList) => {\r\n            selectedNotes.value = selectedNotes.value.filter(n => n.id !== note.id);\r\n            let oldSize = notesInGrid.value.length;\r\n            notesInGrid.value = notesInGrid.value.filter(n => n.id !== note.id);\r\n            let diff = oldSize - notesInGrid.value.length;\r\n            // console.log(`Removed a note!`)\r\n            for (const track of tracks.value) {\r\n                track.notes = track.notes.filter(n => n.id !== note.id);\r\n            }\r\n            if (!fromList && isPlaying.value)\r\n                playSequence();\r\n        };\r\n\r\n        document.addEventListener('mousedown', (event) => {\r\n            isMouseDown.value = true;\r\n        });\r\n\r\n        document.addEventListener('mouseup', () => {\r\n            isMouseDown.value = false;\r\n        });\r\n\r\n        return {\r\n            notes,\r\n            octaves,\r\n            startNote,\r\n            endNote,\r\n            mouseOverNote,\r\n            mouseLeaveNote,\r\n            instruments,\r\n            selectedInstrument,\r\n            changeInstrument,\r\n            pianoRoll,\r\n            grid,\r\n            notesInGrid,\r\n            startDrag,\r\n            endDrag,\r\n            startPlacingNote,\r\n            removeNote,\r\n            gridWidth,\r\n            gridHeight,\r\n            gridSpan,\r\n            startResize,\r\n            endResize,\r\n            onResize,\r\n            currentNoteLength,\r\n            playSequence,\r\n            tempo,\r\n            handleGridClick,\r\n            isSelecting,\r\n            rectangleStyle,\r\n            startMarkerDrag,\r\n            markerPosition,\r\n            markerReplayPosition,\r\n            ruler,\r\n            loopSong,\r\n            trackify,\r\n            noteWidthToMML,\r\n            backgroundStyle,\r\n            genMML,\r\n            showCopyNotification,\r\n            showFailedNotification,\r\n            failedNotificationText,\r\n            handleTrackSelected,\r\n            handleAddTrack,\r\n            handleRemoveTrack,\r\n            handleMuteTrack\r\n        };\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n\r\n.piano-container {\r\n    position: fixed;\r\n    /* Fix to the left side of the screen */\r\n    top: 0;\r\n    left: 0;\r\n    height: 100%;\r\n    /* Full height */\r\n    width: 100%;\r\n    /* Width of the piano roll */\r\n    background-color: #ddd;\r\n}\r\n\r\n.copyNotification {\r\n    position: fixed;\r\n    top: 20px;\r\n    right: 20px;\r\n    background-color: #4caf50;\r\n    color: white;\r\n    padding: 10px 20px;\r\n    border-radius: 5px;\r\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);\r\n    z-index: 1000;\r\n}\r\n\r\n.instrument-selector {\r\n    padding: 10px;\r\n    background-color: #f0f0f0;\r\n    border-bottom: 1px solid #ccc;\r\n}\r\n\r\n.piano-roll {\r\n    height: 100vh;\r\n    flex-wrap: wrap;\r\n    display: flex;\r\n    overflow-y: auto;\r\n    box-sizing: border-box;\r\n    padding-bottom: 36px;\r\n}\r\n\r\n.piano-keys {\r\n    padding-top: 30px;\r\n    background-color: #ccc;\r\n    width: 10%;\r\n    display: flex;\r\n    flex-direction: column-reverse;\r\n    padding-bottom: 18px;\r\n    /* Higher notes at the top */\r\n    z-index: 12;\r\n}\r\n\r\n.octave {\r\n    flex-direction: column;\r\n    position: relative;\r\n}\r\n\r\n.keys-wrapper {\r\n    flex-direction: column-reverse;\r\n    /* Ensure keys are in the correct order */\r\n}\r\n\r\n.piano-key {\r\n    box-sizing: border-box;\r\n    border: 1px solid #ccc;\r\n    cursor: pointer;\r\n    position: relative;\r\n    user-select: none;\r\n}\r\n\r\n.white-key {\r\n    width: 100%;\r\n    height: 24px;\r\n    align-content: center;\r\n    /* Adjust based on desired key height */\r\n    background: white;\r\n    border-bottom: 1px solid #ccc;\r\n    text-align: right;\r\n    padding-right: 10px;\r\n    user-select: none;\r\n    font-size: 80%;\r\n}\r\n\r\n.black-key {\r\n    background: black;\r\n    color: #fff;\r\n    width: 100%;\r\n    height: 24px;\r\n    align-content: center;\r\n    /* Adjust based on desired key height */\r\n    position: relative;\r\n    /* Center black key over white key */\r\n    text-align: right;\r\n    padding-right: 10px;\r\n    user-select: none;\r\n    font-size: 80%;\r\n}\r\n\r\n.white-key:nth-child(2n+1) {\r\n    background: #fff;\r\n}\r\n\r\n.white-key:nth-child(12n) {\r\n    background: #bbb;\r\n}\r\n\r\n.grid-wrapper {\r\n    overflow-x: scroll;\r\n    overflow-y: hidden;\r\n    flex-grow: 1;\r\n    position: relative;\r\n}\r\n\r\n.ruler {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    margin-top: 90px;\r\n    margin-left: calc(10% - 2px);\r\n    background-color: #eee;\r\n    height: 29px;\r\n    border-bottom: 1px solid #ccc;\r\n    display: flex;\r\n    align-items: end;\r\n    font-size: 12px;\r\n    color: #333;\r\n    background: repeating-linear-gradient( /*This is the horizontal lines*/\r\n        90deg,\r\n        #bbb,\r\n        #bbb 2px,\r\n        #eee 2px,\r\n        #eee 256px\r\n    );\r\n    z-index: 11;\r\n    user-select: none;\r\n    cursor: pointer;\r\n}\r\n\r\n.ruler-tick-label {\r\n    position: absolute;\r\n    bottom: 0;\r\n    white-space: nowrap;\r\n    transform: translateX(5px);\r\n    font-size: 14px;\r\n    color: #333;\r\n}\r\n\r\n.marker-replay-triangle {\r\n    position: absolute;\r\n    width: 0;\r\n    height: 0;\r\n    border-left: 10px solid transparent;\r\n    border-right: 10px solid transparent;\r\n    border-top: 10px solid #bbb; /* Triangle color */\r\n    left: 50%;\r\n    bottom: 0; /* Inside the ruler */\r\n    transform: translateX(-50%);\r\n}\r\n\r\n.marker-wrapper {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    transform: translateX(-50%);\r\n    pointer-events: none;\r\n}\r\n\r\n.marker-triangle {\r\n    position: absolute;\r\n    width: 0;\r\n    height: 0;\r\n    border-left: 10px solid transparent;\r\n    border-right: 10px solid transparent;\r\n    border-top: 10px solid #f00; /* Triangle color */\r\n    left: 50%;\r\n    bottom: 0; /* Inside the ruler */\r\n    transform: translateX(-50%);\r\n}\r\n\r\n.marker-line {\r\n    position: absolute;\r\n    width: 2px;\r\n    height: 100vh;\r\n    background-color: #f00;\r\n    left: 50%;\r\n    bottom: - 100%; /* Below the ruler */\r\n    transform: translateX(-50%);\r\n}\r\n\r\n.grid {\r\n    padding-top: 18px;\r\n    margin-top: 30px;\r\n    position: absolute;\r\n    display: flex;\r\n    min-width: 100%;\r\n    align-self: top;\r\n    height: 100%;/*2592px;*/\r\n    background: repeating-linear-gradient( /*This is the horizontal lines*/\r\n        0deg,\r\n        #bbb,\r\n        #bbb 2px,\r\n        transparent 2px,\r\n        transparent 24px\r\n    ),\r\n    repeating-linear-gradient( /*This is the Bar line*/\r\n        90deg,\r\n        #777,\r\n        #777 2px,\r\n        transparent 2px,\r\n        transparent 256px\r\n    ),\r\n    repeating-linear-gradient( /*This is the vertical lines*/\r\n        90deg,\r\n        #c0c0c0,\r\n        #c0c0c0 2px,\r\n        transparent 2px,\r\n        transparent 16px\r\n    ),\r\n    repeating-linear-gradient(/*This is the background colors*/\r\n        90deg,\r\n        #e0e0e0,\r\n        #e0e0e0 64px,\r\n        #ccc 64px,\r\n        #ccc 128px\r\n    );\r\n    z-index: 10;\r\n    overflow: hidden;\r\n}\r\n\r\n.note {\r\n  position: absolute;\r\n  background-color: rgba(0, 120, 255, 0.5);\r\n  border: 1px solid #0078d4;\r\n  cursor: pointer;\r\n  box-sizing: border-box;\r\n  user-select: none;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 20;\r\n  font-size: 70%;\r\n  margin-left: 1px;\r\n}\r\n\r\n.note:active {\r\n    background-color: rgba(0, 120, 255, 0.7);\r\n}\r\n\r\n.resize-handle {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 0;\r\n    width: 40%; /* Adjust as needed */\r\n    max-width: 10px;\r\n    height: 100%;\r\n    cursor: ew-resize;\r\n    background-color: rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.play-button {\r\n  position: fixed;\r\n  top: 10px;\r\n  right: 10px;\r\n  padding: 10px 20px;\r\n  font-size: 16px;\r\n  cursor: pointer;\r\n  border: none;\r\n  border-radius: 5px;\r\n  background-color: #0078d4;\r\n  color: white;\r\n  z-index: 1000; /* Ensure it's on top of other elements */\r\n  outline: none;\r\n  box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.loop-wrapper {\r\n    position: fixed;\r\n    top: 10px;\r\n    right: 160px;\r\n    padding: 10px 20px;\r\n    height: 18px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    user-select: none;\r\n    background-color: #0078d4;\r\n    color: white;\r\n    border-radius: 5px;\r\n    box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n    z-index: 1000;\r\n}\r\n\r\n.controls {\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n\r\n.instrument-selector,\r\n.tempo-selector {\r\n    margin-right: 15px;\r\n}\r\n\r\n.selection-rect {\r\n    position: absolute;\r\n    border: 1px solid rgba(0, 100, 255, 0.5);\r\n    background-color: rgba(0, 100, 255, 0.3);\r\n    z-index: 30;\r\n}\r\n\r\n</style>","<template>\r\n    <div>\r\n      <!-- Help Button -->\r\n      <button \r\n        class=\"help-button\"\r\n        @click=\"showHelp\"\r\n      >\r\n        <span v-if=\"hoverHelp\">Help</span>\r\n        <span v-else> ? </span>\r\n      </button>\r\n  \r\n      <!-- Help Modal -->\r\n      <div v-if=\"isHelpVisible\" class=\"modal-background\">\r\n        <transition name=\"fade\">\r\n          <div class=\"help-modal\">\r\n            <button class=\"close-button\" @click=\"closeHelp\">X</button>\r\n            <div class=\"help-content\">\r\n              <h1>Help</h1>\r\n              <h3>Placing Notes</h3>\r\n              <li>To place notes, click anywhere on the grid.</li>\r\n              <li>The size of the note will be the same size as the note that was last placed/moved.</li>\r\n              <li>Placed notes are instantly draggable.</li>\r\n              <li>The color of the placed notes will depend on the color of the track they belong to.</li>\r\n              <li>By changing the \"Grid Spacing\" dropdown, you can control whether the grid is in 16ths or 12ths.</li>\r\n\r\n              <h3>Dragging Notes</h3>\r\n              <li>To drag a note, click on the left side of the note. Then, move your mouse around within the bounds of the grid.</li>\r\n              <li>Holding <strong>Alt</strong> will move notes freely (not locked to the grid).</li>\r\n              <li>If multiple notes are selected, all selected notes will be moved together (even if they are from different tracks).</li>\r\n              \r\n              <h3>Resizing Notes</h3>\r\n              <li>To resize a note, click on the right side of the note, then drag left or right.</li>\r\n              <li>Notes have a minimum length of 1/64th of a beat.</li>\r\n              <li>Holding <strong>Alt</strong> will resize notes freely (not locked to the grid)</li>\r\n              <li>If multiple notes are selected, all selected notes will be resized together.</li>\r\n\r\n              <h3>Selecting Multiple Notes</h3>\r\n              <li>To select multiple notes at once, hold <strong>Ctrl</strong> on the grid and drag your mouse.</li>\r\n              <li>If you hold <strong>Ctrl+Shift</strong> and drag, you will \"add on\" to your note selection. <i>(Previously selected notes will not be unselected, and you can select additional notes.)</i></li>\r\n              <li>If you hold <strong>Shift</strong> and drag a note, you will clone it (if that note is highlighted, it will clone all highlighted notes).</li>\r\n              <li>Pressing <strong>Ctrl+A</strong> will select all notes in the grid.</li>\r\n              <li>Pressing the <strong>Backspace</strong> or <strong>Delete</strong> keys will delete all selected notes.</li>\r\n\r\n              <h3>Tracks</h3>\r\n              <li>Each track has its own name, instrument, color, and visibility toggle.</li>\r\n              <li>To add a track, click on the blue plus button to the right of the tracks.</li>\r\n              <li>To rename a track, double click on the track's name. When done with renaming, press <strong>Enter</strong>.</li>\r\n              <li>To mute/unmute a track, click on the volume icon next to the track's name.</li>\r\n              <li>Clicking on a note from another track will cause you to switch to that note's track.</li>\r\n              <li>You can remove a track by clicking on the <strong>X</strong>. This will also remove the notes belonging to that track.</li>\r\n              <li>To change the color of a track and its notes, click on the outlined box at the bottom-center of the selected track's tab.</li>\r\n              <li>You can have a minimum of 1 track, and a maximum of 16 tracks.</li>\r\n              <li>The number of tracks you can have at once is dependant on screen width. This is so that smaller screens can still access all of their created tabs easily.</li>\r\n              <li>Hovering over a track tab will show you the name of the track.</li>\r\n\r\n              <h3>Track Splitting</h3>\r\n              <li>With a track selected, click the \"Split Track\" button. This will separate the track into multiple other tracks (unless that number would exceed 16).</li>\r\n              <li>A track is split from left to right, then top to bottom. This can sometimes lead to weird splits.</li>\r\n              <li>The purpose of this feature is so that you can compose parts of your piece in a single track, then split them up if you need to.</li>\r\n\r\n              <h3>Exporting to MML</h3>\r\n              <li>Clicking on the \"Convert to MML\" button will copy the MML of audible tracks to your clipboard.</li>\r\n              <li>Only unmuted/audible tracks will be copied to your clipboard.</li>\r\n              <li>A maximum of four tracks can be exported at once.</li>\r\n              <li>Remember that the fourth track in a score is always the 'song' track.</li>\r\n              <li>Tracks that have multiple notes playing at once will NOT export properly, so be sure to split them before export.</li>\r\n              <li>The exported MML will be moderately optimized for length, but don't expect them to be perfect.</li>\r\n              <li>Tracks will be exported from left to right, meaning that the left-most track will be the one to appear first in the MML export.</li>\r\n              <li>Currently, exported MMLs will be at max volume (V15) in all tracks.</li>\r\n\r\n              <h3>Misc</h3>\r\n              <li>Click and hold on the piano keys to play them. <br><em>(Note: some instruments can only play certain keys)</em></li>\r\n              <li>Press <strong>Space</strong> to play your song. It will start from the marker.</li>\r\n              <li>Press <strong>Space</strong> again to pause your song. If you press <strong>Ctrl+Space</strong>, it will stop the marker where it was.</li>\r\n              <li>Check the <strong>Loop</strong> checkbox to loop your song.</li>\r\n              <li>Click and drag on the timeline to move the marker.</li>\r\n              <li>If you hold <strong>ALT</strong> while dragging, the marker will move freely.</li>\r\n              <li>You can change instruments using the spinner at the top left of the page.</li>\r\n              <li>You can change the tempo by entering a number at the top left of the page.</li>\r\n      \r\n              <h3>Planned Features</h3>\r\n              <li>Support for tempo and note volume changes</li>\r\n              <li>MML import</li>\r\n              <li>MIDI import/export support</li>\r\n              <li>Support for saving/loading \"projects\"</li>\r\n              <li>Undo/Redo functionality</li>\r\n              <li>Copy/Paste functionality</li>\r\n\r\n              <p class=\"credits\">Credits: Made by Daderic</p>\r\n\r\n            </div>\r\n          </div>\r\n        </transition>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        hoverHelp: false,\r\n        isHelpVisible: true, // Initially visible when the page loads\r\n      };\r\n    },\r\n    methods: {\r\n      showHelp() {\r\n        this.isHelpVisible = true;\r\n      },\r\n      closeHelp() {\r\n        this.isHelpVisible = false;\r\n      },\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .help-button {\r\n    position: fixed;\r\n    top: 14px;\r\n    right: 280px;\r\n    width: 34px;\r\n    height: 34px;\r\n    cursor: pointer;\r\n    border-radius: 50%;\r\n    background-color: white;\r\n    border-width: 2px;\r\n    border-style: solid;\r\n    font-size: 24px;\r\n    border-color: black;\r\n    font-weight: lighter;\r\n    color: black;\r\n    z-index: 1000;\r\n    box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n  }\r\n  \r\n  .help-button span {\r\n    display: block;\r\n  }\r\n  \r\n  .modal-background {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 1000;\r\n  }\r\n  \r\n  .help-modal {\r\n    background-color: white;\r\n    padding: 20px;\r\n    width: 500px;\r\n    max-height: 80%;\r\n    overflow-y: auto;\r\n    border-radius: 8px;\r\n    position: relative;\r\n    justify-items: left;\r\n    justify-content: left;\r\n  }\r\n  \r\n  .close-button {\r\n    position: absolute;\r\n    top: 10px;\r\n    right: 10px;\r\n    background-color: transparent;\r\n    border: none;\r\n    font-size: 20px;\r\n    cursor: pointer;\r\n  }\r\n  \r\n  .fade-enter-active, .fade-leave-active {\r\n    transition: opacity 0.5s;\r\n  }\r\n  .fade-enter, .fade-leave-to /* .fade-leave-active in <2.1.8 */ {\r\n    opacity: 0;\r\n  }\r\n  \r\n  .help-content {\r\n    font-size: 14px;\r\n    line-height: 1.6;\r\n    text-align: left;\r\n  }\r\n\r\n  .help-content h1 {\r\n    text-align: center;\r\n  }\r\n  \r\n  .credits {\r\n    margin-top: 20px;\r\n    font-style: italic;\r\n  }\r\n  </style>\r\n  ","import { render } from \"./HelpMenu.vue?vue&type=template&id=67dc015c&scoped=true\"\nimport script from \"./HelpMenu.vue?vue&type=script&lang=js\"\nexport * from \"./HelpMenu.vue?vue&type=script&lang=js\"\n\nimport \"./HelpMenu.vue?vue&type=style&index=0&id=67dc015c&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-67dc015c\"]])\n\nexport default __exports__","<template>\r\n    <div>\r\n      <div class=\"track-tab-container\" ref=\"tabContainerRef\">\r\n        <div\r\n          v-for=\"(track, index) in tracks\"\r\n          :key=\"track.id\"\r\n          :class=\"['track-tab', { selected: selectedTrackIndex === index }]\"\r\n          @click=\"selectTrack(index)\"\r\n          :style=\"{ backgroundColor: track.color }\"\r\n          :title=\"track.name\"\r\n        >\r\n          <div class=\"tab-header\">\r\n            <input\r\n              v-if=\"track.isEditingName\"\r\n              v-model=\"track.name\"\r\n              @blur=\"track.isEditingName = false\"\r\n              @keyup.enter=\"track.isEditingName = false\"\r\n              class=\"track-name-input\"\r\n            />\r\n            <span\r\n              v-else\r\n              @dblclick=\"track.isEditingName = true\"\r\n              class=\"track-name\"\r\n            >\r\n              {{ track.name }}\r\n            </span>\r\n            <span class=\"mute-icon\" @click.stop=\"toggleMute(index)\">\r\n              {{ track.isMuted ? '🔇' : '🔊' }}\r\n            </span>\r\n            <button @click.stop=\"removeTrack(index)\" class=\"delete-btn\">✖</button>\r\n          </div>\r\n          <div v-if=\"selectedTrackIndex === index\" class=\"color-picker-container\">\r\n            <input\r\n              type=\"color\"\r\n              v-model=\"trackHexColor\"\r\n              class=\"color-picker\"\r\n              @input=\"updateTrackColor\"\r\n            />\r\n          </div>\r\n        </div>\r\n  \r\n        <button\r\n          @click=\"addTrack\"\r\n          class=\"add-track-btn\"\r\n          :disabled=\"!canAddTrack\"\r\n        >\r\n          +\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { ref, computed, onMounted, onBeforeUnmount, nextTick, reactive } from 'vue';\r\n\r\n  export const EventBus = reactive({});\r\n\r\n  export const tracks = ref([]);\r\n  export const selectedTrackIndex = ref(null);\r\n  export const selectedTrack = computed(() => tracks.value[selectedTrackIndex.value] || null);\r\n  export const trackHexColor = ref('#ffffff');\r\n  export default {\r\n    created() {\r\n      EventBus.addTrack = this.addTrack;\r\n    },\r\n    setup(props, { emit }) {\r\n      const containerWidth = ref(0);\r\n      const tabContainerRef = ref(null);\r\n  \r\n  \r\n      const canAddTrack = computed(() => {\r\n        if (tracks.value.length > 15)\r\n          return false;\r\n        const minWidth = 75;\r\n        const totalWidth = tracks.value.length * minWidth;\r\n        return containerWidth.value - totalWidth - 50 > minWidth; // Limit to 16 tracks\r\n      });\r\n  \r\n      const updateContainerWidth = () => {\r\n        if (tabContainerRef.value) {\r\n          containerWidth.value = tabContainerRef.value.clientWidth; // Get container width\r\n        }\r\n      };\r\n  \r\n      const getRandomColor = () => {\r\n        const hue = Math.floor(Math.random() * 360);\r\n        const saturation = 75 + Math.random() * 25;\r\n        const lightness = 50 + Math.random() * 10;\r\n        \r\n        const chroma = (1 - Math.abs(2 * lightness / 100 - 1)) * (saturation / 100);\r\n        const x = chroma * (1 - Math.abs(((hue / 60) % 2) - 1));\r\n        const m = lightness / 100 - chroma / 2;\r\n  \r\n        let [r, g, b] =\r\n          hue < 60 ? [chroma, x, 0]\r\n          : hue < 120 ? [x, chroma, 0]\r\n          : hue < 180 ? [0, chroma, x]\r\n          : hue < 240 ? [0, x, chroma]\r\n          : hue < 300 ? [x, 0, chroma]\r\n          : [chroma, 0, x];\r\n  \r\n        r = Math.round((r + m) * 255);\r\n        g = Math.round((g + m) * 255);\r\n        b = Math.round((b + m) * 255);\r\n  \r\n        // Return the color in hex format\r\n        return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\r\n      };\r\n  \r\n      const root = process.env.NODE_ENV === 'production' ? '../MabiMML/' : '../';\r\n\r\n      const addTrack = (instr=null, color=null, name=null) => {\r\n        const newTrack = {\r\n          id: Date.now(),\r\n          name: name || `Track ${tracks.value.length + 1}`,\r\n          isMuted: false,\r\n          color: color || getRandomColor(),\r\n          isEditingName: false,\r\n          notes: [],\r\n          instrument: instr || { name: 'Lute', program: 0 },\r\n        };\r\n        tracks.value.push(newTrack);\r\n        selectTrack(tracks.value.length - 1);\r\n        emit('add-track', newTrack, tracks.value.length - 1);\r\n        return newTrack;\r\n      };\r\n  \r\n      const removeTrack = (index) => {\r\n        if (tracks.value.length === 1)\r\n          return;\r\n        let trackClone = tracks.value[index];\r\n        tracks.value.splice(index, 1);\r\n  \r\n        if (tracks.value.length === 0) {\r\n          selectedTrackIndex.value = null;\r\n          trackHexColor.value = '#ffffff'; // Reset color picker when no tracks are left\r\n        } else {\r\n          if (index === selectedTrackIndex.value) {\r\n            // If the removed track was selected, select the next available track\r\n            const newIndex = index < tracks.value.length ? index : index - 1;\r\n            selectedTrackIndex.value = newIndex;\r\n            trackHexColor.value = tracks.value[newIndex].color; // Update the color picker to the new selected track's color\r\n          } else if (selectedTrackIndex.value > index) {\r\n            selectedTrackIndex.value--;\r\n          }\r\n  \r\n          // Update color picker for the currently selected track\r\n          if (selectedTrack.value) {\r\n            trackHexColor.value = selectedTrack.value.color;\r\n          }\r\n        }\r\n\r\n        emit('remove-track', trackClone, selectedTrack.value);\r\n      };\r\n  \r\n  \r\n      const selectTrack = (index) => {\r\n        selectedTrackIndex.value = index;\r\n        trackHexColor.value = tracks.value[index].color; // Update color picker when track is selected\r\n        emit('track-selected', tracks.value[index]);\r\n      };\r\n  \r\n      const toggleMute = (index) => {\r\n        tracks.value[index].isMuted = !tracks.value[index].isMuted;\r\n        if (tracks.value[index].isMuted)\r\n          for (const note of tracks.value[index].notes) {\r\n            note.muted = true;\r\n          }\r\n        else {\r\n          for (const note of tracks.value[index].notes) {\r\n            note.muted = false;\r\n          }\r\n        }\r\n        emit('mute-track');\r\n      };\r\n  \r\n      const updateTrackColor = (event) => {\r\n        const newColor = event.target.value;\r\n        if (selectedTrack.value) {\r\n          selectedTrack.value.color = newColor;\r\n          trackHexColor.value = newColor; // Update hex color for the picker\r\n          for (const note of selectedTrack.value.notes) {\r\n            note.color = newColor;\r\n          }\r\n        }\r\n      };\r\n  \r\n      onMounted(() => {\r\n        addTrack(); // Always start with one track\r\n        nextTick(() => {\r\n          updateContainerWidth(); // Get initial container width\r\n        });\r\n        window.addEventListener('resize', updateContainerWidth);\r\n      });\r\n  \r\n      onBeforeUnmount(() => {\r\n        window.removeEventListener('resize', updateContainerWidth);\r\n      });\r\n  \r\n      return {\r\n        tracks,\r\n        selectedTrackIndex,\r\n        trackHexColor,\r\n        containerWidth,\r\n        addTrack,\r\n        removeTrack,\r\n        selectTrack,\r\n        toggleMute,\r\n        updateTrackColor,\r\n        selectedTrack,\r\n        canAddTrack,\r\n        tabContainerRef,\r\n      };\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .track-tab-container {\r\n    display: flex;\r\n    align-items: flex-end;\r\n    max-width: 83%;\r\n    background-color: #f1f1f1;\r\n    flex-wrap: nowrap;\r\n    height: 50px;\r\n  }\r\n  \r\n  .track-tab {\r\n    user-select: none;\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin-right: -10px;\r\n    flex-grow: 1;\r\n    min-width: 75px;\r\n    max-width: 200px;\r\n    height: 40px;\r\n    border: 2px solid #ccc;\r\n    border-radius: 8px 8px 0 0;\r\n    cursor: pointer;\r\n    transition: background-color 0.3s ease;\r\n    position: relative;\r\n    z-index: 1;\r\n    align-self: flex-end;\r\n    overflow: hidden;\r\n  }\r\n  \r\n  .track-tab.selected {\r\n    padding-bottom: 10px;\r\n    z-index: 10;\r\n    border-bottom: none;\r\n  }\r\n  \r\n  .tab-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 5px 10px;\r\n    border-radius: 8px 8px 0 0;\r\n    font-weight: bold;\r\n    font-size: 1em;\r\n    color: white;\r\n  }\r\n  \r\n  .track-name-input {\r\n    width: 100%;\r\n    font-size: 1em;\r\n    background-color: transparent;\r\n    border: none;\r\n    color: white;\r\n    outline: none;\r\n  }\r\n  \r\n  .track-name {\r\n    color: white;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n  }\r\n  \r\n  .mute-icon {\r\n    font-size: 1.2em;\r\n    cursor: pointer;\r\n    margin-left: 10px;\r\n    color: white;\r\n  }\r\n  \r\n  .delete-btn {\r\n    background: transparent;\r\n    border: none;\r\n    cursor: pointer;\r\n    color: white;\r\n    font-size: 1.1em;\r\n    font-weight: bold;\r\n  }\r\n  \r\n  .add-track-btn {\r\n    user-select: none;\r\n    width: 50px;\r\n    height: 50px;\r\n    font-size: 2em;\r\n    background-color: #007bff;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 8px;\r\n    margin-left: 12px;\r\n    flex-shrink: 0;\r\n    cursor: pointer;\r\n    position: relative;\r\n    z-index: 5;\r\n    transition: background-color 0.3s ease;\r\n  }\r\n  \r\n  .add-track-btn:disabled {\r\n    background-color: #ccc;\r\n    cursor: not-allowed;\r\n  }\r\n  \r\n  .color-picker-container {\r\n  }\r\n  \r\n  .color-picker {\r\n    margin-left: 10px;\r\n  }\r\n  \r\n  .track-tab:hover::after {\r\n    content: attr(title);\r\n    position: absolute;\r\n    bottom: 100%;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    background-color: rgba(0, 0, 0, 0.7);\r\n    color: white;\r\n    padding: 5px;\r\n    border-radius: 4px;\r\n    white-space: nowrap;\r\n    z-index: 10;\r\n    margin-bottom: 5px;\r\n    opacity: 0;\r\n    transition: opacity 0.2s ease;\r\n  }\r\n  \r\n  .track-tab:hover::after {\r\n    opacity: 1;\r\n  }\r\n  </style>","import { render } from \"./Tracks.vue?vue&type=template&id=46554816&scoped=true\"\nimport script from \"./Tracks.vue?vue&type=script&lang=js\"\nexport * from \"./Tracks.vue?vue&type=script&lang=js\"\n\nimport \"./Tracks.vue?vue&type=style&index=0&id=46554816&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-46554816\"]])\n\nexport default __exports__","import { render } from \"./PianoRoll.vue?vue&type=template&id=87c43784&scoped=true\"\nimport script from \"./PianoRoll.vue?vue&type=script&lang=js\"\nexport * from \"./PianoRoll.vue?vue&type=script&lang=js\"\n\nimport \"./PianoRoll.vue?vue&type=style&index=0&id=87c43784&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-87c43784\"]])\n\nexport default __exports__","import { render } from \"./Sequencer.vue?vue&type=template&id=2e49d91b&scoped=true\"\nimport script from \"./Sequencer.vue?vue&type=script&lang=js\"\nexport * from \"./Sequencer.vue?vue&type=script&lang=js\"\n\nimport \"./Sequencer.vue?vue&type=style&index=0&id=2e49d91b&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2e49d91b\"]])\n\nexport default __exports__","import { render } from \"./PatternEditor.vue?vue&type=template&id=233a7f0a&scoped=true\"\nimport script from \"./PatternEditor.vue?vue&type=script&lang=js\"\nexport * from \"./PatternEditor.vue?vue&type=script&lang=js\"\n\nimport \"./PatternEditor.vue?vue&type=style&index=0&id=233a7f0a&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-233a7f0a\"]])\n\nexport default __exports__","import { render } from \"./App.vue?vue&type=template&id=45718dbe\"\nimport script from \"./App.vue?vue&type=script&lang=js\"\nexport * from \"./App.vue?vue&type=script&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=45718dbe&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { createApp } from 'vue'\nimport App from './App.vue'\nimport HelpMenu from './components/HelpMenu.vue'\n\ncreateApp(App).mount('#app');\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","__webpack_require__.p = \"/MabiMML/\";","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t524: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkmusic_sequencer\"] = self[\"webpackChunkmusic_sequencer\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [504], function() { return __webpack_require__(23673); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["_createElementVNode","alt","src","_imports_0","id","_createElementBlock","_Fragment","_hoisted_1","_hoisted_2","_createVNode","_component_PatternEditor","class","ref","_component_PianoRoll","key","style","for","_hoisted_18","_hoisted_19","onClick","_cache","args","$setup","playSequence","_createTextVNode","type","$event","loopSong","_component_HelpMenu","showCopyNotification","_hoisted_3","_createCommentVNode","showFailedNotification","_hoisted_4","_toDisplayString","failedNotificationText","_component_Tracks","onTrackSelected","handleTrackSelected","onAddTrack","handleAddTrack","onRemoveTrack","handleRemoveTrack","onMuteTrack","handleMuteTrack","_hoisted_5","_hoisted_6","_hoisted_7","selectedInstrument","onChange","changeInstrument","_renderList","instruments","instrument","index","value","name","_hoisted_8","_hoisted_9","_hoisted_10","tempo","min","max","number","trackify","genMML","_hoisted_11","_hoisted_12","gridWidth","displayName","width","_hoisted_13","_hoisted_14","_hoisted_15","octaves","octave","_hoisted_16","notes","slice","reverse","note","_normalizeClass","isBlack","onMousedown","startNote","onMouseover","mouseOverNote","onMouseup","endNote","onMouseleave","mouseLeaveNote","_normalizeStyle","zIndex","_hoisted_17","startMarkerDrag","gridSpan","Math","ceil","left","markerReplayPosition","markerPosition","_hoisted_20","_hoisted_21","background","backgroundStyle","_withModifiers","handleGridClick","onContextmenu","_ctx","startNoteRemove","notesInGrid","top","gridHeight","muted","color","highlighted","startDrag","removeNote","endDrag","startResize","_hoisted_23","_hoisted_22","isSelecting","rectangleStyle","$options","showHelp","$data","hoverHelp","isHelpVisible","_Transition","default","_withCtx","closeHelp","_","data","methods","this","__exports__","tracks","track","selected","selectedTrackIndex","selectTrack","backgroundColor","title","isEditingName","onBlur","onKeyup","_withKeys","onDblclick","toggleMute","isMuted","removeTrack","trackHexColor","onInput","updateTrackColor","addTrack","disabled","canAddTrack","EventBus","reactive","selectedTrack","computed","created","setup","props","emit","containerWidth","tabContainerRef","length","minWidth","totalWidth","updateContainerWidth","clientWidth","getRandomColor","hue","floor","random","saturation","lightness","chroma","abs","x","m","r","g","b","round","toString","instr","newTrack","Date","now","program","push","trackClone","splice","newIndex","event","newColor","target","onMounted","nextTick","window","addEventListener","onBeforeUnmount","removeEventListener","components","HelpMenu","Tracks","root","pianoRoll","grid","synth","context","isMouseDown","midiBuilder","currentNoteLength","draggingNotes","resizingNotes","startX","startY","innerWidth","scrollX","selectedNotes","currentX","currentY","ruler","seq","isPlaying","height","border","noteNames","blackNotes","map","includes","watchEffect","maxRightPosition","indexOf","async","oldTrack","loadSoundFont","response","fetch","soundFontArrayBuffer","arrayBuffer","error","console","gridWrapper","document","querySelector","updateRuler","handleKeyPress","AudioContext","audioWorklet","addModule","Synthetizer","destination","undefined","chorusEnabled","reverbEnabled","isReady","stopPlaying","updateMarkerPos","clientX","altKey","onMarkerDrag","onMarkerDragEnd","markerInterval","markerStartPos","startTempo","startMarkerAnim","doMarkerAnim","tick","currentTime","loop","clearInterval","setInterval","noteWidthToMML","outString","mmlWidth","noteLengths","i","val1","val2","result","getClosestWidth","noteCombination","join","targetWidth","amount","dp","Array","fill","Infinity","usedNotes","noteValue","minNotes","currentAmount","stopMarkerAnim","fromClick","rulerRect","getBoundingClientRect","newPos","code","preventDefault","ctrlKey","selectNote","scrollLeft","stop","programChange","MIDIBuilder","resume","notesAdded","audibleTracks","addNewTrack","forEach","containingTrack","some","n","trackIndex","channel","pitch","noteStartTime","noteDuration","markerTime","startTime","duration","volume","addEvent","addNoteOn","addNoteOff","flush","writeMIDIFile","Sequencer","binary","skipToFirstNoteOn","addOnSongEndedEvent","play","noteOn","noteOff","startPositions","Map","placeNote","button","clearSelection","shiftKey","newNote","start","end","unshift","draggingNote","set","y","clientY","onDrag","outOfBounds","newPositions","startPos","get","dx","dy","newLeft","newTop","noteName","clear","startResizeData","onResize","endResize","allInBounds","newWidths","startData","newWidth","startSelection","startPlacingNote","rect","onSelectionMove","onSelectionEnd","checkIntersections","selectionRect","right","bottom","itemRect","intersects","rect1","rect2","gridElement","scrollTop","existingNote","find","notesList","sort","a","trackWrappers","log","trackWrapper","setTimeout","copyToClipboard","text","navigator","clipboard","writeText","then","catch","err","prevNoteEnd","gap","restStr","replaceAll","noteStr","k","split","outTracks","newTracks","tokens","tokenizeMML","simplifiedTokens","simplifyMML","simplifiedMML","stringifyMML","patterns","LENGTH","NOTE","REST","TIE","OCTAVE","mmlString","regex","Object","entries","match","exec","tokenList","newTokenList","JSON","parse","stringify","totalPasses","pass","token","tokenLength","restLength","notePitch","Number","noteOctave","keys","noteKey","diff","octaveChanges","symbol","j","prevToken","noteCount","noteIndexes","token2","replace","noteIndex","outStr","fromList","filter","oldSize","PianoRoll","scrollContainer","PatternEditor","render","createApp","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","call","deferred","O","chunkIds","fn","priority","notFulfilled","fulfilled","every","getter","__esModule","d","definition","o","defineProperty","enumerable","globalThis","Function","e","obj","prop","prototype","hasOwnProperty","p","baseURI","self","location","href","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","bind","__webpack_exports__"],"sourceRoot":""}