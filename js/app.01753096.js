(function(){"use strict";var e={18988:function(e,t,l){var n=l(45130),o=l(56768),a=l.p+"img/logo.824f291d.png";const r=(0,o.Lk)("img",{alt:"Vue logo",src:a},null,-1),i={id:"app"};function u(e,t,l,n,a,u){const s=(0,o.g2)("PatternEditor");return(0,o.uX)(),(0,o.CE)(o.FK,null,[r,(0,o.Lk)("div",i,[(0,o.bF)(s)])],64)}const s={class:"pattern-editor"},c={class:"scroll-container",ref:"scrollContainer"};function d(e,t,l,n,a,r){const i=(0,o.g2)("PianoRoll");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("div",c,[(0,o.bF)(i)],512)])}var v=l(90144),h=l(24232);const m=e=>((0,o.Qi)("data-v-61b8a8dc"),e=e(),(0,o.jt)(),e),p={class:"piano-container"},f={class:"loop-wrapper"},k={class:"scroll-wrapper"},g={key:0,class:"copyNotification"},y={key:1,class:"copyNotification",style:{"background-color":"#d44"}},L={class:"controls"},b={class:"instrument-selector"},w=m((()=>(0,o.Lk)("label",{for:"instrument-select"},"Select Instrument: ",-1))),M=["value"],x={class:"tempo-selector"},T=m((()=>(0,o.Lk)("label",{for:"tempo-select"},"Tempo: ",-1))),C={class:"grid-division-selector"},E=m((()=>(0,o.Lk)("label",{for:"grid-select",style:{"padding-left":"10px"}},"Grid Spacing: ",-1))),N=["value"],R={style:{padding:"10px"}},K={class:"piano-roll",ref:"pianoRoll"},S={class:"piano-keys"},W={class:"keys-wrapper"},I=["onMousedown","onMouseover","onMouseup","onMouseleave"],O=m((()=>(0,o.Lk)("div",{class:"marker-triangle"},null,-1))),D=m((()=>(0,o.Lk)("div",{class:"marker-line"},null,-1))),X=[O,D],A={class:"grid-wrapper"},H=["onMousedown","onMouseover"],F=["onMousedown"],V=["onMousedown"];function $(e,t,l,a,r,i){const u=(0,o.g2)("HelpMenu"),s=(0,o.g2)("Tracks"),c=(0,o.g2)("TempoMarker");return(0,o.uX)(),(0,o.CE)("div",p,[(0,o.Lk)("button",{class:"play-button",onClick:t[0]||(t[0]=(...e)=>a.playSequence&&a.playSequence(...e))},"Play Sequence"),(0,o.Lk)("label",f,[(0,o.eW)(" Loop: "),(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>a.loopSong=e)},null,512),[[n.lH,a.loopSong]])]),(0,o.Lk)("label",k,[(0,o.eW)(" Auto-scroll: "),(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>a.autoScrollSong=e)},null,512),[[n.lH,a.autoScrollSong]])]),(0,o.bF)(u),a.showSuccessNotification?((0,o.uX)(),(0,o.CE)("div",g,(0,h.v_)(a.successNotificationText),1)):(0,o.Q3)("",!0),a.showFailedNotification?((0,o.uX)(),(0,o.CE)("div",y,(0,h.v_)(a.failedNotificationText),1)):(0,o.Q3)("",!0),(0,o.bF)(s,{onTrackSelected:a.handleTrackSelected,onAddTrack:a.handleAddTrack,onRemoveTrack:a.handleRemoveTrack,onMuteTrack:a.handleMuteTrack,onColorChange:a.updateColor},null,8,["onTrackSelected","onAddTrack","onRemoveTrack","onMuteTrack","onColorChange"]),(0,o.Lk)("div",L,[(0,o.Lk)("div",b,[w,(0,o.bo)((0,o.Lk)("select",{id:"instrument-select","onUpdate:modelValue":t[3]||(t[3]=e=>a.selectedInstrument=e),onChange:t[4]||(t[4]=(...e)=>a.changeInstrument&&a.changeInstrument(...e))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.instruments,((e,t)=>((0,o.uX)(),(0,o.CE)("option",{key:t,value:e},(0,h.v_)(e.name),9,M)))),128))],544),[[n.u1,a.selectedInstrument]])]),(0,o.Lk)("div",x,[T,(0,o.bo)((0,o.Lk)("input",{type:"number",id:"tempo-select","onUpdate:modelValue":t[5]||(t[5]=e=>a.tempo=e),min:"40",max:"240"},null,512),[[n.Jo,a.tempo,void 0,{number:!0}]])]),(0,o.Lk)("button",{class:"track-splitter",onClick:t[6]||(t[6]=(...e)=>a.trackify&&a.trackify(...e))},"Split Track"),(0,o.Lk)("button",{class:"MML-converter",onClick:t[7]||(t[7]=(...e)=>a.genMML&&a.genMML(...e)),style:{"margin-left":"10px"}},"Gen MML"),(0,o.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>a.parseMMLFromClipboard&&a.parseMMLFromClipboard(...e)),style:{"margin-left":"10px"}},"Import MML From Clipboard"),(0,o.Lk)("div",C,[E,(0,o.bo)((0,o.Lk)("select",{id:"grid-select","onUpdate:modelValue":t[9]||(t[9]=e=>a.gridWidth=e)},[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)([{displayName:"16ths",width:16},{displayName:"12ths",width:256/12}],(e=>(0,o.Lk)("option",{key:e.displayName,value:e.width},(0,h.v_)(e.displayName),9,N))),64))],512),[[n.u1,a.gridWidth]])]),(0,o.Lk)("label",R,(0,h.v_)("Current Note Volume: "+a.currentNoteVolume),1)]),(0,o.Lk)("div",K,[(0,o.Lk)("div",S,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.octaves,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"octave"},[(0,o.Lk)("div",W,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.notes.slice().reverse(),((t,l)=>((0,o.uX)(),(0,o.CE)("div",{key:t.name,class:(0,h.C4)(["piano-key",t.isBlack?"black-key":"white-key"]),onMousedown:l=>a.startNote(0,t,e),onMouseover:l=>a.mouseOverNote(0,t,e),onMouseup:l=>a.endNote(0,t,e),onMouseleave:l=>a.mouseLeaveNote(0,t,e),style:(0,h.Tr)({zIndex:t.isBlack?1:0,background:t.index+12*e<a.instrKeyMin||t.index+12*e>a.instrKeyMax?"#d44":t.isBlack?"#000":"#fff"})},(0,h.v_)(t.name+e),47,I)))),128))])])))),128))]),(0,o.Lk)("div",{class:"ruler",ref:"ruler",onMousedown:t[10]||(t[10]=(...e)=>a.handleRulerClick&&a.handleRulerClick(...e)),style:(0,h.Tr)({width:"calc( 10% + "+a.gridSpan*a.zoomScalar+"px )",background:`repeating-linear-gradient(\n                        90deg,\n                        #bbb,\n                        #bbb 2px,\n                        #eee 2px,\n                        #eee ${256*a.zoomScalar}px\n                    )`})},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Math.ceil(a.gridSpan/256),(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"ruler-tick-label",style:(0,h.Tr)({left:`calc(${256*(e-1)*a.zoomScalar}px)`})},(0,h.v_)(e),5)))),128)),(0,o.Lk)("div",{class:"marker-replay-triangle",style:(0,h.Tr)({left:a.markerReplayPosition*a.zoomScalar+"px"})},null,4),(0,o.Lk)("div",{class:"marker-wrapper",style:(0,h.Tr)({left:a.markerPosition*a.zoomScalar+"px"})},X,4),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.tempoMarkers,((e,t)=>((0,o.uX)(),(0,o.Wv)(c,{key:e.left,left:e.left*a.zoomScalar+1,tempo:e.tempo,index:t,color:e.color,visible:e.muted?"hidden":"visible",onClick:a.clickTempoMarker},null,8,["left","tempo","index","color","visible","onClick"])))),128))],36),(0,o.Lk)("div",A,[(0,o.Lk)("div",{class:"grid",ref:"grid",style:(0,h.Tr)({width:a.gridSpan*a.zoomScalar+"px",background:a.backgroundStyle.background}),onMousedown:t[12]||(t[12]=(0,n.D$)(((...e)=>a.handleGridClick&&a.handleGridClick(...e)),["left"])),onContextmenu:t[13]||(t[13]=(0,n.D$)(((...t)=>e.startNoteRemove&&e.startNoteRemove(...t)),["prevent"])),onWheel:t[14]||(t[14]=(...e)=>a.handleGridScroll&&a.handleGridScroll(...e))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.notesInGrid,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"note",style:(0,h.Tr)({left:e.left*a.zoomScalar+"px",top:e.top+"px",width:(e.width+1)*a.zoomScalar-1+"px",height:a.gridHeight+"px",visibility:e.muted?"hidden":"visible",pointerEvents:e.muted?"none":"auto",backgroundColor:a.hexToRgba(e.color,(e.volume+1)/15),border:`${e.highlighted?2:1}px solid ${e.highlighted?"white":e.color}`}),onMousedown:[(0,n.D$)((t=>a.startDrag(e,t)),["left"]),(0,n.D$)((t=>a.removeNote(e,!1,t)),["right","prevent"])],onMouseup:t[11]||(t[11]=(0,n.D$)(((...e)=>a.endDrag&&a.endDrag(...e)),["left"])),onMouseover:t=>a.removeNote(e,!1,t)},[(0,o.Lk)("div",{class:"resize-handle",onMousedown:t=>a.startResize(e,t)},null,40,F),(0,o.Lk)("div",{class:"volume-handle",onMousedown:t=>a.startVolumeChange(e,t)},null,40,V),(0,o.eW)(" "+(0,h.v_)(e.name+`(${e.volume})`),1)],44,H)))),128)),a.isSelecting?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"selection-rect",style:(0,h.Tr)(a.rectangleStyle)},null,4)):(0,o.Q3)("",!0)],36)])],512)])}l(44114);var P=l(20715);const z=e=>((0,o.Qi)("data-v-2dc8a40b"),e=e(),(0,o.jt)(),e),_={key:0},G={key:1},B={key:0,class:"modal-background"},U={class:"help-modal"},j=z((()=>(0,o.Lk)("div",{class:"help-content"},[(0,o.Lk)("h1",null,"Help"),(0,o.Lk)("p",{class:"credits"},"MOS v1.1"),(0,o.Lk)("h3",null,"Navigating the Grid"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"Scroll within the grid using the scroll bars, or directly with your mouse wheel."),(0,o.Lk)("li",null,"Scrolling your mouse wheel normally will move the grid vertically."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" while scrolling will move the grid horizontally.")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" and scrolling will zoom the grid in and out.")]),(0,o.Lk)("li",null,"If the grid is focused (after clicking inside it), you can use the arrow keys to navigate around the grid.")]),(0,o.Lk)("h3",null,"Placing Notes"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"To place notes, click anywhere on the grid."),(0,o.Lk)("li",null,"The size of the note will be the same size as the note that was last placed/moved."),(0,o.Lk)("li",null,"Placed notes are instantly draggable."),(0,o.Lk)("li",null,"The color of the placed notes will depend on the color of the track they belong to."),(0,o.Lk)("li",null,'By changing the "Grid Spacing" dropdown, you can control whether the grid is in 16ths or 12ths.'),(0,o.Lk)("li",null,"Each instrument has a different range of notes that it can play. The red keys on the piano to the left indicate notes that will not make a sound with the current instrument.")]),(0,o.Lk)("h3",null,"Dragging Notes"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"To drag a note, click on the left side of the note. Then, move your mouse around within the bounds of the grid."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Alt"),(0,o.eW)(" will move notes freely (not locked to the grid).")]),(0,o.Lk)("li",null,"If multiple notes are selected, all selected notes will be moved together (even if they are from different tracks).")]),(0,o.Lk)("h3",null,"Resizing Notes"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"To resize a note, click on the right side of the note, then drag left or right."),(0,o.Lk)("li",null,"Notes have a minimum length of 1/64th of a beat."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Alt"),(0,o.eW)(" will resize notes freely (not locked to the grid)")]),(0,o.Lk)("li",null,"If multiple notes are selected, all selected notes will be resized together.")]),(0,o.Lk)("h3",null,"Note Volume"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"The current note volume can be seen at the top of the screen."),(0,o.Lk)("li",null,"A note's volume is indicated by the opacity of the note, as well as the number next to the note's name."),(0,o.Lk)("li",null,"To change a note's volume, left click and hold on the half-circle at the bottom center of the note. Then, drag your mouse up and down. Dragging up will increase the note's volume, and dragging down will decrease it."),(0,o.Lk)("li",null,"Notes start with a default volume of 8."),(0,o.Lk)("li",null,"Notes have a volume range from 1 to 15.")]),(0,o.Lk)("h3",null,"Selecting Multiple Notes"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,[(0,o.eW)("To select multiple notes at once, hold "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" on the grid and drag your mouse.")]),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"Ctrl+Shift"),(0,o.eW)(' and drag, you will "add on" to your note selection. '),(0,o.Lk)("i",null,"(Previously selected notes will not be unselected, and you can select additional notes.)")]),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and drag a note, you will clone it (if that note is highlighted, it will clone all highlighted notes).")]),(0,o.Lk)("li",null,[(0,o.eW)("Pressing "),(0,o.Lk)("strong",null,"Ctrl+A"),(0,o.eW)(" will select all notes in the grid.")]),(0,o.Lk)("li",null,[(0,o.eW)("Pressing the "),(0,o.Lk)("strong",null,"Backspace"),(0,o.eW)(" or "),(0,o.Lk)("strong",null,"Delete"),(0,o.eW)(" keys will delete all selected notes.")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" and pressing the left or right arrows will move the selected notes a whole grid space (i.e. 1/16th or 1/12th).")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" and pressing the up or down arrows will move the selected notes an octave (if possible).")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and pressing the left or right arrows will move the selected notes a fourth of a grid space (i.e. 1/64th or 1/48th).")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and pressing the up or down arrows will move the selected notes up or down a single note (if possible).")]),(0,o.Lk)("li",null,[(0,o.eW)("Pressing "),(0,o.Lk)("strong",null,"T"),(0,o.eW)(" with notes selected will move them into the currently selected track.")])]),(0,o.Lk)("h3",null,"Tracks"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"Each track has its own name, instrument, color, and visibility/mute toggle."),(0,o.Lk)("li",null,"To add a track, click on the blue plus button to the right of the tracks."),(0,o.Lk)("li",null,[(0,o.eW)("To rename a track, double click on the track's name. When done with renaming, press "),(0,o.Lk)("strong",null,"Enter"),(0,o.eW)(".")]),(0,o.Lk)("li",null,"To mute/unmute a track, click on the volume icon next to the track's name."),(0,o.Lk)("li",null,"Clicking on a note from another track will cause you to switch to that note's track."),(0,o.Lk)("li",null,[(0,o.eW)("You can remove a track by clicking on the "),(0,o.Lk)("strong",null,"X"),(0,o.eW)(". This will also remove the notes belonging to that track.")]),(0,o.Lk)("li",null,"To change the color of a track and its notes, click on the outlined box at the bottom-center of the selected track's tab."),(0,o.Lk)("li",null,"You can have a minimum of 1 track, and a maximum of 16 tracks."),(0,o.Lk)("li",null,"The number of tracks you can have at once is dependant on screen width. This is so that smaller screens can still access all of their created tabs easily."),(0,o.Lk)("li",null,"Hovering over a track tab will show you the name of the track."),(0,o.Lk)("li",null,[(0,o.eW)("With notes selected, pressing "),(0,o.Lk)("strong",null,"Ctrl+C"),(0,o.eW)(" or "),(0,o.Lk)("strong",null,"Ctrl+X"),(0,o.eW)(" will copy/cut notes.")]),(0,o.Lk)("li",null,[(0,o.eW)("After copying/cutting notes, you can paste them back in with "),(0,o.Lk)("strong",null,"Ctrl+V"),(0,o.eW)(". This will paste all previously copied notes into the current track.")])]),(0,o.Lk)("h3",null,"Track Splitting"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'With a track selected, click the "Split Track" button. This will separate the track into multiple other tracks (unless that number would exceed 16).'),(0,o.Lk)("li",null,"A track is split from left to right, then top to bottom. This can sometimes lead to weird splits."),(0,o.Lk)("li",null,"The purpose of this feature is so that you can compose parts of your piece in a single track, then split them up if you need to.")]),(0,o.Lk)("h3",null,"Exporting to MML"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'Clicking on the "Gen MML" button will copy the MML of audible tracks to your clipboard.'),(0,o.Lk)("li",null,"Only unmuted/audible tracks will be copied to your clipboard."),(0,o.Lk)("li",null,"A maximum of four tracks can be exported at once."),(0,o.Lk)("li",null,"Remember that the fourth track in a score is always the 'song' track."),(0,o.Lk)("li",null,"Tracks that have multiple notes playing at once will NOT export properly, so be sure to split them before export."),(0,o.Lk)("li",null,"The exported MML will be moderately optimized for length, but don't expect them to be perfect."),(0,o.Lk)("li",null,"Tracks will be exported sorted by number of notes. If a track has more notes, then it will be first.")]),(0,o.Lk)("h3",null,"Importing MML"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'Clicking on the "Import MML From Clipboard" button will attempt to copy whatever is in your clipboard into new sequencer tracks.'),(0,o.Lk)("li",null,"Available import types are MMLs that start with `MML@` and end with a semicolon (;), or MMLs taken straight from Mabinogi score scrolls."),(0,o.Lk)("li",null,"Imported MMLs should not have any extraneous spaces, characters, or new line characters. Otherwise, they will not import properly."),(0,o.Lk)("li",null,"Importing from Mabinogi directly will named the tracks according to which track they came from (e.g. Melody, Harmony 1, Harmony 2, Song)")]),(0,o.Lk)("h3",null,"Tempo"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"You can change the tempo by entering a number at the top left of the page. Note that this will only change the starting tempo of the song."),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and left click on the ruler on top of the grid, you will be prompted to enter a tempo (BPM).")]),(0,o.Lk)("li",null,"Tempo markers will automatically be assigned to the currently selected track. This is visible through the color of the marker. Deleting the selected track will delete all associated tempo markers."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Alt"),(0,o.eW)(" while placing a marker will allow for more freedom in placement.")]),(0,o.Lk)("li",null,"Clicking on an existing tempo marker will allow you to modify it. By entering an empty string, you will delete the marker."),(0,o.Lk)("li",null,"Muting a track will also hide the tempo markers associated with that track.")]),(0,o.Lk)("h3",null,"Misc"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,[(0,o.eW)("Click and hold on the piano keys to play them. "),(0,o.Lk)("br"),(0,o.Lk)("em",null,"(Note: some instruments can only play certain keys)")]),(0,o.Lk)("li",null,[(0,o.eW)("Press "),(0,o.Lk)("strong",null,"Space"),(0,o.eW)(" to play your song. It will start from the marker.")]),(0,o.Lk)("li",null,[(0,o.eW)("Press "),(0,o.Lk)("strong",null,"Space"),(0,o.eW)(" again to pause your song. If you press "),(0,o.Lk)("strong",null,"Ctrl+Space"),(0,o.eW)(", it will stop the marker where it was.")]),(0,o.Lk)("li",null,[(0,o.eW)("Check the "),(0,o.Lk)("strong",null,"Loop"),(0,o.eW)(" checkbox to loop your song.")]),(0,o.Lk)("li",null,"Click and drag on the timeline to move the marker."),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"ALT"),(0,o.eW)(" while dragging, the marker will move freely.")]),(0,o.Lk)("li",null,"You can change instruments using the spinner at the top left of the page.")]),(0,o.Lk)("h3",null,"Planned Features"),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"MML export that lets you select track order manually."),(0,o.Lk)("li",null,"MIDI import/export support"),(0,o.Lk)("li",null,'Support for saving/loading "projects"'),(0,o.Lk)("li",null,"Undo/Redo functionality")]),(0,o.Lk)("p",{class:"credits"},"Credits: Made by Daderic")],-1)));function q(e,t,l,a,r,i){return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("button",{class:"help-button",onClick:t[0]||(t[0]=(...e)=>i.showHelp&&i.showHelp(...e))},[r.hoverHelp?((0,o.uX)(),(0,o.CE)("span",_,"Help")):((0,o.uX)(),(0,o.CE)("span",G," ? "))]),r.isHelpVisible?((0,o.uX)(),(0,o.CE)("div",B,[(0,o.bF)(n.eB,{name:"fade"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",U,[(0,o.Lk)("button",{class:"close-button",onClick:t[1]||(t[1]=(...e)=>i.closeHelp&&i.closeHelp(...e))},"X"),j])])),_:1})])):(0,o.Q3)("",!0)])}var Y={data(){return{hoverHelp:!1,isHelpVisible:!0}},methods:{showHelp(){this.isHelpVisible=!0},closeHelp(){this.isHelpVisible=!1}}},Q=l(71241);const J=(0,Q.A)(Y,[["render",q],["__scopeId","data-v-2dc8a40b"]]);var Z=J;const ee={class:"track-tab-container",ref:"tabContainerRef"},te=["onClick","title"],le={class:"tab-header"},ne=["onUpdate:modelValue","onBlur","onKeyup"],oe=["onDblclick"],ae=["onClick"],re=["onClick"],ie={key:0,class:"color-picker-container"},ue=["disabled"];function se(e,t,l,a,r,i){return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",ee,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.tracks,((e,l)=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:(0,h.C4)(["track-tab",{selected:a.selectedTrackIndex===l}]),onClick:e=>a.selectTrack(l),style:(0,h.Tr)({backgroundColor:e.color}),title:e.name},[(0,o.Lk)("div",le,[e.isEditingName?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:0,"onUpdate:modelValue":t=>e.name=t,onBlur:t=>e.isEditingName=!1,onKeyup:(0,n.jR)((t=>e.isEditingName=!1),["enter"]),class:"track-name-input"},null,40,ne)),[[n.Jo,e.name]]):((0,o.uX)(),(0,o.CE)("span",{key:1,onDblclick:t=>e.isEditingName=!0,class:"track-name"},(0,h.v_)(e.name),41,oe)),(0,o.Lk)("span",{class:"mute-icon",onClick:(0,n.D$)((e=>a.toggleMute(l)),["stop"])},(0,h.v_)(e.isMuted?"🔇":"🔊"),9,ae),(0,o.Lk)("button",{onClick:(0,n.D$)((e=>a.removeTrack(l)),["stop"]),class:"delete-btn"},"✖",8,re)]),a.selectedTrackIndex===l?((0,o.uX)(),(0,o.CE)("div",ie,[(0,o.bo)((0,o.Lk)("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>a.trackHexColor=e),class:"color-picker",onInput:t[1]||(t[1]=(...e)=>a.updateTrackColor&&a.updateTrackColor(...e))},null,544),[[n.Jo,a.trackHexColor]])])):(0,o.Q3)("",!0)],14,te)))),128)),(0,o.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>a.addTrack&&a.addTrack(...e)),class:"add-track-btn",disabled:!a.canAddTrack}," + ",8,ue)],512)])}const ce=(0,v.Kh)({}),de=(0,v.KR)([]),ve=(0,v.KR)(null),he=(0,o.EW)((()=>de.value[ve.value]||null)),me=(0,v.KR)("#ffffff");var pe={created(){ce.addTrack=this.addTrack},setup(e,{emit:t}){const l=(0,v.KR)(0),n=(0,v.KR)(null),a=(0,o.EW)((()=>{if(de.value.length>15)return!1;const e=75,t=de.value.length*e;return l.value-t-50>e})),r=()=>{n.value&&(l.value=n.value.clientWidth)},i=()=>{const e=Math.floor(360*Math.random()),t=75+25*Math.random(),l=50+10*Math.random(),n=(1-Math.abs(2*l/100-1))*(t/100),o=n*(1-Math.abs(e/60%2-1)),a=l/100-n/2;let[r,i,u]=e<60?[n,o,0]:e<120?[o,n,0]:e<180?[0,n,o]:e<240?[0,o,n]:e<300?[o,0,n]:[n,0,o];return r=Math.round(255*(r+a)),i=Math.round(255*(i+a)),u=Math.round(255*(u+a)),`#${((1<<24)+(r<<16)+(i<<8)+u).toString(16).slice(1)}`},u=(e=null,l=null,n=null,o=null)=>{const a={id:de.value.length+Date.now(),name:o||`Track ${de.value.length+1}`,isMuted:!1,color:n||i(),isEditingName:!1,notes:[],instrument:l||{name:"Lute",program:0,min:16,max:88}};return de.value.push(a),c(de.value.length-1),t("add-track",a,de.value.length-1),a},s=e=>{if(1===de.value.length)return;let l=!0;if(0!==de.value[e].notes.length&&(l=confirm(`Are you sure you want to delete the track "${de.value[e].name}"? All notes belonging to this track will also be deleted.`)),!l)return;let n=de.value[e];if(de.value.splice(e,1),0===de.value.length)ve.value=null,me.value="#ffffff";else{if(e===ve.value){const t=e<de.value.length?e:e-1;ve.value=t,me.value=de.value[t].color}else ve.value>e&&ve.value--;he.value&&(me.value=he.value.color)}t("remove-track",n,he.value)},c=e=>{ve.value=e,me.value=de.value[e].color,t("track-selected",de.value[e])},d=e=>{if(de.value[e].isMuted=!de.value[e].isMuted,de.value[e].isMuted)for(const t of de.value[e].notes)t.muted=!0;else for(const t of de.value[e].notes)t.muted=!1;t("mute-track",e)},h=e=>{const l=e.target.value;if(he.value){he.value.color=l,me.value=l;for(const e of he.value.notes)e.color=l}t("color-change",he.value,l)};return(0,o.sV)((()=>{u(),(0,o.dY)((()=>{r()})),window.addEventListener("resize",r)})),(0,o.xo)((()=>{window.removeEventListener("resize",r)})),{tracks:de,selectedTrackIndex:ve,trackHexColor:me,containerWidth:l,addTrack:u,removeTrack:s,selectTrack:c,toggleMute:d,updateTrackColor:h,selectedTrack:he,canAddTrack:a,tabContainerRef:n}}};const fe=(0,Q.A)(pe,[["render",se],["__scopeId","data-v-7c7d4df7"]]);var ke=fe;l(44847);function ge(e,t,l,n,a,r){return(0,o.uX)(),(0,o.CE)("div",{class:"tempo-marker",style:(0,h.Tr)({left:l.left+"px",visibility:l.visible}),onClick:t[0]||(t[0]=(...e)=>n.clickMarker&&n.clickMarker(...e))},[(0,o.Lk)("div",{class:"tempo-triangle",style:(0,h.Tr)({borderTop:"10px solid "+l.color,visibility:l.visible})},null,4),(0,o.Lk)("div",{class:"tempo-label",style:(0,h.Tr)({visibility:l.visible})},"T"+(0,h.v_)(l.tempo),5)],4)}var ye={props:{left:Number,tempo:Number,index:Number,color:String,visible:String},emits:["click"],setup(e,{emit:t}){const l=l=>{t("click",l,e.index)};return{clickMarker:l}}};const Le=(0,Q.A)(ye,[["render",ge],["__scopeId","data-v-770e7685"]]);var be=Le,we={name:"PianoRoll",components:{HelpMenu:Z,Tracks:ke,TempoMarker:be},setup(){const e="../MabiMML/",t=(0,v.KR)(null),l=(0,v.KR)(null),n=(0,v.KR)(null),a=(0,v.KR)(null),r=(0,v.KR)(!1),i=(0,v.KR)({name:"Lute",program:0,min:16,max:88}),u=(0,v.KR)(null),s=(0,v.KR)(120),c=(0,v.KR)(!1),d=(0,v.KR)(!1),h=(0,v.KR)([{name:"Lute",program:0,min:16,max:88},{name:"Ukulele",program:1,min:16,max:88},{name:"Mandolin",program:2,min:16,max:88},{name:"Whistle",program:3,min:12,max:88},{name:"Roncadora",program:4,min:12,max:88},{name:"Flute",program:5,min:15,max:88},{name:"Chalumeau",program:6,min:16,max:88},{name:"Tuba",program:18,min:12,max:95},{name:"Lyre",program:19,min:9,max:80},{name:"Electric Guitar",program:20,min:4,max:99},{name:"Piano",program:21,min:0,max:84},{name:"Violin",program:22,min:16,max:59},{name:"Cello",program:23,min:0,max:46},{name:"Harp",program:24,min:9,max:83},{name:"Tuned Violin",program:25,min:16,max:59},{name:"Tuned Cello",program:26,min:0,max:46},{name:"Drum Kit",program:27,min:29,max:53},{name:"Festival Lute",program:50,min:16,max:88},{name:"Festival Ukulele",program:51,min:16,max:88},{name:"Festival Mandolin",program:52,min:16,max:88},{name:"Fest/Tuned Whistle",program:53,min:12,max:83},{name:"Fest/Tuned Flute",program:54,min:15,max:83},{name:"Bass Drum",program:66,min:12,max:84},{name:"Snare Drum",program:67,min:12,max:84},{name:"Cymbals",program:68,min:12,max:84},{name:"Hand Chimes",program:77,min:9,max:80},{name:"Female Chorus",program:110,min:19,max:48},{name:"Male Chorus",program:100,min:14,max:46},{name:"Male Voice",program:120,min:17,max:49},{name:"Female Voice",program:121,min:12,max:45}]);let m=(0,v.KR)(16),p=(0,v.KR)(8);const f=(0,v.KR)(16),k=24,g=(0,v.KR)([]),y=(0,v.KR)([]),L=(0,v.KR)([]),b=(0,v.KR)([]),w=(0,v.KR)(0),M=(0,v.KR)(0),x=((0,v.KR)(0),(0,v.KR)(0),(0,v.KR)(0),(0,v.KR)(window.innerWidth)),T=(0,v.KR)(0),C=(0,v.KR)([]),E=(0,v.KR)(!1),N=(0,v.KR)(0),R=(0,v.KR)(0),K=(0,v.KR)(null),S=(0,v.KR)(0),W=(0,v.KR)(0),I=(0,v.KR)([]),O=(0,v.KR)(null),D=(0,v.KR)(!1),X=(0,v.KR)(1),A=(0,o.EW)((()=>({left:`${Math.min(w.value,N.value)}px`,top:`${Math.min(M.value,R.value)}px`,width:`${Math.abs(N.value-w.value)}px`,height:`${Math.abs(R.value-M.value)}px`,backgroundColor:"rgba(0, 100, 255, 0.3)",border:"1px solid rgba(0, 100, 255, 0.5)"}))),H=(0,o.EW)((()=>({background:`repeating-linear-gradient( /*This is the horizontal lines*/\n                0deg,\n                #bbb,\n                #bbb 2px,\n                transparent 2px,\n                transparent 24px\n            ),\n            repeating-linear-gradient( /*This is the Bar line*/\n                90deg,\n                #777,\n                #777 2px,\n                transparent 2px,\n                transparent ${256*X.value}px\n            ),\n            repeating-linear-gradient( /*This is the vertical lines*/\n                90deg,\n                #c0c0c0,\n                #c0c0c0 2px,\n                transparent 2px,\n                transparent ${f.value*X.value}px\n            ),\n            repeating-linear-gradient(/*This is the background colors*/\n                90deg,\n                #e0e0e0,\n                #e0e0e0 ${64*X.value}px,\n                #ccc ${64*X.value}px,\n                #ccc ${128*X.value}px\n            )`}))),F=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],V=["C#","D#","F#","G#","A#"],$=(0,v.KR)(F.map(((e,t)=>({name:e,index:t,isBlack:V.includes(e)})))),z=(0,v.KR)([0,1,2,3,4,5,6,7,8]),_=(0,v.KR)(!1),G=(0,v.KR)(""),B=(0,v.KR)(!1),U=(0,v.KR)(""),j=(0,v.KR)(16),q=(0,v.KR)(88);let Y=[];(0,o.nT)((()=>{const e=Math.max(...g.value.map((e=>e.left+e.width)),0);x.value=Math.max(e+window.innerWidth/X.value,window.innerWidth/X.value)}));const Q=(e,t,l)=>ce.addTrack(null,e,t,l),J=e=>{i.value=e.instrument,ve.value=de.value.indexOf(e),Xe()},Z=async(e,t)=>{},ee=async(e,t)=>{for(const l of e.notes)yt(l,!0);I.value=I.value.filter((t=>t.parentTrack.id!==e.id))},te=async e=>{D.value&&Re();const t=de.value[e];for(const l of I.value)l.parentTrack===t&&(l.muted=t.isMuted)},le=(e,t)=>{for(const l of I.value)l.parentTrack===e&&(l.color=t)},ne=async()=>{try{const t=await fetch(e+"soundfonts/mabi_instruments_high_quality.sf3"),l=await t.arrayBuffer();return l}catch(t){return console.error("Failed to load SoundFont:",t),null}},oe=e=>{const t="Leave Site? Changes you made may not be saved.";return e.preventDefault(),e.returnValue=t,"message"};(0,o.sV)((async()=>{try{const t=document.querySelector(".grid-wrapper");t&&(t.addEventListener("scroll",Ee),Ee()),document.addEventListener("keydown",Ce),window.addEventListener("beforeunload",oe),a.value=new AudioContext,await a.value.audioWorklet.addModule(e+"worklet_processor.min.js");const l=await ne();if(!l)return;n.value=new P.gV(a.value.destination,l,!0,void 0,{chorusEnabled:!1,reverbEnabled:!1}),n.value.setMainVolume(2),n.value.setLogLevel(!1,!1,!1,!1),await n.value.isReady}catch(t){console.error("Error initializing sequencer or synthesizer:",t)}})),(0,o.xo)((()=>{window.removeEventListener("beforeunload",oe)}));const ae=e=>{0===e.button&&(e.shiftKey?re(e):ue(e))},re=e=>{const t=e.altKey?f.value/4:f.value,l=Math.round((e.clientX-K.value.getBoundingClientRect().left)/t/X.value)*t,n=prompt("Enter tempo (BPM):","120");null===n||isNaN(n)||""===n||I.value.push({left:l,tempo:Number(n),color:he.value.color,parentTrack:he.value,muted:!1})},ie=(e,t)=>{if(e.preventDefault(),0!==e.button)return;const l=prompt("Enter tempo (BPM):","120");null!==l&&(isNaN(l)||""===l?I.value.splice(t,1):I.value[t].tempo=Number(l))},ue=e=>{D&&Ne(),Te(e.clientX,e.altKey,!0),document.addEventListener("mousemove",se),document.addEventListener("mouseup",pe)},se=e=>{Te(e.clientX,e.altKey,!0)},pe=async()=>{document.removeEventListener("mousemove",se),document.removeEventListener("mouseup",pe)};let fe,ke,ge,ye=0;async function Le(){D.value=!0,ke=S.value,ge=s.value,I.value.sort(((e,t)=>{e.left,t.left})),be()}function be(){let e=0;ye=0,ge=s.value;let t=I.value[ye];while(t&&t.left<S.value)S.value>0&&(ge=t.tempo),ye++,t=I.value[ye];const l=document.querySelector(".grid-wrapper");function n(){S.value<0&&(ge=s.value,ye=0,e=0,ke=0,S.value=0),t=I.value[ye];while(t&&t.muted)ye++,t=I.value[ye];t&&null!==t&&S.value>=t.left&&(ye++,ke=S.value,e=O.value.currentTime,ge=t.tempo),S.value=4*(O.value.currentTime-e)*16*ge/60+ke,d.value&&(l.scrollLeft=S.value*X.value-.66*screen.width),O.value&&!c.value&&(O.value.loop=c.value)}clearInterval(fe),n(),fe=setInterval(n,5)}function we(e){let t="",l=e,n=[];for(let a=1;a<=64;++a)if(a<12||a%12===0||a%16===0){let e=Math.round(256/a*100),t=Math.round(256/a*150);n.push({length:t,name:"L"+a+"."}),n.push({length:e,name:"L"+a})}let o=Me(n,l);return t=o.noteCombination.map((e=>e.name)).join("&"),t}function Me(e,t){let l=Math.round(100*t);const n=new Array(l+1).fill(1/0);n[0]=0;const o=new Array(l+1).fill(-1);for(let i=1;i<=l;i++)for(const t of e){const e=t.length;i>=e&&n[i-e]+1<n[i]&&(n[i]=n[i-e]+1,o[i]=t)}if(n[l]===1/0)return{minNotes:null,noteCombination:[]};const a=[];let r=l;while(r>0){const e=o[r];a.push(e),r-=e.length}return{minNotes:n[l],noteCombination:a}}const xe=()=>{clearInterval(fe),D.value=!1},Te=(e,t,l)=>{if(K.value){const n=K.value.getBoundingClientRect();let o=Math.round((e-n.left)/X.value/(f.value/4))*(f.value/4),a=f.value*(X.value<=.5?64/f.value:1);t||(o=Math.round(o/a)*a),o=Math.max(0,Math.min(x.value,o)),S.value=o,l&&(W.value=o)}};function Ce(e){if(!he.value.isEditingName){if("Backspace"===e.key||"Delete"===e.key){for(const e of C.value)yt(e,!0);D.value&&Re()}if("Space"===e.code)e.preventDefault(),D.value?(Ne(),e.ctrlKey||(S.value=W.value)):Re();else if("a"===e.key&&e.ctrlKey&&!he.value.isEditingName){e.preventDefault();for(const e of g.value)lt(e);We(`Selected ${C.value.length} notes!`,1e3)}else if("ArrowUp"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?12:1;for(const e of C.value)if(e.top-k*t<-0)return;for(const e of C.value){e.top-=k*t;const l=(1284-e.top/2)/144,n=F[12*l%12]+""+Math.floor(l);e.name=n,e.pitch=12*l%12+12*(Math.floor(l)+1)}}}else if("ArrowDown"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?12:1;for(const e of C.value)if(e.top+k*t>=z.value.length*k*12)return;for(const e of C.value){e.top+=k*t;const l=(1284-e.top/2)/144,n=F[12*l%12]+""+Math.floor(l);e.name=n,e.pitch=12*l%12+12*(Math.floor(l)+1)}}}else if("ArrowLeft"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?1:4;for(const e of C.value)if(Math.round(1e3*(e.left-f.value/t))/1e3<0)return;for(const e of C.value)e.left=Math.round(1e3*(e.left-f.value/t))/1e3}}else if("ArrowRight"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?1:4;for(const e of C.value)e.left=Math.round(1e3*(e.left+f.value/t))/1e3}}else if("c"===e.key&&e.ctrlKey){e.preventDefault(),Y=[];for(const e of C.value)Y.push(e);We(`Copied ${Y.length} note${Y.length>1?"s":""} to the clipboard!`,1e3)}else if("x"===e.key&&e.ctrlKey){e.preventDefault(),Y=[];for(const e of C.value)Y.push(e),yt(e,!0);We(`Cut ${Y.length} note${Y.length>1?"s":""} and put them in the clipboard!`,1e3)}else if("v"===e.key&&e.ctrlKey){e.preventDefault(),Qe();for(const e of Y){const t={id:g.value.length+Date.now(),name:e.name,left:Math.round(4*Math.round((e.left+T.value/X.value)*f.value/4)/f.value),top:e.top,pitch:e.pitch,width:e.width,length:e.length,highlighted:!0,color:he.value.color,start:e.start,end:e.end,volume:e.volume,muted:!1,track:he.value};C.value.push(t),g.value.push(t),t.track.notes.unshift(t)}We(`Pasted ${Y.length} notes from the clipboard!`,1e3)}else if("t"===e.key&&C.value.length>0){for(const e of de.value)e.notes=e.notes.filter((e=>!C.value.includes(e)));for(const e of C.value)e.track=he.value,e.color=he.value.color,he.value.notes.unshift(e);We(`Moved ${C.value.length} notes into track "${he.value.name}"!`,1e3)}}}function Ee(){const e=document.querySelector(".grid-wrapper"),t=document.querySelector(".ruler");e&&t&&(T.value=e.scrollLeft,t.style.left=-T.value+"px")}function Ne(){O.value&&O.value.stop(),xe(),n.value.programChange(0,i.value.program)}const Re=async(e=null)=>{try{if(e&&D.value)return Ne(),void(S.value=W.value);if(u.value=new P.Hm("untitled",480,s.value),await a.value.resume(),!n.value)return;let t=0,l=[];for(const e of de.value)e.isMuted||(l.push(e),u.value.addNewTrack(e.name+de.value.indexOf(e)));g.value.forEach((e=>{if(!e.muted&&e.left+e.width>=S.value){let n=null;for(const t of de.value)t.notes.some((t=>t.id===e.id))&&(n=t);const o=l.indexOf(n),a=o,r=e.pitch,i=e.left/16*120,s=(e.width+1)/16*120,c=S.value/16*120,d=Math.max(i,c)-c,v=Math.min(s,i+s-c),h=Math.max(0,Math.min(127,8*(e.volume+1)-1));u.value.addEvent(d,o,192|15&a,[n.instrument.program]),u.value.addNoteOn(d,o,a,r,h),u.value.addNoteOff(d+v-1,o,a,r),t++}}));for(const e of I.value){if(e.parentTrack.isMuted)continue;const t=e.left/16*120,l=S.value/16*120,n=Math.max(t,l)-l;u.value.addSetTempo(n,e.tempo)}if(0===t)return;u.value.flush();const o=await(0,P.Nt)(u.value);O.value=new P.YC([{binary:o}],n.value),O.value.skipToFirstNoteOn=!1,O.value.loop=c.value&&0===S.value,await n.value.isReady,O.value.addOnSongEndedEvent((()=>{xe(),S.value=W.value,c.value&&!O.value.loop&&(S.value=0,Re())}),"test2"),await O.value.play(),Le()}catch(t){console.error("Error playing sequence: ",t)}},Ke=async(e,t,l)=>{try{a.value.resume(),await n.value.isReady,n.value.noteOn(e,t.index+12*(l+1),Math.max(0,Math.min(127,8*(p.value+1)-1)),!1)}catch(o){console.error(o)}},Se=async(e,t,l)=>{try{await n.value.isReady,n.value&&n.value.noteOff(e,t.index+12*(l+1))}catch(o){console.error(o)}},We=(e,t=2e3)=>{G.value=e,_.value=!0,setTimeout((()=>{_.value=!1}),t)},Ie=(e,t=2e3)=>{U.value=e,B.value=!0,setTimeout((()=>{B.value=!1}),t)},Oe=(e,t,l)=>{r.value&&0===y.value.length&&0===L.value.length&&Ke(e,t,l)},De=(e,t,l)=>{r.value&&0===y.value.length&&0===L.value.length&&Se(e,t,l)},Xe=async()=>{n.value&&i.value&&(he.value.instrument=i.value,j.value=i.value.min,q.value=i.value.max,n.value.programChange(0,i.value.program),D.value&&Re(),await n.value.isReady)},Ae=new Map,He=(e,t,l=!0)=>{if(t.preventDefault(),0===t.button&&0===L.value.length&&0===b.value.length){if(e.highlighted?y.value=C.value:(Qe(),y.value.push(e)),t.shiftKey&&l)for(const e of y.value){const t={id:g.value.length+Date.now(),name:e.name,left:e.left,top:e.top,pitch:e.pitch,width:e.width,length:e.length,highlighted:!1,color:e.color,start:e.start,end:e.end,volume:e.volume,muted:!1,track:e.track};g.value.push(t),t.track.notes.unshift(t)}for(const e of y.value)Ae.set(e.id,{x:t.clientX,y:t.clientY,left:e.left,top:e.top});m.value=e.length,p.value=e.volume,ve.value=de.value.indexOf(e.track),me.value=e.track.color,document.addEventListener("mousemove",Fe),document.addEventListener("mouseup",Ve)}},Fe=e=>{if(y.value&&0===L.value.length&&0===b.value.length){let t=!1;const l=[];let n=!1;for(const r of y.value)if(e.altKey||r.highlighted&&r.left%f.value!==0){n=!0;break}const o=n?f.value/4:f.value;let a=0;for(let r=0;r<y.value.length;++r){const n=y.value[r],i=Ae.get(n.id);if(!i)continue;const u=(e.clientX-i.x)/X.value,s=e.clientY-i.y;let c=0;0===r?(c=Math.round((i.left+u)/o)*o,a=c-i.left):c=i.left+a;let d=Math.round((i.top+s)/k)*k;if(c<0||d<0||d>2568){t=!0;break}l.push({note:n,newLeft:c,newTop:d})}if(t)return;for(const{note:e,newLeft:r,newTop:i}of l){e.left=r,e.top=i;const t=(1284-e.top/2)/144,l=F[12*t%12]+""+Math.floor(t);e.name!=l&&1===y.value.length&&(Ke(0,{name:l,index:12*t%12},Math.floor(t)),Se(0,{name:l,index:12*t%12},Math.floor(t))),e.name=l,e.pitch=12*t%12+12*(Math.floor(t)+1)}}},Ve=()=>{D.value&&Re(),y.value=[],document.removeEventListener("mousemove",Fe),document.removeEventListener("mouseup",Ve),Ae.clear()},$e=new Map,Pe=(e,t)=>{t.preventDefault(),0===t.button&&(L.value=[],w.value=t.clientX,$e.clear(),e.highlighted?(C.value.forEach((e=>{$e.set(e.id,{width:e.width,startX:t.clientX})})),L.value=C.value):(Qe(),$e.set(e.id,{width:e.width,startX:t.clientX}),L.value=[e]),document.addEventListener("mousemove",ze),document.addEventListener("mouseup",_e))},ze=e=>{if(L.value.length>0){let t=!0;const l=[];if(L.value.forEach((n=>{const o=$e.get(n.id);if(!o)return;const a=(e.clientX-o.startX)/X.value;let r=0;r=e.altKey?Math.round((o.width+a)/(f.value/4))*f.value/4-1:Math.round((o.width+a)/f.value)*f.value-1,r<f.value-1&&!e.altKey||r<3?t=!1:l.push({note:n,newWidth:r})})),t)for(const{note:e,newWidth:n}of l)e.width=n,e.length=(n+1)/f.value,m.value=e.length}},_e=()=>{L.value=[],$e.clear(),document.removeEventListener("mousemove",ze),document.removeEventListener("mouseup",_e)};let Ge=0;const Be=(e,t)=>{t.preventDefault(),0===t.button&&(b.value=[],M.value=t.clientY,e.highlighted?b.value=C.value:(Qe(),b.value=[e]),Ge=e.volume,document.addEventListener("mousemove",Ue),document.addEventListener("mouseup",je))},Ue=e=>{if(e.preventDefault(),b.value.length>0)for(const t of b.value){const l=M.value-e.clientY;let n=Math.round(Math.max(1,Math.min(15,Ge+l/10)));t.volume=n,p.value=n}},je=()=>{b.value=[],D.value&&Re(),document.removeEventListener("mousemove",Ue),document.removeEventListener("mouseup",je)},qe=e=>{e.ctrlKey&&y.value.length<=0?(e.shiftKey||Qe(),Je(e)):ot(e)},Ye=e=>{const t=1*-Math.sign(e.deltaY)/8;if(e.ctrlKey){e.preventDefault();const l=document.querySelector(".grid-wrapper"),n=X.value,o=l.scrollLeft,a=e.clientX-l.getBoundingClientRect().left+o;X.value=Math.min(8,Math.max(1/8,X.value+t));const r=X.value;l.scrollLeft+=a*(r/n-1)}};function Qe(){C.value.forEach((e=>{e.highlighted=!1})),C.value=[]}const Je=e=>{e.preventDefault(),E.value=!0;const t=l.value.getBoundingClientRect();w.value=e.clientX-t.left,M.value=e.clientY-t.top,N.value=e.clientX-t.left,R.value=e.clientY-t.top,document.addEventListener("mousemove",Ze),document.addEventListener("mouseup",et)},Ze=e=>{if(E.value){const t=l.value.getBoundingClientRect();N.value=e.clientX-t.left,R.value=e.clientY-t.top}},et=()=>{E.value&&(E.value=!1,document.removeEventListener("mousemove",Ze),document.removeEventListener("mouseup",et),tt())};function tt(){const e={left:Math.min(w.value,N.value)/X.value,top:Math.min(M.value,R.value),right:Math.max(w.value,N.value)/X.value,bottom:Math.max(M.value,R.value)};g.value.forEach((t=>{const l={left:t.left,top:t.top,right:t.left+t.width,bottom:t.top+k};nt(e,l)&&lt(t)}))}function lt(e){C.value.includes(e)||e.muted||(C.value.push(e),e.highlighted=!0)}function nt(e,t){return!(t.left>=e.right||t.right<=e.left||t.top>=e.bottom||t.bottom<=e.top)}const ot=e=>{if(y.value.length>0||L.value.length>0||b.value.length>0)return;const t=l.value.getBoundingClientRect(),n=e.clientX-t.left+l.value.scrollLeft*X.value,o=e.clientY-t.top+l.value.scrollTop;let a=Math.round((n-f.value/2)/f.value/X.value)*f.value;e.altKey&&(a=Math.round((n-f.value/2)/(f.value/4)/X.value)*f.value/4);const r=Math.round((o-k/2)/k)*k,i=(1284-r/2)/144,u=F[12*i%12]+""+Math.floor(i);Ke(0,{name:u,index:12*i%12},Math.floor(i)),Se(0,{name:u,index:12*i%12},Math.floor(i));const s=g.value.find((e=>e.left===a&&e.top===r&&!e.muted));if(s)He(s,e);else{Qe();const t=g.value.length+Date.now(),l={left:a,top:r,width:f.value*m.value-1,highlighted:!1,color:he.value?he.value.color:"hsla(212, 100%, 50%, 0.5)",id:t,name:u,pitch:12*i%12+12*(Math.floor(i)+1),length:m.value,start:a/f.value,end:a/f.value+m.value,volume:p.value,track:he.value};g.value.push(l),he.value.notes.unshift(l),He(g.value.find((e=>e.id==t)),e,!1)}},at=()=>{let e=[...he.value.notes].sort(((e,t)=>e.left===t.left?e.top-t.top:e.left-t.left)),t=[];t.push({notes:[],track:he.value,index:0});for(const l of e)for(const e of t){if(!e.notes[0]||e.notes[0].left+e.notes[0].width<l.left){e.notes.unshift(l);break}e.index===t.length-1&&t.push({notes:[],track:{instrument:e.track.instrument,color:null,name:he.value.name+` (${t.length})`},index:t.length})}if(de.value.length+t.length-1>16)Ie("Failed to split track! (Process would create too many tracks!)");else{We(`Successfully split the track "${he.value.name}" into ${t.length} tracks!`,3e3);for(const e of t){de.value.includes(e.track)||(e.track=Q(e.track.instrument,e.track.color,e.track.name)),e.track.notes=e.notes;for(const t of e.track.notes)t.track=e.track,t.color=e.track.color}}};function rt(e,t){let l=e.replace("#","");3===l.length&&(l=l.split("").map((e=>e+e)).join(""));const n=parseInt(l.substring(0,2),16),o=parseInt(l.substring(2,4),16),a=parseInt(l.substring(4,6),16);return`rgba(${n}, ${o}, ${a}, ${t})`}function it(e){navigator.clipboard.writeText(e).then((()=>{G.value="MML copied to clipboard!",_.value=!0,setTimeout((()=>{_.value=!1}),2e3)})).catch((e=>{console.error("Could not copy text: ",e)}))}const ut=()=>{for(const o of de.value)o.notes.sort(((e,t)=>e.left===t.left?e.top-t.top:e.left-t.left)),o.notes.reverse();let e="T"+s.value,t=[];for(const o of de.value)o.isMuted||t.push(o);for(const o of t)for(let e=0;e<o.notes.length;++e){let t=o.notes[e],l=e+1<o.notes.length?o.notes[e+1]:null;if(null===l)break;if(t.left<=l.left+l.width)return console.log("Could Not Gen MML"),Ie(`Failed to copy MML to clipboard! Track '${o.name}'' has overlapping notes!`),null}if(!(0<=t.length&&t.length<=4))return console.log("Could Not Gen MML"),Ie("Failed to copy MML to clipboard! Too many tracks visible!"),null;t.sort(((e,t)=>t.notes.length-e.notes.length));for(const o of t){let t=0,l=[];for(const e of I.value)e.parentTrack===o&&l.push(e);let n=[...l,...o.notes.slice().reverse()];n.sort(((e,t)=>e.left-t.left));for(const o of n){if(o.left>=t+4){let l=o.left-t,n=we(l);n=n.replaceAll("L","R"),e+=n}if(o.width){let l=we(o.width+1);if(l.includes("&")){let t=l.split("&");for(let l=0;l<t.length;++l)e+=t[l]+"V"+o.volume+"N"+(o.pitch-12)+(l===t.length-1?"":"&")}else e+=we(o.width+1)+"V"+o.volume+"N"+(o.pitch-12);t=o.left+o.width+1}else e+="T"+o.tempo,t=o.left}e+=","}e=e.slice(0,-1);let l=e.split(","),n=[];for(const o of l){let e=dt(o),t=vt(e),l=ht(t);n.push(l)}e=`MML@${n.join(",")};`,console.log(e),it(e)};function st(e){if(1===e.length)return e;let t=e[0],l=e[1],n=F.indexOf(t);return"#"===l||"+"===l?n=(n+1)%12:"-"===l&&(n=((n-1)%12+12)%12),F[n]}const ct={LENGTH:/L(\d+)\.?/g,NOTE:/[A-G][-+#]?\d*\.?|N\d+/g,REST:/R\d*\.?/g,TIE:/&/g,VOLUME:/V(\d+)/g,TEMPO:/T(\d+)/g,OCTAVE:/O(\d+)|[<>]/g};function dt(e){let t=[];for(const[l,n]of Object.entries(ct)){let o;while(null!==(o=n.exec(e)))t.push({type:l,value:o[0],index:o.index})}return t.sort(((e,t)=>e.index-t.index)),t}function vt(e){let t=JSON.parse(JSON.stringify(e)),l=10;for(let n=0;n<l;++n){let e=4,l="4",n="120",o="8";for(let a=0;a<t.length;++a){let r=t[a];if("LENGTH"===r.type){let e=r.value.split("L")[1];e!==l?l=e:(t.splice(a,1),a--)}else if("VOLUME"===r.type){let e=r.value.split("V")[1];e!==o?o=e:(t.splice(a,1),a--)}else if("TEMPO"===r.type){let e=r.value.split("T")[1];e!==n?n=e:(t.splice(a,1),a--)}else if("REST"===r.type){let e=r.value.split("R")[1];e===l&&(r.value="R")}else if("NOTE"===r.type){if(!r.value.includes("N"))continue;let l=Number(r.value.split("N")[1]),n=Math.floor(l/12),o=F[l-12*n];if(n!==e){let l=n-e,i=[];if(Math.abs(l)<3){let e=l>0?">":"<";for(let t=0;t<Math.abs(l);++t)i.push({type:"OCTAVE",value:e,index:r.index+t})}else i=[{type:"OCTAVE",value:"O"+n,index:r.index}];t.splice(a,1,...i,{type:"NOTE",value:o,index:r.index+i.length}),e=n}else r.value=o}}for(let a=0;a<t.length;++a){let e=t[a],l=a>0?t[a-1]:null;if("LENGTH"===e.type){let n=0,o=[];for(let e=a+1;e<t.length;++e){let l=t[e];if("NOTE"!==l.type&&"REST"!==l.type||""!==l.value.replace(/[A-GRN][#]?/g,"")){if("LENGTH"===l.type)break}else n++,o.push(e)}if(l&&"TIE"===l.type||n*e.value.length<=e.value.length+n){for(const l of o)t[l].value=t[l].value+e.value.split("L")[1];t.splice(a,1)}}else"TEMPO"===e.type||e.type}}return t}function ht(e){let t="";for(const l of e)t+=l.value;return t}function mt(e,t){let l=[...t],n=Q(h.value[10],null,e),o=4,a="4",r="120",i="8",u=0,s=null;for(let c=0;c<l.length;c++){let e=l[c];if("LENGTH"===e.type){let t=e.value.split("L")[1];t!==a&&(a=t)}else if("TIE"===e.type){if(null===s)continue;let e=l[c+1],t=a,n="C",r=o,i=0;if(e.value.startsWith("N")){i=Number(e.value.split("N")[1]),r=Math.floor(i/12),n=F[(i-12*r)%12];let l=t.includes(".");t=Number(t.slice(0,t.length-l))*(l?2/3:1)}else{let l=e.value.includes("#")||e.value.includes("+"),o=e.value.includes("-"),u=e.value.includes(".");n=st(e.value.slice(0,1+l+o));let s=F.indexOf(n);if(11===s&&o&&(r-=1),0===s&&l&&(r+=1),e.value.length-u>1+l+o)t=Number(e.value.slice(l||o?2:1,e.value.length-u))*(u?2/3:1);else{let e=a.includes(".");u=e||u,t=Number(a.slice(0,a.length-e))*(u?2/3:1)}i=F.indexOf(n)+12*r}s.pitch-12===i&&(u+=256/t,s.width+=256/t,s.length+=t,s.end+=t,c++)}else if("OCTAVE"===e.type){let t=e.value;"<"===t?o-=1:">"===t?o+=1:o=Number(t.split("O")[1])}else if("VOLUME"===e.type){let t=e.value.split("V")[1];t!==i&&(i=t)}else if("TEMPO"===e.type){let t=e.value.split("T")[1];t!==r&&(r=t,I.value.push({left:u,tempo:Number(r),color:n.color,parentTrack:n,muted:!1}))}else if("REST"===e.type){let t=e.value.split("R")[1];if(t===a||0===Number(t)||isNaN(Number(t))){let e=a.includes(".")||t.includes("."),l=Number(a);u+=256/l*(e?1.5:1)}else{let e=t.includes("."),l=Number(t);u+=256/l*(e?1.5:1)}}else if("NOTE"===e.type){let t=a,l="C",r=o,c=0;if(e.value.startsWith("N")){c=Number(e.value.split("N")[1]),r=Math.floor(c/12),l=F[(c-12*r)%12];let n=t.includes(".");t=Number(t)*(n?2/3:1)}else{let n=e.value.includes("#")||e.value.includes("+"),o=e.value.includes("-"),i=e.value.includes(".");l=st(e.value.slice(0,1+n+o));let u=F.indexOf(l);if(11===u&&o&&(r-=1),0===u&&n&&(r+=1),e.value.length-i>1+n+o)t=Number(e.value.slice(n||o?2:1,e.value.length))*(i?2/3:1);else{let e=a.includes(".");i=e||i,t=Number(a)*(i?2/3:1)}c=F.indexOf(l)+12*r}const d={left:u,top:2568-c*k,width:256/t-1,highlighted:!1,color:n.color,id:g.value.length+Date.now(),name:l+r,pitch:c+12,length:t,start:u,end:u+t,volume:Number(i),track:n};g.value.push(d),d.track.notes.unshift(d),u+=d.width+1,s=d}}}function pt(e){const t=e.replace(/\s/,"").toUpperCase().match(/MML@([^;]+);/)[1].split(",");for(const l of t)l.length>0&&mt(null,dt(l))}function ft(e){const t=e.split("\r\n");let l=[];for(let n=2;n<t.length;++n){let e=t[n].split(" : ");e.length<2||l.push({title:e[0].trim(),tokens:dt(e[1].trim().toUpperCase())})}for(const n of l)n.tokens.length>0&&mt(n.title,n.tokens)}function kt(e){e.trim().startsWith("MML@")&&e.trim().endsWith(";")?pt(e):ft(e)}async function gt(){const e=await navigator.clipboard.readText();kt(e),We("Successfully imported tracks from clipboard!",1e3)}const yt=(e,t,l=null)=>{if(l&&2!==l.buttons)return;C.value=C.value.filter((t=>t.id!==e.id));let n=g.value.length;g.value=g.value.filter((t=>t.id!==e.id));g.value.length;for(const o of de.value)o.notes=o.notes.filter((t=>t.id!==e.id));!t&&D.value&&Re()};return document.addEventListener("mousedown",(e=>{r.value=!0})),document.addEventListener("mouseup",(()=>{r.value=!1})),{notes:$,octaves:z,startNote:Ke,endNote:Se,mouseOverNote:Oe,mouseLeaveNote:De,instruments:h,selectedInstrument:i,changeInstrument:Xe,pianoRoll:t,grid:l,notesInGrid:g,startDrag:He,endDrag:Ve,startPlacingNote:ot,startVolumeChange:Be,removeNote:yt,gridWidth:f,gridHeight:k,gridSpan:x,startResize:Pe,endResize:_e,onResize:ze,currentNoteLength:m,playSequence:Re,tempo:s,handleGridClick:qe,handleGridScroll:Ye,isSelecting:E,rectangleStyle:A,handleRulerClick:ae,markerPosition:S,markerReplayPosition:W,ruler:K,loopSong:c,trackify:at,noteWidthToMML:we,backgroundStyle:H,genMML:ut,showSuccessNotification:_,successNotificationText:G,showFailedNotification:B,failedNotificationText:U,handleTrackSelected:J,handleAddTrack:Z,handleRemoveTrack:ee,handleMuteTrack:te,instrKeyMin:j,instrKeyMax:q,hexToRgba:rt,currentNoteVolume:p,clickTempoMarker:ie,tempoMarkers:I,updateColor:le,zoomScalar:X,autoScrollSong:d,parseMMLFromClipboard:gt}}};const Me=(0,Q.A)(we,[["render",$],["__scopeId","data-v-61b8a8dc"]]);var xe=Me;var Te={name:"PatternEditor",components:{PianoRoll:xe},setup(){const e=(0,v.KR)(null);return{scrollContainer:e}}};const Ce=(0,Q.A)(Te,[["render",d],["__scopeId","data-v-233a7f0a"]]);var Ee=Ce,Ne={name:"App",components:{PatternEditor:Ee}};const Re=(0,Q.A)(Ne,[["render",u]]);var Ke=Re;(0,n.Ef)(Ke).mount("#app")}},t={};function l(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,l),a.exports}l.m=e,function(){var e=[];l.O=function(t,n,o,a){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],o=e[c][1],a=e[c][2];for(var i=!0,u=0;u<n.length;u++)(!1&a||r>=a)&&Object.keys(l.O).every((function(e){return l.O[e](n[u])}))?n.splice(u--,1):(i=!1,a<r&&(r=a));if(i){e.splice(c--,1);var s=o();void 0!==s&&(t=s)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,o,a]}}(),function(){l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,{a:t}),t}}(),function(){l.d=function(e,t){for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){l.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){l.p="/MabiMML/"}(),function(){l.b=document.baseURI||self.location.href;var e={524:0};l.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,r=n[0],i=n[1],u=n[2],s=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)l.o(i,o)&&(l.m[o]=i[o]);if(u)var c=u(l)}for(t&&t(n);s<r.length;s++)a=r[s],l.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return l.O(c)},n=self["webpackChunkmusic_sequencer"]=self["webpackChunkmusic_sequencer"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=l.O(void 0,[504],(function(){return l(18988)}));n=l.O(n)})();
//# sourceMappingURL=app.01753096.js.map