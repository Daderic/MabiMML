{"version":3,"file":"js/app.6eaf1462.js","mappings":"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","sources":["webpack://music-sequencer/./src/App.vue","webpack://music-sequencer/./src/components/PatternEditor.vue","webpack://music-sequencer/./src/components/PianoRoll.vue","webpack://music-sequencer/./src/components/HelpMenu.vue","webpack://music-sequencer/./src/components/HelpMenu.vue?d290","webpack://music-sequencer/./src/components/Tracks.vue","webpack://music-sequencer/./src/components/Tracks.vue?6cb4","webpack://music-sequencer/./src/components/TempoMarker.vue","webpack://music-sequencer/./src/components/TempoMarker.vue?dda8","webpack://music-sequencer/./src/components/ExportMenu.vue","webpack://music-sequencer/./src/components/ExportMenu.vue?3d5c","webpack://music-sequencer/./src/components/PianoRoll.vue?b086","webpack://music-sequencer/./src/components/Sequencer.vue","webpack://music-sequencer/./src/components/PatternEditor.vue?415c","webpack://music-sequencer/./src/App.vue?7ccd","webpack://music-sequencer/./src/main.js","webpack://music-sequencer/webpack/bootstrap","webpack://music-sequencer/webpack/runtime/chunk loaded","webpack://music-sequencer/webpack/runtime/compat get default export","webpack://music-sequencer/webpack/runtime/define property getters","webpack://music-sequencer/webpack/runtime/global","webpack://music-sequencer/webpack/runtime/hasOwnProperty shorthand","webpack://music-sequencer/webpack/runtime/publicPath","webpack://music-sequencer/webpack/runtime/jsonp chunk loading","webpack://music-sequencer/webpack/startup"],"sourcesContent":["<template>\n  <!--img alt=\"Vue logo\" src=\"./assets/logo.png\"></!-->\n  <div id=\"app\">\n    <PatternEditor />\n  </div>\n</template>\n\n<script>\nimport PatternEditor from './components/PatternEditor.vue';\nimport PianoRoll from './components/PianoRoll.vue';\n\nexport default {\n  name: 'App',\n  components: {\n    PatternEditor\n  }\n}\n</script>\n\n<style>\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background-color: #ddd;\n}\n</style>\n","<template>\r\n    <div class=\"pattern-editor\">\r\n        <div class=\"scroll-container\" ref=\"scrollContainer\">\r\n            <PianoRoll />\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from 'vue';\r\nimport PianoRoll from './PianoRoll.vue';\r\nimport Sequencer from './Sequencer.vue';\r\n\r\nexport default {\r\n    name: 'PatternEditor',\r\n    components: {\r\n        PianoRoll\r\n    },\r\n    setup() {\r\n        const scrollContainer = ref(null);\r\n\r\n        return {\r\n            scrollContainer\r\n        };\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.pattern-editor {\r\n    height: 100%;\r\n    width: 100%;\r\n    overflow: hidden;\r\n}\r\n\r\n.scroll-container {\r\n    height: 100%;\r\n    width: 100%;\r\n    overflow: auto;\r\n    display: flex;\r\n}\r\n</style>\r\n","<template>\r\n    <div class=\"piano-container\">\r\n        <button class=\"play-button\" @click=\"playSequence\">Play Sequence</button>\r\n        <label class=\"loop-wrapper\">\r\n            Loop:\r\n            <input type=\"checkbox\" v-model=\"loopSong\" />\r\n        </label>\r\n        <label class=\"scroll-wrapper\">\r\n            Auto-scroll:\r\n            <input type=\"checkbox\" v-model=\"autoScrollSong\" />\r\n        </label>\r\n        <ExportMenu :tracks=\"tracks\" :generateTokens=\"genTokensOutright\" :renderTokens=\"renderTokens\"\r\n            :copyToClipboard=\"copyToClipboard\" />\r\n        <HelpMenu />\r\n        <div v-if=\"showSuccessNotification\" class=\"copyNotification\">\r\n            {{ successNotificationText }}\r\n        </div>\r\n        <div v-if=\"showFailedNotification\" class=\"copyNotification\" style=\"background-color: #d44;\">\r\n            {{ failedNotificationText }}\r\n        </div>\r\n\r\n        <Tracks @track-selected=\"handleTrackSelected\" @add-track=\"handleAddTrack\" @remove-track=\"handleRemoveTrack\"\r\n            @mute-track=\"handleMuteTrack\" @color-change=\"updateColor\" />\r\n        <div class=\"controls\">\r\n            <div class=\"instrument-selector\">\r\n                <label for=\"instrument-select\">Select Instrument: </label>\r\n                <select id=\"instrument-select\" v-model=\"selectedInstrument\" @change=\"changeInstrument(false)\">\r\n                    <option v-for=\"(instrument, index) in instruments\" :key=\"index\" :value=\"instrument\">\r\n                        {{ instrument.name }}\r\n                    </option>\r\n                </select>\r\n            </div>\r\n            <div class=\"tempo-selector\">\r\n                <label for=\"tempo-select\">Tempo: </label>\r\n                <input type=\"number\" id=\"tempo-select\" v-model.number=\"tempo\" min=\"40\" max=\"240\">\r\n            </div>\r\n            <button class=\"track-splitter\" @click=\"trackify\">Split Track</button>\r\n            <!--<button class=\"MML-converter\" @click=\"genTokensOutright\" style=\"margin-left: 10px;\">Gen MML</button>-->\r\n            <button @click=\"parseMMLFromClipboard\" style=\"margin-left: 10px;\">Import MML From Clipboard</button>\r\n            <button @click=\"importMidi\" style=\"margin-left: 10px;\">Import MIDI</button>\r\n            <button @click=\"exportMidi\" style=\"margin-left: 10px;\">Export MIDI</button>\r\n            <input type=\"file\" id=\"hiddenFileInput\" style=\"display: none\" accept=\".mid,.midi\" />\r\n            <div class=\"grid-division-selector\">\r\n                <label for=\"grid-select\" style=\"padding-left: 10px\">Grid Spacing: </label>\r\n                <select id=\"grid-select\" v-model=\"gridWidth\">\r\n                    <option\r\n                        v-for=\"(value) in [{ displayName: '16ths', width: 256 / 16 }, { displayName: '12ths', width: 256 / 12 }]\"\r\n                        :key=\"value.displayName\" :value=\"value.width\">\r\n                        {{ value.displayName }}\r\n                    </option>\r\n                </select>\r\n            </div>\r\n            <label style=\"padding: 10px;\"> {{ 'Current Note Volume: ' + currentNoteVolume }} </label>\r\n        </div>\r\n        <div class=\"piano-roll\" ref=\"pianoRoll\">\r\n            <div class=\"piano-keys\">\r\n                <!-- Generate piano keys for multiple octaves -->\r\n                <div v-for=\"octave in octaves\" :key=\"octave\" class=\"octave\">\r\n                    <div class=\"keys-wrapper\">\r\n                        <!-- Keys should be in reverse order to have higher notes at the top -->\r\n                        <div v-for=\"(note, index) in notes.slice().reverse()\" :key=\"note.name\"\r\n                            :class=\"['piano-key', note.isBlack ? 'black-key' : 'white-key']\"\r\n                            @mousedown=\"startNote(0, note, octave)\" @mouseover=\"mouseOverNote(0, note, octave)\"\r\n                            @mouseup=\"endNote(0, note, octave)\" @mouseleave=\"mouseLeaveNote(0, note, octave)\" :style=\"{\r\n                                zIndex: note.isBlack ? 1 : 0,\r\n                                background: note.index + 12 * octave < instrKeyMin || note.index + 12 * octave > instrKeyMax ? '#d44' : (note.isBlack ? '#000' : '#fff')\r\n                            }\">\r\n                            {{ note.name + octave }}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"ruler\" ref=\"ruler\" @mousedown=\"handleRulerClick\" :style=\"{\r\n                width: 'calc( 10% + ' + gridSpan * zoomScalar + 'px )',\r\n                background: `repeating-linear-gradient(\r\n                        90deg,\r\n                        #bbb,\r\n                        #bbb 2px,\r\n                        #eee 2px,\r\n                        #eee ${256 * zoomScalar}px\r\n                    )`,\r\n                float: 'bottom'\r\n            }\">\r\n                <div v-for=\"index in Math.ceil((gridSpan / 256))\" :key=\"index\" class=\"ruler-tick-label\"\r\n                    :style=\"{ left: `calc(${(index - 1) * 256 * zoomScalar}px)` }\">\r\n                    {{ index }}\r\n                </div>\r\n                <div class=\"marker-replay-triangle\" :style=\"{ left: markerReplayPosition * zoomScalar + 'px' }\"></div>\r\n                <div class=\"marker-wrapper\" :style=\"{ left: markerPosition * zoomScalar + 'px' }\">\r\n                    <div class=\"marker-triangle\"></div>\r\n                    <div class=\"marker-line\"></div>\r\n                </div>\r\n\r\n                <TempoMarker v-for=\"(tempoMarker, index) in tempoMarkers\" :key=\"tempoMarker.left\"\r\n                    :left=\"(tempoMarker.left) * zoomScalar + 1\" :tempo=\"tempoMarker.tempo\" :index=\"index\"\r\n                    :color=\"tempoMarker.color\" :visible=\"tempoMarker.muted ? 'hidden' : 'visible'\"\r\n                    @click=\"clickTempoMarker\" @click.stop />\r\n\r\n            </div>\r\n            <div class=\"grid-wrapper\">\r\n                <div class=\"grid\" ref=\"grid\" :style=\"{ width: gridSpan * zoomScalar + 'px', height: 2622 + 'px' }\">\r\n                    <div :style=\"{ width: scrollX + 'px' }\" />\r\n                    <canvas class=\"gridCanvas\" ref=\"gridCanvas\" :width=\"windowWidth * 0.9 - 14\" :height=\"2592\"\r\n                        @mousemove=\"tryRemoveNote\" @mousedown=\"handleGridClick\" @contextmenu.prevent=\"startNoteRemove\"\r\n                        @wheel=\"handleGridScroll\" />\r\n                    <div v-if=\"isSelecting\" class=\"selection-rect\" :style=\"rectangleStyle\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, watchEffect, computed, onBeforeUnmount, watch, nextTick, mergeProps, useCssModule } from 'vue';\r\nimport { Synthetizer, MIDIBuilder, writeMIDIFile, Sequencer, consoleColors, SpessaSynthLogging, MIDI } from \"spessasynth_lib\";\r\nimport Heap from 'heap-js';\r\nimport HelpMenu from '@/components/HelpMenu.vue'\r\nimport Tracks from '@/components/Tracks.vue'\r\nimport { selectedTrack, tracks, selectedTrackIndex, trackHexColor, EventBus } from '@/components/Tracks.vue'\r\nimport { _ } from 'core-js';\r\nimport TempoMarker from './TempoMarker.vue';\r\nimport ExportMenu from './ExportMenu.vue';\r\n\r\nexport default {\r\n    name: 'PianoRoll',\r\n    components: {\r\n        HelpMenu, Tracks, TempoMarker, ExportMenu\r\n    },\r\n    setup() {\r\n        const root = process.env.NODE_ENV === 'production' ? '../MabiMML/' : '../';\r\n        const pianoRoll = ref(null);\r\n        const grid = ref(null);\r\n        const synth = ref(null);\r\n        const context = ref(null);\r\n        const isMouseDown = ref(false);\r\n        const selectedInstrument = ref({ name: 'Lute', program: 0, min: 16, max: 88 });\r\n        const midiBuilder = ref(null);\r\n        const tempo = ref(120);\r\n        const loopSong = ref(false);\r\n        const autoScrollSong = ref(false);\r\n        const gridCanvas = ref(null);\r\n        const windowWidth = ref(window.innerWidth);\r\n\r\n        const instruments = ref([\r\n            { name: 'Lute', program: 0, min: 16, max: 88 },\r\n            { name: 'Ukulele', program: 1, min: 16, max: 88 },\r\n            { name: 'Mandolin', program: 2, min: 16, max: 88 },\r\n            { name: 'Whistle', program: 3, min: 12, max: 88 },\r\n            { name: 'Roncadora', program: 4, min: 12, max: 88 },\r\n            { name: 'Flute', program: 5, min: 15, max: 88 },\r\n            { name: 'Chalumeau', program: 6, min: 16, max: 88 },\r\n            { name: 'Tuba', program: 18, min: 12, max: 95 },\r\n            { name: 'Lyre', program: 19, min: 9, max: 80 },\r\n            { name: 'Electric Guitar', program: 20, min: 4, max: 99 },\r\n            { name: 'Piano', program: 21, min: 0, max: 84 },\r\n            { name: 'Violin', program: 22, min: 16, max: 59 },\r\n            { name: 'Cello', program: 23, min: 0, max: 46 },\r\n            { name: 'Harp', program: 24, min: 9, max: 83 },\r\n            { name: 'Tuned Violin', program: 25, min: 16, max: 59 },\r\n            { name: 'Tuned Cello', program: 26, min: 0, max: 46 },\r\n            { name: 'Drum Kit', program: 27, min: 29, max: 53 },\r\n            { name: 'Festival Lute', program: 50, min: 16, max: 88 },\r\n            { name: 'Festival Ukulele', program: 51, min: 16, max: 88 },\r\n            { name: 'Festival Mandolin', program: 52, min: 16, max: 88 },\r\n            { name: 'Fest/Tuned Whistle', program: 53, min: 12, max: 83 },\r\n            { name: 'Fest/Tuned Flute', program: 54, min: 15, max: 83 },\r\n            { name: 'Bass Drum', program: 66, min: 12, max: 84 },\r\n            { name: 'Snare Drum', program: 67, min: 12, max: 84 },\r\n            { name: 'Cymbals', program: 68, min: 12, max: 84 },\r\n            { name: 'Hand Chimes', program: 77, min: 9, max: 80 },\r\n            { name: 'Female Chorus', program: 110, min: 19, max: 48 },\r\n            { name: 'Male Chorus', program: 100, min: 14, max: 46 },\r\n            { name: 'Male Voice', program: 120, min: 17, max: 49 },\r\n            { name: 'Female Voice', program: 121, min: 12, max: 45 },\r\n        ]);\r\n\r\n\r\n        let currentNoteLength = ref((960*4));\r\n        let currentNoteVolume = ref(8);\r\n        const gridWidth = ref(256 / 16); // This makes the base size an x-th note\r\n        const gridHeight = 24;\r\n        const notesInGrid = ref([]);\r\n        const draggingNotes = ref([]);\r\n        const resizingNotes = ref([]);\r\n        const volumeChangingNotes = ref([]);\r\n        const startX = ref(0);\r\n        const startY = ref(0);\r\n        const startLeft = ref(0);\r\n        const startTop = ref(0);\r\n        const startWidth = ref(0);\r\n        const gridSpan = ref(window.innerWidth);\r\n        const gridWrapper = ref(null);\r\n\r\n        const scrollX = ref(0);\r\n\r\n        const selectedNotes = ref([]);\r\n        const isSelecting = ref(false);\r\n        const currentX = ref(0);\r\n        const currentY = ref(0);\r\n\r\n        const ruler = ref(null);\r\n        const markerPosition = ref(0);\r\n        const markerReplayPosition = ref(0);\r\n        const tempoMarkers = ref([]);\r\n        const seq = ref(null);\r\n        const isPlaying = ref(false);\r\n\r\n        const zoomScalar = ref(1);\r\n\r\n        const rectangleStyle = computed(() => ({\r\n            left: `${Math.min(startX.value, currentX.value)}px`,\r\n            top: `${Math.min(startY.value, currentY.value) + 30}px`,\r\n            width: `${Math.abs(currentX.value - startX.value)}px`,\r\n            height: `${Math.abs(currentY.value - startY.value)}px`,\r\n            backgroundColor: 'rgba(0, 100, 255, 0.3)', // Transparent blue\r\n            border: '1px solid rgba(0, 100, 255, 0.5)' // Optional border\r\n        }));\r\n\r\n        const backgroundStyle = computed(() => ({\r\n            background: `repeating-linear-gradient( /*This is the horizontal lines*/\r\n                0deg,\r\n                #bbb,\r\n                #bbb 2px,\r\n                transparent 2px,\r\n                transparent 24px\r\n            ),\r\n            repeating-linear-gradient( /*This is the Bar line*/\r\n                90deg,\r\n                #777,\r\n                #777 2px,\r\n                transparent 2px,\r\n                transparent ${256 * zoomScalar.value}px\r\n            ),\r\n            repeating-linear-gradient( /*This is the vertical lines*/\r\n                90deg,\r\n                #c0c0c0,\r\n                #c0c0c0 2px,\r\n                transparent 2px,\r\n                transparent ${gridWidth.value * zoomScalar.value}px\r\n            ),\r\n            repeating-linear-gradient(/*This is the background colors*/\r\n                90deg,\r\n                #e0e0e0,\r\n                #e0e0e0 ${64 * zoomScalar.value}px,\r\n                #ccc ${64 * zoomScalar.value}px,\r\n                #ccc ${128 * zoomScalar.value}px\r\n            )`\r\n        }));\r\n\r\n        let ctx = null;\r\n\r\n        function drawCanvasGrid() {\r\n            if (!ctx) return;\r\n\r\n            const screenLeft = scrollX.value;\r\n            const screenRight = screenLeft + window.innerWidth;\r\n            const zoom = zoomScalar.value;\r\n            const grid = gridWidth.value;\r\n            const width = gridSpan.value * zoom;\r\n            const height = 12 * 9 * gridHeight; // numKeys * keyHeight\r\n            const gridwidth = 256 / grid;\r\n\r\n            ctx.clearRect(0, 0, width, height);\r\n\r\n            // --- Draw Background Quarter Notes ---\r\n            const bgSpacing = 64 * zoom;\r\n            ctx.fillStyle = '#e0e0e0';\r\n            for (let i = 0; i <= width; i += 2 * bgSpacing) {\r\n                const x = i - screenLeft;\r\n                ctx.fillRect(x, 0, bgSpacing, height);\r\n            }\r\n            ctx.fillStyle = '#ccc';\r\n            for (let i = bgSpacing; i <= width; i += 2 * bgSpacing) {\r\n                const x = i - screenLeft;\r\n                ctx.fillRect(x, 0, bgSpacing, height);\r\n            }\r\n\r\n            // --- Draw Horizontal Grid Lines ---\r\n            ctx.strokeStyle = '#bbb';\r\n            ctx.lineWidth = 2;\r\n            const horizontalSpacing = 24;\r\n            const hCount = Math.ceil(height / horizontalSpacing);\r\n            ctx.beginPath();\r\n            for (let i = 0; i <= hCount; i++) {\r\n                const y = i * horizontalSpacing;\r\n                ctx.moveTo(0, y);\r\n                ctx.lineTo(screenRight, y);\r\n            }\r\n            ctx.stroke();\r\n\r\n            if (zoom > 1 / 8) {\r\n\r\n                // --- Vertical Subdivisions ---\r\n                ctx.strokeStyle = '#c0c0c0';\r\n                ctx.lineWidth = 2;\r\n                let verticalSpacing = 0;\r\n                if (zoom > 1 / 8 && zoom <= 1 / 2) {\r\n                    verticalSpacing = gridwidth == 12 ? grid * 4 * zoom : grid * 8 * zoom;\r\n                } else if (zoom > 1 / 2 && zoom <= 7 / 8) {\r\n                    verticalSpacing = grid * 4 * zoom;\r\n                } else if (zoom > 7 / 8 && zoom < 2.5) {\r\n                    verticalSpacing = grid * 2 * zoom;\r\n                } else if (zoom >= 2.5) {\r\n                    verticalSpacing = grid * zoom;\r\n                }\r\n                const vStart = Math.max(0, Math.floor(screenLeft / verticalSpacing) - 1);\r\n                const vEnd = Math.ceil(screenRight / verticalSpacing) + 1;\r\n                ctx.beginPath();\r\n                for (let i = vStart; i <= vEnd; i++) {\r\n                    const x = i * verticalSpacing - screenLeft;\r\n                    ctx.moveTo(x, 0);\r\n                    ctx.lineTo(x, height);\r\n                }\r\n                ctx.stroke();\r\n            }\r\n\r\n            // --- Bar Lines ---\r\n            ctx.strokeStyle = '#777';\r\n            ctx.lineWidth = 2;\r\n            const barSpacing = 256 * zoom;\r\n            const bStart = Math.max(0, Math.floor(screenLeft / barSpacing) - 1);\r\n            const bEnd = Math.ceil(screenRight / barSpacing) + 1;\r\n            ctx.beginPath();\r\n            for (let i = bStart; i <= bEnd; i++) {\r\n                const x = i * barSpacing - screenLeft;\r\n                ctx.moveTo(x, 0);\r\n                ctx.lineTo(x, height);\r\n            }\r\n            ctx.stroke();\r\n\r\n            // --- Notes ---\r\n            const notes = notesInGrid.value;\r\n            if (!notes || notes.length === 0) return;\r\n\r\n            const visibleNotes = [];\r\n            const leftLimit = screenLeft / zoom;\r\n            const rightLimit = screenRight / zoom;\r\n\r\n            for (const note of notes) {\r\n                const noteLeft = note.left;\r\n                const noteRight = noteLeft + note.width;\r\n                if (noteRight < leftLimit || noteLeft > rightLimit) continue;\r\n                if (note.muted) continue;\r\n                visibleNotes.push(note);\r\n            }\r\n\r\n            for (const note of visibleNotes) {\r\n                const x = note.left * zoom - screenLeft;\r\n                const y = note.top;\r\n                const noteWidth = (note.width + 1) * zoom - 1;\r\n                const h = gridHeight;\r\n\r\n                // Note body\r\n                ctx.fillStyle = hexToRgba(note.color, (note.volume + 1) / 15);\r\n                ctx.fillRect(x, y, noteWidth, h);\r\n\r\n                // Border\r\n                ctx.strokeStyle = note.highlighted ? 'white' : note.color;\r\n                ctx.lineWidth = note.highlighted ? 2 : 1;\r\n                ctx.strokeRect(x, y, noteWidth, h);\r\n\r\n                // Volume handle (semi-circle)\r\n                const semiCircleRadius = Math.max(0, Math.min(6, noteWidth / 4));\r\n                const centerX = x + noteWidth / 2;\r\n                const centerY = y + h + semiCircleRadius * 0.35 - 1;\r\n                ctx.beginPath();\r\n                ctx.arc(centerX, centerY, semiCircleRadius, Math.PI, 0, false);\r\n                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';\r\n                ctx.fill();\r\n\r\n                // Resize handle\r\n                const barWidth = Math.min(10, noteWidth * 0.4);\r\n                ctx.fillRect(x + noteWidth - barWidth, y, barWidth, h);\r\n\r\n                // Text\r\n                ctx.font = '11px sans-serif';\r\n                ctx.fillStyle = '#444';\r\n                ctx.textAlign = 'center';\r\n                ctx.textBaseline = 'middle';\r\n\r\n                const fullText = `${note.name} (${note.volume})`;\r\n                const truncatedText = truncateTextToWidth(ctx, fullText, noteWidth);\r\n\r\n                if (truncatedText) {\r\n                    ctx.fillText(truncatedText, x + noteWidth / 2, y + h / 2);\r\n                }\r\n            }\r\n        }\r\n\r\n        function truncateTextToWidth(ctx, text, maxWidth) {\r\n            const ellipsis = '…';\r\n            if (ctx.measureText(text).width <= maxWidth) return text;\r\n\r\n            let truncated = text;\r\n            while (truncated.length > 0) {\r\n                truncated = truncated.slice(0, -1);\r\n                if (ctx.measureText(truncated + ellipsis).width <= maxWidth) {\r\n                    return truncated + ellipsis;\r\n                }\r\n            }\r\n            return '';\r\n        }\r\n\r\n\r\n\r\n        // Left-hand Piano notes, not grid notes\r\n        const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\r\n        const blackNotes = ['C#', 'D#', 'F#', 'G#', 'A#'];\r\n        const notes = ref(noteNames.map((name, index) => ({\r\n            name: name,\r\n            index: index,\r\n            isBlack: blackNotes.includes(name)\r\n        })));\r\n        const octaves = ref([0, 1, 2, 3, 4, 5, 6, 7, 8]);\r\n\r\n        const showSuccessNotification = ref(false);\r\n        const successNotificationText = ref('');\r\n        const showFailedNotification = ref(false);\r\n        const failedNotificationText = ref('');\r\n\r\n        const instrKeyMin = ref(16);\r\n        const instrKeyMax = ref(88);\r\n\r\n        let noteClipboard = [];\r\n\r\n        watchEffect(() => {\r\n            const maxRightPosition = Math.max(...notesInGrid.value.map(note => note.left + note.width), 0);\r\n            gridSpan.value = Math.max((maxRightPosition + window.innerWidth / zoomScalar.value), window.innerWidth / zoomScalar.value);\r\n            windowWidth.value = window.innerWidth;\r\n            if (document.querySelector('.grid-wrapper'))\r\n                scrollX.value = gridWrapper.value.scrollLeft;\r\n        });\r\n\r\n        watch(notesInGrid, () => {\r\n            drawCanvasGrid();\r\n        }, { deep: true });\r\n\r\n        watch(gridSpan, async () => {\r\n            await nextTick();\r\n            drawCanvasGrid();\r\n        }, { deep: true });\r\n\r\n        watch(gridWidth, () => {\r\n            drawCanvasGrid();\r\n        }, { deep: true });\r\n\r\n        const addTrack = (instr, color, name) => {\r\n            return EventBus.addTrack(null, instr, color, name);\r\n        };\r\n\r\n        const handleTrackSelected = (track) => {\r\n            selectedInstrument.value = track.instrument;\r\n            selectedTrackIndex.value = tracks.value.indexOf(track);\r\n            changeInstrument(true);\r\n        };\r\n\r\n        const handleAddTrack = async (newTrack, index) => {\r\n            // if (synth.value)\r\n            //     await synth.value.soundfontManager.addNewSoundFont(newTrack.instrument, `main${index}`, index);\r\n        };\r\n\r\n        const handleRemoveTrack = async (oldTrack, newTrack) => {\r\n            const idsToRemove = new Set(oldTrack.notes.map(n => n.id));\r\n\r\n            selectedNotes.value = selectedNotes.value.filter(n => !idsToRemove.has(n.id));\r\n            notesInGrid.value = notesInGrid.value.filter(n => !idsToRemove.has(n.id));\r\n\r\n            for (const track of tracks.value) {\r\n                track.notes = track.notes.filter(n => !idsToRemove.has(n.id));\r\n            }\r\n\r\n            tempoMarkers.value = tempoMarkers.value.filter(marker => marker.parentTrack.id !== oldTrack.id);\r\n\r\n            // if (selectedTrackIndex.value === newTrack.index)\r\n            //     selectedInstrument.value = newTrack.instrument;\r\n            // if (synth.value)\r\n            //     await synth.value.soundfontManager.deleteSoundFont(`main${index}`);\r\n        };\r\n\r\n        const handleMuteTrack = async (trackIndex) => {\r\n            if (isPlaying.value)\r\n                playSequence();\r\n            const track = tracks.value[trackIndex];\r\n            for (const tempoMarker of tempoMarkers.value) {\r\n                if (tempoMarker.parentTrack === track) {\r\n                    tempoMarker.muted = track.isMuted;\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        const updateColor = (track, newColor) => {\r\n            for (const marker of tempoMarkers.value) {\r\n                if (marker.parentTrack === track) {\r\n                    marker.color = newColor;\r\n                }\r\n            }\r\n        };\r\n\r\n        const loadSoundFont = async () => {\r\n            try {\r\n                const response = await fetch(root + 'soundfonts/mabi_instruments_high_quality.sf3');\r\n                const soundFontArrayBuffer = await response.arrayBuffer();\r\n                return soundFontArrayBuffer;\r\n            } catch (error) {\r\n                console.error(\"Failed to load SoundFont:\", error);\r\n                return null;\r\n            }\r\n        };\r\n\r\n        const handleBeforeUnload = (event) => {\r\n            const message = 'Leave Site? Changes you made may not be saved.';\r\n            event.preventDefault();\r\n            event.returnValue = message;\r\n            return 'message';\r\n        }\r\n\r\n        onMounted(async () => {\r\n            try {\r\n                windowWidth.value = window.innerWidth;\r\n\r\n                const gridWrapperVar = document.querySelector('.grid-wrapper');\r\n                if (gridWrapperVar) {\r\n                    gridWrapper.value = gridWrapperVar;\r\n                    gridWrapperVar.addEventListener('scroll', updateRuler);\r\n                    updateRuler();\r\n                }\r\n\r\n                document.addEventListener('keydown', handleKeyPress);\r\n                window.addEventListener('beforeunload', handleBeforeUnload);\r\n                // Setting up audio context\r\n                context.value = new AudioContext();\r\n\r\n                await context.value.audioWorklet.addModule(root + \"worklet_processor.min.js\");\r\n                const soundFontArrayBuffer = await loadSoundFont();\r\n                if (!soundFontArrayBuffer) return;\r\n                synth.value = new Synthetizer(context.value.destination, soundFontArrayBuffer, true, undefined, { chorusEnabled: false, reverbEnabled: false });\r\n                synth.value.setMainVolume(2);\r\n                synth.value.setLogLevel(false, false, false, false);\r\n                await synth.value.isReady;\r\n\r\n            } catch (error) {\r\n                console.error(\"Error initializing sequencer or synthesizer:\", error);\r\n            }\r\n            await nextTick();\r\n            if (gridCanvas.value) {\r\n                ctx = gridCanvas.value.getContext('2d', { alpha: false });\r\n                drawCanvasGrid();\r\n            }\r\n        });\r\n\r\n\r\n\r\n        onBeforeUnmount(() => {\r\n            window.removeEventListener('beforeunload', handleBeforeUnload);\r\n        });\r\n\r\n        const handleRulerClick = (event) => {\r\n            if (event.button === 0) {\r\n                if (!event.shiftKey) {\r\n                    startMarkerDrag(event);\r\n                } else {\r\n                    placeTempoMarker(event);\r\n                }\r\n            }\r\n        };\r\n\r\n        const placeTempoMarker = (event) => {\r\n            const granularity = event.altKey ? gridWidth.value / 4 : gridWidth.value;\r\n            const left = Math.round((event.clientX - ruler.value.getBoundingClientRect().left) / granularity / zoomScalar.value) * granularity;\r\n            const enteredTempo = prompt(\"Enter tempo (BPM):\", tempo.value);\r\n            if (enteredTempo !== null && !isNaN(enteredTempo) && enteredTempo !== '') {\r\n                tempoMarkers.value.push({\r\n                    left: left,\r\n                    tempo: Number(enteredTempo),\r\n                    color: selectedTrack.value.color,\r\n                    parentTrack: selectedTrack.value,\r\n                    muted: false\r\n                });\r\n            }\r\n        };\r\n\r\n        const clickTempoMarker = (event, index) => {\r\n            event.preventDefault();\r\n            if (event.button === 0) {\r\n                const enteredTempo = prompt(\"Enter tempo (BPM):\", tempoMarkers.value[index].tempo);\r\n                if (enteredTempo === null)\r\n                    return;\r\n                if (!isNaN(enteredTempo) && enteredTempo !== '') {\r\n                    tempoMarkers.value[index].tempo = Number(enteredTempo);\r\n                } else {\r\n                    tempoMarkers.value.splice(index, 1);\r\n                }\r\n            } else if (event.button === 2) {\r\n                tempoMarkers.value[index].parentTrack = selectedTrack.value;\r\n                tempoMarkers.value[index].color = selectedTrack.value.color;\r\n            }\r\n        };\r\n\r\n        const startMarkerDrag = (event) => {\r\n            if (isPlaying) {\r\n                stopPlaying();\r\n            }\r\n            updateMarkerPos(event.clientX, event.altKey, true);\r\n            document.addEventListener('mousemove', onMarkerDrag);\r\n            document.addEventListener('mouseup', onMarkerDragEnd);\r\n        };\r\n\r\n        const onMarkerDrag = (event) => {\r\n            updateMarkerPos(event.clientX, event.altKey, true);\r\n        };\r\n\r\n        const onMarkerDragEnd = async () => {\r\n            document.removeEventListener('mousemove', onMarkerDrag);\r\n            document.removeEventListener('mouseup', onMarkerDragEnd);\r\n        };\r\n\r\n        let markerInterval;\r\n        let markerStartPos;\r\n        let startTempo;\r\n        let tempoIdx = 0;\r\n\r\n        async function startMarkerAnim() {\r\n            isPlaying.value = true;\r\n            markerStartPos = markerPosition.value;\r\n            startTempo = tempo.value;\r\n            tempoMarkers.value.sort((a, b) => { return a.left - b.left });\r\n            doMarkerAnim();\r\n        }\r\n\r\n        function doMarkerAnim() {\r\n            let timeChange = 0;\r\n            tempoIdx = 0;\r\n            startTempo = tempo.value;\r\n            let marker = tempoMarkers.value[tempoIdx];\r\n            while (marker && marker.left < markerPosition.value) { // Skip ahead to proper first marker\r\n                if (markerPosition.value > 0) {\r\n                    startTempo = marker.tempo;\r\n                }\r\n                tempoIdx++;\r\n                marker = tempoMarkers.value[tempoIdx];\r\n            }\r\n            function tick() {\r\n                if (markerPosition.value < 0) {\r\n                    startTempo = tempo.value;\r\n                    tempoIdx = 0;\r\n                    timeChange = 0;\r\n                    markerStartPos = 0;\r\n                    markerPosition.value = 0;\r\n                }\r\n                marker = tempoMarkers.value[tempoIdx];\r\n                while (marker && marker.muted) { // Skip ahead to the next unmuted marker\r\n                    tempoIdx++;\r\n                    marker = tempoMarkers.value[tempoIdx];\r\n                }\r\n                if (marker && marker !== null) {\r\n                    if (markerPosition.value >= marker.left) {\r\n                        tempoIdx++;\r\n                        markerStartPos = markerPosition.value;\r\n                        timeChange = seq.value.currentTime;\r\n                        startTempo = marker.tempo;\r\n                    }\r\n                }\r\n\r\n                markerPosition.value = ((seq.value.currentTime - timeChange) * 4 * 16 * startTempo / 60) + markerStartPos;\r\n                if (autoScrollSong.value) {\r\n                    gridWrapper.value.scrollLeft = markerPosition.value * zoomScalar.value - window.innerWidth * 0.66;\r\n                }\r\n                if (seq.value && !loopSong.value)\r\n                    seq.value.loop = loopSong.value;\r\n            }\r\n            clearInterval(markerInterval);\r\n            tick();\r\n            markerInterval = setInterval(tick, 20);\r\n        }\r\n\r\n        const noteLengths = [];\r\n        const widthCache = {};\r\n\r\n        function getUniquePermutations(nums) {\r\n            nums.sort((a, b) => a - b); // Sort to enable duplicate skipping\r\n            const used = new Array(nums.length).fill(false);\r\n            const result = [];\r\n\r\n            function backtrack(path) {\r\n                if (path.length === nums.length) {\r\n                    result.push([...path]);\r\n                    return;\r\n                }\r\n\r\n                for (let i = 0; i < nums.length; i++) {\r\n                    if (used[i]) continue;\r\n\r\n                    // Skip duplicate numbers at the same tree depth\r\n                    if (i > 0 && nums[i] === nums[i - 1] && !used[i - 1]) {\r\n                        continue;\r\n                    }\r\n\r\n                    used[i] = true;\r\n                    path.push(nums[i]);\r\n                    backtrack(path);\r\n                    path.pop();\r\n                    used[i] = false;\r\n                }\r\n            }\r\n\r\n            backtrack([]);\r\n            return result;\r\n        }\r\n\r\n        function getOptimalNoteLengths(width) {\r\n            if (width in widthCache)\r\n                return widthCache[width];\r\n            let outString = '';\r\n            let mmlWidth = width;\r\n\r\n            if (noteLengths.length === 0) {\r\n                for (let i = 1; i <= 64; ++i) {\r\n                    let val1 = Math.round(256 * 32 / (i/960*64) );\r\n                    let val2 = Math.round(256 * 32 / (i/960*64) * 1.5);\r\n\r\n                    noteLengths.push({\r\n                        length: val2,\r\n                        name: i + '.',\r\n                        charLength: ('L' + i + '.').length\r\n                    });\r\n                    noteLengths.push({\r\n                        length: val1,\r\n                        name: i + '',\r\n                        charLength: ('L' + i).length\r\n                    });\r\n                }\r\n            }\r\n\r\n            const best = new Map();\r\n            for (const note of noteLengths) {\r\n                if (!best.has(note.length) || note.charLength < best.get(note.length).charLength) {\r\n                    best.set(note.length, note);\r\n                }\r\n            }\r\n\r\n            let result = getMinCharLengthWidth([...best.values()], mmlWidth);\r\n            outString = result.noteCombination.map(note => note.name).join('&');\r\n            // Rather than returning a single string combining the notes, we should return a list of such strings (or a list of a list of lengths like lengths: [[1., 2], [2, 1.]])\r\n            // let outputs = getUniquePermutations(result.noteCombination.map(note => note.name));\r\n            widthCache[width] = result;\r\n            return result; // returns a list of lists of note lenths\r\n        }\r\n\r\n        function getMinCharLengthWidth(notes, targetWidth) {\r\n            let amount = Math.round(targetWidth * 32);\r\n\r\n            // === Compress notes to keep only the shortest representation for each length ===\r\n            const best = new Map();\r\n            for (const note of notes) {\r\n                if (!best.has(note.length) || note.charLength < best.get(note.length).charLength) {\r\n                    best.set(note.length, note);\r\n                }\r\n            }\r\n            const compressedNotes = [...best.values()];\r\n\r\n            // Flatten notes into arrays for fast lookup\r\n            const n = compressedNotes.length;\r\n            const lengths = new Int32Array(n);\r\n            const charLens = new Int32Array(n);\r\n            for (let j = 0; j < n; j++) {\r\n                lengths[j] = compressedNotes[j].length;\r\n                charLens[j] = compressedNotes[j].charLength;\r\n            }\r\n\r\n            // === DP arrays ===\r\n            const INF = 0x7fffffff;\r\n            const dp = new Uint32Array(amount + 1);\r\n            dp.fill(INF);\r\n            dp[0] = 0;\r\n\r\n            const prev = new Int32Array(amount + 1);\r\n            prev.fill(-1);\r\n\r\n            const last = new Int32Array(amount + 1);\r\n            last.fill(-1);\r\n\r\n            // === Core DP ===\r\n            for (let j = 0; j < n; j++) {\r\n                const noteValue = lengths[j];\r\n                const noteChars = charLens[j];\r\n                for (let i = noteValue; i <= amount; i++) {\r\n                    const candidate = dp[i - noteValue] + noteChars;\r\n                    if (candidate < dp[i]) {\r\n                        dp[i] = candidate;\r\n                        prev[i] = i - noteValue;\r\n                        last[i] = j;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (dp[amount] === INF) {\r\n                return { minChars: null, noteCombination: [] };\r\n            }\r\n\r\n            // === Backtrack ===\r\n            const result = [];\r\n            let i = amount;\r\n            while (i > 0) {\r\n                const j = last[i];\r\n                result.push(compressedNotes[j]);\r\n                i = prev[i];\r\n            }\r\n\r\n            return { minChars: dp[amount], noteCombination: result };\r\n        }\r\n\r\n\r\n        const stopMarkerAnim = () => {\r\n            clearInterval(markerInterval);\r\n            isPlaying.value = false;\r\n        }\r\n\r\n        const updateMarkerPos = (clientX, altKey, fromClick) => {\r\n            if (ruler.value) {\r\n                const rulerRect = ruler.value.getBoundingClientRect();\r\n                let newPos = Math.round((clientX - rulerRect.left) / zoomScalar.value / (gridWidth.value / 4)) * (gridWidth.value / 4);\r\n                let gridSnap = gridWidth.value * (zoomScalar.value <= 0.5 ? 64 / gridWidth.value : 1);\r\n\r\n                if (!altKey) {\r\n                    newPos = Math.round(newPos / (gridSnap)) * gridSnap;\r\n                }\r\n\r\n                newPos = Math.max(0, Math.min(gridSpan.value, newPos));\r\n\r\n                markerPosition.value = newPos;\r\n                if (fromClick) {\r\n                    markerReplayPosition.value = newPos;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        function handleKeyPress(event) {\r\n            if (selectedTrack.value.isEditingName)\r\n                return;\r\n            if (event.key === 'Backspace' || event.key === 'Delete') {\r\n                for (const note of selectedNotes.value) {\r\n                    removeNote(note, true);\r\n                }\r\n\r\n                if (isPlaying.value)\r\n                    playSequence();\r\n            }\r\n            if (event.code === 'Space') {\r\n                event.preventDefault();\r\n                if (isPlaying.value) {\r\n                    stopPlaying();\r\n                    if (!event.ctrlKey) {\r\n                        markerPosition.value = markerReplayPosition.value;\r\n                    }\r\n                } else {\r\n                    playSequence();\r\n                }\r\n            } else if (event.key === 'a' && event.ctrlKey && !selectedTrack.value.isEditingName) {\r\n                event.preventDefault();\r\n                for (const note of notesInGrid.value) {\r\n                    selectNote(note);\r\n                }\r\n\r\n                showSuccessMessage(`Selected ${selectedNotes.value.length} notes!`, 1000);\r\n            } else if (event.key === 'ArrowUp') {\r\n                if (event.ctrlKey || event.shiftKey) {\r\n                    event.preventDefault();\r\n                    let movementValue = event.ctrlKey ? 12 : 1;\r\n                    for (const note of selectedNotes.value) {\r\n                        if (note.top - gridHeight * movementValue < -0) return;\r\n                    }\r\n                    for (const note of selectedNotes.value) {\r\n                        note.top -= gridHeight * movementValue\r\n                        const number = (1284 - (note.top / 2)) / 144;\r\n                        const noteName = noteNames[number * 12 % 12] + \"\" + Math.floor(number);\r\n                        note.name = noteName;\r\n                        note.pitch = number * 12 % 12 + 12 * (Math.floor(number) + 1);\r\n                    }\r\n                }\r\n            } else if (event.key === 'ArrowDown') {\r\n                if (event.ctrlKey || event.shiftKey) {\r\n                    event.preventDefault();\r\n                    let movementValue = event.ctrlKey ? 12 : 1;\r\n                    for (const note of selectedNotes.value) {\r\n                        if (note.top + gridHeight * movementValue >= octaves.value.length * gridHeight * 12) return;\r\n                    }\r\n                    for (const note of selectedNotes.value) {\r\n                        note.top += gridHeight * movementValue\r\n                        const number = (1284 - (note.top / 2)) / 144;\r\n                        const noteName = noteNames[number * 12 % 12] + \"\" + Math.floor(number);\r\n                        note.name = noteName;\r\n                        note.pitch = number * 12 % 12 + 12 * (Math.floor(number) + 1);\r\n                    }\r\n                }\r\n            } else if (event.key === 'ArrowLeft') {\r\n                if (event.ctrlKey || event.shiftKey) {\r\n                    event.preventDefault();\r\n                    let movementValue = event.ctrlKey ? 1 : 4;\r\n                    for (const note of selectedNotes.value) {\r\n                        if (Math.round((note.left - gridWidth.value / movementValue) * 1000) / 1000 < 0) return;\r\n                    }\r\n                    for (const note of selectedNotes.value) {\r\n                        note.left = Math.round((note.left - gridWidth.value / movementValue) * 1000) / 1000;\r\n                        note.start = Math.round(note.left / (256) * (960*4));\r\n                        note.end = Math.round(note.start + note.length);\r\n                    }\r\n                }\r\n            } else if (event.key === 'ArrowRight') {\r\n                if (event.ctrlKey || event.shiftKey) {\r\n                    event.preventDefault();\r\n                    let movementValue = event.ctrlKey ? 1 : 4;\r\n                    for (const note of selectedNotes.value) {\r\n                        note.left = Math.round((note.left + gridWidth.value / movementValue) * 1000) / 1000;\r\n                        note.start = Math.round(note.left / (256) * (960*4));\r\n                        note.end = Math.round(note.start + note.length);\r\n                    }\r\n                }\r\n            } else if (event.key === 'c' && event.ctrlKey) {\r\n                event.preventDefault();\r\n                // Copy selected notes to some \"clipboard\".\r\n                noteClipboard = [];\r\n                for (const note of selectedNotes.value) {\r\n                    noteClipboard.push(note);\r\n                }\r\n\r\n                showSuccessMessage(`Copied ${noteClipboard.length} note${noteClipboard.length > 1 ? 's' : ''} to the clipboard!`, 1000);\r\n            } else if (event.key === 'x' && event.ctrlKey) {\r\n                event.preventDefault();\r\n                // Copy and delete selected notes to some \"clipboard\".\r\n                noteClipboard = [];\r\n                for (const note of selectedNotes.value) {\r\n                    noteClipboard.push(note);\r\n                    removeNote(note, true);\r\n                }\r\n                showSuccessMessage(`Cut ${noteClipboard.length} note${noteClipboard.length > 1 ? 's' : ''} and put them in the clipboard!`, 1000);\r\n            } else if (event.key === 'v' && event.ctrlKey) {\r\n                event.preventDefault();\r\n                // Paste selected notes from \"clipboard\" into the selected track.\r\n                clearSelection();\r\n                const baseId = Date.now(); // Avoid calling Date.now() in every iteration\r\n                const track = selectedTrack.value;\r\n                const trackColor = track.color;\r\n                const scroll = scrollX.value;\r\n                const zoom = zoomScalar.value;\r\n                const grid = gridWidth.value;\r\n\r\n                const idOffset = notesInGrid.value.length;\r\n\r\n                const newNotes = [];\r\n\r\n                for (let i = 0; i < noteClipboard.length; i++) {\r\n                    const note = noteClipboard[i];\r\n                    const newLeft = Math.round(Math.round((note.left + scroll / zoom) * grid / 4) * 4 / grid);\r\n                    const newNote = {\r\n                        id: baseId + idOffset + i,\r\n                        name: note.name,\r\n                        left: newLeft,\r\n                        top: note.top,\r\n                        pitch: note.pitch,\r\n                        width: note.width,\r\n                        length: note.length,\r\n                        highlighted: true,\r\n                        color: trackColor,\r\n                        start: Math.round(newLeft / (256) * (960*4)),\r\n                        end: Math.round(Math.round(newLeft / (256) * (960*4)) + note.length),\r\n                        volume: note.volume,\r\n                        muted: false,\r\n                        track: track\r\n                    };\r\n                    newNotes.push(newNote);\r\n                }\r\n\r\n                // Push all at once\r\n                selectedNotes.value.push(...newNotes);\r\n                notesInGrid.value.push(...newNotes);\r\n                track.notes.unshift(...newNotes.reverse()); // unshift in correct order\r\n\r\n                showSuccessMessage(`Pasted ${noteClipboard.length} notes from the clipboard!`, 1000);\r\n            } else if (event.key === 't' && selectedNotes.value.length > 0) {\r\n                const selectedSet = new Set(selectedNotes.value);\r\n\r\n                for (const track of tracks.value) {\r\n                    track.notes = track.notes.filter(note => !selectedSet.has(note));\r\n                }\r\n\r\n                selectedNotes.value.forEach(note => {\r\n                    note.track = selectedTrack.value;\r\n                    note.color = selectedTrack.value.color;\r\n                });\r\n\r\n                selectedTrack.value.notes.unshift(...[...selectedNotes.value].reverse());\r\n\r\n                showSuccessMessage(`Moved ${selectedNotes.value.length} notes into track \"${selectedTrack.value.name}\"!`, 1000);\r\n            }\r\n        }\r\n\r\n\r\n        function updateRuler() {\r\n            if (gridWrapper.value && ruler.value) {\r\n                scrollX.value = gridWrapper.value.scrollLeft;\r\n                ruler.value.style.left = -scrollX.value + 'px'; // Adjust ruler's left position\r\n            }\r\n            drawCanvasGrid();\r\n        }\r\n\r\n        function stopPlaying() {\r\n            if (seq.value)\r\n                seq.value.stop();\r\n            stopMarkerAnim();\r\n            synth.value.programChange(0, selectedInstrument.value.program);\r\n        }\r\n\r\n        async function getMidiBlob(name=\"MySong\", startPosition=0) {\r\n            const tempMidiBuilder = new MIDIBuilder(name, 480, tempo.value);\r\n            await context.value.resume();\r\n                if (!synth.value) return;\r\n\r\n                let notesAdded = 0;\r\n\r\n                let audibleTracks = [];\r\n\r\n                for (const track of tracks.value) {\r\n                    if (!track.isMuted) {\r\n                        audibleTracks.push(track);\r\n                        tempMidiBuilder.addNewTrack(track.name + tracks.value.indexOf(track));\r\n                    }\r\n                }\r\n\r\n                // Setting the instruments per track.\r\n                audibleTracks.forEach((track, idx) => {\r\n                    let index = idx >= 9 ? idx + 1 : idx\r\n                    const channel = index % 16;\r\n                    tempMidiBuilder.addEvent(0, index, 0xC0 | channel , [track.instrument.program]);\r\n                });\r\n\r\n                notesInGrid.value.forEach(note => {\r\n                    if (!note.muted && note.left + note.width >= startPosition) {\r\n\r\n                        // Code to get the note's parent track\r\n                        let containingTrack = note.track;\r\n                        // for (const track of tracks.value) {\r\n                        //     if (track.notes.some(n => n.id === note.id)) {\r\n                        //         containingTrack = track;\r\n                        //     }\r\n                        // }\r\n                        const trackIndex = audibleTracks.indexOf(containingTrack) >= 9 ? audibleTracks.indexOf(containingTrack) + 1 : audibleTracks.indexOf(containingTrack);\r\n                        const channel = trackIndex % 16;//trackIndex;\r\n                        const pitch = note.pitch;\r\n                        // Conversion from pixels to time.\r\n                        const noteStartTime = note.start / (960/4) * 120;\r\n                        const noteDuration = (note.length) / (960/4) * 120;\r\n                        const markerTime = startPosition / 16 * 120;\r\n                        const startTime = Math.max(noteStartTime, markerTime) - markerTime;\r\n                        const duration = Math.min(noteDuration, noteStartTime + noteDuration - markerTime);\r\n                        const volume = Math.max(0, Math.min(127, (note.volume + 1) * 8 - 1));\r\n\r\n \r\n\r\n                        //tempMidiBuilder.addEvent(startTime, trackIndex, 0xC0 | (channel & 0x0F), [containingTrack.instrument.program]);\r\n                        tempMidiBuilder.addNoteOn(startTime, trackIndex, channel, pitch, volume);\r\n                        tempMidiBuilder.addNoteOff(startTime + duration, trackIndex, channel, pitch);\r\n                        notesAdded++;\r\n                    }\r\n                });\r\n\r\n                for (const tempoMarker of tempoMarkers.value) {\r\n                    if (tempoMarker.parentTrack.isMuted)\r\n                        continue;\r\n                    const tempoStartTime = tempoMarker.left / 16 * 120;\r\n                    const markerTime = startPosition / 16 * 120;\r\n                    const tempoChangeTime = Math.max(tempoStartTime, markerTime) - markerTime;\r\n                    tempMidiBuilder.addSetTempo(tempoChangeTime, tempoMarker.tempo);\r\n                }\r\n\r\n                if (notesAdded === 0) {\r\n                    return;\r\n                }\r\n\r\n                tempMidiBuilder.flush();\r\n\r\n                midiBuilder.value = tempMidiBuilder;\r\n\r\n                const b = await (writeMIDIFile(midiBuilder.value));\r\n                return b;\r\n        }\r\n\r\n        const playSequence = async (fromClick = null) => {\r\n            try {\r\n                if (fromClick && isPlaying.value) {\r\n                    stopPlaying();\r\n                    markerPosition.value = markerReplayPosition.value;\r\n                    return;\r\n                }\r\n\r\n                const b = await getMidiBlob(\"untitled\", markerPosition.value);\r\n                seq.value = new Sequencer([{ binary: b }], synth.value);\r\n                seq.value.skipToFirstNoteOn = false;\r\n                seq.value.loop = loopSong.value && markerPosition.value === 0;\r\n                await synth.value.isReady;\r\n                seq.value.addOnSongEndedEvent(() => {\r\n                    stopMarkerAnim();\r\n                    markerPosition.value = markerReplayPosition.value;\r\n                    if (loopSong.value && !seq.value.loop) {\r\n                        markerPosition.value = 0;\r\n                        playSequence();\r\n                    }\r\n                }, 'test2');\r\n                await seq.value.play();\r\n                startMarkerAnim();\r\n            } catch (error) {\r\n                console.error(\"Error playing sequence: \", error);\r\n            }\r\n        };\r\n\r\n        const startNote = async (channel, note, octave) => {\r\n            try {\r\n                context.value.resume();\r\n                await synth.value.isReady;\r\n                synth.value.noteOn(channel, note.index + 12 * (octave + 1), Math.max(0, Math.min(127, (currentNoteVolume.value + 1) * 8 - 1)), false);\r\n            } catch (error) {\r\n                console.error(error);\r\n            }\r\n        };\r\n\r\n        const endNote = async (channel, note, octave) => {\r\n            try {\r\n                await synth.value.isReady;\r\n                if (synth.value) {\r\n                    synth.value.noteOff(channel, note.index + 12 * (octave + 1));\r\n                }\r\n            } catch (error) {\r\n                console.error(error);\r\n            }\r\n        };\r\n\r\n        const showSuccessMessage = (text, timeout = 2000) => {\r\n            successNotificationText.value = text;\r\n            showSuccessNotification.value = true; // Show notification\r\n\r\n            // Hide notification after 2 seconds\r\n            setTimeout(() => {\r\n                showSuccessNotification.value = false;\r\n            }, timeout);\r\n        };\r\n\r\n        const showFailureMessage = (text, timeout = 2000) => {\r\n            failedNotificationText.value = text;\r\n            showFailedNotification.value = true; // Show notification\r\n\r\n            // Hide notification after 2 seconds\r\n            setTimeout(() => {\r\n                showFailedNotification.value = false;\r\n            }, timeout);\r\n        };\r\n\r\n        const mouseOverNote = (channel, note, octave) => {\r\n            if (isMouseDown.value && draggingNotes.value.length === 0 && resizingNotes.value.length === 0) {\r\n                startNote(channel, note, octave);\r\n            }\r\n        };\r\n\r\n        const mouseLeaveNote = (channel, note, octave) => {\r\n            if (isMouseDown.value && draggingNotes.value.length === 0 && resizingNotes.value.length === 0) {\r\n                endNote(channel, note, octave);\r\n            }\r\n        };\r\n\r\n        const changeInstrument = async (fromTrack = false) => {\r\n            if (synth.value && selectedInstrument.value) {\r\n                selectedTrack.value.instrument = selectedInstrument.value;\r\n\r\n                instrKeyMin.value = selectedInstrument.value.min;\r\n                instrKeyMax.value = selectedInstrument.value.max;\r\n\r\n                synth.value.programChange(0, selectedInstrument.value.program);\r\n                if (isPlaying.value && !fromTrack)\r\n                    playSequence();\r\n\r\n                await synth.value.isReady;\r\n            }\r\n        };\r\n\r\n        const startPositions = new Map();\r\n\r\n        const startDrag = (note, event, placeNote = true) => {\r\n            event.preventDefault();\r\n            if (event.button === 0 && resizingNotes.value.length === 0 && volumeChangingNotes.value.length === 0) { // Ensure we're dragging with left button\r\n                if (note.highlighted) {\r\n                    draggingNotes.value = selectedNotes.value;\r\n                } else {\r\n                    clearSelection();\r\n                    draggingNotes.value.push(note);\r\n                }\r\n\r\n                if (event.shiftKey && placeNote) {\r\n                    const baseId = Date.now();\r\n                    const initialLength = notesInGrid.value.length;\r\n                    const newNotes = [];\r\n\r\n                    for (let i = 0; i < draggingNotes.value.length; i++) {\r\n                        const note = draggingNotes.value[i];\r\n                        const newNote = {\r\n                            id: baseId + initialLength + i,\r\n                            name: note.name,\r\n                            left: note.left,\r\n                            top: note.top,\r\n                            pitch: note.pitch,\r\n                            width: note.width,\r\n                            length: note.length,\r\n                            highlighted: false,\r\n                            color: note.color,\r\n                            start: note.start,\r\n                            end: note.end,\r\n                            volume: note.volume,\r\n                            muted: false,\r\n                            track: note.track\r\n                        };\r\n                        newNotes.push(newNote);\r\n                    }\r\n\r\n                    // Bulk update reactive arrays outside the loop\r\n                    notesInGrid.value.push(...newNotes);\r\n                    newNotes.forEach(note => {\r\n                        note.track.notes.unshift(note);\r\n                    });\r\n\r\n                }\r\n\r\n                for (const draggingNote of draggingNotes.value) {\r\n                    startPositions.set(draggingNote.id, {\r\n                        x: event.clientX,\r\n                        y: event.clientY,\r\n                        left: draggingNote.left,\r\n                        top: draggingNote.top\r\n                    });\r\n                }\r\n\r\n                currentNoteLength.value = note.length;\r\n                currentNoteVolume.value = note.volume;\r\n                selectedTrackIndex.value = tracks.value.indexOf(note.track);\r\n                trackHexColor.value = note.track.color;\r\n                document.addEventListener('mousemove', onDrag);\r\n                document.addEventListener('mouseup', endDrag);\r\n            }\r\n        };\r\n\r\n        const onDrag = (event) => {\r\n            if (draggingNotes.value && resizingNotes.value.length === 0 && volumeChangingNotes.value.length === 0) {\r\n\r\n                let outOfBounds = false;\r\n                const newPositions = [];\r\n\r\n                let offGridNote = false;\r\n\r\n                for (const note of draggingNotes.value) {\r\n                    if (event.altKey || (note.highlighted && note.left % gridWidth.value !== 0)) {\r\n                        offGridNote = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                const noteSnapScale = offGridNote ? gridWidth.value / 4 : gridWidth.value;\r\n\r\n                let noteDelta = 0;\r\n\r\n                for (let i = 0; i < draggingNotes.value.length; ++i) {\r\n                    const note = draggingNotes.value[i];\r\n\r\n                    const startPos = startPositions.get(note.id);\r\n                    if (!startPos) continue;\r\n\r\n                    const dx = (event.clientX - startPos.x) / zoomScalar.value;\r\n                    const dy = event.clientY - startPos.y;\r\n\r\n                    let newLeft = 0;\r\n\r\n                    if (i === 0) {\r\n                        newLeft = Math.round((startPos.left + dx) / noteSnapScale) * noteSnapScale;\r\n                        noteDelta = newLeft - startPos.left;\r\n                    } else {\r\n                        newLeft = startPos.left + noteDelta;\r\n                    }\r\n\r\n                    let newTop = Math.round((startPos.top + dy) / gridHeight) * gridHeight;\r\n\r\n                    if (newLeft < 0 || newTop < 0 || newTop > 2568) {\r\n                        outOfBounds = true;\r\n                        break; // Exit loop if any note is out of bounds\r\n                    }\r\n\r\n                    newPositions.push({ note, newLeft, newTop });\r\n\r\n                }\r\n\r\n                if (outOfBounds) return;\r\n\r\n                // Auto-scroll stuff doesnt work super well yet, so I'll leave it out for now\r\n                let rightMost = Infinity;\r\n                let leftMost = Infinity;\r\n                let topMost = Infinity;\r\n                let bottomMost = 0;\r\n\r\n                for (const { note, newLeft, newTop } of newPositions) {\r\n\r\n                    note.left = newLeft;\r\n                    note.start = Math.round(note.left / (256) * (960*4));\r\n                    note.end = Math.round(note.start + note.length);\r\n                    note.top = newTop;\r\n\r\n                    const number = (1284 - (note.top / 2)) / 144;\r\n                    const noteName = noteNames[number * 12 % 12] + \"\" + Math.floor(number);\r\n                    if (note.name != noteName && draggingNotes.value.length === 1) {\r\n                        startNote(0, { name: noteName, index: number * 12 % 12 }, Math.floor(number))\r\n                        endNote(0, { name: noteName, index: number * 12 % 12 }, Math.floor(number))\r\n                    }\r\n                    note.name = noteName;\r\n                    note.pitch = number * 12 % 12 + 12 * (Math.floor(number) + 1);\r\n\r\n                    // if (note.left + note.width < rightMost)\r\n                    //     rightMost = note.left + note.width;\r\n\r\n                    // if (note.left < leftMost)\r\n                    //     leftMost = note.left;\r\n\r\n                    // if (note.top < topMost)\r\n                    //     topMost = note.top;\r\n\r\n                    // if (note.top > bottomMost)\r\n                    //     bottomMost = note.top;\r\n\r\n                }\r\n                // const gridWrapper = document.querySelector('.grid-wrapper');\r\n                // const pianoRoll = document.querySelector('.piano-roll');\r\n                // if (rightMost > gridWrapper.scrollLeft + window.innerWidth) {\r\n                //     gridWrapper.scrollLeft = rightMost - window.innerWidth;\r\n                // } else if (leftMost < gridWrapper.scrollLeft) {\r\n                //     gridWrapper.scrollLeft = leftMost;\r\n                // } else if (bottomMost - topMost < window.innerHeight && topMost < pianoRoll.scrollTop) {\r\n                //     pianoRoll.scrollTop = topMost;\r\n                // } else if (bottomMost - topMost < window.innerHeight && bottomMost > window.innerHeight*0.85 + pianoRoll.scrollTop) {\r\n                //     pianoRoll.scrollTop = bottomMost - window.innerHeight*0.85;\r\n                // }\r\n\r\n            }\r\n        };\r\n\r\n        const endDrag = () => {\r\n            if (isPlaying.value)\r\n                playSequence();\r\n            draggingNotes.value = [];\r\n            document.removeEventListener('mousemove', onDrag);\r\n            document.removeEventListener('mouseup', endDrag);\r\n            startPositions.clear();\r\n        };\r\n\r\n        const startResizeData = new Map();\r\n\r\n        const startResize = (note, event) => {\r\n            event.preventDefault();\r\n            if (event.button === 0) { // Ensure we're resizing with the left button\r\n                resizingNotes.value = [];\r\n                startX.value = event.clientX;\r\n                startResizeData.clear(); // Clear previous data\r\n\r\n                if (note.highlighted) {\r\n                    // If note is highlighted, prepare to resize all selected notes\r\n                    selectedNotes.value.forEach(n => {\r\n                        startResizeData.set(n.id, { width: n.width, startX: event.clientX });\r\n                    });\r\n                    resizingNotes.value = selectedNotes.value;\r\n                } else {\r\n                    // If note is not highlighted, resize only this note\r\n                    clearSelection();\r\n                    startResizeData.set(note.id, { width: note.width, startX: event.clientX });\r\n                    resizingNotes.value = [note];\r\n                }\r\n\r\n                document.addEventListener('mousemove', onResize);\r\n                document.addEventListener('mouseup', endResize);\r\n            }\r\n        };\r\n\r\n        const onResize = (event) => {\r\n            if (resizingNotes.value.length > 0) {\r\n                let allInBounds = true;\r\n\r\n                const newWidths = [];\r\n\r\n                resizingNotes.value.forEach(note => {\r\n                    const startData = startResizeData.get(note.id);\r\n                    if (!startData) return;\r\n\r\n                    const dx = (event.clientX - startData.startX) / zoomScalar.value;\r\n                    let newWidth = 0;\r\n                    if (event.altKey) {\r\n                        newWidth = Math.round((startData.width + dx) / (gridWidth.value / 4)) * gridWidth.value / 4 - 1;\r\n                    } else {\r\n                        newWidth = Math.round((startData.width + dx) / gridWidth.value) * gridWidth.value - 1;\r\n                    }\r\n\r\n                    // Check if newWidth is valid for the note\r\n                    if (newWidth < gridWidth.value - 1 && !event.altKey || newWidth < 3) {\r\n                        allInBounds = false;\r\n                        return;\r\n                    }\r\n\r\n                    newWidths.push({ note, newWidth })\r\n\r\n                });\r\n\r\n                // If any note was resized to an invalid width, stop resizing\r\n                if (allInBounds) {\r\n                    for (const { note, newWidth } of newWidths) {\r\n                        note.width = newWidth;\r\n                        note.length = (960*4) * ((newWidth + 1) / 256);\r\n                        note.end = note.start + note.length;\r\n                        currentNoteLength.value = note.length;\r\n                    };\r\n                }\r\n            }\r\n        };\r\n\r\n        const endResize = () => {\r\n            resizingNotes.value = [];\r\n            startResizeData.clear();\r\n            document.removeEventListener('mousemove', onResize);\r\n            document.removeEventListener('mouseup', endResize);\r\n        };\r\n\r\n        let startingNoteVolumes = [];\r\n\r\n        const startVolumeChange = (note, event) => {\r\n            event.preventDefault();\r\n            if (event.button === 0) { // Ensure we're clicking with the left button\r\n                volumeChangingNotes.value = [];\r\n                startY.value = event.clientY;\r\n\r\n                if (note.highlighted) {\r\n                    // If note is highlighted, prepare to re-volume all selected notes\r\n                    volumeChangingNotes.value = selectedNotes.value;\r\n                } else {\r\n                    // If note is not highlighted, re-volume only this note\r\n                    clearSelection();\r\n                    volumeChangingNotes.value = [note];\r\n                }\r\n                startingNoteVolumes = volumeChangingNotes.value.map((note) => { return note.volume });\r\n\r\n                document.addEventListener('mousemove', onVolumeChange);\r\n                document.addEventListener('mouseup', endVolumeChange);\r\n            }\r\n        };\r\n\r\n        const onVolumeChange = (event) => {\r\n            event.preventDefault();\r\n            if (volumeChangingNotes.value.length > 0) {\r\n                let i = 0;\r\n                for (const note of volumeChangingNotes.value) {\r\n                    const dy = startY.value - event.clientY;\r\n                    let newVolume = Math.round(Math.max(1, Math.min(15, startingNoteVolumes[i] + dy / 10)));\r\n                    note.volume = newVolume;\r\n                    currentNoteVolume.value = newVolume;\r\n                    i++;\r\n                }\r\n            }\r\n        };\r\n\r\n        const endVolumeChange = () => {\r\n            volumeChangingNotes.value = [];\r\n            if (isPlaying.value)\r\n                playSequence();\r\n            document.removeEventListener('mousemove', onVolumeChange);\r\n            document.removeEventListener('mouseup', endVolumeChange);\r\n        };\r\n\r\n        const handleGridClick = (event) => {\r\n            if (event.ctrlKey && draggingNotes.value.length <= 0 && event.button === 0) {\r\n                if (!event.shiftKey)\r\n                    clearSelection();\r\n                startSelection(event);\r\n            } else {\r\n                startPlacingNote(event);\r\n            }\r\n        };\r\n\r\n        const handleGridScroll = (event) => {\r\n            // TODO: WE HAVE TO MAINTAIN A CONSTANT SIZED CANVAS. THE EXPANSION OF THE CANVAS CAUSES MUCHO LAG\r\n            const deltaY = -Math.sign(event.deltaY) * 1 / 8;\r\n            if (event.ctrlKey) {\r\n                event.preventDefault();\r\n                const z1 = zoomScalar.value;\r\n                const l = gridWrapper.value.scrollLeft;\r\n                const x = (event.clientX - gridWrapper.value.getBoundingClientRect().left + l);\r\n                zoomScalar.value = Math.min(8, Math.max(1 / 8, Math.round((zoomScalar.value + deltaY) * 8) / 8)); // Making sure that the zoom is in multiples of 1/8th\r\n                const z2 = zoomScalar.value;\r\n                gridWrapper.value.scrollLeft += x * (z2 / z1 - 1);\r\n            }\r\n        }\r\n\r\n        function clearSelection() {\r\n            selectedNotes.value.forEach((note) => {\r\n                note.highlighted = false;\r\n            });\r\n            selectedNotes.value = [];\r\n        }\r\n\r\n        const startSelection = (event) => {\r\n            event.preventDefault();\r\n            isSelecting.value = true;\r\n            const rect = gridCanvas.value.getBoundingClientRect();\r\n            startX.value = event.clientX - rect.left + scrollX.value;\r\n            startY.value = event.clientY - rect.top;\r\n            currentX.value = event.clientX - rect.left + scrollX.value;\r\n            currentY.value = event.clientY - rect.top;\r\n            document.addEventListener('mousemove', onSelectionMove);\r\n            document.addEventListener('mouseup', onSelectionEnd);\r\n        };\r\n\r\n        const onSelectionMove = (event) => {\r\n            if (isSelecting.value) {\r\n                const rect = gridCanvas.value.getBoundingClientRect();\r\n                currentX.value = event.clientX - rect.left + scrollX.value;\r\n                currentY.value = event.clientY - rect.top;\r\n            }\r\n        };\r\n\r\n        const onSelectionEnd = () => {\r\n            if (isSelecting.value) {\r\n                isSelecting.value = false;\r\n                document.removeEventListener('mousemove', onSelectionMove);\r\n                document.removeEventListener('mouseup', onSelectionEnd);\r\n                // This is where we add the logic to actually select the notes\r\n                checkIntersections();\r\n            }\r\n        };\r\n\r\n        function checkIntersections() {\r\n            const selectionRect = {\r\n                left: Math.min(startX.value, currentX.value) / zoomScalar.value,\r\n                top: Math.min(startY.value, currentY.value),\r\n                right: Math.max(startX.value, currentX.value) / zoomScalar.value,\r\n                bottom: Math.max(startY.value, currentY.value),\r\n            };\r\n\r\n            notesInGrid.value.forEach(note => {\r\n                const itemRect = {\r\n                    left: note.left,\r\n                    top: note.top,\r\n                    right: note.left + note.width,\r\n                    bottom: note.top + gridHeight,\r\n                };\r\n\r\n                if (intersects(selectionRect, itemRect)) {\r\n                    selectNote(note);\r\n                }\r\n            });\r\n\r\n        };\r\n\r\n        function selectNote(note) {\r\n            if (!selectedNotes.value.includes(note) && !note.muted) {\r\n                selectedNotes.value.push(note);\r\n                note.highlighted = true;\r\n            }\r\n        }\r\n\r\n        function intersects(rect1, rect2) {\r\n            return !(rect2.left >= rect1.right ||\r\n                rect2.right <= rect1.left ||\r\n                rect2.top >= rect1.bottom ||\r\n                rect2.bottom <= rect1.top);\r\n        }\r\n\r\n\r\n        const startPlacingNote = (event) => {\r\n            if (draggingNotes.value.length > 0 || resizingNotes.value.length > 0 || volumeChangingNotes.value.length > 0) {\r\n                return;\r\n            }\r\n\r\n            const rect = gridCanvas.value.getBoundingClientRect();\r\n            const x = (event.clientX - rect.left + scrollX.value) / zoomScalar.value;\r\n            const y = event.clientY - rect.top + grid.value.scrollTop;\r\n\r\n            let left = Math.round((x - gridWidth.value / 2) / gridWidth.value) * gridWidth.value;\r\n            if (event.altKey)\r\n                left = Math.round((x - gridWidth.value / 8) / (gridWidth.value / 4)) * gridWidth.value / 4;\r\n\r\n            const top = Math.round((y - gridHeight / 2) / gridHeight) * gridHeight;\r\n\r\n            const number = (1284 - (top / 2)) / 144;\r\n            const noteName = noteNames[number * 12 % 12] + \"\" + Math.floor(number);\r\n            startNote(0, { name: noteName, index: number * 12 % 12 }, Math.floor(number));\r\n            endNote(0, { name: noteName, index: number * 12 % 12 }, Math.floor(number));\r\n\r\n            const existingNote = notesInGrid.value.find(note =>\r\n                note.left <= x && x <= note.left + note.width + 1 && note.top === top && !note.muted\r\n            );\r\n\r\n            if (!existingNote) {\r\n                if (event.button !== 0)\r\n                    return;\r\n                clearSelection();\r\n                const id = notesInGrid.value.length + Date.now();\r\n                const newNote = {\r\n                    left: left,\r\n                    top: top,\r\n                    width: 256 * (currentNoteLength.value/(960*4)) - 1,\r\n                    highlighted: false,\r\n                    color: selectedTrack.value ? selectedTrack.value.color : 'hsla(212, 100%, 50%, 0.5)',\r\n                    id: id,\r\n                    name: noteName,\r\n                    pitch: number * 12 % 12 + 12 * (Math.floor(number) + 1),\r\n                    length: currentNoteLength.value,\r\n                    start: Math.round(left / (256) * (960*4)),\r\n                    end: Math.round(left / (256) * (960*4) + currentNoteLength.value),\r\n                    volume: currentNoteVolume.value,\r\n                    track: selectedTrack.value\r\n                };\r\n                notesInGrid.value.push(newNote);\r\n                selectedTrack.value.notes.unshift(newNote);\r\n                startDrag(notesInGrid.value.find(note => note.id == id), event, false);\r\n            } else {\r\n                // Here, we have identified that we clicked on an existing note.\r\n                if (event.button === 0) {\r\n                    const resizeHandleWidth = Math.min(10, (existingNote.width + 1) * 0.4) / zoomScalar.value;\r\n                    const volumeHandleCenter = { x: existingNote.left + (existingNote.width + 1) / 2, y: existingNote.top + gridHeight };\r\n                    const squaredDistToCenter = ((volumeHandleCenter.x - x) * zoomScalar.value) ** 2 + (volumeHandleCenter.y - y) ** 2;\r\n                    const radius = Math.min(6, ((existingNote.width + 1) / 4) * zoomScalar.value);\r\n                    if (x >= existingNote.left + existingNote.width - resizeHandleWidth && x <= existingNote.left + existingNote.width + 1) {\r\n                        startResize(existingNote, event);\r\n                        selectedTrackIndex.value = tracks.value.indexOf(existingNote.track);\r\n                        currentNoteLength.value = existingNote.length;\r\n                        currentNoteVolume.value = existingNote.volume;\r\n                    } else if (squaredDistToCenter <= radius * radius) {\r\n                        startVolumeChange(existingNote, event);\r\n                        selectedTrackIndex.value = tracks.value.indexOf(existingNote.track);\r\n                        currentNoteLength.value = existingNote.length;\r\n                        currentNoteVolume.value = existingNote.volume;\r\n                    } else {\r\n                        startDrag(existingNote, event);\r\n                    }\r\n                } else if (event.button === 2) {\r\n                    removeNote(existingNote, false);\r\n                }\r\n                \r\n                //console.log(existingNote.length, existingNote.left, existingNote.start, existingNote.end);\r\n            }\r\n        };\r\n\r\n        //let trackWrappers = [];\r\n\r\n        const trackify = () => {\r\n            let notesList = [...selectedTrack.value.notes].sort((a, b) => {\r\n                if (a.start === b.start) {\r\n                    return a.top - b.top;\r\n                }\r\n                return a.start - b.start;\r\n            });\r\n            //let trackWrappers = [];\r\n            // for (let i = 0; i < tracks.value.length; ++i) {   \r\n            //     trackWrappers.push({\r\n            //         notes: [],\r\n            //         track: tracks.value[i]\r\n            //     });\r\n            // }\r\n\r\n            // Idea: Take the selected track and split it into more tracks.\r\n            // This involves adding new tracks (only if allowed, otherwise cancel the operation)\r\n            // if (tracks.value.length < 16)\r\n            //     addTrack();\r\n            // Then, put the proper notes into the proper tracks.\r\n\r\n            // For all notes in the selected track\r\n            // starting with selected track:\r\n            // if note can go into this track, then add it\r\n            // otherwise, add a new track, and put the note in there.\r\n\r\n            // after all notes are situated, loop through all tracks in the wrapper and set their notes equal to the new note lists\r\n\r\n            let trackWrappers = [];\r\n            trackWrappers.push({\r\n                notes: [],\r\n                track: selectedTrack.value,\r\n                index: 0\r\n            });\r\n\r\n            for (const note of notesList) {\r\n                for (const trackWrapper of trackWrappers) {\r\n                    if (!trackWrapper.notes[0] || trackWrapper.notes[0].end <= note.start) {\r\n                        trackWrapper.notes.unshift(note);\r\n                        break;\r\n                    } else {\r\n                        if (trackWrapper.index === trackWrappers.length - 1) {\r\n                            trackWrappers.push({\r\n                                notes: [],\r\n                                track: { instrument: trackWrapper.track.instrument, color: null, name: selectedTrack.value.name + ` (${trackWrappers.length})` },\r\n                                index: trackWrappers.length\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (tracks.value.length + trackWrappers.length - 1 > 15) {\r\n                showFailureMessage('Failed to split track! (Process would create too many tracks!)');\r\n                return;\r\n            }\r\n\r\n            showSuccessMessage(`Successfully split the track \"${selectedTrack.value.name}\" into ${trackWrappers.length} tracks!`, 3000);\r\n\r\n            for (const trackWrapper of trackWrappers) {\r\n                if (!tracks.value.includes(trackWrapper.track)) {\r\n                    trackWrapper.track = addTrack(trackWrapper.track.instrument, trackWrapper.track.color, trackWrapper.track.name);\r\n                }\r\n                trackWrapper.track.notes = trackWrapper.notes;\r\n                for (const note of trackWrapper.track.notes) {\r\n                    note.track = trackWrapper.track;\r\n                    note.color = trackWrapper.track.color;\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        function hexToRgba(originalColor, alpha) {\r\n            let hex = originalColor.replace('#', '');\r\n\r\n            if (hex.length === 3) {\r\n                hex = hex.split('').map(char => char + char).join('');\r\n            }\r\n\r\n            const r = parseInt(hex.substring(0, 2), 16);\r\n            const g = parseInt(hex.substring(2, 4), 16);\r\n            const b = parseInt(hex.substring(4, 6), 16);\r\n\r\n            return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n        }\r\n\r\n        function copyToClipboard(text) {\r\n            navigator.clipboard.writeText(text).then(() => {\r\n                successNotificationText.value = \"MML copied to clipboard!\";\r\n                showSuccessNotification.value = true; // Show notification\r\n\r\n                // Hide notification after 2 seconds\r\n                setTimeout(() => {\r\n                    showSuccessNotification.value = false;\r\n                }, 2000);\r\n            }).catch(err => {\r\n                console.error('Could not copy text: ', err);\r\n            });\r\n        }\r\n\r\n        function optimDijkstra(tokens) {\r\n            // An early exit Dijkstra's algorithm\r\n            // Priority Queue worklist to which I add nodes whose priority is the total distance to reach that node.\r\n            // uniform cost search\r\n            const n = tokens.length;\r\n            // if depth = n then stop and return the string from the parents of the shortest path.\r\n\r\n            class GraphNode {\r\n                constructor (textValue, implicitOct, implicitLen, implicitVol) {\r\n                    this.implicitOct = implicitOct;\r\n                    this.implicitLen = implicitLen;\r\n                    this.implicitVol = implicitVol;\r\n                    this.parent = null;\r\n                    this.children = [];\r\n                    this.textValue = textValue;\r\n                    this.accCost = textValue.length;\r\n                    this.depth = 0;\r\n                }\r\n\r\n                addChild(child) {\r\n                    this.children.push(child);\r\n                    child.parent = this;\r\n                    child.accCost += this.accCost;\r\n                    child.depth = this.depth + 1;\r\n                }\r\n\r\n            }\r\n\r\n            function stateKey(depth, len, oct, vol) {\r\n                return `${depth}|${len}|${oct}|${vol}`;\r\n            }\r\n\r\n            const bestCost = new Map();\r\n\r\n            const startNode = new GraphNode('', 4, 960, 8);\r\n            const worklist = new Heap((a, b) => a.priority - b.priority);\r\n            let endNode = null;\r\n            worklist.push( {node: startNode, priority: 0} );\r\n\r\n            while (worklist.size() > 0) {\r\n                const { node: u, priority } = worklist.pop();\r\n                const key = stateKey(u.depth, u.implicitLen, u.implicitOct, u.implicitVol);\r\n\r\n                if (bestCost.has(key) && bestCost.get(key) <= priority) continue;\r\n                bestCost.set(key, priority);\r\n\r\n                const d = u.depth;\r\n                const token = tokens[d];\r\n                const tl = token?.length;\r\n                const td = token?.dotted;\r\n                const lengthString = Math.floor((960 * 4) / tl * (td ? 1.5 : 1)) + (td ? '.' : '');\r\n                let suffixLengthString = lengthString;\r\n                if (tl === u.implicitLen * 1.5 && td) {\r\n                    suffixLengthString = '.';\r\n                }\r\n\r\n                if (d === n) {\r\n                    endNode = u;\r\n                    break;\r\n                }\r\n\r\n                // create the children then add them to the worklist.\r\n                if (token.type === 'NOTE') {\r\n                    let octaveString = '';\r\n                    let volumeString = token.volume === u.implicitVol ? '' : `V${token.volume}`;\r\n\r\n                    let octaveDiff = token.octave - u.implicitOct;\r\n                    if (Math.abs(octaveDiff) > 2) {\r\n                        octaveString = `o${token.octave}`;\r\n                    } else {\r\n                        octaveString = (octaveDiff > 0 ? '>' : '<').repeat(Math.abs(octaveDiff));\r\n                    }\r\n\r\n                    if (token.length === u.implicitLen) {\r\n                        u.addChild(new GraphNode(`${volumeString}${octaveString}${token.name}`, token.octave, u.implicitLen, token.volume));\r\n                        u.addChild(new GraphNode(`${volumeString}N${token.pitch}`, u.implicitOct, u.implicitLen, token.volume));\r\n\r\n                        if (token.name === 'b') {\r\n                            octaveDiff = (token.octave+1) - u.implicitOct;\r\n                            if (Math.abs(octaveDiff) > 2) {\r\n                                octaveString = `o${token.octave}`;\r\n                            } else {\r\n                                octaveString = (octaveDiff > 0 ? '>' : '<').repeat(Math.abs(octaveDiff));\r\n                            }\r\n                            u.addChild(new GraphNode(`${volumeString}${octaveString}c-`, token.octave + 1, u.implicitLen, token.volume));\r\n                        }\r\n\r\n                        if (token.name === 'c') {\r\n                            octaveDiff = (token.octave-1) - u.implicitOct;\r\n                            if (Math.abs(octaveDiff) > 2) {\r\n                                octaveString = `o${token.octave}`;\r\n                            } else {\r\n                                octaveString = (octaveDiff > 0 ? '>' : '<').repeat(Math.abs(octaveDiff));\r\n                            }\r\n                            u.addChild(new GraphNode(`${volumeString}${octaveString}b+`, token.octave - 1, u.implicitLen, token.volume));\r\n                        }\r\n\r\n                    } else {\r\n                        u.addChild(new GraphNode(`${volumeString}L${lengthString}${octaveString}${token.name}`, token.octave, token.length, token.volume));\r\n                        u.addChild(new GraphNode(`${volumeString}${octaveString}${token.name}${suffixLengthString}`, token.octave, u.implicitLen, token.volume));\r\n\r\n                        if (token.name === 'b') {\r\n                            octaveDiff = (token.octave+1) - u.implicitOct;\r\n                            if (Math.abs(octaveDiff) > 2) {\r\n                                octaveString = `o${token.octave}`;\r\n                            } else {\r\n                                octaveString = (octaveDiff > 0 ? '>' : '<').repeat(Math.abs(octaveDiff));\r\n                            }\r\n                            u.addChild(new GraphNode(`${volumeString}L${lengthString}${octaveString}c-`, token.octave + 1, token.length, token.volume));\r\n                            u.addChild(new GraphNode(`${volumeString}${octaveString}c-${suffixLengthString}`, token.octave + 1, u.implicitLen, token.volume));\r\n                        }\r\n\r\n                        if (token.name === 'c') {\r\n                            octaveDiff = (token.octave-1) - u.implicitOct;\r\n                            if (Math.abs(octaveDiff) > 2) {\r\n                                octaveString = `o${token.octave}`;\r\n                            } else {\r\n                                octaveString = (octaveDiff > 0 ? '>' : '<').repeat(Math.abs(octaveDiff));\r\n                            }\r\n                            u.addChild(new GraphNode(`${volumeString}L${lengthString}${octaveString}b+`, token.octave - 1, token.length, token.volume));\r\n                            u.addChild(new GraphNode(`${volumeString}${octaveString}b+${suffixLengthString}`, token.octave - 1, u.implicitLen, token.volume));\r\n                        }\r\n\r\n                        u.addChild(new GraphNode(`${volumeString}L${lengthString}N${token.pitch}`, u.implicitOct, token.length, token.volume));\r\n                    }\r\n                } else if (token.type === 'REST') {\r\n                    if (token.length === u.implicitLen) {\r\n                        u.addChild(new GraphNode(`${token.name}`, u.implicitOct, u.implicitLen, u.implicitVol));\r\n                    } else {\r\n                        u.addChild(new GraphNode(`L${lengthString}${token.name}`, u.implicitOct, token.length, u.implicitVol));\r\n                        u.addChild(new GraphNode(`${token.name}${suffixLengthString}`, u.implicitOct, u.implicitLen, u.implicitVol));\r\n                    }\r\n                } else if (token.type === 'TEMPO') {\r\n                    u.addChild(new GraphNode(`T${token.tempo}`, u.implicitOct, u.implicitLen, u.implicitVol));\r\n                }\r\n\r\n                for (const child of u.children) {\r\n                    worklist.push({node: child, priority: child.accCost});\r\n                }\r\n\r\n            }\r\n\r\n            // Rebuild string with list from recursively checking parents.\r\n            const pieces = [];\r\n            let currentNode = endNode;\r\n            while (currentNode !== null) {\r\n                pieces.push(currentNode.textValue);\r\n                currentNode = currentNode.parent;\r\n            }\r\n\r\n            return pieces.reverse().join('');\r\n\r\n        }\r\n\r\n        function OxLxTokensDP(tokens) {\r\n            const n = tokens.length;\r\n\r\n            // All possible lengths and octaves we may encounter\r\n            const lengths = new Set(['4', ...tokens.filter(t => t.type !== 'TEMPO').map(t => t.lengthString)]);\r\n            const octaves = new Set(tokens.filter(t => t.type === 'NOTE').map(t => t.octave));\r\n            octaves.add(4);\r\n\r\n            const dp = {};\r\n            const action = {};\r\n\r\n            function getDP(i, len, oct) {\r\n                return dp[i]?.[len]?.[oct] ?? Infinity;\r\n            }\r\n\r\n            function setDP(i, len, oct, val, act) {\r\n                dp[i] ??= {};\r\n                dp[i][len] ??= {};\r\n                dp[i][len][oct] = val;\r\n\r\n                action[i] ??= {};\r\n                action[i][len] ??= {};\r\n                action[i][len][oct] = act;\r\n            }\r\n\r\n            // Base case: finishing at end has 0 cost\r\n            for (const len of lengths) {\r\n                for (const oct of octaves) {\r\n                    setDP(n, len, oct, 0, null);\r\n                }\r\n            }\r\n\r\n            // Helper: compute encoding cost/options for a note/rest in current state\r\n            function encodingsFor(lengthString, curLen, tie, noteName, notePitch, useTies) {\r\n                const results = [];\r\n\r\n                const isDotted = lengthString.endsWith('.');\r\n                const undotted = isDotted ? lengthString.slice(0, -1) : lengthString;\r\n                const tieString = tie ? '&' : '';\r\n\r\n                // Implicit (length same as current)\r\n                if (lengthString === curLen) {\r\n                    if (noteName) {\r\n                        const implicit = tieString + noteName;\r\n                        results.push({\r\n                            spelling: implicit,\r\n                            newLen: curLen,\r\n                            cost: implicit.length,\r\n                            type: 'implicit'\r\n                        });\r\n                    } else {\r\n                        const implicit = tieString + 'r';\r\n                        results.push({\r\n                            spelling: implicit,\r\n                            newLen: curLen,\r\n                            cost: implicit.length,\r\n                            type: 'implicit'\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // Switch (change L then note)\r\n                const sw = 'L' + lengthString + tieString + (noteName || 'r');\r\n                results.push({\r\n                    spelling: tieString + (noteName || 'r'),\r\n                    newLen: lengthString,\r\n                    cost: sw.length,\r\n                    type: 'switch',\r\n                    needLengthCmd: true\r\n                });\r\n\r\n                // Explicit (append undotted)\r\n                if (noteName) {\r\n                    const ex = tieString + noteName + undotted;\r\n                    results.push({\r\n                        spelling: ex,\r\n                        newLen: curLen,\r\n                        cost: ex.length,\r\n                        type: 'explicit'\r\n                    });\r\n                }\r\n\r\n                // Pitch-notation (when useTies and we have pitch)\r\n                if (useTies && notePitch !== undefined) {\r\n                    if (lengthString === curLen) {\r\n                        const usePitch = tieString + `N${notePitch}`;\r\n                        results.push({\r\n                            spelling: usePitch,\r\n                            newLen: curLen,\r\n                            cost: usePitch.length,\r\n                            type: 'pitchImplicit',\r\n                            pitch: notePitch\r\n                        });\r\n                    }\r\n                    const exPitch = `L${lengthString}${tieString}N${notePitch}`;\r\n                    results.push({\r\n                        spelling: tieString + `N${notePitch}`,\r\n                        newLen: lengthString,\r\n                        cost: exPitch.length,\r\n                        type: 'pitchSwitch',\r\n                        pitch: notePitch,\r\n                        needLengthCmd: true\r\n                    });\r\n                }\r\n\r\n                return results;\r\n            }\r\n\r\n            // Bottom-up DP\r\n            for (let i = n - 1; i >= 0; i--) {\r\n                const token = tokens[i];\r\n                for (const len of lengths) {\r\n                    for (const oct of octaves) {\r\n                        let best = Infinity;\r\n                        let bestAct = null;\r\n\r\n                        if (token.type === 'REST') {\r\n                            const options = encodingsFor(token.lengthString, len, false, null, null, false);\r\n                            for (const opt of options) {\r\n                                const cand = opt.cost + getDP(i + 1, opt.newLen, oct);\r\n                                if (cand < best) {\r\n                                    best = cand;\r\n                                    bestAct = { type: 'rest', ...opt };\r\n                                }\r\n                            }\r\n\r\n                        } else if (token.type === 'NOTE') {\r\n                            const spellings = [];\r\n\r\n                            // Normal spelling\r\n                            spellings.push({ name: token.name, oct: token.octave });\r\n\r\n                            // Enharmonics\r\n                            if (token.name.toLowerCase() === 'b' && token.octave + 1 <= 8) {\r\n                                spellings.push({ name: 'c-', oct: token.octave + 1 });\r\n                            }\r\n                            if (token.name.toLowerCase() === 'c' && token.octave - 1 >= 0) {\r\n                                spellings.push({ name: 'b+', oct: token.octave - 1 });\r\n                            }\r\n\r\n                            for (const sp of spellings) {\r\n                                const options = encodingsFor(token.lengthString, len, false, sp.name, token.pitch, true);\r\n\r\n                                for (const opt of options) {\r\n                                    // A) Implicit octave (same as current)\r\n                                    const isPitchNotation = opt.type.startsWith('pitch');\r\n                                    if (isPitchNotation || sp.oct === oct) {\r\n                                        const cand = opt.cost + getDP(i + 1, opt.newLen, oct);\r\n                                        if (cand < best) {\r\n                                            best = cand;\r\n                                            bestAct = { type: 'spell', newOct: oct, ...opt };\r\n                                        }\r\n                                    }\r\n\r\n                                    if (isPitchNotation) continue;\r\n\r\n                                    // B) Relative octave (within ±2)\r\n                                    const diff = sp.oct - oct;\r\n                                    if (Math.abs(diff) <= 2 && diff !== 0) {\r\n                                        const relPrefix = (diff > 0 ? '>' : '<').repeat(Math.abs(diff));\r\n                                        const cand = relPrefix.length + opt.cost + getDP(i + 1, opt.newLen, sp.oct);\r\n                                        if (cand < best) {\r\n                                            best = cand;\r\n                                            bestAct = { type: 'spell+relOct', shift: diff, newOct: sp.oct, ...opt };\r\n                                        }\r\n                                    }\r\n\r\n                                    // C) Absolute octave\r\n                                    const absPrefix = `o${sp.oct}`;\r\n                                    const cand = absPrefix.length + opt.cost + getDP(i + 1, opt.newLen, sp.oct);\r\n                                    if (cand < best) {\r\n                                        best = cand;\r\n                                        bestAct = { type: 'spell+absOct', newOct: sp.oct, ...opt };\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        setDP(i, len, oct, best, bestAct);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Rebuild token list\r\n            let implicitLen = '4';\r\n            let implicitOct = 4;\r\n            const output = [];\r\n\r\n            for (let i = 0; i < tokens.length; i++) {\r\n                const token = tokens[i];\r\n                if (token.type === 'TEMPO') {\r\n                    output.push(token);\r\n                    continue;\r\n                }\r\n\r\n                const a = action[i][implicitLen][implicitOct];\r\n                if (!a) continue;\r\n\r\n                if (a.newOct !== undefined && a.type !== 'spell') {\r\n                    let text;\r\n                    if (a.type === 'spell+absOct') {\r\n                        text = `o${a.newOct}`;\r\n                    } else if (a.type === 'spell+relOct') {\r\n                        const shift = a.shift;\r\n                        text = (shift > 0 ? '>' : '<').repeat(Math.abs(shift));\r\n                    }\r\n                    output.push({ type: 'OCTAVE', start: token.start, text });\r\n                    implicitOct = a.newOct;\r\n                }\r\n\r\n                if (a.needLengthCmd) {\r\n                    output.push({\r\n                        type: 'LENGTH',\r\n                        start: token.start,\r\n                        lengthString: a.newLen,\r\n                        length: Number(a.newLen),\r\n                        dotted: a.newLen.endsWith('.')\r\n                    });\r\n                    implicitLen = a.newLen;\r\n                }\r\n\r\n                output.push({\r\n                    type: token.type,\r\n                    start: token.start,\r\n                    name: a.spelling,\r\n                    lengthString: a.newLen,\r\n                    length: Number(a.newLen),\r\n                    dotted: a.newLen.endsWith('.'),\r\n                    tie: false,\r\n                    pitch: a.pitch\r\n                });\r\n\r\n                implicitLen = a.newLen;\r\n            }\r\n\r\n            return output;\r\n        }\r\n\r\n        const getTrackTokens = (track) => {\r\n            let tokens = [];\r\n            // Add Note tokens to list\r\n            for (const note of track.notes) {\r\n                const noteLengths = getOptimalNoteLengths(note.length); // Returns a list of lists of raw note length strings\r\n                const noteName = note.name.slice(0, note.name.length - 1).toLowerCase();\r\n                let useTies = false;\r\n                let prevNoteEnd = 0;\r\n                for (const noteLength of noteLengths.noteCombination) {\r\n                    tokens.push({\r\n                        type: 'NOTE',\r\n                        pitch: note.pitch - 12,\r\n                        volume: note.volume,\r\n                        length: noteLength.length / 32,\r\n                        lengthString: noteLength.name,\r\n                        dotted: noteLength.name.endsWith('.'),\r\n                        start: note.start + prevNoteEnd,\r\n                        octave: Math.floor((note.pitch - 12) / 12),\r\n                        name: (useTies ? '&' : '') + noteName\r\n                    });\r\n                    useTies = true;\r\n                    prevNoteEnd += noteLength.length / 32;\r\n                }\r\n            }\r\n            // Add tempo markers before rests\r\n            // Remove any duplicate tempo markers and push only relevant ones\r\n            const latestTempoMarkers = new Map();\r\n\r\n            if (tempo.value !== 120) {\r\n                latestTempoMarkers.set(0, {\r\n                    parentTrack: track,\r\n                    tempo: tempo.value,\r\n                    left: 0\r\n                });\r\n            }\r\n\r\n            for (const marker of tempoMarkers.value) {\r\n                if (marker.parentTrack === track) {\r\n                    latestTempoMarkers.set(marker.left, marker);\r\n                }\r\n            }\r\n\r\n            for (const marker of latestTempoMarkers.values()) {\r\n                tokens.push({\r\n                    type: 'TEMPO',\r\n                    tempo: marker.tempo,\r\n                    start: marker.left / 256 * 960 * 4,\r\n                    length: 0\r\n                });\r\n            }\r\n\r\n            tokens.sort((a, b) => {\r\n                if (a.start - b.start === 0) {\r\n                    if (a.type === 'TEMPO')\r\n                        return -1\r\n                }\r\n                return a.start - b.start;\r\n            });\r\n\r\n            // Add Rests between notes and tempo markers\r\n            for (let i = -1; i < tokens.length - 1; ++i) {\r\n                const token1 = i > -1 ? tokens[i] : {\r\n                    type: 'TEMPO',\r\n                    length: 0,\r\n                    start: 0\r\n                };\r\n                const token2 = tokens[i + 1];\r\n\r\n                if (token1.type === 'REST' || token2.type === 'REST') continue;\r\n\r\n                const gap = Math.max(0, token2.start - (token1.start + token1.length));\r\n                if (gap > 0) {\r\n                    const restLengths = getOptimalNoteLengths(gap);\r\n                    let prevRestEnd = 0;\r\n                    for (const restLength of restLengths.noteCombination) {\r\n                        tokens.splice(i + 1, 0, {\r\n                            type: \"REST\",\r\n                            length: restLength.length / 32,\r\n                            lengthString: restLength.name, // This IS MML REPRESENTATION\r\n                            start: token1.start + token1.length + prevRestEnd,\r\n                            name: \"r\",\r\n                            dotted: restLength.name.endsWith('.')\r\n                        });\r\n                        prevRestEnd += restLength.length / 32;\r\n                        i++;\r\n                    }\r\n                }\r\n            }\r\n            // Run dynamic programming algorithm to place length tokens in proper spots (ignoring tempo tokens).\r\n            const tempoTokens = tokens.filter(t => t.type === 'TEMPO');\r\n            const dpTokens = tokens.filter(t => t.type !== 'TEMPO');\r\n\r\n            const testStr = optimDijkstra(tokens);\r\n            return { tokens: tokens, rendered: testStr };\r\n        };\r\n\r\n        const renderTrackTokens = (tokenList) => {\r\n            let output = [];\r\n            let activeDefault = 4;\r\n            let activeDotted = false;\r\n\r\n            if (!tokenList) {\r\n                return;\r\n            }\r\n\r\n            for (const tok of tokenList) {\r\n                let rendered = '';\r\n                if (tok.type === 'LENGTH') {\r\n                    activeDefault = tok.length;\r\n                    activeDotted = tok.dotted;\r\n                    rendered = `L${activeDefault}${tok.dotted ? '.' : ''}`;\r\n                } else if (tok.type === 'OCTAVE') {\r\n                    rendered = tok.text;\r\n                } else if (tok.type === 'VOLUME') {\r\n                    rendered = `V${tok.volume}`;\r\n                } else if (tok.type === 'REST') {\r\n                    rendered = tok.name;\r\n                } else if (tok.type === 'NOTE') {\r\n                    rendered = tok.name;\r\n                } else if (tok.type === 'TEMPO') {\r\n                    rendered = `T${tok.tempo}`;\r\n                }\r\n\r\n                if (rendered)\r\n                    output.push(rendered);\r\n            }\r\n\r\n            let outputText = output.join('');\r\n            return outputText;\r\n        };\r\n\r\n        const genTokensOutright = (singleTrack = null) => {\r\n            // Should split this per track.\r\n            const tracksToConsider = [singleTrack] || tracks.value;\r\n            if (tracksToConsider[0] === null || tracksToConsider === 0)\r\n                return;\r\n            const allTokens = [];\r\n            for (const track of tracksToConsider) {\r\n                allTokens.push(getTrackTokens(track));\r\n            }\r\n            return allTokens;\r\n        };\r\n\r\n        function renderTokens(tokenList) {\r\n            const outputText = renderTrackTokens(tokenList);\r\n            return outputText;\r\n        }\r\n\r\n        function getEnharmonicEquivalent(note) {\r\n            if (note.length === 1)\r\n                return note;\r\n            let root = note[0];\r\n            let accidental = note[1];\r\n            let noteIndex = noteNames.indexOf(root);\r\n            if (accidental === '#' || accidental === '+') {\r\n                noteIndex = (noteIndex + 1) % 12;\r\n            } else if (accidental === '-') {\r\n                noteIndex = ((noteIndex - 1) % 12 + 12) % 12;\r\n            }\r\n            return noteNames[noteIndex];\r\n        }\r\n\r\n        const patterns = {\r\n            LENGTH: /[Ll](\\d+)\\.?/g,  // Matches note lengths, e.g., L4, L8.\r\n            NOTE: /[a-gA-G][-+#]?\\d*\\.?|N\\d+/g,         // Matches notes like N60, N62.\r\n            REST: /[Rr]\\d*\\.?/g,      // Matches rests like R4, R8.\r\n            TIE: /&/g,              // Matches ties.\r\n            VOLUME: /[Vv](\\d+)/g,\r\n            TEMPO: /[Tt](\\d+)/g,\r\n            OCTAVE: /[Oo](\\d+)|[<>]/g\r\n        };\r\n\r\n        function tokenizeMML(mmlString) {\r\n            let tokens = [];\r\n\r\n            // Run regex patterns over the input\r\n            for (const [key, regex] of Object.entries(patterns)) {\r\n                let match;\r\n                while ((match = regex.exec(mmlString)) !== null) {\r\n                    tokens.push({ type: key, value: match[0], index: match.index });\r\n                }\r\n            }\r\n\r\n            // Sort tokens by their original index in the string\r\n            tokens.sort((a, b) => { return a.index - b.index });\r\n\r\n            return tokens;\r\n        }\r\n\r\n        function mmlToNewTrack(title, mmlTokens) {\r\n            let newTokenList = [...mmlTokens];\r\n            // Creates a new track with title and with data from mmlTokens\r\n            let newTrack = addTrack(instruments.value[10], null, title);\r\n            let octave = 4;\r\n            let length = '4';\r\n            let tempo = '120';\r\n            let volume = '8';\r\n            let builderX = 0; // We will update the currentX based on note length/width/etc\r\n            let previousNote = null;\r\n            for (let i = 0; i < newTokenList.length; i++) {\r\n                let token = newTokenList[i];\r\n                if (token.type === 'LENGTH') {\r\n                    let tokenLength = token.value.split('L')[1];\r\n                    if (tokenLength !== length) {\r\n                        length = tokenLength;\r\n                    }\r\n                } else if (token.type === 'TIE') {\r\n                    if (previousNote === null || newTokenList[i + 1] == null)\r\n                        continue;\r\n                    // if the next note has the same pitch as the previous note, then we modify the duration of previous note and increment builderX and i\r\n                    let nextNote = newTokenList[i + 1];\r\n                    let noteLength = length;\r\n                    let noteName = 'C';\r\n                    let noteOctave = octave;\r\n                    let notePitch = 0;\r\n\r\n                    if (nextNote.value.startsWith('N')) {\r\n                        notePitch = Number(nextNote.value.split('N')[1]);\r\n                        noteOctave = Math.floor(notePitch / 12);\r\n                        noteName = noteNames[(notePitch - 12 * noteOctave) % 12];\r\n                        let dotted = noteLength.includes('.');\r\n                        noteLength = Number(noteLength.slice(0, noteLength.length - dotted)) * (dotted ? 2 / 3 : 1);\r\n                    } else {\r\n                        let sharp = nextNote.value.includes('#') || nextNote.value.includes('+')\r\n                        let flat = nextNote.value.includes('-');\r\n                        let dotted = nextNote.value.includes('.');\r\n                        noteName = getEnharmonicEquivalent(nextNote.value.slice(0, 1 + sharp + flat));\r\n                        let noteIndex = noteNames.indexOf(noteName);\r\n                        if (noteIndex === 11 && flat)\r\n                            noteOctave -= 1;\r\n                        if (noteIndex === 0 && sharp)\r\n                            noteOctave += 1;\r\n                        if (nextNote.value.length - dotted > 1 + sharp + flat) { // If the note has a length added on\r\n                            noteLength = Number(nextNote.value.slice(((sharp || flat) ? 2 : 1), nextNote.value.length - dotted)) * (dotted ? 2 / 3 : 1);\r\n                        } else {// If the note has no added length\r\n                            let Ldotted = length.includes('.');\r\n                            dotted = Ldotted || dotted;\r\n                            noteLength = Number(length.slice(0, length.length - Ldotted)) * (dotted ? 2 / 3 : 1);\r\n                        }\r\n                        notePitch = noteNames.indexOf(noteName) + 12 * noteOctave;\r\n                    }\r\n                    if (previousNote.pitch - 12 === notePitch) {\r\n                        builderX += 256 / noteLength;\r\n                        previousNote.width += 256 / noteLength;\r\n                        previousNote.length += (960*4) / noteLength;\r\n                        previousNote.end += (960*4) / noteLength;\r\n                        i++;\r\n                    }\r\n\r\n                } else if (token.type === 'OCTAVE') {\r\n                    let tokenOctave = token.value;\r\n                    if (tokenOctave === '<') {\r\n                        octave -= 1;\r\n                    } else if (tokenOctave === '>') {\r\n                        octave += 1;\r\n                    } else {\r\n                        octave = Number(tokenOctave.split('O')[1]);\r\n                    }\r\n                } else if (token.type === 'VOLUME') {\r\n                    let tokenVolume = token.value.split('V')[1];\r\n                    if (tokenVolume !== volume) {\r\n                        volume = tokenVolume;\r\n                    }\r\n                } else if (token.type === 'TEMPO') {\r\n                    let tokenTempo = token.value.split('T')[1];\r\n                    if (tokenTempo !== tempo) {\r\n                        tempo = tokenTempo;\r\n                        tempoMarkers.value.push({\r\n                            left: builderX,\r\n                            tempo: Number(tempo),\r\n                            color: newTrack.color,\r\n                            parentTrack: newTrack,\r\n                            muted: false\r\n                        });\r\n                    }\r\n                } else if (token.type === 'REST') {\r\n                    let restLength = token.value.split('R')[1];\r\n                    if (restLength === length || Number(restLength) === 0 || isNaN(Number(restLength))) {\r\n                        let dotted = length.includes('.') || restLength.includes('.');\r\n                        let lengthNum = Number(length);\r\n                        builderX += (256 / lengthNum) * (dotted ? 1.5 : 1); // 1 bar is 256 pixels (no matter the tempo)\r\n                    } else {\r\n                        let dotted = restLength.includes('.');\r\n                        let lengthNum = Number(restLength);\r\n                        builderX += (256 / lengthNum) * (dotted ? 1.5 : 1); // 1 bar is 256 pixels (no matter the tempo)\r\n                    }\r\n                } else if (token.type === 'NOTE') {\r\n                    // notes will be placed starting from builderX\r\n                    // each note COULD have its own length, but notes starting with 'N' or not having a following number use the global length value\r\n                    let noteLength = length;\r\n                    let noteName = 'C';\r\n                    let noteOctave = octave;\r\n                    let notePitch = 0;\r\n\r\n                    if (token.value.startsWith('N')) {\r\n                        notePitch = Number(token.value.split('N')[1]);\r\n                        noteOctave = Math.floor(notePitch / 12);\r\n                        noteName = noteNames[(notePitch - 12 * noteOctave) % 12];\r\n                        let dotted = noteLength.includes('.');\r\n                        noteLength = Number(noteLength) * (dotted ? 2 / 3 : 1);\r\n                    } else {\r\n                        let sharp = token.value.includes('#') || token.value.includes('+');\r\n                        let flat = token.value.includes('-');\r\n                        let dotted = token.value.includes('.');\r\n                        noteName = getEnharmonicEquivalent(token.value.slice(0, 1 + sharp + flat));\r\n                        let noteIndex = noteNames.indexOf(noteName);\r\n                        if (noteIndex === 11 && flat)\r\n                            noteOctave -= 1;\r\n                        if (noteIndex === 0 && sharp)\r\n                            noteOctave += 1;\r\n                        if (token.value.length - dotted > 1 + sharp + flat) { // If the note has a length added on\r\n                            noteLength = Number(token.value.slice(((sharp || flat) ? 2 : 1), token.value.length)) * (dotted ? 2 / 3 : 1);\r\n                        } else { // If the note has no added length\r\n                            let Ldotted = length.includes('.');\r\n                            dotted = Ldotted || dotted;\r\n                            noteLength = Number(length) * (dotted ? 2 / 3 : 1);\r\n                        }\r\n                        notePitch = noteNames.indexOf(noteName) + 12 * noteOctave;\r\n                    }\r\n\r\n                    const newNote = {\r\n                        left: builderX, // In pixels\r\n                        top: 2568 - notePitch * gridHeight, // In pixels, the top of the note\r\n                        width: 256 / noteLength - 1, // In pixels (we assume 4/4 time, which is 16 pixels per beat)\r\n                        highlighted: false,\r\n                        color: newTrack.color,\r\n                        id: notesInGrid.value.length + Date.now(),\r\n                        name: noteName + noteOctave,\r\n                        pitch: notePitch + 12,\r\n                        length: (960*4) / noteLength, // In beats\r\n                        start: builderX / 256 * (960*4), // In beats\r\n                        end: builderX / 256 * (960*4) + (960*4) / noteLength, // In beats\r\n                        volume: Number(volume),\r\n                        track: newTrack\r\n                    };\r\n                    notesInGrid.value.push(newNote);\r\n                    newNote.track.notes.unshift(newNote);\r\n                    builderX += newNote.width + 1;\r\n                    previousNote = newNote;\r\n                }\r\n            }\r\n        }\r\n\r\n        function parseMMLNotation(mmlString) {\r\n            const segments = mmlString.replace(/\\s/, '').toUpperCase().match(/MML@([^;]+);/)[1].split(',');\r\n            for (const segment of segments) {\r\n                if (segment.length > 0)\r\n                    mmlToNewTrack(null, tokenizeMML(segment));\r\n            }\r\n        }\r\n\r\n        function parseMabiNotation(mabiString) {\r\n            const lines = mabiString.split(\"\\r\\n\"); // Goes title, composer, melody, harmony1, harmony2, song\r\n            let tokenizedSections = [];\r\n            for (let i = 2; i < lines.length; ++i) {\r\n                let line = lines[i].split(\" : \");\r\n                if (line.length < 2) {\r\n                    continue;\r\n                }\r\n                tokenizedSections.push({ title: line[0].trim(), tokens: tokenizeMML(line[1].trim().toUpperCase()) });\r\n            }\r\n\r\n            // Convert the titles and tokens into tracks with notes in them (and any tempo markers).\r\n            for (const section of tokenizedSections) {\r\n                if (section.tokens.length > 0) {\r\n                    mmlToNewTrack(section.title, section.tokens);\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        function parseMML(mmlString) {\r\n            if (mmlString.trim().startsWith(\"MML@\") && mmlString.trim().endsWith(\";\")) {\r\n                parseMMLNotation(mmlString);\r\n            } else {\r\n                parseMabiNotation(mmlString);\r\n            }\r\n        }\r\n\r\n        function importMidi() {\r\n            // Let user choose and \"upload\" MIDI file\r\n            const hiddenFileInput = document.getElementById('hiddenFileInput');\r\n            hiddenFileInput.click();\r\n\r\n            let handleFileSelect = async () => {\r\n                const file = hiddenFileInput.files[0];\r\n\r\n                hiddenFileInput.removeEventListener('change', handleFileSelect);\r\n\r\n                if (file) {\r\n                    const reader = new FileReader();\r\n\r\n                    reader.onload = async function (e) {\r\n                        const arrayBuffer = e.target.result;\r\n\r\n                        try {\r\n                            const parsedMIDI = new MIDI(arrayBuffer);\r\n                            await parsedMIDI.isReady;\r\n\r\n                            const ticksPerBeat = parsedMIDI.timeDivision;\r\n                            const fileDuration = parsedMIDI.duration;\r\n                            const fileTempo = parsedMIDI.tempoChanges.at(-2).tempo;\r\n\r\n                            const firstAddedTrackIndex = tracks.value.length;\r\n\r\n                            parsedMIDI.tracks.forEach((track, idx) => {\r\n\r\n                                const trackName = track.name || `Track ${idx}`;\r\n                                const activeNotes = []; // {pitch: 66, ticks: 44, velocity: 127}\r\n                                const sustainBuffer = [];\r\n                                const pairedNotes = []; // {startTicks: 1, pitch: 66, duration: 76 (in ticks, end ticks minus start ticks), velocity: 65}\r\n\r\n                                let pedalDown = false;\r\n\r\n                                track.forEach(midiMessage => {\r\n                                    const status = midiMessage.messageStatusByte;\r\n                                    const data = midiMessage.messageData;\r\n                                    const ticks = midiMessage.ticks;\r\n\r\n                                    if ((status & 0xF0) === 0x90 && data[1] > 0) {\r\n                                        activeNotes.push({\r\n                                            pitch: data[0],\r\n                                            ticks,\r\n                                            velocity: data[1]\r\n                                        });\r\n                                    }\r\n\r\n                                    // Note-off (either via 0x80 or 0x90 velocity=0)\r\n                                    else if (((status & 0xF0) === 0x80) || ((status & 0xF0) === 0x90 && data[1] === 0)) {\r\n                                        const pitch = data[0];\r\n                                        const endTicks = ticks;\r\n\r\n                                        const index = activeNotes.findIndex(n => n.pitch === pitch);\r\n                                        if (index !== -1) {\r\n                                            const startNote = activeNotes.splice(index, 1)[0];\r\n\r\n                                            if (pedalDown) {\r\n                                                sustainBuffer.push({\r\n                                                    pitch: startNote.pitch,\r\n                                                    startTicks: startNote.ticks,\r\n                                                    velocity: startNote.velocity,\r\n                                                    originalEndTicks: endTicks\r\n                                                });\r\n                                            } else {\r\n                                                pairedNotes.push({\r\n                                                    startTicks: startNote.ticks,\r\n                                                    pitch: startNote.pitch,\r\n                                                    duration: endTicks - startNote.ticks,\r\n                                                    velocity: startNote.velocity\r\n                                                });\r\n                                            }\r\n                                        }\r\n                                    }\r\n\r\n                                    // Sustain Pedal (Control Change 64)\r\n                                    else if ((status & 0xF0) === 0xB0 && data[0] === 64) {\r\n                                        const value = data[1];\r\n                                        const wasDown = pedalDown;\r\n                                        pedalDown = value >= 64;\r\n\r\n                                        if (wasDown && !pedalDown) {\r\n                                            // Pedal released – finalize all sustained notes\r\n                                            for (const note of sustainBuffer) {\r\n                                                pairedNotes.push({\r\n                                                    startTicks: note.startTicks,\r\n                                                    pitch: note.pitch,\r\n                                                    duration: ticks - note.startTicks,\r\n                                                    velocity: note.velocity\r\n                                                });\r\n                                            }\r\n                                            sustainBuffer.length = 0;\r\n                                        }\r\n                                    }\r\n\r\n                                    // Optionally, handle program change, tempo, etc., elsewhere\r\n                                });\r\n\r\n                                // Optional: handle any dangling notes at end of track\r\n                                for (const note of activeNotes) {\r\n                                    pairedNotes.push({\r\n                                        startTicks: note.ticks,\r\n                                        pitch: note.pitch,\r\n                                        duration: 0, // or default duration\r\n                                        velocity: note.velocity\r\n                                    });\r\n                                }\r\n\r\n                                for (const note of sustainBuffer) {\r\n                                    pairedNotes.push({\r\n                                        startTicks: note.startTicks,\r\n                                        pitch: note.pitch,\r\n                                        duration: note.originalEndTicks - note.startTicks, // fallback if pedal never released\r\n                                        velocity: note.velocity\r\n                                    });\r\n                                }\r\n\r\n                                if (pairedNotes.length !== 0) {\r\n\r\n                                    const newTrack = addTrack(instruments.value[10], null, trackName);\r\n\r\n                                    for (const note of pairedNotes) {\r\n\r\n                                        const notePitch = note.pitch - 12;\r\n                                        const noteOctave = Math.floor(notePitch / 12);\r\n                                        const noteName = noteNames[notePitch % 12];\r\n                                        const noteLength = Math.max(60, Math.round(note.duration / ticksPerBeat * 960)); // in beats\r\n                                        const noteWidth = Math.max(3, Math.round(note.duration / ticksPerBeat * 64 / 4) * 4 - 1);\r\n                                        const noteLeft = Math.round(note.startTicks / ticksPerBeat * 64 / 4) * 4; // t * b/t * 64px/b = px (1/4 note at 120 bpm (default) is 64 px wide)\r\n                                        const noteVolume = Math.floor(note.velocity / 8);\r\n\r\n                                        const newNote = {\r\n                                            left: noteLeft, // In pixels\r\n                                            top: 2568 - notePitch * gridHeight, // In pixels, the top of the note\r\n                                            width: noteWidth, // In pixels (we assume 4/4 time, which is 16 pixels per beat)\r\n                                            highlighted: false,\r\n                                            color: newTrack.color,\r\n                                            id: notesInGrid.value.length + Date.now(),\r\n                                            name: noteName + noteOctave,\r\n                                            pitch: notePitch + 12,\r\n                                            length: noteLength, // In beats\r\n                                            start: Math.round(noteLeft / (256) * (960*4)), // In beats\r\n                                            end: Math.round(noteLeft / (256) * (960*4)) + noteLength, // In beats\r\n                                            volume: noteVolume,\r\n                                            track: newTrack\r\n                                        };\r\n\r\n                                        notesInGrid.value.push(newNote);\r\n                                        newNote.track.notes.unshift(newNote);\r\n                                    }\r\n                                }\r\n\r\n                            });\r\n\r\n                            tempo.value = Math.round(fileTempo);\r\n\r\n                            const tempoMarkersTemp = [];\r\n                            let previousTempo = fileTempo;\r\n\r\n                            let idx = 0;\r\n                            for (const tempo of parsedMIDI.tempoChanges) {\r\n                                idx++;\r\n                                if (Math.round(tempo.tempo) === previousTempo || tempo.ticks === 0 && idx === parsedMIDI.tempoChanges.length) {\r\n                                    continue;\r\n                                }\r\n                                let marker = {\r\n                                    left: Math.round(tempo.ticks / ticksPerBeat * 16) * 4,\r\n                                    tempo: Math.round(tempo.tempo),\r\n                                    color: tracks.value[firstAddedTrackIndex].color,\r\n                                    parentTrack: tracks.value[firstAddedTrackIndex],\r\n                                    muted: false\r\n                                };\r\n\r\n                                tempoMarkersTemp.push(marker);\r\n                                previousTempo = Math.round(tempo.tempo);\r\n                            }\r\n\r\n                            tempoMarkers.value = [...tempoMarkers.value, ...tempoMarkersTemp];\r\n                            hiddenFileInput.value = \"\";\r\n\r\n                        } catch (err) {\r\n                            console.error('Error parsing MIDI file:', err);\r\n                        }\r\n                    };\r\n\r\n                    reader.readAsArrayBuffer(file);\r\n                }\r\n            };\r\n\r\n            hiddenFileInput.addEventListener('change', handleFileSelect);\r\n        }\r\n\r\n        async function exportMidi() {\r\n            const b = await getMidiBlob(\"MySong\", 0);\r\n            const blob = new Blob([b.buffer], {type: \"audio/mid\"});\r\n            const url = URL.createObjectURL(blob);\r\n            const a = document.createElement(\"a\");\r\n            a.href = url;\r\n            a.download = \"MySong.mid\";\r\n            document.body.appendChild(a);\r\n            a.click();\r\n            document.body.removeChild(a);\r\n            URL.revokeObjectURL(url);\r\n        }\r\n\r\n\r\n        async function parseMMLFromClipboard() {\r\n            const textFromClipboard = await navigator.clipboard.readText();\r\n            parseMML(textFromClipboard);\r\n            showSuccessMessage(`Successfully imported tracks from clipboard!`, 1000);\r\n        }\r\n\r\n        function tryRemoveNote(event) {\r\n            if (event && event.buttons !== 2)\r\n                return;\r\n\r\n            const rect = gridCanvas.value.getBoundingClientRect();\r\n            const x = (event.clientX - rect.left + scrollX.value) / zoomScalar.value;\r\n            const y = event.clientY - rect.top + grid.value.scrollTop;\r\n\r\n            for (const note of notesInGrid.value) {\r\n                const left = note.left;\r\n                const right = left + note.width;\r\n                const top = note.top;\r\n                const bottom = note.top + gridHeight;\r\n                const intersects = left <= x && x <= right && y >= top && y <= bottom;\r\n                if (intersects) {\r\n                    removeNote(note, false, event);\r\n                }\r\n            }\r\n        }\r\n\r\n        const removeNote = (note, fromList, event = null) => {\r\n            if (event && event.buttons !== 2)\r\n                return;\r\n            selectedNotes.value = selectedNotes.value.filter(n => n.id !== note.id);\r\n            let oldSize = notesInGrid.value.length;\r\n            notesInGrid.value = notesInGrid.value.filter(n => n.id !== note.id);\r\n            let diff = oldSize - notesInGrid.value.length;\r\n            for (const track of tracks.value) {\r\n                track.notes = track.notes.filter(n => n.id !== note.id);\r\n            }\r\n            if (!fromList && isPlaying.value)\r\n                playSequence();\r\n        };\r\n\r\n        document.addEventListener('mousedown', (event) => {\r\n            isMouseDown.value = true;\r\n        });\r\n\r\n        document.addEventListener('mouseup', () => {\r\n            isMouseDown.value = false;\r\n        });\r\n\r\n        return {\r\n            notes,\r\n            octaves,\r\n            startNote,\r\n            endNote,\r\n            mouseOverNote,\r\n            mouseLeaveNote,\r\n            instruments,\r\n            selectedInstrument,\r\n            changeInstrument,\r\n            pianoRoll,\r\n            grid,\r\n            notesInGrid,\r\n            startDrag,\r\n            endDrag,\r\n            startPlacingNote,\r\n            startVolumeChange,\r\n            removeNote,\r\n            gridWidth,\r\n            gridHeight,\r\n            gridSpan,\r\n            startResize,\r\n            endResize,\r\n            onResize,\r\n            currentNoteLength,\r\n            playSequence,\r\n            tempo,\r\n            handleGridClick,\r\n            handleGridScroll,\r\n            isSelecting,\r\n            rectangleStyle,\r\n            handleRulerClick,\r\n            markerPosition,\r\n            markerReplayPosition,\r\n            ruler,\r\n            loopSong,\r\n            trackify,\r\n            tracks,\r\n            backgroundStyle,\r\n            genTokensOutright,\r\n            renderTokens,\r\n            showSuccessNotification,\r\n            successNotificationText,\r\n            showFailedNotification,\r\n            failedNotificationText,\r\n            handleTrackSelected,\r\n            handleAddTrack,\r\n            handleRemoveTrack,\r\n            handleMuteTrack,\r\n            instrKeyMin,\r\n            instrKeyMax,\r\n            hexToRgba,\r\n            currentNoteVolume,\r\n            clickTempoMarker,\r\n            tempoMarkers,\r\n            updateColor,\r\n            zoomScalar,\r\n            autoScrollSong,\r\n            parseMMLFromClipboard,\r\n            gridCanvas,\r\n            windowWidth,\r\n            scrollX,\r\n            gridWrapper,\r\n            tryRemoveNote,\r\n            importMidi,\r\n            exportMidi,\r\n            copyToClipboard\r\n        };\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.piano-container {\r\n    position: fixed;\r\n    /* Fix to the left side of the screen */\r\n    top: 0;\r\n    left: 0;\r\n    height: 100%;\r\n    /* Full height */\r\n    width: 100%;\r\n    /* Width of the piano roll */\r\n    background-color: #ddd;\r\n}\r\n\r\n.copyNotification {\r\n    position: fixed;\r\n    top: 20px;\r\n    right: 20px;\r\n    background-color: #4caf50;\r\n    color: white;\r\n    padding: 10px 20px;\r\n    border-radius: 5px;\r\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);\r\n    z-index: 1000;\r\n}\r\n\r\n.instrument-selector {\r\n    padding: 10px;\r\n    background-color: #f0f0f0;\r\n    border-bottom: 1px solid #ccc;\r\n}\r\n\r\n.piano-roll {\r\n    height: 94vh;\r\n    flex-wrap: wrap;\r\n    display: flex;\r\n    overflow-y: auto;\r\n    box-sizing: border-box;\r\n    padding-bottom: 36px;\r\n}\r\n\r\n.piano-keys {\r\n    padding-top: 30px;\r\n    background-color: #ccc;\r\n    width: 10%;\r\n    display: flex;\r\n    flex-direction: column-reverse;\r\n    padding-bottom: 18px;\r\n    /* Higher notes at the top */\r\n    z-index: 12;\r\n}\r\n\r\n.octave {\r\n    flex-direction: column;\r\n    position: relative;\r\n}\r\n\r\n.keys-wrapper {\r\n    flex-direction: column-reverse;\r\n    /* Ensure keys are in the correct order */\r\n}\r\n\r\n.piano-key {\r\n    box-sizing: border-box;\r\n    border: 1px solid #ccc;\r\n    cursor: pointer;\r\n    position: relative;\r\n    user-select: none;\r\n}\r\n\r\n.white-key {\r\n    width: 100%;\r\n    height: 24px;\r\n    align-content: center;\r\n    /* Adjust based on desired key height */\r\n    background: white;\r\n    border-bottom: 1px solid #ccc;\r\n    text-align: right;\r\n    padding-right: 10px;\r\n    user-select: none;\r\n    font-size: 80%;\r\n}\r\n\r\n.black-key {\r\n    background: black;\r\n    color: #fff;\r\n    width: 100%;\r\n    height: 24px;\r\n    align-content: center;\r\n    /* Adjust based on desired key height */\r\n    position: relative;\r\n    /* Center black key over white key */\r\n    text-align: right;\r\n    padding-right: 10px;\r\n    user-select: none;\r\n    font-size: 80%;\r\n}\r\n\r\n.white-key:nth-child(2n+1) {\r\n    background: #fff;\r\n}\r\n\r\n.white-key:nth-child(12n) {\r\n    background: #bbb;\r\n}\r\n\r\n.grid-wrapper {\r\n    overflow-x: scroll;\r\n    overflow-y: hidden;\r\n    flex-grow: 1;\r\n    position: relative;\r\n}\r\n\r\n.ruler {\r\n    position: absolute;\r\n    left: 0;\r\n    margin-left: calc(10% - 2px);\r\n    background-color: #eee;\r\n    height: 29px;\r\n    border-bottom: 1px solid #ccc;\r\n    display: flex;\r\n    align-items: end;\r\n    font-size: 12px;\r\n    color: #333;\r\n    z-index: 11;\r\n    user-select: none;\r\n    cursor: pointer;\r\n}\r\n\r\n.ruler-tick-label {\r\n    position: absolute;\r\n    bottom: 0;\r\n    white-space: nowrap;\r\n    transform: translateX(5px);\r\n    font-size: 14px;\r\n    color: #333;\r\n}\r\n\r\n.marker-replay-triangle {\r\n    position: absolute;\r\n    width: 0;\r\n    height: 0;\r\n    border-left: 10px solid transparent;\r\n    border-right: 10px solid transparent;\r\n    border-top: 10px solid #bbb;\r\n    /* Triangle color */\r\n    left: 50%;\r\n    bottom: 0;\r\n    /* Inside the ruler */\r\n    transform: translateX(-50%);\r\n}\r\n\r\n.marker-wrapper {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    transform: translateX(-50%);\r\n    pointer-events: none;\r\n}\r\n\r\n.marker-triangle {\r\n    position: absolute;\r\n    width: 0;\r\n    height: 0;\r\n    border-left: 10px solid transparent;\r\n    border-right: 10px solid transparent;\r\n    border-top: 10px solid #f00;\r\n    /* Triangle color */\r\n    left: 50%;\r\n    bottom: 0;\r\n    /* Inside the ruler */\r\n    transform: translateX(-50%);\r\n    z-index: 100;\r\n}\r\n\r\n.marker-line {\r\n    position: absolute;\r\n    width: 2px;\r\n    height: 100vh;\r\n    background-color: #f00;\r\n    left: 50%;\r\n    bottom: - 100%;\r\n    /* Below the ruler */\r\n    transform: translateX(-50%);\r\n    z-index: 100;\r\n}\r\n\r\n.grid {\r\n    position: absolute;\r\n    overflow: hidden;\r\n    display: flex;\r\n    /* padding-top: 17px;\r\n    margin-top: 30px;\r\n    left: -1px;\r\n    position: absolute;\r\n    display: flex;\r\n    min-width: 100%;\r\n    align-self: top;\r\n    height: 100%;/*2592px;\r\n    background: repeating-linear-gradient( /*This is the horizontal lines\r\n        0deg,\r\n        #bbb,\r\n        #bbb 2px,\r\n        transparent 2px,\r\n        transparent 24px\r\n    ),\r\n    repeating-linear-gradient( /*This is the Bar line\r\n        90deg,\r\n        #777,\r\n        #777 2px,\r\n        transparent 2px,\r\n        transparent 256px\r\n    ),\r\n    repeating-linear-gradient( /*This is the vertical lines\r\n        90deg,\r\n        #c0c0c0,\r\n        #c0c0c0 2px,\r\n        transparent 2px,\r\n        transparent 16px\r\n    ),\r\n    repeating-linear-gradient(/*This is the background colors\r\n        90deg,\r\n        #e0e0e0,\r\n        #e0e0e0 64px,\r\n        #ccc 64px,\r\n        #ccc 128px\r\n    );\r\n    z-index: 10;\r\n    overflow: hidden; */\r\n}\r\n\r\n.note {\r\n    position: absolute;\r\n    background-color: rgba(0, 120, 255, 0.5);\r\n    border: 1px solid #0078d4;\r\n    cursor: pointer;\r\n    box-sizing: border-box;\r\n    user-select: none;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 20;\r\n    font-size: 70%;\r\n    margin-left: 1px;\r\n    overflow: hidden;\r\n}\r\n\r\n.note:active {\r\n    background-color: rgba(0, 120, 255, 0.7);\r\n}\r\n\r\n.resize-handle {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 0;\r\n    width: 40%;\r\n    /* Adjust as needed */\r\n    max-width: 10px;\r\n    height: 100%;\r\n    cursor: ew-resize;\r\n    background-color: rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.volume-handle {\r\n    width: 12px;\r\n    height: 60%;\r\n    /* Half the width to create the half-circle */\r\n    background-color: rgba(0, 0, 0, 0.2);\r\n    position: absolute;\r\n    bottom: -35%;\r\n    /* Align to the bottom of the note */\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    border-radius: 50%;\r\n    /* Create a circle */\r\n    clip-path: inset(0 0 50% 0);\r\n    /* Clip top half, making it a half-circle */\r\n    cursor: ns-resize;\r\n    /* Show a pointer to indicate draggable */\r\n}\r\n\r\n.play-button {\r\n    position: fixed;\r\n    top: 10px;\r\n    right: 10px;\r\n    padding: 10px 20px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    border: none;\r\n    border-radius: 5px;\r\n    background-color: #0078d4;\r\n    color: white;\r\n    z-index: 1000;\r\n    /* Ensure it's on top of other elements */\r\n    outline: none;\r\n    box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.loop-wrapper {\r\n    position: fixed;\r\n    top: 10px;\r\n    right: 160px;\r\n    padding: 10px 20px;\r\n    height: 18px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    user-select: none;\r\n    background-color: #0078d4;\r\n    color: white;\r\n    border-radius: 5px;\r\n    box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n    z-index: 1000;\r\n    width: 65px;\r\n}\r\n\r\n.scroll-wrapper {\r\n    position: fixed;\r\n    width: 108px;\r\n    top: 50px;\r\n    right: 10px;\r\n    padding: 10px 20px;\r\n    height: 18px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    border: none;\r\n    border-radius: 5px;\r\n    background-color: #0078d4;\r\n    color: white;\r\n    z-index: 1000;\r\n    /* Ensure it's on top of other elements */\r\n    outline: none;\r\n    box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.controls {\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n\r\n.instrument-selector,\r\n.tempo-selector {\r\n    margin-right: 15px;\r\n}\r\n\r\n.selection-rect {\r\n    position: absolute;\r\n    border: 1px solid rgba(0, 100, 255, 0.5);\r\n    background-color: rgba(0, 100, 255, 0.3);\r\n    z-index: 30;\r\n}\r\n\r\n.gridCanvas {\r\n    margin-top: 30px;\r\n    display: block;\r\n    z-index: 10;\r\n    left: 0px;\r\n}\r\n</style>","<template>\r\n  <div>\r\n    <!-- Help Button -->\r\n    <button class=\"help-button\" @click=\"showHelp\">\r\n      <span v-if=\"hoverHelp\">Help</span>\r\n      <span v-else> ? </span>\r\n    </button>\r\n\r\n    <!-- Help Modal -->\r\n    <div v-if=\"isHelpVisible\" class=\"modal-background\" @click=\"closeHelp\">\r\n      <transition name=\"fade\">\r\n        <div class=\"help-modal\">\r\n          <button class=\"close-button\" @click=\"closeHelp\">X</button>\r\n          <div class=\"help-content\" @click.stop>\r\n            <h1>Help</h1>\r\n            <p class=\"credits\">MOS v1.2</p>\r\n\r\n            <h3>Navigating the Grid</h3>\r\n            <ul>\r\n              <li>Scroll within the grid using the scroll bars, or directly with your mouse wheel.</li>\r\n              <li>Scrolling your mouse wheel normally will move the grid vertically.</li>\r\n              <li>Holding <strong>Shift</strong> while scrolling will move the grid horizontally.</li>\r\n              <li>Holding <strong>Ctrl</strong> and scrolling will zoom the grid in and out.</li>\r\n              <li>If the grid is focused (after clicking inside it), you can use the arrow keys to navigate around the\r\n                grid.</li>\r\n            </ul>\r\n\r\n            <h3>Placing Notes</h3>\r\n            <ul>\r\n              <li>To place notes, click anywhere on the grid.</li>\r\n              <li>The size of the note will be the same size as the note that was last placed/moved.</li>\r\n              <li>Placed notes are instantly draggable.</li>\r\n              <li>The color of the placed notes will depend on the color of the track they belong to.</li>\r\n              <li>By changing the \"Grid Spacing\" dropdown, you can control whether the grid is in 16ths or 12ths.</li>\r\n              <li>Each instrument has a different range of notes that it can play. The red keys on the piano to the left\r\n                indicate notes that will not make a sound with the current instrument.</li>\r\n            </ul>\r\n\r\n            <h3>Dragging Notes</h3>\r\n            <ul>\r\n              <li>To drag a note, click on the left side of the note. Then, move your mouse around within the bounds of\r\n                the grid.</li>\r\n              <li>Holding <strong>Alt</strong> will move notes freely (not locked to the grid).</li>\r\n              <li>If multiple notes are selected, all selected notes will be moved together (even if they are from\r\n                different tracks).</li>\r\n            </ul>\r\n\r\n            <h3>Resizing Notes</h3>\r\n            <ul>\r\n              <li>To resize a note, click on the right side of the note, then drag left or right.</li>\r\n              <li>Notes have a minimum length of 1/64th of a beat.</li>\r\n              <li>Holding <strong>Alt</strong> will resize notes freely (not locked to the grid)</li>\r\n              <li>If multiple notes are selected, all selected notes will be resized together.</li>\r\n            </ul>\r\n\r\n            <h3>Note Volume</h3>\r\n            <ul>\r\n              <li>The current note volume can be seen at the top of the screen.</li>\r\n              <li>A note's volume is indicated by the opacity of the note, as well as the number next to the note's\r\n                name.</li>\r\n              <li>To change a note's volume, left click and hold on the half-circle at the bottom center of the note.\r\n                Then, drag your mouse up and down. Dragging up will increase the note's volume, and dragging down will\r\n                decrease it.</li>\r\n              <li>Notes start with a default volume of 8.</li>\r\n              <li>Notes have a volume range from 1 to 15.</li>\r\n              <li>Changing a note's volume while multiple notes are selected will change the volume of all selected\r\n                notes by the same amount.</li>\r\n            </ul>\r\n\r\n            <h3>Selecting Multiple Notes</h3>\r\n            <ul>\r\n              <li>To select multiple notes at once, hold <strong>Ctrl</strong> on the grid and drag your mouse.</li>\r\n              <li>If you hold <strong>Ctrl+Shift</strong> and drag, you will \"add on\" to your note selection.\r\n                <i>(Previously selected notes will not be unselected, and you can select additional notes.)</i>\r\n              </li>\r\n              <li>If you hold <strong>Shift</strong> and drag a note, you will clone it (if that note is highlighted, it\r\n                will clone all highlighted notes).</li>\r\n              <li>Pressing <strong>Ctrl+A</strong> will select all notes in the grid.</li>\r\n              <li>Pressing the <strong>Backspace</strong> or <strong>Delete</strong> keys will delete all selected\r\n                notes.</li>\r\n              <li>Holding <strong>Ctrl</strong> and pressing the left or right arrows will move the selected notes a\r\n                whole grid space (i.e. 1/16th or 1/12th).</li>\r\n              <li>Holding <strong>Ctrl</strong> and pressing the up or down arrows will move the selected notes an\r\n                octave (if possible).</li>\r\n              <li>Holding <strong>Shift</strong> and pressing the left or right arrows will move the selected notes a\r\n                fourth of a grid space (i.e. 1/64th or 1/48th).</li>\r\n              <li>Holding <strong>Shift</strong> and pressing the up or down arrows will move the selected notes up or\r\n                down a single note (if possible).</li>\r\n              <li>Pressing <strong>T</strong> with notes selected will move them into the currently selected track.</li>\r\n            </ul>\r\n\r\n            <h3>Tracks</h3>\r\n            <ul>\r\n              <li>Each track has its own name, instrument, color, and visibility/mute toggle.</li>\r\n              <li>To add a track, click on the blue plus button to the right of the tracks.</li>\r\n              <li>To rename a track, double click on the track's name. When done with renaming, press\r\n                <strong>Enter</strong>.\r\n              </li>\r\n              <li>To mute/unmute a track, click on the volume icon next to the track's name.</li>\r\n              <li>To focus on a track, right click on the volume icon. This will mute all other tracks.</li>\r\n              <li>To unfocus, right click on the volume icon again. This will unmute all other tracks.</li>\r\n              <li>Clicking on a note from another track will cause you to switch to that note's track.</li>\r\n              <li>You can remove a track by clicking on the <strong>X</strong>. This will also remove the notes\r\n                belonging to that track.</li>\r\n              <li>To change the color of a track and its notes, click on the outlined box at the bottom-center of the\r\n                selected track's tab.</li>\r\n              <li>You can have a minimum of 1 track, and a maximum of 15 tracks.</li>\r\n              <li>The number of tracks you can have at once is dependant on screen width. This is so that smaller\r\n                screens can still access all of their created tabs easily.</li>\r\n              <li>Hovering over a track tab will show you the name of the track.</li>\r\n              <li>With notes selected, pressing <strong>Ctrl+C</strong> or <strong>Ctrl+X</strong> will copy/cut notes.\r\n              </li>\r\n              <li>After copying/cutting notes, you can paste them back in with <strong>Ctrl+V</strong>. This will paste\r\n                all previously copied notes into the current track.</li>\r\n            </ul>\r\n\r\n            <h3>Track Splitting</h3>\r\n            <ul>\r\n              <li>With a track selected, click the \"Split Track\" button. This will separate the track into multiple\r\n                other tracks (unless that number would exceed 16).</li>\r\n              <li>A track is split from left to right, then top to bottom. This can sometimes lead to weird splits.</li>\r\n              <li>The purpose of this feature is so that you can compose parts of your piece in a single track, then\r\n                split them up if you need to.</li>\r\n            </ul>\r\n\r\n            <h3>Exporting to MML</h3>\r\n            <ul>\r\n              <li>Clicking on the \"Export\" button will open a menu allowing the export of MML to your clipboard (it may\r\n                take a moment to open).</li>\r\n              <li>A maximum of four tracks can be exported at once, or three tracks if the 'Exclude Song Part' box is\r\n                checked.</li>\r\n              <li>Remember that the fourth track in a score is always the 'song' track.</li>\r\n              <li>Tracks that have multiple notes playing at once will NOT be exportable (marked with an asterisk), so be sure to split them\r\n                before export.</li>\r\n              <li>The exported MML will be moderately optimized for length; they will not be perfectly optimized.</li>\r\n              <li>Exported tracks are sorted by length by default, but this can be changed by unchecking the box.</li>\r\n              <li>When tracks are not sorted by length, they are sorted by the order in which they were selected.</li>\r\n              <li>In the future, tracks will be able to be split into separate Jabchiel-compatible scores based on the\r\n                rank you select. <strong>*Jabchiel export is currently non-functional*</strong>, but you can play with it\r\n                to see what is intended. \r\n              </li>\r\n            </ul>\r\n\r\n            <h3>Importing MML</h3>\r\n            <ul>\r\n              <li>Clicking on the \"Import MML From Clipboard\" button will attempt to copy whatever is in your clipboard\r\n                into new sequencer tracks.</li>\r\n              <li>Available import types are MMLs that start with `MML@` and end with a semicolon (;), or MMLs taken\r\n                straight from Mabinogi score scrolls.</li>\r\n              <li>Imported MMLs should not have any extraneous spaces, characters, or new line characters. Otherwise,\r\n                they will not import properly.</li>\r\n              <li>Importing from Mabinogi directly will named the tracks according to which track they came from (e.g.\r\n                Melody, Harmony 1, Harmony 2, Song)</li>\r\n            </ul>\r\n\r\n            <h3>Exporting MIDI</h3>\r\n            <ul>\r\n              <li>Clicking on the \"Export MIDI\" button will download \"MySong.mid\" directly.</li>\r\n              <li>Only audible tracks will be exported.</li>\r\n            </ul>\r\n\r\n            <h3>Importing MIDI</h3>\r\n            <ul>\r\n              <li>Clicking on the \"Import MIDI\" button will open your computer's file browser.</li>\r\n              <li>From there, you can select a standard MIDI file and it will be imported. Most MIDI files should work.\r\n              </li>\r\n              <li>Each MIDI track will be given its own track, regardless of polyphony.</li>\r\n              <li>Imported songs will automatically be quantized to the nearest 64th note boundary.</li>\r\n            </ul>\r\n\r\n            <h3>Tempo</h3>\r\n            <ul>\r\n              <li>You can change the tempo by entering a number at the top left of the page. Note that this will only\r\n                change the starting tempo of the song.</li>\r\n              <li>If you hold <strong>Shift</strong> and left click on the ruler on top of the grid, you will be\r\n                prompted to enter a tempo (BPM).</li>\r\n              <li>Tempo markers will automatically be assigned to the currently selected track. This is visible through\r\n                the color of the marker. Deleting the selected track will delete all associated tempo markers.</li>\r\n              <li>Holding <strong>Alt</strong> while placing a marker will allow for more freedom in placement.</li>\r\n              <li>Clicking on an existing tempo marker will allow you to modify it. By entering an empty string, you\r\n                will delete the marker.</li>\r\n              <li>Muting a track will also hide the tempo markers associated with that track.</li>\r\n              <li>Right-clicking a tempo marker will move the tempo marker to the currently selected track.</li>\r\n            </ul>\r\n\r\n            <h3>Misc</h3>\r\n            <ul>\r\n              <li>Click and hold on the piano keys to play them. <br><em>(Note: some instruments can only play certain\r\n                  keys)</em></li>\r\n              <li>Press <strong>Space</strong> to play your song. It will start from the marker.</li>\r\n              <li>Press <strong>Space</strong> again to pause your song. If you press <strong>Ctrl+Space</strong>, it\r\n                will stop the marker where it was.</li>\r\n              <li>Check the <strong>Loop</strong> checkbox to loop your song.</li>\r\n              <li>Click and drag on the timeline to move the marker.</li>\r\n              <li>If you hold <strong>ALT</strong> while dragging, the marker will move freely.</li>\r\n              <li>You can change instruments using the spinner at the top left of the page.</li>\r\n            </ul>\r\n\r\n            <h3>Planned Features</h3>\r\n            <ul>\r\n              <li>Jabchiel MML export.</li>\r\n              <li>Undo/Redo functionality.</li>\r\n              <li>Other algorithm options for track splitting.</li>\r\n              <li>Support for saving/loading \"projects\".</li>\r\n              <li>Better exported MML optimization.</li>\r\n              <li>Improved note rendering speed.</li>\r\n            </ul>\r\n\r\n            <p class=\"credits\">Credits: Made by Daderic</p>\r\n\r\n          </div>\r\n        </div>\r\n      </transition>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      hoverHelp: false,\r\n      isHelpVisible: true, // Initially visible when the page loads\r\n    };\r\n  },\r\n  methods: {\r\n    showHelp() {\r\n      this.isHelpVisible = true;\r\n    },\r\n    closeHelp() {\r\n      this.isHelpVisible = false;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.help-button {\r\n  position: fixed;\r\n  top: 14px;\r\n  right: 280px;\r\n  width: 34px;\r\n  height: 34px;\r\n  cursor: pointer;\r\n  border-radius: 50%;\r\n  background-color: white;\r\n  border-width: 2px;\r\n  border-style: solid;\r\n  font-size: 24px;\r\n  border-color: black;\r\n  font-weight: lighter;\r\n  color: black;\r\n  z-index: 1000;\r\n  box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.help-button span {\r\n  display: block;\r\n}\r\n\r\n.modal-background {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.help-modal {\r\n  background-color: white;\r\n  padding: 20px;\r\n  width: 500px;\r\n  max-height: 80%;\r\n  overflow-y: auto;\r\n  border-radius: 8px;\r\n  position: relative;\r\n  justify-items: left;\r\n  justify-content: left;\r\n}\r\n\r\n.close-button {\r\n  position: sticky;\r\n  top: 10px;\r\n  right: 10px;\r\n  background-color: transparent;\r\n  border: none;\r\n  font-size: 20px;\r\n  cursor: pointer;\r\n  float: right;\r\n}\r\n\r\n.fade-enter-active,\r\n.fade-leave-active {\r\n  transition: opacity 0.5s;\r\n}\r\n\r\n.fade-enter,\r\n.fade-leave-to\r\n\r\n/* .fade-leave-active in <2.1.8 */\r\n  {\r\n  opacity: 0;\r\n}\r\n\r\n.help-content {\r\n  font-size: 14px;\r\n  line-height: 1.6;\r\n  text-align: left;\r\n}\r\n\r\n.help-content h1 {\r\n  text-align: center;\r\n}\r\n\r\n.credits {\r\n  margin-top: 20px;\r\n  font-style: italic;\r\n  text-align: center;\r\n}\r\n</style>\r\n","import { render } from \"./HelpMenu.vue?vue&type=template&id=370ae6b0&scoped=true\"\nimport script from \"./HelpMenu.vue?vue&type=script&lang=js\"\nexport * from \"./HelpMenu.vue?vue&type=script&lang=js\"\n\nimport \"./HelpMenu.vue?vue&type=style&index=0&id=370ae6b0&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-370ae6b0\"]])\n\nexport default __exports__","<template>\r\n  <div>\r\n    <div class=\"track-tab-container\" ref=\"tabContainerRef\">\r\n      <div v-for=\"(track, index) in tracks\" :key=\"track.id\"\r\n        :class=\"['track-tab', { selected: selectedTrackIndex === index }]\" @mousedown=\"selectTrack(index)\"\r\n        :style=\"{ backgroundColor: track.color }\" :title=\"track.name\">\r\n        <div class=\"tab-header\">\r\n          <input v-if=\"track.isEditingName\" v-model=\"track.name\" @blur=\"track.isEditingName = false\"\r\n            @keyup.enter=\"track.isEditingName = false\" class=\"track-name-input\" />\r\n          <span v-else @dblclick=\"track.isEditingName = true\" class=\"track-name\">\r\n            {{ track.name }}\r\n          </span>\r\n          <span class=\"mute-icon\" @mousedown=\"toggleMute($event, index)\" @contextmenu=\"$event.preventDefault()\">\r\n            {{ track.isMuted ? '🔇' : '🔊' }}\r\n          </span>\r\n          <button @click.stop=\"removeTrack(index)\" class=\"delete-btn\">✖</button>\r\n        </div>\r\n        <div v-if=\"selectedTrackIndex === index\" class=\"color-picker-container\">\r\n          <input type=\"color\" v-model=\"trackHexColor\" class=\"color-picker\" @input=\"updateTrackColor\" />\r\n        </div>\r\n      </div>\r\n\r\n      <button @click=\"addTrack\" class=\"add-track-btn\" :disabled=\"!canAddTrack\">\r\n        +\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed, onMounted, onBeforeUnmount, nextTick, reactive } from 'vue';\r\n\r\nexport const EventBus = reactive({});\r\n\r\nexport const tracks = ref([]);\r\nexport const selectedTrackIndex = ref(null);\r\nexport const selectedTrack = computed(() => tracks.value[selectedTrackIndex.value] || null);\r\nexport const trackHexColor = ref('#ffffff');\r\nexport default {\r\n  created() {\r\n    EventBus.addTrack = this.addTrack;\r\n  },\r\n  setup(props, { emit }) {\r\n    const containerWidth = ref(0);\r\n    const tabContainerRef = ref(null);\r\n\r\n    let focusedTrack = null;\r\n\r\n\r\n    const canAddTrack = computed(() => {\r\n      if (tracks.value.length > 14)\r\n        return false;\r\n      const minWidth = 75;\r\n      const totalWidth = tracks.value.length * minWidth;\r\n      return containerWidth.value - totalWidth - 50 > minWidth; // Limit to 16 tracks\r\n    });\r\n\r\n    const updateContainerWidth = () => {\r\n      if (tabContainerRef.value) {\r\n        containerWidth.value = tabContainerRef.value.clientWidth; // Get container width\r\n      }\r\n    };\r\n\r\n    const getRandomColor = () => {\r\n      const hue = Math.floor(Math.random() * 360);\r\n      const saturation = 75 + Math.random() * 25;\r\n      const lightness = 50 + Math.random() * 10;\r\n\r\n      const chroma = (1 - Math.abs(2 * lightness / 100 - 1)) * (saturation / 100);\r\n      const x = chroma * (1 - Math.abs(((hue / 60) % 2) - 1));\r\n      const m = lightness / 100 - chroma / 2;\r\n\r\n      let [r, g, b] =\r\n        hue < 60 ? [chroma, x, 0]\r\n          : hue < 120 ? [x, chroma, 0]\r\n            : hue < 180 ? [0, chroma, x]\r\n              : hue < 240 ? [0, x, chroma]\r\n                : hue < 300 ? [x, 0, chroma]\r\n                  : [chroma, 0, x];\r\n\r\n      r = Math.round((r + m) * 255);\r\n      g = Math.round((g + m) * 255);\r\n      b = Math.round((b + m) * 255);\r\n\r\n      // Return the color in hex format\r\n      return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\r\n    };\r\n\r\n    const root = process.env.NODE_ENV === 'production' ? '../MabiMML/' : '../';\r\n\r\n    const addTrack = (pointerEvent = null, instr = null, color = null, name = null) => {\r\n      const newTrack = {\r\n        id: tracks.value.length + Date.now(),\r\n        name: name || `Track ${tracks.value.length + 1}`,\r\n        isMuted: false,\r\n        color: color || getRandomColor(),\r\n        isEditingName: false,\r\n        notes: [],\r\n        instrument: instr || { name: 'Lute', program: 0, min: 16, max: 88 },\r\n      };\r\n      tracks.value.push(newTrack);\r\n      selectTrack(tracks.value.length - 1);\r\n      emit('add-track', newTrack, tracks.value.length - 1);\r\n      return newTrack;\r\n    };\r\n\r\n    const removeTrack = (index) => {\r\n      if (tracks.value.length === 1) return;\r\n\r\n      let confirmation = true;\r\n      if (tracks.value[index].notes.length !== 0)\r\n        confirmation = confirm(`Are you sure you want to delete the track \"${tracks.value[index].name}\"? All notes belonging to this track will also be deleted.`);\r\n      if (!confirmation) return;\r\n\r\n      let trackClone = tracks.value[index];\r\n      tracks.value.splice(index, 1);\r\n\r\n      if (tracks.value.length === 0) {\r\n        selectedTrackIndex.value = null;\r\n        trackHexColor.value = '#ffffff'; // Reset color picker when no tracks are left\r\n      } else {\r\n        if (index === selectedTrackIndex.value) {\r\n          // If the removed track was selected, select the next available track\r\n          const newIndex = index < tracks.value.length ? index : index - 1;\r\n          selectedTrackIndex.value = newIndex;\r\n          trackHexColor.value = tracks.value[newIndex].color; // Update the color picker to the new selected track's color\r\n        } else if (selectedTrackIndex.value > index) {\r\n          selectedTrackIndex.value--;\r\n        }\r\n\r\n        // Update color picker for the currently selected track\r\n        if (selectedTrack.value) {\r\n          trackHexColor.value = selectedTrack.value.color;\r\n        }\r\n      }\r\n\r\n      emit('remove-track', trackClone, selectedTrack.value);\r\n    };\r\n\r\n\r\n    const selectTrack = (index) => {\r\n      selectedTrackIndex.value = index;\r\n      trackHexColor.value = tracks.value[index].color; // Update color picker when track is selected\r\n      emit('track-selected', tracks.value[index]);\r\n    };\r\n\r\n    const toggleMute = (event, index) => {\r\n      event.preventDefault();\r\n      if (event.button === 0) {\r\n        tracks.value[index].isMuted = !tracks.value[index].isMuted;\r\n        if (tracks.value[index].isMuted)\r\n          for (const note of tracks.value[index].notes) {\r\n            note.muted = true;\r\n          }\r\n        else {\r\n          for (const note of tracks.value[index].notes) {\r\n            note.muted = false;\r\n          }\r\n        }\r\n        emit('mute-track', index);\r\n      } else if (event.button === 2) {\r\n        focusedTrack = tracks.value[index] === focusedTrack ? null : tracks.value[index];\r\n        const doMute = focusedTrack !== null\r\n        tracks.value[index].isMuted = false;\r\n        for (const note of tracks.value[index].notes) {\r\n          note.muted = false;\r\n        }\r\n        for (const [idx, track] of tracks.value.entries()) {\r\n          if (track === tracks.value[index])\r\n            continue;\r\n          track.isMuted = doMute;\r\n          for (const note of track.notes) {\r\n            note.muted = doMute;\r\n          }\r\n          emit('mute-track', idx);\r\n        }\r\n        emit('mute-track', index);\r\n      }\r\n    };\r\n\r\n    const updateTrackColor = (event) => {\r\n      const newColor = event.target.value;\r\n      if (selectedTrack.value) {\r\n        selectedTrack.value.color = newColor;\r\n        trackHexColor.value = newColor; // Update hex color for the picker\r\n        for (const note of selectedTrack.value.notes) {\r\n          note.color = newColor;\r\n        }\r\n      }\r\n      emit('color-change', selectedTrack.value, newColor);\r\n    };\r\n\r\n    onMounted(() => {\r\n      addTrack(); // Always start with one track\r\n      nextTick(() => {\r\n        updateContainerWidth(); // Get initial container width\r\n      });\r\n      window.addEventListener('resize', updateContainerWidth);\r\n    });\r\n\r\n    onBeforeUnmount(() => {\r\n      window.removeEventListener('resize', updateContainerWidth);\r\n    });\r\n\r\n    return {\r\n      tracks,\r\n      selectedTrackIndex,\r\n      trackHexColor,\r\n      containerWidth,\r\n      addTrack,\r\n      removeTrack,\r\n      selectTrack,\r\n      toggleMute,\r\n      updateTrackColor,\r\n      selectedTrack,\r\n      canAddTrack,\r\n      tabContainerRef,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.track-tab-container {\r\n  display: flex;\r\n  align-items: flex-end;\r\n  max-width: 83%;\r\n  background-color: #f1f1f1;\r\n  flex-wrap: nowrap;\r\n  height: 50px;\r\n}\r\n\r\n.track-tab {\r\n  user-select: none;\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-right: -10px;\r\n  flex-grow: 1;\r\n  min-width: 75px;\r\n  max-width: 200px;\r\n  height: 40px;\r\n  border: 2px solid #ccc;\r\n  border-radius: 8px 8px 0 0;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s ease;\r\n  position: relative;\r\n  z-index: 1;\r\n  align-self: flex-end;\r\n  overflow: hidden;\r\n}\r\n\r\n.track-tab.selected {\r\n  padding-bottom: 10px;\r\n  z-index: 10;\r\n  border-bottom: none;\r\n}\r\n\r\n.tab-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 5px 10px;\r\n  border-radius: 8px 8px 0 0;\r\n  font-weight: bold;\r\n  font-size: 1em;\r\n  color: white;\r\n}\r\n\r\n.track-name-input {\r\n  width: 100%;\r\n  font-size: 1em;\r\n  background-color: transparent;\r\n  border: none;\r\n  color: white;\r\n  outline: none;\r\n}\r\n\r\n.track-name {\r\n  color: white;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n.mute-icon {\r\n  font-size: 1.2em;\r\n  cursor: pointer;\r\n  margin-left: 10px;\r\n  color: white;\r\n}\r\n\r\n.delete-btn {\r\n  background: transparent;\r\n  border: none;\r\n  cursor: pointer;\r\n  color: white;\r\n  font-size: 1.1em;\r\n  font-weight: bold;\r\n}\r\n\r\n.add-track-btn {\r\n  user-select: none;\r\n  width: 50px;\r\n  height: 50px;\r\n  font-size: 2em;\r\n  background-color: #007bff;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 8px;\r\n  margin-left: 12px;\r\n  flex-shrink: 0;\r\n  cursor: pointer;\r\n  position: relative;\r\n  z-index: 5;\r\n  transition: background-color 0.3s ease;\r\n}\r\n\r\n.add-track-btn:disabled {\r\n  background-color: #ccc;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.color-picker-container {}\r\n\r\n.color-picker {\r\n  margin-left: 10px;\r\n}\r\n\r\n.track-tab:hover::after {\r\n  content: attr(title);\r\n  position: absolute;\r\n  bottom: 100%;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  background-color: rgba(0, 0, 0, 0.7);\r\n  color: white;\r\n  padding: 5px;\r\n  border-radius: 4px;\r\n  white-space: nowrap;\r\n  z-index: 10;\r\n  margin-bottom: 5px;\r\n  opacity: 0;\r\n  transition: opacity 0.2s ease;\r\n}\r\n\r\n.track-tab:hover::after {\r\n  opacity: 1;\r\n}\r\n</style>","import { render } from \"./Tracks.vue?vue&type=template&id=78489fbc&scoped=true\"\nimport script from \"./Tracks.vue?vue&type=script&lang=js\"\nexport * from \"./Tracks.vue?vue&type=script&lang=js\"\n\nimport \"./Tracks.vue?vue&type=style&index=0&id=78489fbc&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-78489fbc\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"tempo-marker\" :style=\"{ left: left + 'px', visibility: visible }\" @mousedown=\"clickMarker\" @contextmenu.prevent=\"$event.preventDefault()\">\r\n        <div class=\"tempo-triangle\" :style=\"{ borderTop: '10px solid ' + color, visibility: visible }\"></div>\r\n        <div class=\"tempo-label\" :style=\"{ visibility: visible }\">T{{ tempo }}</div>\r\n    </div>\r\n</template>\r\n\r\n\r\n<script>\r\nexport default {\r\n    props: {\r\n        left: Number,\r\n        tempo: Number,\r\n        index: Number, // For identifying which marker to remove\r\n        color: String,\r\n        visible: String\r\n    },\r\n    emits: ['click'],\r\n    setup(props, { emit }) {\r\n        const clickMarker = (event) => {\r\n            emit('click', event, props.index);\r\n        };\r\n\r\n        return {\r\n            clickMarker,\r\n        };\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.tempo-marker {\r\n    z-index: 1;\r\n    position: absolute;\r\n    bottom: 0;\r\n    transform: translateX(-50%);\r\n    cursor: pointer;\r\n    pointer-events: auto;\r\n    /* Allows clicking */\r\n}\r\n\r\n.tempo-triangle {\r\n    z-index: 1;\r\n    position: absolute;\r\n    width: 0;\r\n    height: 0;\r\n    border-left: 6px solid transparent;\r\n    border-right: 6px solid transparent;\r\n    border-top: 10px solid #333;\r\n    /* Dark grey color */\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n}\r\n\r\n.tempo-label {\r\n    z-index: 13;\r\n    position: absolute;\r\n    top: -20px;\r\n    /* Adjusts the label position above the triangle */\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    font-size: 12px;\r\n    background-color: #fff;\r\n    color: #333;\r\n    /* Dark grey text */\r\n    padding: 2px 4px;\r\n    border-radius: 3px;\r\n    white-space: nowrap;\r\n    border: 1px solid #ccc;\r\n    /* Optional border to highlight the label */\r\n}\r\n</style>","import { render } from \"./TempoMarker.vue?vue&type=template&id=3f9a78ee&scoped=true\"\nimport script from \"./TempoMarker.vue?vue&type=script&lang=js\"\nexport * from \"./TempoMarker.vue?vue&type=script&lang=js\"\n\nimport \"./TempoMarker.vue?vue&type=style&index=0&id=3f9a78ee&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-3f9a78ee\"]])\n\nexport default __exports__","<template>\r\n    <div>\r\n        <button class=\"export-button\" @click=\"showExport\">\r\n            Export\r\n        </button>\r\n        <div v-if=\"isExportVisible\" class=\"modal-background\" @click=\"hideExport\">\r\n            <transition name=\"fade\">\r\n                <div class=\"export-modal\" @click.stop>\r\n                    <button class=\"close-button\" @click=\"hideExport\">X</button>\r\n                    <div class=\"export-content\">\r\n                        <h1>Export</h1>\r\n                        <div class=\"flex-row\">\r\n                            <!-- Left Panel: Track List -->\r\n                            <div class=\"left-panel\">\r\n                                <div class=\"track-header\">Track</div>\r\n                                <div class=\"track-list\">\r\n                                    <label v-for=\"(track, index) in tracks\" :key=\"index\">\r\n                                        <input type=\"checkbox\" :checked=\"isSelected(track)\"\r\n                                            :disabled=\"(!isSelected(track) && selectedTracks.length >= maxSelectable) || trackHasPolyphony(track)\"\r\n                                            @change=\"toggleTrack(track)\" />\r\n                                        {{ track.name }} : {{ trackHasPolyphony(track) ? '-' : getRenderedTrackTokens(track, index).rendered.length + ' char(s)'}} {{ trackHasPolyphony(track) ? '*' : '' }}\r\n                                    </label>\r\n                                </div>\r\n                                <button class=\"clear-btn\" @click=\"clearSelection\">Clear Selection</button>\r\n                            </div>\r\n\r\n                            <!-- Right Panel: Info + Output -->\r\n                            <div class=\"right-panel\">\r\n\r\n                                <!-- Output Settings -->\r\n                                <div class=\"output-settings\">\r\n                                    <strong>Output Settings</strong>\r\n                                    <li><input type=\"radio\" name=\"format\" checked /> Mabinogi MML@ Format </li>\r\n                                    <!-- <li><input type=\"radio\" name=\"format\" /> Sitaraba MML Template </li>\r\n                                    <li><input type=\"radio\" name=\"format\" /> MabiMML Compatible Format </li> -->\r\n                                    <li><input type=\"checkbox\" v-model=\"sortTracksByLength\" checked /> Sort tracks by\r\n                                        text length. </li>\r\n                                    <li><input type=\"checkbox\" v-model=\"excludeSongPart\" /> Exclude Song Part </li>\r\n                                    <li><input type=\"checkbox\" v-model=\"jabSplit\" /> Split Score for Jabs (WIP) </li>\r\n                                    <li>\r\n                                        <select id=\"rank-select\" :disabled=\"!jabSplit\" v-model=\"selectedRank\"\r\n                                            @change=\"changeComposeRank\">\r\n                                            <option v-for=\"(rank, index) in composeRanks\" :key=\"index\" :value=\"rank\">\r\n                                                Rank: {{ rank.name }} {{ [rank.melody, rank.harmony1, rank.harmony2] }}\r\n                                            </option>\r\n                                        </select>\r\n                                    </li>\r\n                                </div>\r\n\r\n                                <!-- Information -->\r\n                                <div class=\"info-box\">\r\n                                    <strong>Information</strong>\r\n                                    <div v-for=\"(score, index) in generatedScores\" :key=\"index\" class=\"score-block\">\r\n                                        <p>\r\n                                            <strong>Score {{ index + 1 }}:</strong> Rank {{ score.rank }}\r\n                                            <button @click=\"copyScore(index)\">📋</button>\r\n                                        </p>\r\n                                        <ul>\r\n                                            <li v-for=\"(part, pIndex) in score.parts\" :key=\"pIndex\">\r\n                                                Part {{ pIndex + 1 }}: {{ part.length }} char(s)\r\n                                                <button @click=\"copyScorePiece(index, pIndex)\">📋</button>\r\n                                            </li>\r\n                                        </ul>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </transition>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { consoleColors } from 'spessasynth_lib';\r\n\r\nexport default {\r\n    props: {\r\n        tracks: Array,\r\n        generateTokens: Function,\r\n        renderTokens: Function,\r\n        copyToClipboard: Function\r\n    },\r\n    data() {\r\n        return {\r\n            isExportVisible: false,\r\n            selectedTracks: [],\r\n            excludeSongPart: false,\r\n            jabSplit: false,\r\n            sortTracksByLength: true,\r\n            composeRanks: [\r\n                { name: 'Impossible', melody: Infinity, harmony1: Infinity, harmony2: Infinity},\r\n                { name: '1', melody: 1200, harmony1: 800, harmony2: 500 },\r\n                { name: '2', melody: 1150, harmony1: 700, harmony2: 400 },\r\n                { name: '3', melody: 1100, harmony1: 600, harmony2: 350 },\r\n                { name: '4', melody: 1050, harmony1: 550, harmony2: 300 },\r\n                { name: '5', melody: 1000, harmony1: 500, harmony2: 250 },\r\n                { name: '6', melody: 950, harmony1: 450, harmony2: 200 },\r\n                { name: '7', melody: 900, harmony1: 400, harmony2: 200 },\r\n                { name: '8', melody: 850, harmony1: 400, harmony2: 200 },\r\n                { name: '9', melody: 800, harmony1: 350, harmony2: 200 },\r\n                { name: 'A', melody: 750, harmony1: 300, harmony2: 200 },\r\n                { name: 'B', melody: 700, harmony1: 300, harmony2: 200 },\r\n                { name: 'C', melody: 650, harmony1: 250, harmony2: 200 },\r\n                { name: 'D', melody: 600, harmony1: 250, harmony2: 150 },\r\n                { name: 'E', melody: 500, harmony1: 200, harmony2: 100 },\r\n                { name: 'F', melody: 400, harmony1: 200, harmony2: 100 },\r\n                { name: 'Practice', melody: 200, harmony1: 100, harmony2: 0 },\r\n            ],\r\n            selectedRank: { name: '1', melody: 1200, harmony1: 800, harmony2: 500 },\r\n            selectedRankIndex: 1,\r\n            generatedScores: [],\r\n            tokenCache: new Map()\r\n        };\r\n    },\r\n    computed: {\r\n        maxSelectable() {\r\n            return this.excludeSongPart ? 3 : 4;\r\n        }\r\n    },\r\n    watch: {\r\n        excludeSongPart(newVal) {\r\n            const limit = newVal ? 3 : 4;\r\n            if (this.selectedTracks.length > limit) {\r\n                this.selectedTracks.splice(limit);\r\n            }\r\n\r\n            if (newVal) {\r\n                this.composeRanks = [\r\n                    { name: 'Impossible', melody: Infinity, harmony1: Infinity, harmony2: Infinity},\r\n                    { name: '1*', melody: 1600, harmony1: 1200, harmony2: 900 },\r\n                    { name: '2*', melody: 1533, harmony1: 1083, harmony2: 783 },\r\n                    { name: '3*', melody: 1466, harmony1: 966, harmony2: 716 },\r\n                    { name: '4*', melody: 1400, harmony1: 900, harmony2: 650 },\r\n                    { name: '5*', melody: 1333, harmony1: 833, harmony2: 583 },\r\n                    { name: '6*', melody: 1266, harmony1: 766, harmony2: 516 },\r\n                    { name: '7*', melody: 1200, harmony1: 700, harmony2: 500 },\r\n                    { name: '8*', melody: 1133, harmony1: 683, harmony2: 483 },\r\n                    { name: '9*', melody: 1066, harmony1: 616, harmony2: 466 },\r\n                    { name: 'A*', melody: 1000, harmony1: 550, harmony2: 450 },\r\n                    { name: 'B*', melody: 933, harmony1: 533, harmony2: 433 },\r\n                    { name: 'C*', melody: 866, harmony1: 466, harmony2: 416 },\r\n                    { name: 'D*', melody: 800, harmony1: 450, harmony2: 350 },\r\n                    { name: 'E*', melody: 666, harmony1: 366, harmony2: 233 },\r\n                    { name: 'F*', melody: 553, harmony1: 333, harmony2: 233 },\r\n                    { name: 'Practice*', melody: 266, harmony1: 166, harmony2: 66 },\r\n                ];\r\n            } else {\r\n                this.composeRanks = [\r\n                    { name: 'Impossible', melody: Infinity, harmony1: Infinity, harmony2: Infinity},\r\n                    { name: '1', melody: 1200, harmony1: 800, harmony2: 500 },\r\n                    { name: '2', melody: 1150, harmony1: 700, harmony2: 400 },\r\n                    { name: '3', melody: 1100, harmony1: 600, harmony2: 350 },\r\n                    { name: '4', melody: 1050, harmony1: 550, harmony2: 300 },\r\n                    { name: '5', melody: 1000, harmony1: 500, harmony2: 250 },\r\n                    { name: '6', melody: 950, harmony1: 450, harmony2: 200 },\r\n                    { name: '7', melody: 900, harmony1: 400, harmony2: 200 },\r\n                    { name: '8', melody: 850, harmony1: 400, harmony2: 200 },\r\n                    { name: '9', melody: 800, harmony1: 350, harmony2: 200 },\r\n                    { name: 'A', melody: 750, harmony1: 300, harmony2: 200 },\r\n                    { name: 'B', melody: 700, harmony1: 300, harmony2: 200 },\r\n                    { name: 'C', melody: 650, harmony1: 250, harmony2: 200 },\r\n                    { name: 'D', melody: 600, harmony1: 250, harmony2: 150 },\r\n                    { name: 'E', melody: 500, harmony1: 200, harmony2: 100 },\r\n                    { name: 'F', melody: 400, harmony1: 200, harmony2: 100 },\r\n                    { name: 'Practice', melody: 200, harmony1: 100, harmony2: 0 },\r\n                ];\r\n            }\r\n            this.selectedRank = this.composeRanks[this.selectedRankIndex];\r\n            this.generateScores();\r\n\r\n        },\r\n        jabSplit() {\r\n            this.generateScores();\r\n        },\r\n        selectedRank() {\r\n            this.generateScores();\r\n        },\r\n        sortTracksByLength() {\r\n            this.generateScores();\r\n        },\r\n        tracks: {\r\n            handler() {\r\n                this.tokenCache.clear();\r\n                this.clearSelection();\r\n            },\r\n            deep: true\r\n        }\r\n    },\r\n    methods: {\r\n        isSelected(track) {\r\n            return this.selectedTracks.includes(track);\r\n        },\r\n        toggleTrack(track) {\r\n            const index = this.selectedTracks.indexOf(track);\r\n\r\n            if (index !== -1) {\r\n                this.selectedTracks.splice(index, 1);\r\n            } else {\r\n                if (this.selectedTracks.length < this.maxSelectable) {\r\n                    this.selectedTracks.push(track);\r\n                }\r\n            }\r\n\r\n            this.generateScores();\r\n\r\n        },\r\n        trackHasPolyphony(track) {\r\n            track.notes.sort((a,b) => {return b.start - a.start; });\r\n            for (let i = 0; i < track.notes.length; ++i) {\r\n                const rightNote = track.notes[i];\r\n                const leftNote = i + 1 < track.notes.length ? track.notes[i + 1] : null;\r\n                if (leftNote === null) return false;\r\n                // Scan from left to right. The next note should not have a left value <= note.end\r\n                if (rightNote.start < leftNote.end) {\r\n                    rightNote.highlighted = true;\r\n                    // rightNote.color = 'hsla(212, 100%, 50%, 0.5)';\r\n                    leftNote.highlighted = true;\r\n                    // leftNote.color = 'hsla(212, 100%, 50%, 0.5)';\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        clearSelection() {\r\n            this.selectedTracks = [];\r\n            this.generateScores();\r\n        },\r\n        changeComposeRank() {\r\n            this.selectedRankIndex = this.composeRanks.indexOf(this.selectedRank);\r\n        },\r\n        showExport() {\r\n            this.isExportVisible = true;\r\n        },\r\n        hideExport() {\r\n            this.isExportVisible = false;\r\n        },\r\n        getRenderedTrackTokens(track) {\r\n            if (this.tokenCache.has(track)) return this.tokenCache.get(track);\r\n            if (this.trackHasPolyphony(track)) return { tokens: [], rendered: '' };\r\n            const result = this.generateTokens(track)[0];\r\n            //const rendered = this.renderTokens(tokens);\r\n            //const result = { tokens, rendered };\r\n            this.tokenCache.set(track, result);\r\n            return result;\r\n        },\r\n        splitTokensByLimit(tokens, limit) {\r\n            const chunks = [];\r\n            let current = [];\r\n            let length = 0;\r\n\r\n            for (let i = 0; i < tokens.length; i++) {\r\n                const next = [...current, tokens[i]];\r\n                const rendered = this.renderTokens(next);\r\n                const renderedLength = rendered.length;\r\n\r\n                if (renderedLength > limit) {\r\n                    if (current.length) {\r\n                        chunks.push(current);\r\n                        current = [tokens[i]];\r\n                        length = this.renderTokens(current).length;\r\n                    } else {\r\n                        // Single token too big: force split anyway\r\n                        chunks.push([tokens[i]]);\r\n                        current = [];\r\n                        length = 0;\r\n                    }\r\n                } else {\r\n                    current.push(tokens[i]);\r\n                    length = renderedLength;\r\n                }\r\n            }\r\n\r\n            if (current.length) {\r\n                chunks.push(current);\r\n            }\r\n\r\n            return chunks;\r\n        },\r\n        generateScores() {\r\n            const selected = [...this.selectedTracks];\r\n\r\n            if (this.sortTracksByLength) {\r\n                selected.sort((a, b) => {\r\n                    const aIndex = this.tracks.indexOf(a);\r\n                    const bIndex = this.tracks.indexOf(b);\r\n                    return this.getRenderedTrackTokens(b, bIndex).rendered.length - this.getRenderedTrackTokens(a, aIndex).rendered.length;\r\n                });\r\n            }\r\n\r\n            const numParts = this.excludeSongPart ? 3 : 4;\r\n            const tokenized = selected.map(track => {\r\n                const index = this.tracks.indexOf(track);\r\n                return this.getRenderedTrackTokens(track, index).tokens;\r\n            });\r\n            const rendered = selected.map(track => {\r\n                const index = this.tracks.indexOf(track);\r\n                return this.getRenderedTrackTokens(track, index).rendered;\r\n            });\r\n\r\n            const availableRanks = [...this.composeRanks].reverse(); // lowest to highest\r\n            this.generatedScores = [];\r\n\r\n            if (!this.jabSplit) {\r\n                // Attempt to fit the entire track set into the lowest viable rank\r\n                for (const rank of availableRanks) {\r\n                    const limits = [rank.melody, rank.harmony1, rank.harmony2, rank.melody].slice(0, numParts);\r\n                    const fits = rendered.every((mml, i) => mml.length <= limits[i]);\r\n\r\n                    if (fits) {\r\n                        this.generatedScores.push({ parts: rendered.slice(0, numParts), rank: rank.name });\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                const rank = this.selectedRank;\r\n                const limits = [rank.melody, rank.harmony1, rank.harmony2, rank.melody].slice(0, numParts);\r\n                const allSplitTokens = tokenized.map((tokens, i) => {\r\n                    return this.splitTokensByLimit(tokens, limits[i]);\r\n                });\r\n\r\n                const maxChunks = Math.max(...allSplitTokens.map(chunks => chunks.length));\r\n\r\n                for (let chunkIndex = 0; chunkIndex < maxChunks; chunkIndex++) {\r\n                    const scoreParts = [];\r\n\r\n                    for (let i = 0; i < numParts; i++) {\r\n                        const chunk = allSplitTokens[i]?.[chunkIndex] || [];\r\n                        const renderedChunk = this.renderTokens(chunk);\r\n                        scoreParts.push(renderedChunk);\r\n                    }\r\n\r\n                    const allEmpty = scoreParts.every(str => str === '');\r\n                    if (allEmpty) break;\r\n\r\n                    this.generatedScores.push({ parts: scoreParts, rank: rank.name });\r\n                }\r\n\r\n            }\r\n        },\r\n        copyScore(index) {\r\n            const score = this.generatedScores[index];\r\n            const joined = `MML@${score.parts.join(',')};`;\r\n            this.copyToClipboard(joined);\r\n        },\r\n        copyScorePiece(scoreIndex, pieceIndex) {\r\n            const score = this.generatedScores[scoreIndex];\r\n            this.copyToClipboard(score.parts[pieceIndex]);\r\n        }\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.export-button {\r\n    position: fixed;\r\n    top: 50px;\r\n    right: 160px;\r\n    padding: 10px 20px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    border: none;\r\n    border-radius: 5px;\r\n    background-color: #0078d4;\r\n    color: white;\r\n    z-index: 1000;\r\n    outline: none;\r\n    box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);\r\n    width: 105px;\r\n}\r\n\r\n.export-modal {\r\n    background-color: white;\r\n    padding: 20px;\r\n    width: 500px;\r\n    max-height: 80%;\r\n    overflow-y: auto;\r\n    border-radius: 8px;\r\n    position: relative;\r\n    justify-items: left;\r\n    justify-content: left;\r\n}\r\n\r\n.modal-background {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 1000;\r\n}\r\n\r\n.close-button {\r\n    position: sticky;\r\n    top: 10px;\r\n    right: 10px;\r\n    background-color: transparent;\r\n    border: none;\r\n    font-size: 20px;\r\n    cursor: pointer;\r\n    float: right;\r\n}\r\n\r\n.export-content {\r\n    font-size: 14px;\r\n    line-height: 1.6;\r\n    text-align: left;\r\n    width: 100%;\r\n}\r\n\r\n.flex-row {\r\n    display: flex;\r\n    flex-direction: row;\r\n    gap: 20px;\r\n}\r\n\r\n.left-panel {\r\n    width: 200px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background-color: #fff;\r\n    padding: 10px;\r\n    border: 1px solid #ccc;\r\n}\r\n\r\n.track-header {\r\n    font-weight: bold;\r\n    margin-bottom: 5px;\r\n}\r\n\r\n.track-list {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 5px;\r\n    margin-bottom: auto;\r\n}\r\n\r\n.clear-btn {\r\n    margin-top: 10px;\r\n    align-self: flex-start;\r\n}\r\n\r\n.right-panel {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 15px;\r\n}\r\n\r\n.info-box,\r\n.output-settings {\r\n    background-color: #fff;\r\n    border: 1px solid #ccc;\r\n    padding: 10px;\r\n}\r\n\r\nli {\r\n    list-style: none;\r\n}\r\n</style>","import { render } from \"./ExportMenu.vue?vue&type=template&id=054bb656&scoped=true\"\nimport script from \"./ExportMenu.vue?vue&type=script&lang=js\"\nexport * from \"./ExportMenu.vue?vue&type=script&lang=js\"\n\nimport \"./ExportMenu.vue?vue&type=style&index=0&id=054bb656&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-054bb656\"]])\n\nexport default __exports__","import { render } from \"./PianoRoll.vue?vue&type=template&id=257857ec&scoped=true\"\nimport script from \"./PianoRoll.vue?vue&type=script&lang=js\"\nexport * from \"./PianoRoll.vue?vue&type=script&lang=js\"\n\nimport \"./PianoRoll.vue?vue&type=style&index=0&id=257857ec&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-257857ec\"]])\n\nexport default __exports__","import { render } from \"./Sequencer.vue?vue&type=template&id=2e49d91b&scoped=true\"\nimport script from \"./Sequencer.vue?vue&type=script&lang=js\"\nexport * from \"./Sequencer.vue?vue&type=script&lang=js\"\n\nimport \"./Sequencer.vue?vue&type=style&index=0&id=2e49d91b&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2e49d91b\"]])\n\nexport default __exports__","import { render } from \"./PatternEditor.vue?vue&type=template&id=f2d0b530&scoped=true\"\nimport script from \"./PatternEditor.vue?vue&type=script&lang=js\"\nexport * from \"./PatternEditor.vue?vue&type=script&lang=js\"\n\nimport \"./PatternEditor.vue?vue&type=style&index=0&id=f2d0b530&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-f2d0b530\"]])\n\nexport default __exports__","import { render } from \"./App.vue?vue&type=template&id=03d7e477\"\nimport script from \"./App.vue?vue&type=script&lang=js\"\nexport * from \"./App.vue?vue&type=script&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=03d7e477&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { createApp } from 'vue'\nimport App from './App.vue'\nimport HelpMenu from './components/HelpMenu.vue'\n\ncreateApp(App).mount('#app');\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","__webpack_require__.p = \"/MabiMML/\";","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t524: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkmusic_sequencer\"] = self[\"webpackChunkmusic_sequencer\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [504], function() { return __webpack_require__(58923); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["id","_createElementBlock","_hoisted_1","_createVNode","_component_PatternEditor","class","ref","_createElementVNode","_hoisted_2","_component_PianoRoll","key","style","for","type","accept","_hoisted_21","_hoisted_22","onClick","_cache","args","$setup","playSequence","_createTextVNode","$event","loopSong","_hoisted_3","autoScrollSong","_component_ExportMenu","tracks","generateTokens","genTokensOutright","renderTokens","copyToClipboard","_component_HelpMenu","showSuccessNotification","_hoisted_4","_toDisplayString","successNotificationText","_createCommentVNode","showFailedNotification","_hoisted_5","failedNotificationText","_component_Tracks","onTrackSelected","handleTrackSelected","onAddTrack","handleAddTrack","onRemoveTrack","handleRemoveTrack","onMuteTrack","handleMuteTrack","onColorChange","updateColor","_hoisted_6","_hoisted_7","_hoisted_8","selectedInstrument","onChange","changeInstrument","_Fragment","_renderList","instruments","instrument","index","value","name","_hoisted_9","_hoisted_10","_hoisted_11","tempo","min","max","number","trackify","parseMMLFromClipboard","importMidi","exportMidi","_hoisted_12","_hoisted_13","_hoisted_14","gridWidth","displayName","width","_hoisted_15","_hoisted_16","currentNoteVolume","_hoisted_17","_hoisted_18","octaves","octave","_hoisted_19","notes","slice","reverse","note","_normalizeClass","isBlack","onMousedown","startNote","onMouseover","mouseOverNote","onMouseup","endNote","onMouseleave","mouseLeaveNote","_normalizeStyle","instrKeyMin","instrKeyMax","_hoisted_20","handleRulerClick","gridSpan","zoomScalar","Math","ceil","left","markerReplayPosition","markerPosition","_hoisted_23","tempoMarkers","tempoMarker","_createBlock","_component_TempoMarker","color","visible","muted","clickTempoMarker","_withModifiers","_hoisted_24","height","scrollX","windowWidth","onMousemove","tryRemoveNote","handleGridClick","onContextmenu","_ctx","startNoteRemove","onWheel","handleGridScroll","_hoisted_25","isSelecting","rectangleStyle","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","$options","showHelp","$data","hoverHelp","isHelpVisible","closeHelp","_Transition","default","_withCtx","_hoisted_37","_","data","methods","this","__exports__","track","selected","selectedTrackIndex","selectTrack","backgroundColor","title","isEditingName","onBlur","onKeyup","_withKeys","onDblclick","toggleMute","preventDefault","isMuted","removeTrack","trackHexColor","onInput","updateTrackColor","addTrack","disabled","canAddTrack","EventBus","reactive","selectedTrack","computed","created","setup","props","emit","containerWidth","tabContainerRef","focusedTrack","length","minWidth","totalWidth","updateContainerWidth","clientWidth","getRandomColor","hue","floor","random","saturation","lightness","chroma","abs","x","m","r","g","b","round","toString","pointerEvent","instr","newTrack","Date","now","program","push","confirmation","confirm","trackClone","splice","newIndex","event","button","doMute","idx","entries","newColor","target","onMounted","nextTick","window","addEventListener","onBeforeUnmount","removeEventListener","$props","visibility","clickMarker","borderTop","Number","String","emits","checked","showExport","isExportVisible","hideExport","isSelected","selectedTracks","maxSelectable","trackHasPolyphony","toggleTrack","getRenderedTrackTokens","rendered","clearSelection","sortTracksByLength","excludeSongPart","jabSplit","selectedRank","changeComposeRank","composeRanks","rank","melody","harmony1","harmony2","generatedScores","score","copyScore","parts","part","pIndex","copyScorePiece","Array","Function","Infinity","selectedRankIndex","tokenCache","Map","watch","newVal","limit","generateScores","handler","clear","deep","includes","indexOf","sort","a","start","i","rightNote","leftNote","end","highlighted","has","get","tokens","result","set","splitTokensByLimit","chunks","current","next","renderedLength","aIndex","bIndex","numParts","tokenized","map","availableRanks","limits","allSplitTokens","maxChunks","chunkIndex","scoreParts","chunk","renderedChunk","allEmpty","every","str","fits","mml","joined","join","scoreIndex","pieceIndex","components","HelpMenu","Tracks","TempoMarker","ExportMenu","root","pianoRoll","grid","synth","context","isMouseDown","midiBuilder","gridCanvas","innerWidth","currentNoteLength","gridHeight","notesInGrid","draggingNotes","resizingNotes","volumeChangingNotes","startX","startY","gridWrapper","selectedNotes","currentX","currentY","ruler","seq","isPlaying","top","border","backgroundStyle","background","ctx","drawCanvasGrid","screenLeft","screenRight","zoom","gridwidth","clearRect","bgSpacing","fillStyle","fillRect","strokeStyle","lineWidth","horizontalSpacing","hCount","beginPath","y","moveTo","lineTo","stroke","verticalSpacing","vStart","vEnd","barSpacing","bStart","bEnd","visibleNotes","leftLimit","rightLimit","noteLeft","noteRight","noteWidth","h","hexToRgba","volume","strokeRect","semiCircleRadius","centerX","centerY","arc","PI","fill","barWidth","font","textAlign","textBaseline","fullText","truncatedText","truncateTextToWidth","fillText","text","maxWidth","ellipsis","measureText","truncated","noteNames","blackNotes","noteClipboard","watchEffect","maxRightPosition","document","querySelector","scrollLeft","async","oldTrack","idsToRemove","Set","n","filter","marker","parentTrack","trackIndex","loadSoundFont","response","fetch","soundFontArrayBuffer","arrayBuffer","error","console","handleBeforeUnload","message","returnValue","gridWrapperVar","updateRuler","handleKeyPress","AudioContext","audioWorklet","addModule","Synthetizer","destination","undefined","chorusEnabled","reverbEnabled","setMainVolume","setLogLevel","isReady","getContext","alpha","shiftKey","placeTempoMarker","startMarkerDrag","granularity","altKey","clientX","getBoundingClientRect","enteredTempo","prompt","isNaN","stopPlaying","updateMarkerPos","onMarkerDrag","onMarkerDragEnd","markerInterval","markerStartPos","startTempo","tempoIdx","startMarkerAnim","doMarkerAnim","timeChange","tick","currentTime","loop","clearInterval","setInterval","noteLengths","widthCache","getOptimalNoteLengths","outString","mmlWidth","val1","val2","charLength","best","getMinCharLengthWidth","values","noteCombination","targetWidth","amount","compressedNotes","lengths","Int32Array","charLens","j","INF","dp","Uint32Array","prev","last","noteValue","noteChars","candidate","minChars","stopMarkerAnim","fromClick","rulerRect","newPos","gridSnap","removeNote","code","ctrlKey","selectNote","showSuccessMessage","movementValue","noteName","pitch","baseId","trackColor","scroll","idOffset","newNotes","newLeft","newNote","unshift","selectedSet","forEach","stop","programChange","getMidiBlob","startPosition","tempMidiBuilder","MIDIBuilder","resume","notesAdded","audibleTracks","addNewTrack","channel","addEvent","containingTrack","noteStartTime","noteDuration","markerTime","startTime","duration","addNoteOn","addNoteOff","tempoStartTime","tempoChangeTime","addSetTempo","flush","writeMIDIFile","Sequencer","binary","skipToFirstNoteOn","addOnSongEndedEvent","play","noteOn","noteOff","timeout","setTimeout","showFailureMessage","fromTrack","startPositions","startDrag","placeNote","initialLength","draggingNote","clientY","onDrag","endDrag","outOfBounds","newPositions","offGridNote","noteSnapScale","noteDelta","startPos","dx","dy","newTop","startResizeData","startResize","onResize","endResize","allInBounds","newWidths","startData","newWidth","startingNoteVolumes","startVolumeChange","onVolumeChange","endVolumeChange","newVolume","startSelection","startPlacingNote","deltaY","sign","z1","l","z2","rect","onSelectionMove","onSelectionEnd","checkIntersections","selectionRect","right","bottom","itemRect","intersects","rect1","rect2","scrollTop","existingNote","find","resizeHandleWidth","volumeHandleCenter","squaredDistToCenter","radius","notesList","trackWrappers","trackWrapper","originalColor","hex","replace","split","char","parseInt","substring","navigator","clipboard","writeText","then","catch","err","optimDijkstra","GraphNode","constructor","textValue","implicitOct","implicitLen","implicitVol","parent","children","accCost","depth","addChild","child","stateKey","len","oct","vol","bestCost","startNode","worklist","Heap","priority","endNode","node","size","u","pop","d","token","tl","td","dotted","lengthString","suffixLengthString","octaveString","volumeString","octaveDiff","repeat","pieces","currentNode","getTrackTokens","toLowerCase","useTies","prevNoteEnd","noteLength","endsWith","latestTempoMarkers","token1","token2","gap","restLengths","prevRestEnd","restLength","t","testStr","renderTrackTokens","tokenList","output","activeDefault","activeDotted","tok","outputText","singleTrack","tracksToConsider","allTokens","getEnharmonicEquivalent","accidental","noteIndex","patterns","LENGTH","NOTE","REST","TIE","VOLUME","TEMPO","OCTAVE","tokenizeMML","mmlString","regex","Object","match","exec","mmlToNewTrack","mmlTokens","newTokenList","builderX","previousNote","tokenLength","nextNote","noteOctave","notePitch","startsWith","sharp","flat","Ldotted","tokenOctave","tokenVolume","tokenTempo","lengthNum","parseMMLNotation","segments","toUpperCase","segment","parseMabiNotation","mabiString","lines","tokenizedSections","line","trim","section","parseMML","hiddenFileInput","getElementById","click","handleFileSelect","file","files","reader","FileReader","onload","e","parsedMIDI","MIDI","ticksPerBeat","timeDivision","fileTempo","tempoChanges","at","firstAddedTrackIndex","trackName","activeNotes","sustainBuffer","pairedNotes","pedalDown","midiMessage","status","messageStatusByte","messageData","ticks","velocity","endTicks","findIndex","startTicks","originalEndTicks","wasDown","noteVolume","tempoMarkersTemp","previousTempo","readAsArrayBuffer","blob","Blob","buffer","url","URL","createObjectURL","createElement","href","download","body","appendChild","removeChild","revokeObjectURL","textFromClipboard","readText","buttons","fromList","oldSize","PianoRoll","scrollContainer","PatternEditor","render","createApp","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","call","deferred","O","chunkIds","fn","notFulfilled","fulfilled","keys","getter","__esModule","definition","o","defineProperty","enumerable","globalThis","obj","prop","prototype","hasOwnProperty","p","baseURI","self","location","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","bind","__webpack_exports__"],"sourceRoot":""}