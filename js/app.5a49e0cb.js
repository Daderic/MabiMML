(function(){"use strict";var e={20705:function(e,t,l){var n=l(45130),o=l(56768);const a={id:"app"};function r(e,t,l,n,r,i){const s=(0,o.g2)("PatternEditor");return(0,o.uX)(),(0,o.CE)("div",a,[(0,o.bF)(s)])}const i={class:"pattern-editor"},s={class:"scroll-container",ref:"scrollContainer"};function u(e,t,l,n,a,r){const u=(0,o.g2)("PianoRoll");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.Lk)("div",s,[(0,o.bF)(u)],512)])}var c=l(90144),h=l(24232);const d=e=>((0,o.Qi)("data-v-0b657b3d"),e=e(),(0,o.jt)(),e),m={class:"piano-container"},p={class:"loop-wrapper"},v={class:"scroll-wrapper"},k={key:0,class:"copyNotification"},f={key:1,class:"copyNotification",style:{"background-color":"#d44"}},g={class:"controls"},y={class:"instrument-selector"},b=d((()=>(0,o.Lk)("label",{for:"instrument-select"},"Select Instrument: ",-1))),L=["value"],w={class:"tempo-selector"},M=d((()=>(0,o.Lk)("label",{for:"tempo-select"},"Tempo: ",-1))),T=d((()=>(0,o.Lk)("input",{type:"file",id:"hiddenFileInput",style:{display:"none"},accept:".mid,.midi"},null,-1))),x={class:"grid-division-selector"},C=d((()=>(0,o.Lk)("label",{for:"grid-select",style:{"padding-left":"10px"}},"Grid Spacing: ",-1))),E=["value"],S={style:{padding:"10px"}},R={class:"piano-roll",ref:"pianoRoll"},W={class:"piano-keys"},K={class:"keys-wrapper"},N=["onMousedown","onMouseover","onMouseup","onMouseleave"],I=d((()=>(0,o.Lk)("div",{class:"marker-triangle"},null,-1))),$=d((()=>(0,o.Lk)("div",{class:"marker-line"},null,-1))),O=[I,$],D={class:"grid-wrapper"},P=["width"];function X(e,t,l,a,r,i){const s=(0,o.g2)("ExportMenu"),u=(0,o.g2)("HelpMenu"),c=(0,o.g2)("Tracks"),d=(0,o.g2)("TempoMarker");return(0,o.uX)(),(0,o.CE)("div",m,[(0,o.Lk)("button",{class:"play-button",onClick:t[0]||(t[0]=(...e)=>a.playSequence&&a.playSequence(...e))},"Play Sequence"),(0,o.Lk)("label",p,[(0,o.eW)(" Loop: "),(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>a.loopSong=e)},null,512),[[n.lH,a.loopSong]])]),(0,o.Lk)("label",v,[(0,o.eW)(" Auto-scroll: "),(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>a.autoScrollSong=e)},null,512),[[n.lH,a.autoScrollSong]])]),(0,o.bF)(s,{tracks:a.tracks,generateTokens:a.genTokensOutright,renderTokens:a.renderTokens,copyToClipboard:a.copyToClipboard},null,8,["tracks","generateTokens","renderTokens","copyToClipboard"]),(0,o.bF)(u),a.showSuccessNotification?((0,o.uX)(),(0,o.CE)("div",k,(0,h.v_)(a.successNotificationText),1)):(0,o.Q3)("",!0),a.showFailedNotification?((0,o.uX)(),(0,o.CE)("div",f,(0,h.v_)(a.failedNotificationText),1)):(0,o.Q3)("",!0),(0,o.bF)(c,{onTrackSelected:a.handleTrackSelected,onAddTrack:a.handleAddTrack,onRemoveTrack:a.handleRemoveTrack,onMuteTrack:a.handleMuteTrack,onColorChange:a.updateColor},null,8,["onTrackSelected","onAddTrack","onRemoveTrack","onMuteTrack","onColorChange"]),(0,o.Lk)("div",g,[(0,o.Lk)("div",y,[b,(0,o.bo)((0,o.Lk)("select",{id:"instrument-select","onUpdate:modelValue":t[3]||(t[3]=e=>a.selectedInstrument=e),onChange:t[4]||(t[4]=e=>a.changeInstrument(!1))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.instruments,((e,t)=>((0,o.uX)(),(0,o.CE)("option",{key:t,value:e},(0,h.v_)(e.name),9,L)))),128))],544),[[n.u1,a.selectedInstrument]])]),(0,o.Lk)("div",w,[M,(0,o.bo)((0,o.Lk)("input",{type:"number",id:"tempo-select","onUpdate:modelValue":t[5]||(t[5]=e=>a.tempo=e),min:"40",max:"240"},null,512),[[n.Jo,a.tempo,void 0,{number:!0}]])]),(0,o.Lk)("button",{class:"track-splitter",onClick:t[6]||(t[6]=(...e)=>a.trackify&&a.trackify(...e))},"Split Track"),(0,o.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>a.parseMMLFromClipboard&&a.parseMMLFromClipboard(...e)),style:{"margin-left":"10px"}},"Import MML From Clipboard"),(0,o.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>a.importMidi&&a.importMidi(...e)),style:{"margin-left":"10px"}},"Import MIDI"),(0,o.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>a.exportMidi&&a.exportMidi(...e)),style:{"margin-left":"10px"}},"Export MIDI"),T,(0,o.Lk)("div",x,[C,(0,o.bo)((0,o.Lk)("select",{id:"grid-select","onUpdate:modelValue":t[10]||(t[10]=e=>a.gridWidth=e)},[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)([{displayName:"16ths",width:16},{displayName:"12ths",width:256/12}],(e=>(0,o.Lk)("option",{key:e.displayName,value:e.width},(0,h.v_)(e.displayName),9,E))),64))],512),[[n.u1,a.gridWidth]])]),(0,o.Lk)("label",S,(0,h.v_)("Current Note Volume: "+a.currentNoteVolume),1)]),(0,o.Lk)("div",R,[(0,o.Lk)("div",W,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.octaves,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"octave"},[(0,o.Lk)("div",K,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.notes.slice().reverse(),((t,l)=>((0,o.uX)(),(0,o.CE)("div",{key:t.name,class:(0,h.C4)(["piano-key",t.isBlack?"black-key":"white-key"]),onMousedown:l=>a.startNote(0,t,e),onMouseover:l=>a.mouseOverNote(0,t,e),onMouseup:l=>a.endNote(0,t,e),onMouseleave:l=>a.mouseLeaveNote(0,t,e),style:(0,h.Tr)({zIndex:t.isBlack?1:0,background:t.index+12*e<a.instrKeyMin||t.index+12*e>a.instrKeyMax?"#d44":t.isBlack?"#000":"#fff"})},(0,h.v_)(t.name+e),47,N)))),128))])])))),128))]),(0,o.Lk)("div",{class:"ruler",ref:"ruler",onMousedown:t[12]||(t[12]=(...e)=>a.handleRulerClick&&a.handleRulerClick(...e)),style:(0,h.Tr)({width:"calc( 10% + "+a.gridSpan*a.zoomScalar+"px )",background:`repeating-linear-gradient(\n                        90deg,\n                        #bbb,\n                        #bbb 2px,\n                        #eee 2px,\n                        #eee ${256*a.zoomScalar}px\n                    )`,float:"bottom"})},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Math.ceil(a.gridSpan/256),(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"ruler-tick-label",style:(0,h.Tr)({left:`calc(${256*(e-1)*a.zoomScalar}px)`})},(0,h.v_)(e),5)))),128)),(0,o.Lk)("div",{class:"marker-replay-triangle",style:(0,h.Tr)({left:a.markerReplayPosition*a.zoomScalar+"px"})},null,4),(0,o.Lk)("div",{class:"marker-wrapper",style:(0,h.Tr)({left:a.markerPosition*a.zoomScalar+"px"})},O,4),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.tempoMarkers,((e,l)=>((0,o.uX)(),(0,o.Wv)(d,{key:e.left,left:e.left*a.zoomScalar+1,tempo:e.tempo,index:l,color:e.color,visible:e.muted?"hidden":"visible",onClick:[a.clickTempoMarker,t[11]||(t[11]=(0,n.D$)((()=>{}),["stop"]))]},null,8,["left","tempo","index","color","visible","onClick"])))),128))],36),(0,o.Lk)("div",D,[(0,o.Lk)("div",{class:"grid",ref:"grid",style:(0,h.Tr)({width:a.gridSpan*a.zoomScalar+"px",height:"2622px"})},[(0,o.Lk)("div",{style:(0,h.Tr)({width:a.scrollX+"px"})},null,4),(0,o.Lk)("canvas",{class:"gridCanvas",ref:"gridCanvas",width:.9*a.windowWidth-14,height:2592,onMousemove:t[13]||(t[13]=(...e)=>a.tryRemoveNote&&a.tryRemoveNote(...e)),onMousedown:t[14]||(t[14]=(...e)=>a.handleGridClick&&a.handleGridClick(...e)),onContextmenu:t[15]||(t[15]=(0,n.D$)(((...t)=>e.startNoteRemove&&e.startNoteRemove(...t)),["prevent"])),onWheel:t[16]||(t[16]=(...e)=>a.handleGridScroll&&a.handleGridScroll(...e))},null,40,P),a.isSelecting?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"selection-rect",style:(0,h.Tr)(a.rectangleStyle)},null,4)):(0,o.Q3)("",!0)],4)])],512)])}l(44114),l(16573),l(78100),l(77936),l(17642),l(58004),l(33853),l(45876),l(32475),l(15024),l(31698),l(37467),l(44732),l(79577),l(14603),l(47566),l(98721);var F=l(20715),V=l(29362);const A=e=>((0,o.Qi)("data-v-370ae6b0"),e=e(),(0,o.jt)(),e),H={key:0},B={key:1},_={class:"help-modal"},z=A((()=>(0,o.Lk)("h1",null,"Help",-1))),U=A((()=>(0,o.Lk)("p",{class:"credits"},"MOS v1.2",-1))),j=A((()=>(0,o.Lk)("h3",null,"Navigating the Grid",-1))),G=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"Scroll within the grid using the scroll bars, or directly with your mouse wheel."),(0,o.Lk)("li",null,"Scrolling your mouse wheel normally will move the grid vertically."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" while scrolling will move the grid horizontally.")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" and scrolling will zoom the grid in and out.")]),(0,o.Lk)("li",null,"If the grid is focused (after clicking inside it), you can use the arrow keys to navigate around the grid.")],-1))),Y=A((()=>(0,o.Lk)("h3",null,"Placing Notes",-1))),q=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"To place notes, click anywhere on the grid."),(0,o.Lk)("li",null,"The size of the note will be the same size as the note that was last placed/moved."),(0,o.Lk)("li",null,"Placed notes are instantly draggable."),(0,o.Lk)("li",null,"The color of the placed notes will depend on the color of the track they belong to."),(0,o.Lk)("li",null,'By changing the "Grid Spacing" dropdown, you can control whether the grid is in 16ths or 12ths.'),(0,o.Lk)("li",null,"Each instrument has a different range of notes that it can play. The red keys on the piano to the left indicate notes that will not make a sound with the current instrument.")],-1))),Q=A((()=>(0,o.Lk)("h3",null,"Dragging Notes",-1))),J=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"To drag a note, click on the left side of the note. Then, move your mouse around within the bounds of the grid."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Alt"),(0,o.eW)(" will move notes freely (not locked to the grid).")]),(0,o.Lk)("li",null,"If multiple notes are selected, all selected notes will be moved together (even if they are from different tracks).")],-1))),Z=A((()=>(0,o.Lk)("h3",null,"Resizing Notes",-1))),ee=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"To resize a note, click on the right side of the note, then drag left or right."),(0,o.Lk)("li",null,"Notes have a minimum length of 1/64th of a beat."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Alt"),(0,o.eW)(" will resize notes freely (not locked to the grid)")]),(0,o.Lk)("li",null,"If multiple notes are selected, all selected notes will be resized together.")],-1))),te=A((()=>(0,o.Lk)("h3",null,"Note Volume",-1))),le=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"The current note volume can be seen at the top of the screen."),(0,o.Lk)("li",null,"A note's volume is indicated by the opacity of the note, as well as the number next to the note's name."),(0,o.Lk)("li",null,"To change a note's volume, left click and hold on the half-circle at the bottom center of the note. Then, drag your mouse up and down. Dragging up will increase the note's volume, and dragging down will decrease it."),(0,o.Lk)("li",null,"Notes start with a default volume of 8."),(0,o.Lk)("li",null,"Notes have a volume range from 1 to 15."),(0,o.Lk)("li",null,"Changing a note's volume while multiple notes are selected will change the volume of all selected notes by the same amount.")],-1))),ne=A((()=>(0,o.Lk)("h3",null,"Selecting Multiple Notes",-1))),oe=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,[(0,o.eW)("To select multiple notes at once, hold "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" on the grid and drag your mouse.")]),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"Ctrl+Shift"),(0,o.eW)(' and drag, you will "add on" to your note selection. '),(0,o.Lk)("i",null,"(Previously selected notes will not be unselected, and you can select additional notes.)")]),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and drag a note, you will clone it (if that note is highlighted, it will clone all highlighted notes).")]),(0,o.Lk)("li",null,[(0,o.eW)("Pressing "),(0,o.Lk)("strong",null,"Ctrl+A"),(0,o.eW)(" will select all notes in the grid.")]),(0,o.Lk)("li",null,[(0,o.eW)("Pressing the "),(0,o.Lk)("strong",null,"Backspace"),(0,o.eW)(" or "),(0,o.Lk)("strong",null,"Delete"),(0,o.eW)(" keys will delete all selected notes.")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" and pressing the left or right arrows will move the selected notes a whole grid space (i.e. 1/16th or 1/12th).")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Ctrl"),(0,o.eW)(" and pressing the up or down arrows will move the selected notes an octave (if possible).")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and pressing the left or right arrows will move the selected notes a fourth of a grid space (i.e. 1/64th or 1/48th).")]),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and pressing the up or down arrows will move the selected notes up or down a single note (if possible).")]),(0,o.Lk)("li",null,[(0,o.eW)("Pressing "),(0,o.Lk)("strong",null,"T"),(0,o.eW)(" with notes selected will move them into the currently selected track.")])],-1))),ae=A((()=>(0,o.Lk)("h3",null,"Tracks",-1))),re=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"Each track has its own name, instrument, color, and visibility/mute toggle."),(0,o.Lk)("li",null,"To add a track, click on the blue plus button to the right of the tracks."),(0,o.Lk)("li",null,[(0,o.eW)("To rename a track, double click on the track's name. When done with renaming, press "),(0,o.Lk)("strong",null,"Enter"),(0,o.eW)(". ")]),(0,o.Lk)("li",null,"To mute/unmute a track, click on the volume icon next to the track's name."),(0,o.Lk)("li",null,"To focus on a track, right click on the volume icon. This will mute all other tracks."),(0,o.Lk)("li",null,"To unfocus, right click on the volume icon again. This will unmute all other tracks."),(0,o.Lk)("li",null,"Clicking on a note from another track will cause you to switch to that note's track."),(0,o.Lk)("li",null,[(0,o.eW)("You can remove a track by clicking on the "),(0,o.Lk)("strong",null,"X"),(0,o.eW)(". This will also remove the notes belonging to that track.")]),(0,o.Lk)("li",null,"To change the color of a track and its notes, click on the outlined box at the bottom-center of the selected track's tab."),(0,o.Lk)("li",null,"You can have a minimum of 1 track, and a maximum of 15 tracks."),(0,o.Lk)("li",null,"The number of tracks you can have at once is dependant on screen width. This is so that smaller screens can still access all of their created tabs easily."),(0,o.Lk)("li",null,"Hovering over a track tab will show you the name of the track."),(0,o.Lk)("li",null,[(0,o.eW)("With notes selected, pressing "),(0,o.Lk)("strong",null,"Ctrl+C"),(0,o.eW)(" or "),(0,o.Lk)("strong",null,"Ctrl+X"),(0,o.eW)(" will copy/cut notes. ")]),(0,o.Lk)("li",null,[(0,o.eW)("After copying/cutting notes, you can paste them back in with "),(0,o.Lk)("strong",null,"Ctrl+V"),(0,o.eW)(". This will paste all previously copied notes into the current track.")])],-1))),ie=A((()=>(0,o.Lk)("h3",null,"Track Splitting",-1))),se=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'With a track selected, click the "Split Track" button. This will separate the track into multiple other tracks (unless that number would exceed 16).'),(0,o.Lk)("li",null,"A track is split from left to right, then top to bottom. This can sometimes lead to weird splits."),(0,o.Lk)("li",null,"The purpose of this feature is so that you can compose parts of your piece in a single track, then split them up if you need to.")],-1))),ue=A((()=>(0,o.Lk)("h3",null,"Exporting to MML",-1))),ce=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'Clicking on the "Export" button will open a menu allowing the export of MML to your clipboard (it may take a moment to open).'),(0,o.Lk)("li",null,"A maximum of four tracks can be exported at once, or three tracks if the 'Exclude Song Part' box is checked."),(0,o.Lk)("li",null,"Remember that the fourth track in a score is always the 'song' track."),(0,o.Lk)("li",null,"Tracks that have multiple notes playing at once will NOT be exportable (marked with an asterisk), so be sure to split them before export."),(0,o.Lk)("li",null,"The exported MML will be moderately optimized for length; they will not be perfectly optimized."),(0,o.Lk)("li",null,"Exported tracks are sorted by length by default, but this can be changed by unchecking the box."),(0,o.Lk)("li",null,"When tracks are not sorted by length, they are sorted by the order in which they were selected."),(0,o.Lk)("li",null,[(0,o.eW)("In the future, tracks will be able to be split into separate Jabchiel-compatible scores based on the rank you select. "),(0,o.Lk)("strong",null,"*Jabchiel export is currently non-functional*"),(0,o.eW)(", but you can play with it to see what is intended. ")])],-1))),he=A((()=>(0,o.Lk)("h3",null,"Importing MML",-1))),de=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'Clicking on the "Import MML From Clipboard" button will attempt to copy whatever is in your clipboard into new sequencer tracks.'),(0,o.Lk)("li",null,"Available import types are MMLs that start with `MML@` and end with a semicolon (;), or MMLs taken straight from Mabinogi score scrolls."),(0,o.Lk)("li",null,"Imported MMLs should not have any extraneous spaces, characters, or new line characters. Otherwise, they will not import properly."),(0,o.Lk)("li",null,"Importing from Mabinogi directly will named the tracks according to which track they came from (e.g. Melody, Harmony 1, Harmony 2, Song)")],-1))),me=A((()=>(0,o.Lk)("h3",null,"Exporting MIDI",-1))),pe=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'Clicking on the "Export MIDI" button will download "MySong.mid" directly.'),(0,o.Lk)("li",null,"Only audible tracks will be exported.")],-1))),ve=A((()=>(0,o.Lk)("h3",null,"Importing MIDI",-1))),ke=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,'Clicking on the "Import MIDI" button will open your computer\'s file browser.'),(0,o.Lk)("li",null,"From there, you can select a standard MIDI file and it will be imported. Most MIDI files should work. "),(0,o.Lk)("li",null,"Each MIDI track will be given its own track, regardless of polyphony."),(0,o.Lk)("li",null,"Imported songs will automatically be quantized to the nearest 64th note boundary.")],-1))),fe=A((()=>(0,o.Lk)("h3",null,"Tempo",-1))),ge=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"You can change the tempo by entering a number at the top left of the page. Note that this will only change the starting tempo of the song."),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"Shift"),(0,o.eW)(" and left click on the ruler on top of the grid, you will be prompted to enter a tempo (BPM).")]),(0,o.Lk)("li",null,"Tempo markers will automatically be assigned to the currently selected track. This is visible through the color of the marker. Deleting the selected track will delete all associated tempo markers."),(0,o.Lk)("li",null,[(0,o.eW)("Holding "),(0,o.Lk)("strong",null,"Alt"),(0,o.eW)(" while placing a marker will allow for more freedom in placement.")]),(0,o.Lk)("li",null,"Clicking on an existing tempo marker will allow you to modify it. By entering an empty string, you will delete the marker."),(0,o.Lk)("li",null,"Muting a track will also hide the tempo markers associated with that track."),(0,o.Lk)("li",null,"Right-clicking a tempo marker will move the tempo marker to the currently selected track.")],-1))),ye=A((()=>(0,o.Lk)("h3",null,"Misc",-1))),be=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,[(0,o.eW)("Click and hold on the piano keys to play them. "),(0,o.Lk)("br"),(0,o.Lk)("em",null,"(Note: some instruments can only play certain keys)")]),(0,o.Lk)("li",null,[(0,o.eW)("Press "),(0,o.Lk)("strong",null,"Space"),(0,o.eW)(" to play your song. It will start from the marker.")]),(0,o.Lk)("li",null,[(0,o.eW)("Press "),(0,o.Lk)("strong",null,"Space"),(0,o.eW)(" again to pause your song. If you press "),(0,o.Lk)("strong",null,"Ctrl+Space"),(0,o.eW)(", it will stop the marker where it was.")]),(0,o.Lk)("li",null,[(0,o.eW)("Check the "),(0,o.Lk)("strong",null,"Loop"),(0,o.eW)(" checkbox to loop your song.")]),(0,o.Lk)("li",null,"Click and drag on the timeline to move the marker."),(0,o.Lk)("li",null,[(0,o.eW)("If you hold "),(0,o.Lk)("strong",null,"ALT"),(0,o.eW)(" while dragging, the marker will move freely.")]),(0,o.Lk)("li",null,"You can change instruments using the spinner at the top left of the page.")],-1))),Le=A((()=>(0,o.Lk)("h3",null,"Planned Features",-1))),we=A((()=>(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"Jabchiel MML export."),(0,o.Lk)("li",null,"Undo/Redo functionality."),(0,o.Lk)("li",null,"Other algorithm options for track splitting."),(0,o.Lk)("li",null,'Support for saving/loading "projects".'),(0,o.Lk)("li",null,"Better exported MML optimization."),(0,o.Lk)("li",null,"Improved note rendering speed.")],-1))),Me=A((()=>(0,o.Lk)("p",{class:"credits"},"Credits: Made by Daderic",-1))),Te=[z,U,j,G,Y,q,Q,J,Z,ee,te,le,ne,oe,ae,re,ie,se,ue,ce,he,de,me,pe,ve,ke,fe,ge,ye,be,Le,we,Me];function xe(e,t,l,a,r,i){return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("button",{class:"help-button",onClick:t[0]||(t[0]=(...e)=>i.showHelp&&i.showHelp(...e))},[r.hoverHelp?((0,o.uX)(),(0,o.CE)("span",H,"Help")):((0,o.uX)(),(0,o.CE)("span",B," ? "))]),r.isHelpVisible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-background",onClick:t[3]||(t[3]=(...e)=>i.closeHelp&&i.closeHelp(...e))},[(0,o.bF)(n.eB,{name:"fade"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",_,[(0,o.Lk)("button",{class:"close-button",onClick:t[1]||(t[1]=(...e)=>i.closeHelp&&i.closeHelp(...e))},"X"),(0,o.Lk)("div",{class:"help-content",onClick:t[2]||(t[2]=(0,n.D$)((()=>{}),["stop"]))},Te)])])),_:1})])):(0,o.Q3)("",!0)])}var Ce={data(){return{hoverHelp:!1,isHelpVisible:!0}},methods:{showHelp(){this.isHelpVisible=!0},closeHelp(){this.isHelpVisible=!1}}},Ee=l(71241);const Se=(0,Ee.A)(Ce,[["render",xe],["__scopeId","data-v-370ae6b0"]]);var Re=Se;const We={class:"track-tab-container",ref:"tabContainerRef"},Ke=["onMousedown","title"],Ne={class:"tab-header"},Ie=["onUpdate:modelValue","onBlur","onKeyup"],$e=["onDblclick"],Oe=["onMousedown"],De=["onClick"],Pe={key:0,class:"color-picker-container"},Xe=["disabled"];function Fe(e,t,l,a,r,i){return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",We,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.tracks,((e,l)=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:(0,h.C4)(["track-tab",{selected:a.selectedTrackIndex===l}]),onMousedown:e=>a.selectTrack(l),style:(0,h.Tr)({backgroundColor:e.color}),title:e.name},[(0,o.Lk)("div",Ne,[e.isEditingName?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:0,"onUpdate:modelValue":t=>e.name=t,onBlur:t=>e.isEditingName=!1,onKeyup:(0,n.jR)((t=>e.isEditingName=!1),["enter"]),class:"track-name-input"},null,40,Ie)),[[n.Jo,e.name]]):((0,o.uX)(),(0,o.CE)("span",{key:1,onDblclick:t=>e.isEditingName=!0,class:"track-name"},(0,h.v_)(e.name),41,$e)),(0,o.Lk)("span",{class:"mute-icon",onMousedown:e=>a.toggleMute(e,l),onContextmenu:t[0]||(t[0]=e=>e.preventDefault())},(0,h.v_)(e.isMuted?"🔇":"🔊"),41,Oe),(0,o.Lk)("button",{onClick:(0,n.D$)((e=>a.removeTrack(l)),["stop"]),class:"delete-btn"},"✖",8,De)]),a.selectedTrackIndex===l?((0,o.uX)(),(0,o.CE)("div",Pe,[(0,o.bo)((0,o.Lk)("input",{type:"color","onUpdate:modelValue":t[1]||(t[1]=e=>a.trackHexColor=e),class:"color-picker",onInput:t[2]||(t[2]=(...e)=>a.updateTrackColor&&a.updateTrackColor(...e))},null,544),[[n.Jo,a.trackHexColor]])])):(0,o.Q3)("",!0)],46,Ke)))),128)),(0,o.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>a.addTrack&&a.addTrack(...e)),class:"add-track-btn",disabled:!a.canAddTrack}," + ",8,Xe)],512)])}const Ve=(0,c.Kh)({}),Ae=(0,c.KR)([]),He=(0,c.KR)(null),Be=(0,o.EW)((()=>Ae.value[He.value]||null)),_e=(0,c.KR)("#ffffff");var ze={created(){Ve.addTrack=this.addTrack},setup(e,{emit:t}){const l=(0,c.KR)(0),n=(0,c.KR)(null);let a=null;const r=(0,o.EW)((()=>{if(Ae.value.length>14)return!1;const e=75,t=Ae.value.length*e;return l.value-t-50>e})),i=()=>{n.value&&(l.value=n.value.clientWidth)},s=()=>{const e=Math.floor(360*Math.random()),t=75+25*Math.random(),l=50+10*Math.random(),n=(1-Math.abs(2*l/100-1))*(t/100),o=n*(1-Math.abs(e/60%2-1)),a=l/100-n/2;let[r,i,s]=e<60?[n,o,0]:e<120?[o,n,0]:e<180?[0,n,o]:e<240?[0,o,n]:e<300?[o,0,n]:[n,0,o];return r=Math.round(255*(r+a)),i=Math.round(255*(i+a)),s=Math.round(255*(s+a)),`#${((1<<24)+(r<<16)+(i<<8)+s).toString(16).slice(1)}`},u=(e=null,l=null,n=null,o=null)=>{const a={id:Ae.value.length+Date.now(),name:o||`Track ${Ae.value.length+1}`,isMuted:!1,color:n||s(),isEditingName:!1,notes:[],instrument:l||{name:"Lute",program:0,min:16,max:88}};return Ae.value.push(a),d(Ae.value.length-1),t("add-track",a,Ae.value.length-1),a},h=e=>{if(1===Ae.value.length)return;let l=!0;if(0!==Ae.value[e].notes.length&&(l=confirm(`Are you sure you want to delete the track "${Ae.value[e].name}"? All notes belonging to this track will also be deleted.`)),!l)return;let n=Ae.value[e];if(Ae.value.splice(e,1),0===Ae.value.length)He.value=null,_e.value="#ffffff";else{if(e===He.value){const t=e<Ae.value.length?e:e-1;He.value=t,_e.value=Ae.value[t].color}else He.value>e&&He.value--;Be.value&&(_e.value=Be.value.color)}t("remove-track",n,Be.value)},d=e=>{He.value=e,_e.value=Ae.value[e].color,t("track-selected",Ae.value[e])},m=(e,l)=>{if(e.preventDefault(),0===e.button){if(Ae.value[l].isMuted=!Ae.value[l].isMuted,Ae.value[l].isMuted)for(const e of Ae.value[l].notes)e.muted=!0;else for(const e of Ae.value[l].notes)e.muted=!1;t("mute-track",l)}else if(2===e.button){a=Ae.value[l]===a?null:Ae.value[l];const e=null!==a;Ae.value[l].isMuted=!1;for(const t of Ae.value[l].notes)t.muted=!1;for(const[n,o]of Ae.value.entries())if(o!==Ae.value[l]){o.isMuted=e;for(const t of o.notes)t.muted=e;t("mute-track",n)}t("mute-track",l)}},p=e=>{const l=e.target.value;if(Be.value){Be.value.color=l,_e.value=l;for(const e of Be.value.notes)e.color=l}t("color-change",Be.value,l)};return(0,o.sV)((()=>{u(),(0,o.dY)((()=>{i()})),window.addEventListener("resize",i)})),(0,o.xo)((()=>{window.removeEventListener("resize",i)})),{tracks:Ae,selectedTrackIndex:He,trackHexColor:_e,containerWidth:l,addTrack:u,removeTrack:h,selectTrack:d,toggleMute:m,updateTrackColor:p,selectedTrack:Be,canAddTrack:r,tabContainerRef:n}}};const Ue=(0,Ee.A)(ze,[["render",Fe],["__scopeId","data-v-78489fbc"]]);var je=Ue;l(44847);function Ge(e,t,l,a,r,i){return(0,o.uX)(),(0,o.CE)("div",{class:"tempo-marker",style:(0,h.Tr)({left:l.left+"px",visibility:l.visible}),onMousedown:t[0]||(t[0]=(...e)=>a.clickMarker&&a.clickMarker(...e)),onContextmenu:t[1]||(t[1]=(0,n.D$)((e=>e.preventDefault()),["prevent"]))},[(0,o.Lk)("div",{class:"tempo-triangle",style:(0,h.Tr)({borderTop:"10px solid "+l.color,visibility:l.visible})},null,4),(0,o.Lk)("div",{class:"tempo-label",style:(0,h.Tr)({visibility:l.visible})},"T"+(0,h.v_)(l.tempo),5)],36)}var Ye={props:{left:Number,tempo:Number,index:Number,color:String,visible:String},emits:["click"],setup(e,{emit:t}){const l=l=>{t("click",l,e.index)};return{clickMarker:l}}};const qe=(0,Ee.A)(Ye,[["render",Ge],["__scopeId","data-v-3f9a78ee"]]);var Qe=qe;const Je=e=>((0,o.Qi)("data-v-054bb656"),e=e(),(0,o.jt)(),e),Ze={class:"export-content"},et=Je((()=>(0,o.Lk)("h1",null,"Export",-1))),tt={class:"flex-row"},lt={class:"left-panel"},nt=Je((()=>(0,o.Lk)("div",{class:"track-header"},"Track",-1))),ot={class:"track-list"},at=["checked","disabled","onChange"],rt={class:"right-panel"},it={class:"output-settings"},st=Je((()=>(0,o.Lk)("strong",null,"Output Settings",-1))),ut=Je((()=>(0,o.Lk)("li",null,[(0,o.Lk)("input",{type:"radio",name:"format",checked:""}),(0,o.eW)(" Mabinogi MML@ Format ")],-1))),ct=["disabled"],ht=["value"],dt={class:"info-box"},mt=Je((()=>(0,o.Lk)("strong",null,"Information",-1))),pt=["onClick"],vt=["onClick"];function kt(e,t,l,a,r,i){return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("button",{class:"export-button",onClick:t[0]||(t[0]=(...e)=>i.showExport&&i.showExport(...e))}," Export "),r.isExportVisible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-background",onClick:t[9]||(t[9]=(...e)=>i.hideExport&&i.hideExport(...e))},[(0,o.bF)(n.eB,{name:"fade"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",{class:"export-modal",onClick:t[8]||(t[8]=(0,n.D$)((()=>{}),["stop"]))},[(0,o.Lk)("button",{class:"close-button",onClick:t[1]||(t[1]=(...e)=>i.hideExport&&i.hideExport(...e))},"X"),(0,o.Lk)("div",Ze,[et,(0,o.Lk)("div",tt,[(0,o.Lk)("div",lt,[nt,(0,o.Lk)("div",ot,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.tracks,((e,t)=>((0,o.uX)(),(0,o.CE)("label",{key:t},[(0,o.Lk)("input",{type:"checkbox",checked:i.isSelected(e),disabled:!i.isSelected(e)&&r.selectedTracks.length>=i.maxSelectable||i.trackHasPolyphony(e),onChange:t=>i.toggleTrack(e)},null,40,at),(0,o.eW)(" "+(0,h.v_)(e.name)+" : "+(0,h.v_)(i.trackHasPolyphony(e)?"-":i.getRenderedTrackTokens(e,t).rendered.length+" char(s)")+" "+(0,h.v_)(i.trackHasPolyphony(e)?"*":""),1)])))),128))]),(0,o.Lk)("button",{class:"clear-btn",onClick:t[2]||(t[2]=(...e)=>i.clearSelection&&i.clearSelection(...e))},"Clear Selection")]),(0,o.Lk)("div",rt,[(0,o.Lk)("div",it,[st,ut,(0,o.Lk)("li",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>r.sortTracksByLength=e),checked:""},null,512),[[n.lH,r.sortTracksByLength]]),(0,o.eW)(" Sort tracks by text length. ")]),(0,o.Lk)("li",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>r.excludeSongPart=e)},null,512),[[n.lH,r.excludeSongPart]]),(0,o.eW)(" Exclude Song Part ")]),(0,o.Lk)("li",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>r.jabSplit=e)},null,512),[[n.lH,r.jabSplit]]),(0,o.eW)(" Split Score for Jabs (WIP) ")]),(0,o.Lk)("li",null,[(0,o.bo)((0,o.Lk)("select",{id:"rank-select",disabled:!r.jabSplit,"onUpdate:modelValue":t[6]||(t[6]=e=>r.selectedRank=e),onChange:t[7]||(t[7]=(...e)=>i.changeComposeRank&&i.changeComposeRank(...e))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.composeRanks,((e,t)=>((0,o.uX)(),(0,o.CE)("option",{key:t,value:e}," Rank: "+(0,h.v_)(e.name)+" "+(0,h.v_)([e.melody,e.harmony1,e.harmony2]),9,ht)))),128))],40,ct),[[n.u1,r.selectedRank]])])]),(0,o.Lk)("div",dt,[mt,((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.generatedScores,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"score-block"},[(0,o.Lk)("p",null,[(0,o.Lk)("strong",null,"Score "+(0,h.v_)(t+1)+":",1),(0,o.eW)(" Rank "+(0,h.v_)(e.rank)+" ",1),(0,o.Lk)("button",{onClick:e=>i.copyScore(t)},"📋",8,pt)]),(0,o.Lk)("ul",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.parts,((e,l)=>((0,o.uX)(),(0,o.CE)("li",{key:l},[(0,o.eW)(" Part "+(0,h.v_)(l+1)+": "+(0,h.v_)(e.length)+" char(s) ",1),(0,o.Lk)("button",{onClick:e=>i.copyScorePiece(t,l)},"📋",8,vt)])))),128))])])))),128))])])])])])])),_:1})])):(0,o.Q3)("",!0)])}var ft={props:{tracks:Array,generateTokens:Function,renderTokens:Function,copyToClipboard:Function},data(){return{isExportVisible:!1,selectedTracks:[],excludeSongPart:!1,jabSplit:!1,sortTracksByLength:!0,composeRanks:[{name:"Impossible",melody:1/0,harmony1:1/0,harmony2:1/0},{name:"1",melody:1200,harmony1:800,harmony2:500},{name:"2",melody:1150,harmony1:700,harmony2:400},{name:"3",melody:1100,harmony1:600,harmony2:350},{name:"4",melody:1050,harmony1:550,harmony2:300},{name:"5",melody:1e3,harmony1:500,harmony2:250},{name:"6",melody:950,harmony1:450,harmony2:200},{name:"7",melody:900,harmony1:400,harmony2:200},{name:"8",melody:850,harmony1:400,harmony2:200},{name:"9",melody:800,harmony1:350,harmony2:200},{name:"A",melody:750,harmony1:300,harmony2:200},{name:"B",melody:700,harmony1:300,harmony2:200},{name:"C",melody:650,harmony1:250,harmony2:200},{name:"D",melody:600,harmony1:250,harmony2:150},{name:"E",melody:500,harmony1:200,harmony2:100},{name:"F",melody:400,harmony1:200,harmony2:100},{name:"Practice",melody:200,harmony1:100,harmony2:0}],selectedRank:{name:"1",melody:1200,harmony1:800,harmony2:500},selectedRankIndex:1,generatedScores:[],tokenCache:new Map}},computed:{maxSelectable(){return this.excludeSongPart?3:4}},watch:{excludeSongPart(e){const t=e?3:4;this.selectedTracks.length>t&&this.selectedTracks.splice(t),this.composeRanks=e?[{name:"Impossible",melody:1/0,harmony1:1/0,harmony2:1/0},{name:"1*",melody:1600,harmony1:1200,harmony2:900},{name:"2*",melody:1533,harmony1:1083,harmony2:783},{name:"3*",melody:1466,harmony1:966,harmony2:716},{name:"4*",melody:1400,harmony1:900,harmony2:650},{name:"5*",melody:1333,harmony1:833,harmony2:583},{name:"6*",melody:1266,harmony1:766,harmony2:516},{name:"7*",melody:1200,harmony1:700,harmony2:500},{name:"8*",melody:1133,harmony1:683,harmony2:483},{name:"9*",melody:1066,harmony1:616,harmony2:466},{name:"A*",melody:1e3,harmony1:550,harmony2:450},{name:"B*",melody:933,harmony1:533,harmony2:433},{name:"C*",melody:866,harmony1:466,harmony2:416},{name:"D*",melody:800,harmony1:450,harmony2:350},{name:"E*",melody:666,harmony1:366,harmony2:233},{name:"F*",melody:553,harmony1:333,harmony2:233},{name:"Practice*",melody:266,harmony1:166,harmony2:66}]:[{name:"Impossible",melody:1/0,harmony1:1/0,harmony2:1/0},{name:"1",melody:1200,harmony1:800,harmony2:500},{name:"2",melody:1150,harmony1:700,harmony2:400},{name:"3",melody:1100,harmony1:600,harmony2:350},{name:"4",melody:1050,harmony1:550,harmony2:300},{name:"5",melody:1e3,harmony1:500,harmony2:250},{name:"6",melody:950,harmony1:450,harmony2:200},{name:"7",melody:900,harmony1:400,harmony2:200},{name:"8",melody:850,harmony1:400,harmony2:200},{name:"9",melody:800,harmony1:350,harmony2:200},{name:"A",melody:750,harmony1:300,harmony2:200},{name:"B",melody:700,harmony1:300,harmony2:200},{name:"C",melody:650,harmony1:250,harmony2:200},{name:"D",melody:600,harmony1:250,harmony2:150},{name:"E",melody:500,harmony1:200,harmony2:100},{name:"F",melody:400,harmony1:200,harmony2:100},{name:"Practice",melody:200,harmony1:100,harmony2:0}],this.selectedRank=this.composeRanks[this.selectedRankIndex],this.generateScores()},jabSplit(){this.generateScores()},selectedRank(){this.generateScores()},sortTracksByLength(){this.generateScores()},tracks:{handler(){this.tokenCache.clear(),this.clearSelection()},deep:!0}},methods:{isSelected(e){return this.selectedTracks.includes(e)},toggleTrack(e){const t=this.selectedTracks.indexOf(e);-1!==t?this.selectedTracks.splice(t,1):this.selectedTracks.length<this.maxSelectable&&this.selectedTracks.push(e),this.generateScores()},trackHasPolyphony(e){e.notes.sort(((e,t)=>t.start-e.start));for(let t=0;t<e.notes.length;++t){const l=e.notes[t],n=t+1<e.notes.length?e.notes[t+1]:null;if(null===n)return!1;if(l.start<n.end)return l.highlighted=!0,n.highlighted=!0,!0}return!1},clearSelection(){this.selectedTracks=[],this.generateScores()},changeComposeRank(){this.selectedRankIndex=this.composeRanks.indexOf(this.selectedRank)},showExport(){this.isExportVisible=!0},hideExport(){this.isExportVisible=!1},getRenderedTrackTokens(e){if(this.tokenCache.has(e))return this.tokenCache.get(e);if(this.trackHasPolyphony(e))return{tokens:[],rendered:""};const t=this.generateTokens(e)[0];return this.tokenCache.set(e,t),t},splitTokensByLimit(e,t){const l=[];let n=[],o=0;for(let a=0;a<e.length;a++){const r=[...n,e[a]],i=this.renderTokens(r),s=i.length;s>t?n.length?(l.push(n),n=[e[a]],o=this.renderTokens(n).length):(l.push([e[a]]),n=[],o=0):(n.push(e[a]),o=s)}return n.length&&l.push(n),l},generateScores(){const e=[...this.selectedTracks];this.sortTracksByLength&&e.sort(((e,t)=>{const l=this.tracks.indexOf(e),n=this.tracks.indexOf(t);return this.getRenderedTrackTokens(t,n).rendered.length-this.getRenderedTrackTokens(e,l).rendered.length}));const t=this.excludeSongPart?3:4,l=e.map((e=>{const t=this.tracks.indexOf(e);return this.getRenderedTrackTokens(e,t).tokens})),n=e.map((e=>{const t=this.tracks.indexOf(e);return this.getRenderedTrackTokens(e,t).rendered})),o=[...this.composeRanks].reverse();if(this.generatedScores=[],this.jabSplit){const e=this.selectedRank,n=[e.melody,e.harmony1,e.harmony2,e.melody].slice(0,t),o=l.map(((e,t)=>this.splitTokensByLimit(e,n[t]))),a=Math.max(...o.map((e=>e.length)));for(let l=0;l<a;l++){const n=[];for(let e=0;e<t;e++){const t=o[e]?.[l]||[],a=this.renderTokens(t);n.push(a)}const a=n.every((e=>""===e));if(a)break;this.generatedScores.push({parts:n,rank:e.name})}}else for(const a of o){const e=[a.melody,a.harmony1,a.harmony2,a.melody].slice(0,t),l=n.every(((t,l)=>t.length<=e[l]));if(l){this.generatedScores.push({parts:n.slice(0,t),rank:a.name});break}}},copyScore(e){const t=this.generatedScores[e],l=`MML@${t.parts.join(",")};`;this.copyToClipboard(l)},copyScorePiece(e,t){const l=this.generatedScores[e];this.copyToClipboard(l.parts[t])}}};const gt=(0,Ee.A)(ft,[["render",kt],["__scopeId","data-v-054bb656"]]);var yt=gt,bt={name:"PianoRoll",components:{HelpMenu:Re,Tracks:je,TempoMarker:Qe,ExportMenu:yt},setup(){const e="../MabiMML/",t=(0,c.KR)(null),l=(0,c.KR)(null),n=(0,c.KR)(null),a=(0,c.KR)(null),r=(0,c.KR)(!1),i=(0,c.KR)({name:"Lute",program:0,min:16,max:88}),s=(0,c.KR)(null),u=(0,c.KR)(120),h=(0,c.KR)(!1),d=(0,c.KR)(!1),m=(0,c.KR)(null),p=(0,c.KR)(window.innerWidth),v=(0,c.KR)([{name:"Lute",program:0,min:16,max:88},{name:"Ukulele",program:1,min:16,max:88},{name:"Mandolin",program:2,min:16,max:88},{name:"Whistle",program:3,min:12,max:88},{name:"Roncadora",program:4,min:12,max:88},{name:"Flute",program:5,min:15,max:88},{name:"Chalumeau",program:6,min:16,max:88},{name:"Tuba",program:18,min:12,max:95},{name:"Lyre",program:19,min:9,max:80},{name:"Electric Guitar",program:20,min:4,max:99},{name:"Piano",program:21,min:0,max:84},{name:"Violin",program:22,min:16,max:59},{name:"Cello",program:23,min:0,max:46},{name:"Harp",program:24,min:9,max:83},{name:"Tuned Violin",program:25,min:16,max:59},{name:"Tuned Cello",program:26,min:0,max:46},{name:"Drum Kit",program:27,min:29,max:53},{name:"Festival Lute",program:50,min:16,max:88},{name:"Festival Ukulele",program:51,min:16,max:88},{name:"Festival Mandolin",program:52,min:16,max:88},{name:"Fest/Tuned Whistle",program:53,min:12,max:83},{name:"Fest/Tuned Flute",program:54,min:15,max:83},{name:"Bass Drum",program:66,min:12,max:84},{name:"Snare Drum",program:67,min:12,max:84},{name:"Cymbals",program:68,min:12,max:84},{name:"Hand Chimes",program:77,min:9,max:80},{name:"Female Chorus",program:110,min:19,max:48},{name:"Male Chorus",program:100,min:14,max:46},{name:"Male Voice",program:120,min:17,max:49},{name:"Female Voice",program:121,min:12,max:45}]);let k=(0,c.KR)(3840),f=(0,c.KR)(8);const g=(0,c.KR)(16),y=24,b=(0,c.KR)([]),L=(0,c.KR)([]),w=(0,c.KR)([]),M=(0,c.KR)([]),T=(0,c.KR)(0),x=(0,c.KR)(0),C=((0,c.KR)(0),(0,c.KR)(0),(0,c.KR)(0),(0,c.KR)(window.innerWidth)),E=(0,c.KR)(null),S=(0,c.KR)(0),R=(0,c.KR)([]),W=(0,c.KR)(!1),K=(0,c.KR)(0),N=(0,c.KR)(0),I=(0,c.KR)(null),$=(0,c.KR)(0),O=(0,c.KR)(0),D=(0,c.KR)([]),P=(0,c.KR)(null),X=(0,c.KR)(!1),A=(0,c.KR)(1),H=(0,o.EW)((()=>({left:`${Math.min(T.value,K.value)}px`,top:`${Math.min(x.value,N.value)+30}px`,width:`${Math.abs(K.value-T.value)}px`,height:`${Math.abs(N.value-x.value)}px`,backgroundColor:"rgba(0, 100, 255, 0.3)",border:"1px solid rgba(0, 100, 255, 0.5)"}))),B=(0,o.EW)((()=>({background:`repeating-linear-gradient( /*This is the horizontal lines*/\n                0deg,\n                #bbb,\n                #bbb 2px,\n                transparent 2px,\n                transparent 24px\n            ),\n            repeating-linear-gradient( /*This is the Bar line*/\n                90deg,\n                #777,\n                #777 2px,\n                transparent 2px,\n                transparent ${256*A.value}px\n            ),\n            repeating-linear-gradient( /*This is the vertical lines*/\n                90deg,\n                #c0c0c0,\n                #c0c0c0 2px,\n                transparent 2px,\n                transparent ${g.value*A.value}px\n            ),\n            repeating-linear-gradient(/*This is the background colors*/\n                90deg,\n                #e0e0e0,\n                #e0e0e0 ${64*A.value}px,\n                #ccc ${64*A.value}px,\n                #ccc ${128*A.value}px\n            )`})));let _=null;function z(){if(!_)return;const e=S.value,t=e+window.innerWidth,l=A.value,n=g.value,o=C.value*l,a=108*y,r=256/n;_.clearRect(0,0,o,a);const i=64*l;_.fillStyle="#e0e0e0";for(let f=0;f<=o;f+=2*i){const t=f-e;_.fillRect(t,0,i,a)}_.fillStyle="#ccc";for(let f=i;f<=o;f+=2*i){const t=f-e;_.fillRect(t,0,i,a)}_.strokeStyle="#bbb",_.lineWidth=2;const s=24,u=Math.ceil(a/s);_.beginPath();for(let f=0;f<=u;f++){const e=f*s;_.moveTo(0,e),_.lineTo(t,e)}if(_.stroke(),l>1/8){_.strokeStyle="#c0c0c0",_.lineWidth=2;let o=0;l>1/8&&l<=.5?o=12==r?4*n*l:8*n*l:l>.5&&l<=7/8?o=4*n*l:l>7/8&&l<2.5?o=2*n*l:l>=2.5&&(o=n*l);const i=Math.max(0,Math.floor(e/o)-1),s=Math.ceil(t/o)+1;_.beginPath();for(let t=i;t<=s;t++){const l=t*o-e;_.moveTo(l,0),_.lineTo(l,a)}_.stroke()}_.strokeStyle="#777",_.lineWidth=2;const c=256*l,h=Math.max(0,Math.floor(e/c)-1),d=Math.ceil(t/c)+1;_.beginPath();for(let f=h;f<=d;f++){const t=f*c-e;_.moveTo(t,0),_.lineTo(t,a)}_.stroke();const m=b.value;if(!m||0===m.length)return;const p=[],v=e/l,k=t/l;for(const f of m){const e=f.left,t=e+f.width;t<v||e>k||(f.muted||p.push(f))}for(const f of p){const t=f.left*l-e,n=f.top,o=(f.width+1)*l-1,a=y;_.fillStyle=kt(f.color,(f.volume+1)/15),_.fillRect(t,n,o,a),_.strokeStyle=f.highlighted?"white":f.color,_.lineWidth=f.highlighted?2:1,_.strokeRect(t,n,o,a);const r=Math.max(0,Math.min(6,o/4)),i=t+o/2,s=n+a+.35*r-1;_.beginPath(),_.arc(i,s,r,Math.PI,0,!1),_.fillStyle="rgba(0, 0, 0, 0.2)",_.fill();const u=Math.min(10,.4*o);_.fillRect(t+o-u,n,u,a),_.font="11px sans-serif",_.fillStyle="#444",_.textAlign="center",_.textBaseline="middle";const c=`${f.name} (${f.volume})`,h=U(_,c,o);h&&_.fillText(h,t+o/2,n+a/2)}}function U(e,t,l){const n="…";if(e.measureText(t).width<=l)return t;let o=t;while(o.length>0)if(o=o.slice(0,-1),e.measureText(o+n).width<=l)return o+n;return""}const j=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],G=["C#","D#","F#","G#","A#"],Y=(0,c.KR)(j.map(((e,t)=>({name:e,index:t,isBlack:G.includes(e)})))),q=(0,c.KR)([0,1,2,3,4,5,6,7,8]),Q=(0,c.KR)(!1),J=(0,c.KR)(""),Z=(0,c.KR)(!1),ee=(0,c.KR)(""),te=(0,c.KR)(16),le=(0,c.KR)(88);let ne=[];(0,o.nT)((()=>{const e=Math.max(...b.value.map((e=>e.left+e.width)),0);C.value=Math.max(e+window.innerWidth/A.value,window.innerWidth/A.value),p.value=window.innerWidth,document.querySelector(".grid-wrapper")&&(S.value=E.value.scrollLeft)})),(0,o.wB)(b,(()=>{z()}),{deep:!0}),(0,o.wB)(C,(async()=>{await(0,o.dY)(),z()}),{deep:!0}),(0,o.wB)(g,(()=>{z()}),{deep:!0});const oe=(e,t,l)=>Ve.addTrack(null,e,t,l),ae=e=>{i.value=e.instrument,He.value=Ae.value.indexOf(e),Ue(!0)},re=async(e,t)=>{},ie=async(e,t)=>{const l=new Set(e.notes.map((e=>e.id)));R.value=R.value.filter((e=>!l.has(e.id))),b.value=b.value.filter((e=>!l.has(e.id)));for(const n of Ae.value)n.notes=n.notes.filter((e=>!l.has(e.id)));D.value=D.value.filter((t=>t.parentTrack.id!==e.id))},se=async e=>{X.value&&$e();const t=Ae.value[e];for(const l of D.value)l.parentTrack===t&&(l.muted=t.isMuted)},ue=(e,t)=>{for(const l of D.value)l.parentTrack===e&&(l.color=t)},ce=async()=>{try{const t=await fetch(e+"soundfonts/mabi_instruments_high_quality.sf3"),l=await t.arrayBuffer();return l}catch(t){return console.error("Failed to load SoundFont:",t),null}},he=e=>{const t="Leave Site? Changes you made may not be saved.";return e.preventDefault(),e.returnValue=t,"message"};(0,o.sV)((async()=>{try{p.value=window.innerWidth;const t=document.querySelector(".grid-wrapper");t&&(E.value=t,t.addEventListener("scroll",Ke),Ke()),document.addEventListener("keydown",We),window.addEventListener("beforeunload",he),a.value=new AudioContext,await a.value.audioWorklet.addModule(e+"worklet_processor.min.js");const l=await ce();if(!l)return;n.value=new F.gV(a.value.destination,l,!0,void 0,{chorusEnabled:!1,reverbEnabled:!1}),n.value.setMainVolume(2),n.value.setLogLevel(!1,!1,!1,!1),await n.value.isReady}catch(t){console.error("Error initializing sequencer or synthesizer:",t)}await(0,o.dY)(),m.value&&(_=m.value.getContext("2d",{alpha:!1}),z())})),(0,o.xo)((()=>{window.removeEventListener("beforeunload",he)}));const de=e=>{0===e.button&&(e.shiftKey?me(e):ve(e))},me=e=>{const t=e.altKey?g.value/4:g.value,l=Math.round((e.clientX-I.value.getBoundingClientRect().left)/t/A.value)*t,n=prompt("Enter tempo (BPM):",u.value);null===n||isNaN(n)||""===n||D.value.push({left:l,tempo:Number(n),color:Be.value.color,parentTrack:Be.value,muted:!1})},pe=(e,t)=>{if(e.preventDefault(),0===e.button){const e=prompt("Enter tempo (BPM):",D.value[t].tempo);if(null===e)return;isNaN(e)||""===e?D.value.splice(t,1):D.value[t].tempo=Number(e)}else 2===e.button&&(D.value[t].parentTrack=Be.value,D.value[t].color=Be.value.color)},ve=e=>{X&&Ne(),Re(e.clientX,e.altKey,!0),document.addEventListener("mousemove",ke),document.addEventListener("mouseup",fe)},ke=e=>{Re(e.clientX,e.altKey,!0)},fe=async()=>{document.removeEventListener("mousemove",ke),document.removeEventListener("mouseup",fe)};let ge,ye,be,Le=0;async function we(){X.value=!0,ye=$.value,be=u.value,D.value.sort(((e,t)=>e.left-t.left)),Me()}function Me(){let e=0;Le=0,be=u.value;let t=D.value[Le];while(t&&t.left<$.value)$.value>0&&(be=t.tempo),Le++,t=D.value[Le];function l(){$.value<0&&(be=u.value,Le=0,e=0,ye=0,$.value=0),t=D.value[Le];while(t&&t.muted)Le++,t=D.value[Le];t&&null!==t&&$.value>=t.left&&(Le++,ye=$.value,e=P.value.currentTime,be=t.tempo),$.value=4*(P.value.currentTime-e)*16*be/60+ye,d.value&&(E.value.scrollLeft=$.value*A.value-.66*window.innerWidth),P.value&&!h.value&&(P.value.loop=h.value)}clearInterval(ge),l(),ge=setInterval(l,20)}const Te=[],xe={};function Ce(e){if(e in xe)return xe[e];let t="",l=e;if(0===Te.length)for(let a=1;a<=64;++a){let e=Math.round(8192/(a/960*64)),t=Math.round(8192/(a/960*64)*1.5);Te.push({length:t,name:a+".",charLength:("L"+a+".").length}),Te.push({length:e,name:a+"",charLength:("L"+a).length})}const n=new Map;for(const a of Te)(!n.has(a.length)||a.charLength<n.get(a.length).charLength)&&n.set(a.length,a);let o=Ee([...n.values()],l);return t=o.noteCombination.map((e=>e.name)).join("&"),xe[e]=o,o}function Ee(e,t){let l=Math.round(32*t);const n=new Map;for(const p of e)(!n.has(p.length)||p.charLength<n.get(p.length).charLength)&&n.set(p.length,p);const o=[...n.values()],a=o.length,r=new Int32Array(a),i=new Int32Array(a);for(let p=0;p<a;p++)r[p]=o[p].length,i[p]=o[p].charLength;const s=2147483647,u=new Uint32Array(l+1);u.fill(s),u[0]=0;const c=new Int32Array(l+1);c.fill(-1);const h=new Int32Array(l+1);h.fill(-1);for(let p=0;p<a;p++){const e=r[p],t=i[p];for(let n=e;n<=l;n++){const l=u[n-e]+t;l<u[n]&&(u[n]=l,c[n]=n-e,h[n]=p)}}if(u[l]===s)return{minChars:null,noteCombination:[]};const d=[];let m=l;while(m>0){const e=h[m];d.push(o[e]),m=c[m]}return{minChars:u[l],noteCombination:d}}const Se=()=>{clearInterval(ge),X.value=!1},Re=(e,t,l)=>{if(I.value){const n=I.value.getBoundingClientRect();let o=Math.round((e-n.left)/A.value/(g.value/4))*(g.value/4),a=g.value*(A.value<=.5?64/g.value:1);t||(o=Math.round(o/a)*a),o=Math.max(0,Math.min(C.value,o)),$.value=o,l&&(O.value=o)}};function We(e){if(!Be.value.isEditingName){if("Backspace"===e.key||"Delete"===e.key){for(const e of R.value)$t(e,!0);X.value&&$e()}if("Space"===e.code)e.preventDefault(),X.value?(Ne(),e.ctrlKey||($.value=O.value)):$e();else if("a"===e.key&&e.ctrlKey&&!Be.value.isEditingName){e.preventDefault();for(const e of b.value)dt(e);Pe(`Selected ${R.value.length} notes!`,1e3)}else if("ArrowUp"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?12:1;for(const e of R.value)if(e.top-y*t<-0)return;for(const e of R.value){e.top-=y*t;const l=(1284-e.top/2)/144,n=j[12*l%12]+""+Math.floor(l);e.name=n,e.pitch=12*l%12+12*(Math.floor(l)+1)}X.value&&$e()}}else if("ArrowDown"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?12:1;for(const e of R.value)if(e.top+y*t>=q.value.length*y*12)return;for(const e of R.value){e.top+=y*t;const l=(1284-e.top/2)/144,n=j[12*l%12]+""+Math.floor(l);e.name=n,e.pitch=12*l%12+12*(Math.floor(l)+1)}X.value&&$e()}}else if("ArrowLeft"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?1:4;for(const e of R.value)if(Math.round(1e3*(e.left-g.value/t))/1e3<0)return;for(const e of R.value)e.left=Math.round(1e3*(e.left-g.value/t))/1e3,e.start=Math.round(e.left/256*3840),e.end=Math.round(e.start+e.length);X.value&&$e()}}else if("ArrowRight"===e.key){if(e.ctrlKey||e.shiftKey){e.preventDefault();let t=e.ctrlKey?1:4;for(const e of R.value)e.left=Math.round(1e3*(e.left+g.value/t))/1e3,e.start=Math.round(e.left/256*3840),e.end=Math.round(e.start+e.length);X.value&&$e()}}else if("c"===e.key&&e.ctrlKey){e.preventDefault(),ne=[];for(const e of R.value)ne.push(e);Pe(`Copied ${ne.length} note${ne.length>1?"s":""} to the clipboard!`,1e3)}else if("x"===e.key&&e.ctrlKey){e.preventDefault(),ne=[];for(const e of R.value)ne.push(e),$t(e,!0);X.value&&$e(),Pe(`Cut ${ne.length} note${ne.length>1?"s":""} and put them in the clipboard!`,1e3)}else if("v"===e.key&&e.ctrlKey){e.preventDefault(),it();const t=Date.now(),l=Be.value,n=l.color,o=S.value,a=A.value,r=g.value,i=b.value.length,s=[];for(let e=0;e<ne.length;e++){const u=ne[e],c=Math.round(4*Math.round((u.left+o/a)*r/4)/r),h={id:t+i+e,name:u.name,left:c,top:u.top,pitch:u.pitch,width:u.width,length:u.length,highlighted:!0,color:n,start:Math.round(c/256*3840),end:Math.round(Math.round(c/256*3840)+u.length),volume:u.volume,muted:!1,track:l};s.push(h)}R.value.push(...s),b.value.push(...s),l.notes.unshift(...s.reverse()),X.value&&$e(),Pe(`Pasted ${ne.length} notes from the clipboard!`,1e3)}else if("t"===e.key&&R.value.length>0){const e=new Set(R.value);for(const t of Ae.value)t.notes=t.notes.filter((t=>!e.has(t)));R.value.forEach((e=>{e.track=Be.value,e.color=Be.value.color})),Be.value.notes.unshift(...[...R.value].reverse()),Pe(`Moved ${R.value.length} notes into track "${Be.value.name}"!`,1e3)}}}function Ke(){E.value&&I.value&&(S.value=E.value.scrollLeft,I.value.style.left=-S.value+"px"),z()}function Ne(){P.value&&P.value.stop(),Se(),n.value.programChange(0,i.value.program)}async function Ie(e="MySong",t=0,l=!1){const o=new F.Hm(e,480,u.value);if(await a.value.resume(),!n.value)return;let r=0,i=[];for(const n of Ae.value)n.isMuted||(i.push(n),o.addNewTrack(n.name+Ae.value.indexOf(n)));i.forEach(((e,t)=>{let l=t>=9?t+1:t;const n=l%16;o.addEvent(0,l,192|n,[e.instrument.program])})),b.value.forEach((e=>{if(!e.muted&&e.left+e.width>=t){let n=e.track;const a=i.indexOf(n)>=9?i.indexOf(n)+1:i.indexOf(n),s=a%16,u=e.pitch,c=e.start/240*120,h=e.length/240*120,d=t/16*120,m=Math.max(c,d)-d,p=Math.min(h,c+h-d),v=Math.max(0,Math.min(127,8*(e.volume+1)-1));o.addNoteOn(m,a,s,u,v),o.addNoteOff(m+p-l,a,s,u),r++}}));for(const n of D.value){if(n.parentTrack.isMuted)continue;const e=n.left/16*120,l=t/16*120,a=Math.max(e,l)-l;o.addSetTempo(a,n.tempo)}if(0===r)return;o.flush(),s.value=o;const c=await(0,F.Nt)(s.value);return c}const $e=async(e=null)=>{try{if(e&&X.value||0===b.value.length)return Ne(),void($.value=O.value);const t=await Ie("untitled",$.value,!0);P.value=new F.YC([{binary:t}],n.value),P.value.skipToFirstNoteOn=!1,P.value.loop=h.value&&0===$.value,await n.value.isReady,P.value.addOnSongEndedEvent((()=>{Se(),$.value=O.value,h.value&&!P.value.loop&&($.value=0,$e())}),"test2"),await P.value.play(),we()}catch(t){console.error("Error playing sequence: ",t)}},Oe=async(e,t,l)=>{try{a.value.resume(),await n.value.isReady,n.value.noteOn(e,t.index+12*(l+1),Math.max(0,Math.min(127,8*(f.value+1)-1)),!1)}catch(o){console.error(o)}},De=async(e,t,l)=>{try{await n.value.isReady,n.value&&n.value.noteOff(e,t.index+12*(l+1))}catch(o){console.error(o)}},Pe=(e,t=2e3)=>{J.value=e,Q.value=!0,setTimeout((()=>{Q.value=!1}),t)},Xe=(e,t=2e3)=>{ee.value=e,Z.value=!0,setTimeout((()=>{Z.value=!1}),t)},Fe=(e,t,l)=>{r.value&&0===L.value.length&&0===w.value.length&&Oe(e,t,l)},ze=(e,t,l)=>{r.value&&0===L.value.length&&0===w.value.length&&De(e,t,l)},Ue=async(e=!1)=>{n.value&&i.value&&(Be.value.instrument=i.value,te.value=i.value.min,le.value=i.value.max,n.value.programChange(He.value,i.value.program),X.value&&!e&&$e(),await n.value.isReady)},je=new Map,Ge=(e,t,l=!0)=>{if(t.preventDefault(),0===t.button&&0===w.value.length&&0===M.value.length){if(e.highlighted?L.value=R.value:(it(),L.value.push(e)),t.shiftKey&&l){const e=Date.now(),t=b.value.length,l=[];for(let n=0;n<L.value.length;n++){const o=L.value[n],a={id:e+t+n,name:o.name,left:o.left,top:o.top,pitch:o.pitch,width:o.width,length:o.length,highlighted:!1,color:o.color,start:o.start,end:o.end,volume:o.volume,muted:!1,track:o.track};l.push(a)}b.value.push(...l),l.forEach((e=>{e.track.notes.unshift(e)}))}for(const e of L.value)je.set(e.id,{x:t.clientX,y:t.clientY,left:e.left,top:e.top});k.value=e.length,f.value=e.volume,He.value=Ae.value.indexOf(e.track),_e.value=e.track.color,document.addEventListener("mousemove",Ye),document.addEventListener("mouseup",qe)}},Ye=e=>{if(L.value&&0===w.value.length&&0===M.value.length){let t=!1;const l=[];let n=!1;for(const r of L.value)if(e.altKey||r.highlighted&&r.left%g.value!==0){n=!0;break}const o=n?g.value/4:g.value;let a=0;for(let r=0;r<L.value.length;++r){const n=L.value[r],i=je.get(n.id);if(!i)continue;const s=(e.clientX-i.x)/A.value,u=e.clientY-i.y;let c=0;0===r?(c=Math.round((i.left+s)/o)*o,a=c-i.left):c=i.left+a;let h=Math.round((i.top+u)/y)*y;if(c<0||h<0||h>2568){t=!0;break}l.push({note:n,newLeft:c,newTop:h})}if(t)return;for(const{note:e,newLeft:r,newTop:i}of l){e.left=r,e.start=Math.round(e.left/256*3840),e.end=Math.round(e.start+e.length),e.top=i;const t=(1284-e.top/2)/144,l=j[12*t%12]+""+Math.floor(t);e.name!=l&&1===L.value.length&&(Oe(0,{name:l,index:12*t%12},Math.floor(t)),De(0,{name:l,index:12*t%12},Math.floor(t))),e.name=l,e.pitch=12*t%12+12*(Math.floor(t)+1)}}},qe=()=>{X.value&&$e(),L.value=[],document.removeEventListener("mousemove",Ye),document.removeEventListener("mouseup",qe),je.clear()},Qe=new Map,Je=(e,t)=>{t.preventDefault(),0===t.button&&(w.value=[],T.value=t.clientX,Qe.clear(),e.highlighted?(R.value.forEach((e=>{Qe.set(e.id,{width:e.width,startX:t.clientX})})),w.value=R.value):(it(),Qe.set(e.id,{width:e.width,startX:t.clientX}),w.value=[e]),document.addEventListener("mousemove",Ze),document.addEventListener("mouseup",et))},Ze=e=>{if(w.value.length>0){let t=!0;const l=[];if(w.value.forEach((n=>{const o=Qe.get(n.id);if(!o)return;const a=(e.clientX-o.startX)/A.value;let r=0;r=e.altKey?Math.round((o.width+a)/(g.value/4))*g.value/4-1:Math.round((o.width+a)/g.value)*g.value-1,r<g.value-1&&!e.altKey||r<3?t=!1:l.push({note:n,newWidth:r})})),t)for(const{note:e,newWidth:n}of l)e.width=n,e.length=(n+1)/256*3840,e.end=e.start+e.length,k.value=e.length}},et=()=>{w.value=[],Qe.clear(),document.removeEventListener("mousemove",Ze),document.removeEventListener("mouseup",et)};let tt=[];const lt=(e,t)=>{t.preventDefault(),0===t.button&&(M.value=[],x.value=t.clientY,e.highlighted?M.value=R.value:(it(),M.value=[e]),tt=M.value.map((e=>e.volume)),document.addEventListener("mousemove",nt),document.addEventListener("mouseup",ot))},nt=e=>{if(e.preventDefault(),M.value.length>0){let t=0;for(const l of M.value){const n=x.value-e.clientY;let o=Math.round(Math.max(1,Math.min(15,tt[t]+n/10)));l.volume=o,f.value=o,t++}}},ot=()=>{M.value=[],X.value&&$e(),document.removeEventListener("mousemove",nt),document.removeEventListener("mouseup",ot)},at=e=>{e.ctrlKey&&L.value.length<=0&&0===e.button?(e.shiftKey||it(),st(e)):pt(e)},rt=e=>{const t=1*-Math.sign(e.deltaY)/8;if(e.ctrlKey){e.preventDefault();const l=A.value,n=E.value.scrollLeft,o=e.clientX-E.value.getBoundingClientRect().left+n;A.value=Math.min(8,Math.max(1/8,Math.round(8*(A.value+t))/8));const a=A.value;E.value.scrollLeft+=o*(a/l-1)}};function it(){R.value.forEach((e=>{e.highlighted=!1})),R.value=[]}const st=e=>{e.preventDefault(),W.value=!0;const t=m.value.getBoundingClientRect();T.value=e.clientX-t.left+S.value,x.value=e.clientY-t.top,K.value=e.clientX-t.left+S.value,N.value=e.clientY-t.top,document.addEventListener("mousemove",ut),document.addEventListener("mouseup",ct)},ut=e=>{if(W.value){const t=m.value.getBoundingClientRect();K.value=e.clientX-t.left+S.value,N.value=e.clientY-t.top}},ct=()=>{W.value&&(W.value=!1,document.removeEventListener("mousemove",ut),document.removeEventListener("mouseup",ct),ht())};function ht(){const e={left:Math.min(T.value,K.value)/A.value,top:Math.min(x.value,N.value),right:Math.max(T.value,K.value)/A.value,bottom:Math.max(x.value,N.value)};b.value.forEach((t=>{const l={left:t.left,top:t.top,right:t.left+t.width,bottom:t.top+y};mt(e,l)&&dt(t)}))}function dt(e){R.value.includes(e)||e.muted||(R.value.push(e),e.highlighted=!0)}function mt(e,t){return!(t.left>=e.right||t.right<=e.left||t.top>=e.bottom||t.bottom<=e.top)}const pt=e=>{if(L.value.length>0||w.value.length>0||M.value.length>0)return;const t=m.value.getBoundingClientRect(),n=(e.clientX-t.left+S.value)/A.value,o=e.clientY-t.top+l.value.scrollTop;let a=Math.round((n-g.value/2)/g.value)*g.value;e.altKey&&(a=Math.round((n-g.value/8)/(g.value/4))*g.value/4);const r=Math.round((o-y/2)/y)*y,i=(1284-r/2)/144,s=j[12*i%12]+""+Math.floor(i);Oe(0,{name:s,index:12*i%12},Math.floor(i)),De(0,{name:s,index:12*i%12},Math.floor(i));const u=b.value.find((e=>e.left<=n&&n<=e.left+e.width+1&&e.top===r&&!e.muted));if(u)if(0===e.button){const t=Math.min(10,.4*(u.width+1))/A.value,l={x:u.left+(u.width+1)/2,y:u.top+y},a=((l.x-n)*A.value)**2+(l.y-o)**2,r=Math.min(6,(u.width+1)/4*A.value);n>=u.left+u.width-t&&n<=u.left+u.width+1?(Je(u,e),He.value=Ae.value.indexOf(u.track),k.value=u.length,f.value=u.volume):a<=r*r?(lt(u,e),He.value=Ae.value.indexOf(u.track),k.value=u.length,f.value=u.volume):Ge(u,e)}else 2===e.button&&$t(u,!1);else{if(0!==e.button)return;it();const t=b.value.length+Date.now(),l={left:a,top:r,width:k.value/3840*256-1,highlighted:!1,color:Be.value?Be.value.color:"hsla(212, 100%, 50%, 0.5)",id:t,name:s,pitch:12*i%12+12*(Math.floor(i)+1),length:k.value,start:Math.round(a/256*3840),end:Math.round(a/256*3840+k.value),volume:f.value,track:Be.value};b.value.push(l),Be.value.notes.unshift(l),Ge(b.value.find((e=>e.id==t)),e,!1)}},vt=()=>{let e=[...Be.value.notes].sort(((e,t)=>e.start===t.start?e.top-t.top:e.start-t.start)),t=[];t.push({notes:[],track:Be.value,index:0});for(const l of e)for(const e of t){if(!e.notes[0]||e.notes[0].end<=l.start){e.notes.unshift(l);break}e.index===t.length-1&&t.push({notes:[],track:{instrument:e.track.instrument,color:null,name:Be.value.name+` (${t.length})`},index:t.length})}if(Ae.value.length+t.length-1>15)Xe("Failed to split track! (Process would create too many tracks!)");else{Pe(`Successfully split the track "${Be.value.name}" into ${t.length} tracks!`,3e3);for(const e of t){Ae.value.includes(e.track)||(e.track=oe(e.track.instrument,e.track.color,e.track.name)),e.track.notes=e.notes;for(const t of e.track.notes)t.track=e.track,t.color=e.track.color}}};function kt(e,t){let l=e.replace("#","");3===l.length&&(l=l.split("").map((e=>e+e)).join(""));const n=parseInt(l.substring(0,2),16),o=parseInt(l.substring(2,4),16),a=parseInt(l.substring(4,6),16);return`rgba(${n}, ${o}, ${a}, ${t})`}function ft(e){navigator.clipboard.writeText(e).then((()=>{J.value="MML copied to clipboard!",Q.value=!0,setTimeout((()=>{Q.value=!1}),2e3)})).catch((e=>{console.error("Could not copy text: ",e)}))}function gt(e){const t=e.length;class l{constructor(e,t,l,n){this.implicitOct=t,this.implicitLen=l,this.implicitVol=n,this.parent=null,this.children=[],this.textValue=e,this.accCost=e.length,this.depth=0}addChild(e){this.children.push(e),e.parent=this,e.accCost+=this.accCost,e.depth=this.depth+1}}function n(e,t,l,n){return`${e}|${t}|${l}|${n}`}const o=new Map,a=new l("",4,960,8),r=new V.Ay(((e,t)=>e.priority-t.priority));let i=null;r.push({node:a,priority:0});while(r.size()>0){const{node:a,priority:s}=r.pop(),u=n(a.depth,a.implicitLen,a.implicitOct,a.implicitVol);if(o.has(u)&&o.get(u)<=s)continue;o.set(u,s);const c=a.depth,h=e[c],d=h?.length,m=h?.dotted,p=Math.floor(3840/d*(m?1.5:1))+(m?".":"");let v=p;if(d===1.5*a.implicitLen&&m&&(v="."),c===t){i=a;break}if("NOTE"===h.type){let e="",t=h.volume===a.implicitVol?"":`V${h.volume}`,n=h.octave-a.implicitOct;e=Math.abs(n)>2?`o${h.octave}`:(n>0?">":"<").repeat(Math.abs(n)),h.length===a.implicitLen?(a.addChild(new l(`${t}${e}${h.name}`,h.octave,a.implicitLen,h.volume)),a.addChild(new l(`${t}N${h.pitch}`,a.implicitOct,a.implicitLen,h.volume)),"b"===h.name&&(n=h.octave+1-a.implicitOct,e=Math.abs(n)>2?`o${h.octave}`:(n>0?">":"<").repeat(Math.abs(n)),a.addChild(new l(`${t}${e}c-`,h.octave+1,a.implicitLen,h.volume))),"c"===h.name&&(n=h.octave-1-a.implicitOct,e=Math.abs(n)>2?`o${h.octave}`:(n>0?">":"<").repeat(Math.abs(n)),a.addChild(new l(`${t}${e}b+`,h.octave-1,a.implicitLen,h.volume)))):(a.addChild(new l(`${t}L${p}${e}${h.name}`,h.octave,h.length,h.volume)),a.addChild(new l(`${t}${e}${h.name}${v}`,h.octave,a.implicitLen,h.volume)),"b"===h.name&&(n=h.octave+1-a.implicitOct,e=Math.abs(n)>2?`o${h.octave}`:(n>0?">":"<").repeat(Math.abs(n)),a.addChild(new l(`${t}L${p}${e}c-`,h.octave+1,h.length,h.volume)),a.addChild(new l(`${t}${e}c-${v}`,h.octave+1,a.implicitLen,h.volume))),"c"===h.name&&(n=h.octave-1-a.implicitOct,e=Math.abs(n)>2?`o${h.octave}`:(n>0?">":"<").repeat(Math.abs(n)),a.addChild(new l(`${t}L${p}${e}b+`,h.octave-1,h.length,h.volume)),a.addChild(new l(`${t}${e}b+${v}`,h.octave-1,a.implicitLen,h.volume))),a.addChild(new l(`${t}L${p}N${h.pitch}`,a.implicitOct,h.length,h.volume)))}else"REST"===h.type?h.length===a.implicitLen?a.addChild(new l(`${h.name}`,a.implicitOct,a.implicitLen,a.implicitVol)):(a.addChild(new l(`L${p}${h.name}`,a.implicitOct,h.length,a.implicitVol)),a.addChild(new l(`${h.name}${v}`,a.implicitOct,a.implicitLen,a.implicitVol))):"TEMPO"===h.type&&a.addChild(new l(`T${h.tempo}`,a.implicitOct,a.implicitLen,a.implicitVol));for(const e of a.children)r.push({node:e,priority:e.accCost})}const s=[];let u=i;while(null!==u)s.push(u.textValue),u=u.parent;return s.reverse().join("")}const yt=e=>{let t=[];for(const o of e.notes){const e=Ce(o.length),l=o.name.slice(0,o.name.length-1).toLowerCase();let n=!1,a=0;for(const r of e.noteCombination)t.push({type:"NOTE",pitch:o.pitch-12,volume:o.volume,length:r.length/32,lengthString:r.name,dotted:r.name.endsWith("."),start:o.start+a,octave:Math.floor((o.pitch-12)/12),name:(n?"&":"")+l}),n=!0,a+=r.length/32}const l=new Map;120!==u.value&&l.set(0,{parentTrack:e,tempo:u.value,left:0});for(const o of D.value)o.parentTrack===e&&l.set(o.left,o);for(const o of l.values())t.push({type:"TEMPO",tempo:o.tempo,start:o.left/256*960*4,length:0});t.sort(((e,t)=>e.start-t.start===0&&"TEMPO"===e.type?-1:e.start-t.start));for(let o=-1;o<t.length-1;++o){const e=o>-1?t[o]:{type:"TEMPO",length:0,start:0},l=t[o+1];if("REST"===e.type||"REST"===l.type)continue;const n=Math.max(0,l.start-(e.start+e.length));if(n>0){const l=Ce(n);let a=0;for(const n of l.noteCombination)t.splice(o+1,0,{type:"REST",length:n.length/32,lengthString:n.name,start:e.start+e.length+a,name:"r",dotted:n.name.endsWith(".")}),a+=n.length/32,o++}}t.filter((e=>"TEMPO"===e.type)),t.filter((e=>"TEMPO"!==e.type));const n=gt(t);return{tokens:t,rendered:n}},bt=e=>{let t=[],l=4,n=!1;if(!e)return;for(const a of e){let e="";"LENGTH"===a.type?(l=a.length,n=a.dotted,e=`L${l}${a.dotted?".":""}`):"OCTAVE"===a.type?e=a.text:"VOLUME"===a.type?e=`V${a.volume}`:"REST"===a.type||"NOTE"===a.type?e=a.name:"TEMPO"===a.type&&(e=`T${a.tempo}`),e&&t.push(e)}let o=t.join("");return o},Lt=(e=null)=>{const t=[e]||0;if(null===t[0]||0===t)return;const l=[];for(const n of t)l.push(yt(n));return l};function wt(e){const t=bt(e);return t}function Mt(e){if(1===e.length)return e;let t=e[0],l=e[1],n=j.indexOf(t);return"#"===l||"+"===l?n=(n+1)%12:"-"===l&&(n=((n-1)%12+12)%12),j[n]}const Tt={LENGTH:/[Ll](\d+)\.?/g,NOTE:/[a-gA-G][-+#]?\d*\.?|N\d+/g,REST:/[Rr]\d*\.?/g,TIE:/&/g,VOLUME:/[Vv](\d+)/g,TEMPO:/[Tt](\d+)/g,OCTAVE:/[Oo](\d+)|[<>]/g};function xt(e){let t=[];for(const[l,n]of Object.entries(Tt)){let o;while(null!==(o=n.exec(e)))t.push({type:l,value:o[0],index:o.index})}return t.sort(((e,t)=>e.index-t.index)),t}function Ct(e,t){let l=[...t],n=oe(v.value[10],null,e),o=4,a="4",r="120",i="8",s=0,u=null;for(let c=0;c<l.length;c++){let e=l[c];if("LENGTH"===e.type){let t=e.value.split("L")[1];t!==a&&(a=t)}else if("TIE"===e.type){if(null===u||null==l[c+1])continue;let e=l[c+1],t=a,n="C",r=o,i=0;if(e.value.startsWith("N")){i=Number(e.value.split("N")[1]),r=Math.floor(i/12),n=j[(i-12*r)%12];let l=t.includes(".");t=Number(t.slice(0,t.length-l))*(l?2/3:1)}else{let l=e.value.includes("#")||e.value.includes("+"),o=e.value.includes("-"),s=e.value.includes(".");n=Mt(e.value.slice(0,1+l+o));let u=j.indexOf(n);if(11===u&&o&&(r-=1),0===u&&l&&(r+=1),e.value.length-s>1+l+o)t=Number(e.value.slice(l||o?2:1,e.value.length-s))*(s?2/3:1);else{let e=a.includes(".");s=e||s,t=Number(a.slice(0,a.length-e))*(s?2/3:1)}i=j.indexOf(n)+12*r}u.pitch-12===i&&(s+=256/t,u.width+=256/t,u.length+=3840/t,u.end+=3840/t,c++)}else if("OCTAVE"===e.type){let t=e.value;"<"===t?o-=1:">"===t?o+=1:o=Number(t.split("O")[1])}else if("VOLUME"===e.type){let t=e.value.split("V")[1];t!==i&&(i=t)}else if("TEMPO"===e.type){let t=e.value.split("T")[1];t!==r&&(r=t,D.value.push({left:s,tempo:Number(r),color:n.color,parentTrack:n,muted:!1}))}else if("REST"===e.type){let t=e.value.split("R")[1];if(t===a||0===Number(t)||isNaN(Number(t))){let e=a.includes(".")||t.includes("."),l=Number(a);s+=256/l*(e?1.5:1)}else{let e=t.includes("."),l=Number(t);s+=256/l*(e?1.5:1)}}else if("NOTE"===e.type){let t=a,l="C",r=o,c=0;if(e.value.startsWith("N")){c=Number(e.value.split("N")[1]),r=Math.floor(c/12),l=j[(c-12*r)%12];let n=t.includes(".");t=Number(t)*(n?2/3:1)}else{let n=e.value.includes("#")||e.value.includes("+"),o=e.value.includes("-"),i=e.value.includes(".");l=Mt(e.value.slice(0,1+n+o));let s=j.indexOf(l);if(11===s&&o&&(r-=1),0===s&&n&&(r+=1),e.value.length-i>1+n+o)t=Number(e.value.slice(n||o?2:1,e.value.length))*(i?2/3:1);else{let e=a.includes(".");i=e||i,t=Number(a)*(i?2/3:1)}c=j.indexOf(l)+12*r}const h={left:s,top:2568-c*y,width:256/t-1,highlighted:!1,color:n.color,id:b.value.length+Date.now(),name:l+r,pitch:c+12,length:3840/t,start:s/256*3840,end:s/256*3840+3840/t,volume:Number(i),track:n};b.value.push(h),h.track.notes.unshift(h),s+=h.width+1,u=h}}}function Et(e){const t=e.replace(/\s/,"").toUpperCase().match(/MML@([^;]+);/)[1].split(",");for(const l of t)l.length>0&&Ct(null,xt(l))}function St(e){const t=e.split("\r\n");let l=[];for(let n=2;n<t.length;++n){let e=t[n].split(" : ");e.length<2||l.push({title:e[0].trim(),tokens:xt(e[1].trim().toUpperCase())})}for(const n of l)n.tokens.length>0&&Ct(n.title,n.tokens)}function Rt(e){e.trim().startsWith("MML@")&&e.trim().endsWith(";")?Et(e):St(e)}function Wt(){const e=document.getElementById("hiddenFileInput");e.click();let t=async()=>{const l=e.files[0];if(e.removeEventListener("change",t),l){const t=new FileReader;t.onload=async function(t){const l=t.target.result;try{const t=new F.eu(l);await t.isReady;const n=t.timeDivision,o=(t.duration,t.tempoChanges.at(-2).tempo),a=Ae.value.length;t.tracks.forEach(((e,t)=>{const l=e.name||`Track ${t}`,o=[],a=[],r=[];let i=!1;e.forEach((e=>{const t=e.messageStatusByte,l=e.messageData,n=e.ticks;if(144===(240&t)&&l[1]>0)o.push({pitch:l[0],ticks:n,velocity:l[1]});else if(128===(240&t)||144===(240&t)&&0===l[1]){const e=l[0],t=n,s=o.findIndex((t=>t.pitch===e));if(-1!==s){const e=o.splice(s,1)[0];i?a.push({pitch:e.pitch,startTicks:e.ticks,velocity:e.velocity,originalEndTicks:t}):r.push({startTicks:e.ticks,pitch:e.pitch,duration:t-e.ticks,velocity:e.velocity})}}else if(176===(240&t)&&64===l[0]){const e=l[1],t=i;if(i=e>=64,t&&!i){for(const e of a)r.push({startTicks:e.startTicks,pitch:e.pitch,duration:n-e.startTicks,velocity:e.velocity});a.length=0}}}));for(const n of o)r.push({startTicks:n.ticks,pitch:n.pitch,duration:0,velocity:n.velocity});for(const n of a)r.push({startTicks:n.startTicks,pitch:n.pitch,duration:n.originalEndTicks-n.startTicks,velocity:n.velocity});if(0!==r.length){const e=oe(v.value[10],null,l);for(const t of r){const l=t.pitch-12,o=Math.floor(l/12),a=j[l%12],r=Math.max(60,Math.round(t.duration/n*960)),i=Math.max(3,4*Math.round(t.duration/n*64/4)-1),s=4*Math.round(t.startTicks/n*64/4),u=Math.floor(t.velocity/8),c={left:s,top:2568-l*y,width:i,highlighted:!1,color:e.color,id:b.value.length+Date.now(),name:a+o,pitch:l+12,length:r,start:Math.round(s/256*3840),end:Math.round(s/256*3840)+r,volume:u,track:e};b.value.push(c),c.track.notes.unshift(c)}}})),u.value=Math.round(o);const r=[];let i=o,s=0;for(const e of t.tempoChanges){if(s++,Math.round(e.tempo)===i||0===e.ticks&&s===t.tempoChanges.length)continue;let l={left:4*Math.round(e.ticks/n*16),tempo:Math.round(e.tempo),color:Ae.value[a].color,parentTrack:Ae.value[a],muted:!1};r.push(l),i=Math.round(e.tempo)}D.value=[...D.value,...r],e.value=""}catch(n){console.error("Error parsing MIDI file:",n)}},t.readAsArrayBuffer(l)}};e.addEventListener("change",t)}async function Kt(){const e=await Ie("MySong",0),t=new Blob([e.buffer],{type:"audio/mid"}),l=URL.createObjectURL(t),n=document.createElement("a");n.href=l,n.download="MySong.mid",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)}async function Nt(){const e=await navigator.clipboard.readText();Rt(e),Pe("Successfully imported tracks from clipboard!",1e3)}function It(e){if(e&&2!==e.buttons)return;const t=m.value.getBoundingClientRect(),n=(e.clientX-t.left+S.value)/A.value,o=e.clientY-t.top+l.value.scrollTop;for(const l of b.value){const t=l.left,a=t+l.width,r=l.top,i=l.top+y,s=t<=n&&n<=a&&o>=r&&o<=i;s&&$t(l,!1,e)}}const $t=(e,t,l=null)=>{if(l&&2!==l.buttons)return;R.value=R.value.filter((t=>t.id!==e.id));let n=b.value.length;b.value=b.value.filter((t=>t.id!==e.id));b.value.length;for(const o of Ae.value)o.notes=o.notes.filter((t=>t.id!==e.id));!t&&X.value&&$e()};return document.addEventListener("mousedown",(e=>{r.value=!0})),document.addEventListener("mouseup",(()=>{r.value=!1})),{notes:Y,octaves:q,startNote:Oe,endNote:De,mouseOverNote:Fe,mouseLeaveNote:ze,instruments:v,selectedInstrument:i,changeInstrument:Ue,pianoRoll:t,grid:l,notesInGrid:b,startDrag:Ge,endDrag:qe,startPlacingNote:pt,startVolumeChange:lt,removeNote:$t,gridWidth:g,gridHeight:y,gridSpan:C,startResize:Je,endResize:et,onResize:Ze,currentNoteLength:k,playSequence:$e,tempo:u,handleGridClick:at,handleGridScroll:rt,isSelecting:W,rectangleStyle:H,handleRulerClick:de,markerPosition:$,markerReplayPosition:O,ruler:I,loopSong:h,trackify:vt,tracks:Ae,backgroundStyle:B,genTokensOutright:Lt,renderTokens:wt,showSuccessNotification:Q,successNotificationText:J,showFailedNotification:Z,failedNotificationText:ee,handleTrackSelected:ae,handleAddTrack:re,handleRemoveTrack:ie,handleMuteTrack:se,instrKeyMin:te,instrKeyMax:le,hexToRgba:kt,currentNoteVolume:f,clickTempoMarker:pe,tempoMarkers:D,updateColor:ue,zoomScalar:A,autoScrollSong:d,parseMMLFromClipboard:Nt,gridCanvas:m,windowWidth:p,scrollX:S,gridWrapper:E,tryRemoveNote:It,importMidi:Wt,exportMidi:Kt,copyToClipboard:ft}}};const Lt=(0,Ee.A)(bt,[["render",X],["__scopeId","data-v-0b657b3d"]]);var wt=Lt;var Mt={name:"PatternEditor",components:{PianoRoll:wt},setup(){const e=(0,c.KR)(null);return{scrollContainer:e}}};const Tt=(0,Ee.A)(Mt,[["render",u],["__scopeId","data-v-f2d0b530"]]);var xt=Tt,Ct={name:"App",components:{PatternEditor:xt}};const Et=(0,Ee.A)(Ct,[["render",r]]);var St=Et;(0,n.Ef)(St).mount("#app")}},t={};function l(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,l),a.exports}l.m=e,function(){var e=[];l.O=function(t,n,o,a){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],o=e[c][1],a=e[c][2];for(var i=!0,s=0;s<n.length;s++)(!1&a||r>=a)&&Object.keys(l.O).every((function(e){return l.O[e](n[s])}))?n.splice(s--,1):(i=!1,a<r&&(r=a));if(i){e.splice(c--,1);var u=o();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,o,a]}}(),function(){l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,{a:t}),t}}(),function(){l.d=function(e,t){for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){l.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){l.p="/MabiMML/"}(),function(){l.b=document.baseURI||self.location.href;var e={524:0};l.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,r=n[0],i=n[1],s=n[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)l.o(i,o)&&(l.m[o]=i[o]);if(s)var c=s(l)}for(t&&t(n);u<r.length;u++)a=r[u],l.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return l.O(c)},n=self["webpackChunkmusic_sequencer"]=self["webpackChunkmusic_sequencer"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=l.O(void 0,[504],(function(){return l(20705)}));n=l.O(n)})();
//# sourceMappingURL=app.5a49e0cb.js.map